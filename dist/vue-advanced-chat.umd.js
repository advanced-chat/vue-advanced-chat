(function(va,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(va=typeof globalThis!="undefined"?globalThis:va||self,r(va["vue-advanced-chat"]={},va.Vue))})(this,function(va,r){"use strict";var Xe=(e,t)=>{const a=e.__vccOpts||e;for(const[n,m]of t)a[n]=m;return a};const w0={name:"AppLoader",props:{show:{type:Boolean,default:!1},infinite:{type:Boolean,default:!1}}},S0=r.createElementVNode("div",{id:"vac-circle"},null,-1);function k0(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-fade-spinner",appear:""},{default:r.withCtx(()=>[a.show?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-loader-wrapper",{"vac-container-center":!a.infinite,"vac-container-top":a.infinite}])},[r.renderSlot(e.$slots,"spinner-icon",r.normalizeProps(r.guardReactiveProps({show:a.show,infinite:a.infinite})),()=>[S0])],2)):r.createCommentVNode("",!0)]),_:3})}var Qr=Xe(w0,[["render",k0]]);const E0={name:"SvgIcon",props:{name:{type:String,default:null},param:{type:String,default:null}},data(){return{svgItem:{search:{path:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},add:{path:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"},toggle:{path:"M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z"},menu:{path:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"},close:{path:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"},file:{path:"M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"},paperclip:{path:"M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"},"close-outline":{path:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},send:{path:"M2,21L23,12L2,3V10L17,12L2,14V21Z"},emoji:{path:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"},document:{path:"M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"},pencil:{path:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"},checkmark:{path:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"},"double-checkmark":{path:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"},eye:{path:"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"},dropdown:{path:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},deleted:{path:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,13.85 4.63,15.55 5.68,16.91L16.91,5.68C15.55,4.63 13.85,4 12,4M12,20A8,8 0 0,0 20,12C20,10.15 19.37,8.45 18.32,7.09L7.09,18.32C8.45,19.37 10.15,20 12,20Z"},microphone:{size:"large",path:"M432.8,216.4v39.2c0,45.2-15.3,84.3-45.2,118.4c-29.8,33.2-67.3,52.8-111.6,57.9v40.9h78.4c5.1,0,10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6c0,5.1-1.7,10.2-6,13.6c-4.3,4.3-8.5,6-13.6,6H157.6c-5.1,0-10.2-1.7-13.6-6c-4.3-4.3-6-8.5-6-13.6c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6H236v-40.9c-44.3-5.1-81.8-23.9-111.6-57.9s-45.2-73.3-45.2-118.4v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6s10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6v39.2c0,37.5,13.6,70.7,40,97.1s59.6,40,97.1,40s70.7-13.6,97.1-40c26.4-26.4,40-59.6,40-97.1v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6c5.1,0,10.2,1.7,13.6,6C430.2,206.2,432.8,211.3,432.8,216.4z M353.5,98v157.6c0,27.3-9.4,50.3-29,69c-19.6,19.6-42.6,29-69,29s-50.3-9.4-69-29c-19.6-19.6-29-42.6-29-69V98c0-27.3,9.4-50.3,29-69c19.6-19.6,42.6-29,69-29s50.3,9.4,69,29C344.2,47.7,353.5,71.6,353.5,98z"},"audio-play":{size:"medium",path:"M43.331,21.237L7.233,0.397c-0.917-0.529-2.044-0.529-2.96,0c-0.916,0.528-1.48,1.505-1.48,2.563v41.684   c0,1.058,0.564,2.035,1.48,2.563c0.458,0.268,0.969,0.397,1.48,0.397c0.511,0,1.022-0.133,1.48-0.397l36.098-20.84   c0.918-0.529,1.479-1.506,1.479-2.564S44.247,21.767,43.331,21.237z"},"audio-pause":{size:"medium",path:"M17.991,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C4.729,2.969,7.698,0,11.36,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z",path2:"M42.877,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C29.616,2.969,32.585,0,36.246,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z"}}}},computed:{svgId(){const e=this.param?"-"+this.param:"";return`vac-icon-${this.name}${e}`},size(){const e=this.svgItem[this.name];return e.size==="large"?512:e.size==="medium"?48:24}}},M0=["viewBox"],R0=["id","d"],A0=["id","d"];function T0(e,t,a,n,m,s){return r.openBlock(),r.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"24",height:"24",viewBox:`0 0 ${s.size} ${s.size}`},[r.createElementVNode("path",{id:s.svgId,d:m.svgItem[a.name].path},null,8,R0),m.svgItem[a.name].path2?(r.openBlock(),r.createElementBlock("path",{key:0,id:s.svgId,d:m.svgItem[a.name].path2},null,8,A0)):r.createCommentVNode("",!0)],8,M0)}var bt=Xe(E0,[["render",T0]]);const B0={name:"RoomsSearch",components:{SvgIcon:bt},props:{textMessages:{type:Object,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0}},emits:["search-room","add-room"],computed:{showSearchBar(){return this.showSearch||this.showAddRoom}}},C0={key:0,class:"vac-icon-search"},O0=["placeholder"];function N0(e,t,a,n,m,s){const R=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass({"vac-box-search":s.showSearchBar,"vac-box-empty":!s.showSearchBar})},[a.showSearch?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[!a.loadingRooms&&a.rooms.length?(r.openBlock(),r.createElementBlock("div",C0,[r.renderSlot(e.$slots,"search-icon",{},()=>[r.createVNode(R,{name:"search"})])])):r.createCommentVNode("",!0),!a.loadingRooms&&a.rooms.length?(r.openBlock(),r.createElementBlock("input",{key:1,type:"search",placeholder:a.textMessages.SEARCH,autocomplete:"off",class:"vac-input",onInput:t[0]||(t[0]=E=>e.$emit("search-room",E))},null,40,O0)):r.createCommentVNode("",!0)],64)):r.createCommentVNode("",!0),a.showAddRoom?(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-svg-button vac-add-icon",onClick:t[1]||(t[1]=E=>e.$emit("add-room"))},[r.renderSlot(e.$slots,"add-icon",{},()=>[r.createVNode(R,{name:"add"})])])):r.createCommentVNode("",!0)],2)}var I0=Xe(B0,[["render",N0]]),wt={},Ka={};Ka.__esModule=!0,Ka.inherits=L0;function L0(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Object.create(e.prototype);for(var m in a)n[m]=a[m];return n.constructor=t,t.prototype=n,t}var fr={};fr.__esModule=!0;var V0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt={defaultProtocol:"http",events:null,format:Ws,formatHref:Ws,nl2br:!1,tagName:"a",target:H0,validate:!0,ignoreTags:[],attributes:null,className:"linkified"};fr.defaults=Vt,fr.Options=Zs,fr.contains=j0;function Zs(e){e=e||{},this.defaultProtocol=e.hasOwnProperty("defaultProtocol")?e.defaultProtocol:Vt.defaultProtocol,this.events=e.hasOwnProperty("events")?e.events:Vt.events,this.format=e.hasOwnProperty("format")?e.format:Vt.format,this.formatHref=e.hasOwnProperty("formatHref")?e.formatHref:Vt.formatHref,this.nl2br=e.hasOwnProperty("nl2br")?e.nl2br:Vt.nl2br,this.tagName=e.hasOwnProperty("tagName")?e.tagName:Vt.tagName,this.target=e.hasOwnProperty("target")?e.target:Vt.target,this.validate=e.hasOwnProperty("validate")?e.validate:Vt.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||Vt.attributes,this.className=e.hasOwnProperty("className")?e.className:e.linkClass||Vt.className;for(var t=e.hasOwnProperty("ignoreTags")?e.ignoreTags:Vt.ignoreTags,a=0;a<t.length;a++)this.ignoreTags.push(t[a].toUpperCase())}Zs.prototype={resolve:function(t){var a=t.toHref(this.defaultProtocol);return{formatted:this.get("format",t.toString(),t),formattedHref:this.get("formatHref",a,t),tagName:this.get("tagName",a,t),className:this.get("className",a,t),target:this.get("target",a,t),events:this.getObject("events",a,t),attributes:this.getObject("attributes",a,t)}},check:function(t){return this.get("validate",t.toString(),t)},get:function(t,a,n){var m=void 0,s=this[t];if(!s)return s;switch(typeof s=="undefined"?"undefined":V0(s)){case"function":return s(a,n.type);case"object":return m=s.hasOwnProperty(n.type)?s[n.type]:Vt[t],typeof m=="function"?m(a,n.type):m}return s},getObject:function(t,a,n){var m=this[t];return typeof m=="function"?m(a,n.type):m}};function j0(e,t){for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1}function Ws(e){return e}function H0(e,t){return t==="url"?"_blank":null}var ta={},da={};da.__esModule=!0,da.stateify=da.TokenState=da.CharacterState=void 0;var Qs=Ka;function Uo(){return function(e){this.j=[],this.T=e||null}}var zo=Uo();zo.prototype={defaultTransition:!1,on:function(t,a){if(t instanceof Array){for(var n=0;n<t.length;n++)this.j.push([t[n],a]);return this}return this.j.push([t,a]),this},next:function(t){for(var a=0;a<this.j.length;a++){var n=this.j[a],m=n[0],s=n[1];if(this.test(t,m))return s}return this.defaultTransition},accepts:function(){return!!this.T},test:function(t,a){return t===a},emit:function(){return this.T}};var qo=(0,Qs.inherits)(zo,Uo(),{test:function(t,a){return t===a||a instanceof RegExp&&a.test(t)}}),P0=(0,Qs.inherits)(zo,Uo(),{jump:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=this.next(new t(""));return n===this.defaultTransition?(n=new this.constructor(a),this.on(t,n)):a&&(n.T=a),n},test:function(t,a){return t instanceof a}});function F0(e,t,a,n){for(var m=0,s=e.length,R=t,E=[],N=void 0;m<s&&(N=R.next(e[m]));)R=N,m++;if(m>=s)return[];for(;m<s-1;)N=new qo(n),E.push(N),R.on(e[m],N),R=N,m++;return N=new qo(a),E.push(N),R.on(e[s-1],N),E}da.CharacterState=qo,da.TokenState=P0,da.stateify=F0;var Se={},$r={};$r.__esModule=!0;function D0(){return function(e){e&&(this.v=e)}}$r.createTokenClass=D0,Se.__esModule=!0,Se.AMPERSAND=Se.CLOSEPAREN=Se.CLOSEANGLEBRACKET=Se.CLOSEBRACKET=Se.CLOSEBRACE=Se.OPENPAREN=Se.OPENANGLEBRACKET=Se.OPENBRACKET=Se.OPENBRACE=Se.WS=Se.TLD=Se.SYM=Se.UNDERSCORE=Se.SLASH=Se.MAILTO=Se.PROTOCOL=Se.QUERY=Se.POUND=Se.PLUS=Se.NUM=Se.NL=Se.LOCALHOST=Se.PUNCTUATION=Se.DOT=Se.COLON=Se.AT=Se.DOMAIN=Se.Base=void 0;var $s=$r,U0=Ka,Xo=(0,$s.createTokenClass)();Xo.prototype={toString:function(){return this.v+""}};function Ye(e){var t=e?{v:e}:{};return(0,U0.inherits)(Xo,(0,$s.createTokenClass)(),t)}var z0=Ye(),q0=Ye("@"),X0=Ye(":"),Y0=Ye("."),G0=Ye(),K0=Ye(),Z0=Ye(`
`),W0=Ye(),Q0=Ye("+"),$0=Ye("#"),J0=Ye(),el=Ye("mailto:"),tl=Ye("?"),al=Ye("/"),rl=Ye("_"),ol=Ye(),sl=Ye(),nl=Ye(),il=Ye("{"),ll=Ye("["),cl=Ye("<"),dl=Ye("("),ml=Ye("}"),hl=Ye("]"),ul=Ye(">"),fl=Ye(")"),_l=Ye("&");Se.Base=Xo,Se.DOMAIN=z0,Se.AT=q0,Se.COLON=X0,Se.DOT=Y0,Se.PUNCTUATION=G0,Se.LOCALHOST=K0,Se.NL=Z0,Se.NUM=W0,Se.PLUS=Q0,Se.POUND=$0,Se.QUERY=tl,Se.PROTOCOL=J0,Se.MAILTO=el,Se.SLASH=al,Se.UNDERSCORE=rl,Se.SYM=ol,Se.TLD=sl,Se.WS=nl,Se.OPENBRACE=il,Se.OPENBRACKET=ll,Se.OPENANGLEBRACKET=cl,Se.OPENPAREN=dl,Se.CLOSEBRACE=ml,Se.CLOSEBRACKET=hl,Se.CLOSEANGLEBRACKET=ul,Se.CLOSEPAREN=fl,Se.AMPERSAND=_l,ta.__esModule=!0,ta.start=ta.run=ta.TOKENS=ta.State=void 0;var ga=da,Ie=Se,pl=vl(Ie);function vl(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var Js="aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|"),Yo="0123456789".split(""),Jr="0123456789abcdefghijklmnopqrstuvwxyz".split(""),en=[" ","\f","\r","	","\v","\xA0","\u1680","\u180E"],Mt=[],ze=function(t){return new ga.CharacterState(t)},qt=ze(),Go=ze(Ie.NUM),Za=ze(Ie.DOMAIN),_r=ze(),Ko=ze(Ie.WS);qt.on("@",ze(Ie.AT)).on(".",ze(Ie.DOT)).on("+",ze(Ie.PLUS)).on("#",ze(Ie.POUND)).on("?",ze(Ie.QUERY)).on("/",ze(Ie.SLASH)).on("_",ze(Ie.UNDERSCORE)).on(":",ze(Ie.COLON)).on("{",ze(Ie.OPENBRACE)).on("[",ze(Ie.OPENBRACKET)).on("<",ze(Ie.OPENANGLEBRACKET)).on("(",ze(Ie.OPENPAREN)).on("}",ze(Ie.CLOSEBRACE)).on("]",ze(Ie.CLOSEBRACKET)).on(">",ze(Ie.CLOSEANGLEBRACKET)).on(")",ze(Ie.CLOSEPAREN)).on("&",ze(Ie.AMPERSAND)).on([",",";","!",'"',"'"],ze(Ie.PUNCTUATION)),qt.on(`
`,ze(Ie.NL)).on(en,Ko),Ko.on(en,Ko);for(var Zo=0;Zo<Js.length;Zo++){var gl=(0,ga.stateify)(Js[Zo],qt,Ie.TLD,Ie.DOMAIN);Mt.push.apply(Mt,gl)}var tn=(0,ga.stateify)("file",qt,Ie.DOMAIN,Ie.DOMAIN),an=(0,ga.stateify)("ftp",qt,Ie.DOMAIN,Ie.DOMAIN),rn=(0,ga.stateify)("http",qt,Ie.DOMAIN,Ie.DOMAIN),on=(0,ga.stateify)("mailto",qt,Ie.DOMAIN,Ie.DOMAIN);Mt.push.apply(Mt,tn),Mt.push.apply(Mt,an),Mt.push.apply(Mt,rn),Mt.push.apply(Mt,on);var bl=tn.pop(),yl=an.pop(),xl=rn.pop(),wl=on.pop(),eo=ze(Ie.DOMAIN),to=ze(Ie.PROTOCOL),Sl=ze(Ie.MAILTO);yl.on("s",eo).on(":",to),xl.on("s",eo).on(":",to),Mt.push(eo),bl.on(":",to),eo.on(":",to),wl.on(":",Sl);var kl=(0,ga.stateify)("localhost",qt,Ie.LOCALHOST,Ie.DOMAIN);Mt.push.apply(Mt,kl),qt.on(Yo,Go),Go.on("-",_r).on(Yo,Go).on(Jr,Za),Za.on("-",_r).on(Jr,Za);for(var Wo=0;Wo<Mt.length;Wo++)Mt[Wo].on("-",_r).on(Jr,Za);_r.on("-",_r).on(Yo,Za).on(Jr,Za),qt.defaultTransition=ze(Ie.SYM);var El=function(t){for(var a=t.replace(/[A-Z]/g,function(x){return x.toLowerCase()}),n=t.length,m=[],s=0;s<n;){for(var R=qt,E=null,N=0,L=null,k=-1;s<n&&(E=R.next(a[s]));)R=E,R.accepts()?(k=0,L=R):k>=0&&k++,N++,s++;if(!(k<0)){s-=k,N-=k;var f=L.emit();m.push(new f(t.substr(s-N,N)))}}return m},Ml=qt;ta.State=ga.CharacterState,ta.TOKENS=pl,ta.run=El,ta.start=Ml;var aa={},Tt={};Tt.__esModule=!0,Tt.URL=Tt.TEXT=Tt.NL=Tt.EMAIL=Tt.MAILTOEMAIL=Tt.Base=void 0;var Wa=$r,pr=Ka,vr=Se;function Rl(e){return e instanceof vr.DOMAIN||e instanceof vr.TLD}var ka=(0,Wa.createTokenClass)();ka.prototype={type:"token",isLink:!1,toString:function(){for(var t=[],a=0;a<this.v.length;a++)t.push(this.v[a].toString());return t.join("")},toHref:function(){return this.toString()},toObject:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(t)}}};var Al=(0,pr.inherits)(ka,(0,Wa.createTokenClass)(),{type:"email",isLink:!0}),Tl=(0,pr.inherits)(ka,(0,Wa.createTokenClass)(),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),Bl=(0,pr.inherits)(ka,(0,Wa.createTokenClass)(),{type:"text"}),Cl=(0,pr.inherits)(ka,(0,Wa.createTokenClass)(),{type:"nl"}),Ol=(0,pr.inherits)(ka,(0,Wa.createTokenClass)(),{type:"url",isLink:!0,toHref:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",a=!1,n=!1,m=this.v,s=[],R=0;m[R]instanceof vr.PROTOCOL;)a=!0,s.push(m[R].toString().toLowerCase()),R++;for(;m[R]instanceof vr.SLASH;)n=!0,s.push(m[R].toString()),R++;for(;Rl(m[R]);)s.push(m[R].toString().toLowerCase()),R++;for(;R<m.length;R++)s.push(m[R].toString());return s=s.join(""),a||n||(s=t+"://"+s),s},hasProtocol:function(){return this.v[0]instanceof vr.PROTOCOL}});Tt.Base=ka,Tt.MAILTOEMAIL=Al,Tt.EMAIL=Tl,Tt.NL=Cl,Tt.TEXT=Bl,Tt.URL=Ol,aa.__esModule=!0,aa.start=aa.run=aa.TOKENS=aa.State=void 0;var sn=da,Bt=Tt,Nl=Il(Bt),he=Se;function Il(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}var Ve=function(t){return new sn.TokenState(t)},ao=Ve(),nn=Ve(),ln=Ve(),Qo=Ve(),cn=Ve(),ba=Ve(),ro=Ve(),gr=Ve(Bt.URL),dn=Ve(),mn=Ve(Bt.URL),et=Ve(Bt.URL),br=Ve(),yr=Ve(),xr=Ve(),wr=Ve(),Sr=Ve(),Ea=Ve(Bt.URL),Ma=Ve(Bt.URL),Ra=Ve(Bt.URL),Aa=Ve(Bt.URL),kr=Ve(),Er=Ve(),Mr=Ve(),Rr=Ve(),Qa=Ve(),$o=Ve(),oo=Ve(Bt.EMAIL),hn=Ve(),Ll=Ve(Bt.EMAIL),Ta=Ve(Bt.MAILTOEMAIL),Jo=Ve(),$a=Ve(),so=Ve(),un=Ve(),Vl=Ve(Bt.NL);ao.on(he.NL,Vl).on(he.PROTOCOL,nn).on(he.MAILTO,ln).on(he.SLASH,Qo),nn.on(he.SLASH,Qo),Qo.on(he.SLASH,cn),ao.on(he.TLD,ba).on(he.DOMAIN,ba).on(he.LOCALHOST,gr).on(he.NUM,ba),cn.on(he.TLD,et).on(he.DOMAIN,et).on(he.NUM,et).on(he.LOCALHOST,et),ba.on(he.DOT,ro),Qa.on(he.DOT,$o),ro.on(he.TLD,gr).on(he.DOMAIN,ba).on(he.NUM,ba).on(he.LOCALHOST,ba),$o.on(he.TLD,oo).on(he.DOMAIN,Qa).on(he.NUM,Qa).on(he.LOCALHOST,Qa),gr.on(he.DOT,ro),oo.on(he.DOT,$o),gr.on(he.COLON,dn).on(he.SLASH,et),dn.on(he.NUM,mn),mn.on(he.SLASH,et),oo.on(he.COLON,hn),hn.on(he.NUM,Ll);var St=[he.DOMAIN,he.AT,he.LOCALHOST,he.NUM,he.PLUS,he.POUND,he.PROTOCOL,he.SLASH,he.TLD,he.UNDERSCORE,he.SYM,he.AMPERSAND],kt=[he.COLON,he.DOT,he.QUERY,he.PUNCTUATION,he.CLOSEBRACE,he.CLOSEBRACKET,he.CLOSEANGLEBRACKET,he.CLOSEPAREN,he.OPENBRACE,he.OPENBRACKET,he.OPENANGLEBRACKET,he.OPENPAREN];et.on(he.OPENBRACE,yr).on(he.OPENBRACKET,xr).on(he.OPENANGLEBRACKET,wr).on(he.OPENPAREN,Sr),br.on(he.OPENBRACE,yr).on(he.OPENBRACKET,xr).on(he.OPENANGLEBRACKET,wr).on(he.OPENPAREN,Sr),yr.on(he.CLOSEBRACE,et),xr.on(he.CLOSEBRACKET,et),wr.on(he.CLOSEANGLEBRACKET,et),Sr.on(he.CLOSEPAREN,et),Ea.on(he.CLOSEBRACE,et),Ma.on(he.CLOSEBRACKET,et),Ra.on(he.CLOSEANGLEBRACKET,et),Aa.on(he.CLOSEPAREN,et),kr.on(he.CLOSEBRACE,et),Er.on(he.CLOSEBRACKET,et),Mr.on(he.CLOSEANGLEBRACKET,et),Rr.on(he.CLOSEPAREN,et),yr.on(St,Ea),xr.on(St,Ma),wr.on(St,Ra),Sr.on(St,Aa),yr.on(kt,kr),xr.on(kt,Er),wr.on(kt,Mr),Sr.on(kt,Rr),Ea.on(St,Ea),Ma.on(St,Ma),Ra.on(St,Ra),Aa.on(St,Aa),Ea.on(kt,Ea),Ma.on(kt,Ma),Ra.on(kt,Ra),Aa.on(kt,Aa),kr.on(St,Ea),Er.on(St,Ma),Mr.on(St,Ra),Rr.on(St,Aa),kr.on(kt,kr),Er.on(kt,Er),Mr.on(kt,Mr),Rr.on(kt,Rr),et.on(St,et),br.on(St,et),et.on(kt,br),br.on(kt,br),ln.on(he.TLD,Ta).on(he.DOMAIN,Ta).on(he.NUM,Ta).on(he.LOCALHOST,Ta),Ta.on(St,Ta).on(kt,Jo),Jo.on(St,Ta).on(kt,Jo);var Ar=[he.DOMAIN,he.NUM,he.PLUS,he.POUND,he.QUERY,he.UNDERSCORE,he.SYM,he.AMPERSAND,he.TLD];ba.on(Ar,$a).on(he.AT,so),gr.on(Ar,$a).on(he.AT,so),ro.on(Ar,$a),$a.on(Ar,$a).on(he.AT,so).on(he.DOT,un),un.on(Ar,$a),so.on(he.TLD,Qa).on(he.DOMAIN,Qa).on(he.LOCALHOST,oo);var jl=function(t){for(var a=t.length,n=0,m=[],s=[];n<a;){for(var R=ao,E=null,N=null,L=0,k=null,f=-1;n<a&&!(E=R.next(t[n]));)s.push(t[n++]);for(;n<a&&(N=E||R.next(t[n]));)E=null,R=N,R.accepts()?(f=0,k=R):f>=0&&f++,n++,L++;if(f<0)for(var x=n-L;x<n;x++)s.push(t[x]);else{s.length>0&&(m.push(new Bt.TEXT(s)),s=[]),n-=f,L-=f;var y=k.emit();m.push(new y(t.slice(n-L,n)))}}return s.length>0&&m.push(new Bt.TEXT(s)),m};aa.State=sn.TokenState,aa.TOKENS=Nl,aa.run=jl,aa.start=ao,wt.__esModule=!0,wt.tokenize=wt.test=wt.scanner=wt.parser=wt.options=wt.inherits=wt.find=void 0;var Hl=Ka,Pl=fr,Fl=es(Pl),Dl=ta,fn=es(Dl),Ul=aa,_n=es(Ul);function es(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"});var ts=function(t){return _n.run(fn.run(t))},zl=function(t){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=ts(t),m=[],s=0;s<n.length;s++){var R=n[s];R.isLink&&(!a||R.type===a)&&m.push(R.toObject())}return m},ql=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=ts(t);return n.length===1&&n[0].isLink&&(!a||n[0].type===a)};wt.find=zl,wt.inherits=Hl.inherits,wt.options=Fl,wt.parser=_n,wt.scanner=fn,wt.test=ql,wt.tokenize=ts;var pn=wt,Xl=(e,t,a)=>{const n={bold:a.bold,italic:a.italic,strike:a.strike,underline:a.underline,multilineCode:a.multilineCode,inlineCode:a.inlineCode},m={[n.bold]:{end:"\\"+n.bold,allowed_chars:".",type:"bold"},[n.italic]:{end:n.italic,allowed_chars:".",type:"italic"},[n.strike]:{end:n.strike,allowed_chars:".",type:"strike"},[n.underline]:{end:n.underline,allowed_chars:".",type:"underline"},[n.multilineCode]:{end:n.multilineCode,allowed_chars:`(.|
)`,type:"multiline-code"},[n.inlineCode]:{end:n.inlineCode,allowed_chars:".",type:"inline-code"},"<usertag>":{allowed_chars:".",end:"</usertag>",type:"tag"}},s=no(e,m),R=Yl(s,m),E=[].concat.apply([],R);return t&&Kl(E),E};function no(e,t){let a=[],n=-1,m=null,s=pn.find(e),R=!1;if(s.length>0&&(n=e.indexOf(s[0].value),R=!0),Object.keys(t).forEach(E=>{const N=e.indexOf(E);N>=0&&(n<0||N<n)&&(n=N,m=E,R=!1)}),R&&m!==-1){let E=e.substr(0,n),N=e.substr(n,s[0].value.length),L=e.substr(n+s[0].value.length);return a.push(E),a.push(N),a=a.concat(no(L,t)),a}if(m){let E=e.substr(0,n);const N=m;let L=e.substr(n+N.length);if(e.replace(/\s/g,"").length===N.length*2)return[e];const k=L.match(new RegExp("^("+(t[N].allowed_chars||".")+"*"+(t[N].end?"?":"")+")"+(t[N].end?"("+t[N].end+")":""),"m"));if(!k||!k[1])E=E+N,a.push(E);else{E&&a.push(E);const f={start:N,content:no(k[1],t),end:k[2],type:t[N].type};a.push(f),L=L.substr(k[0].length)}return a=a.concat(no(L,t)),a}else return e?[e]:[]}function Yl(e,t){const a=[];return e.forEach(n=>{typeof n=="string"?a.push({types:[],value:n}):t[n.start]&&a.push(Gl(n))}),a}function Gl(e){const t=[];return vn(e,t,[]),t}function vn(e,t,a){e.content.forEach(n=>{typeof n=="string"?t.push({types:gn(a.concat([e.type])),value:n}):vn(n,t,gn([n.type].concat([e.type]).concat(a)))})}function gn(e){return[...new Set(e)]}function Kl(e){const t=[];return e.forEach(a=>{const n=pn.find(a.value);if(n.length){const m=a.value.replace(n[0].value,"");t.push({types:a.types,value:m}),a.types=["url"].concat(a.types),a.href=n[0].href,a.value=n[0].value}t.push(a)}),t}const as=["png","jpg","jpeg","webp","svg","gif"],bn=["mp4","video/ogg","webm","quicktime"],Zl=["mp3","audio/ogg","wav","mpeg"],Wl={name:"FormatMessage",components:{SvgIcon:bt},props:{content:{type:[String,Number],required:!0},deleted:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},linkify:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!1},reply:{type:Boolean,default:!1},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["open-user-tag"],computed:{linkifiedMessage(){const e=Xl(this.formatTags(this.content),this.linkify&&!this.linkOptions.disabled,this.textFormatting);return e.forEach(t=>{t.url=this.checkType(t,"url"),t.bold=this.checkType(t,"bold"),t.italic=this.checkType(t,"italic"),t.strike=this.checkType(t,"strike"),t.underline=this.checkType(t,"underline"),t.inline=this.checkType(t,"inline-code"),t.multiline=this.checkType(t,"multiline-code"),t.tag=this.checkType(t,"tag"),t.image=this.checkImageType(t),t.value=this.replaceEmojiByElement(t.value)}),e},formattedContent(){return this.formatTags(this.content)}},methods:{checkType(e,t){return e.types.indexOf(t)!==-1},checkImageType(e){let t=e.value.lastIndexOf(".");e.value.lastIndexOf("/")>t&&(t=-1);const n=e.value.substring(t+1,e.value.length),m=t>0&&as.some(s=>n.toLowerCase().includes(s));return m&&this.setImageSize(e),m},setImageSize(e){const t=new Image;t.src=e.value,t.addEventListener("load",a);function a(n){const m=n.path[0].width/150;e.height=Math.round(n.path[0].height/m)+"px",t.removeEventListener("load",a)}},formatTags(e){const t="<usertag>",a="</usertag>",n=[...e.matchAll(new RegExp(t,"gi"))].map(s=>s.index),m=e;return n.forEach(s=>{const R=m.substring(s+t.length,m.indexOf(a,s)),E=this.users.find(N=>N._id===R);e=e.replaceAll(R,`@${(E==null?void 0:E.username)||"unknown"}`)}),e},openTag(e){if(!this.singleLine&&this.checkType(e,"tag")){const t=this.users.find(a=>e.value.indexOf(a.username)!==-1);this.$emit("open-user-tag",t)}},replaceEmojiByElement(e){let t;return this.singleLine?t=16:t=this.containsOnlyEmojis()?28:20,e.replaceAll(/[\p{Extended_Pictographic}\u{1F3FB}-\u{1F3FF}\u{1F9B0}-\u{1F9B3}]/gu,a=>`<span style="font-size: ${t}px">${a}</span>`)},containsOnlyEmojis(){const e=this.content.replace(new RegExp("[\0-\u1EEFf]","g"),""),t=this.content.replace(new RegExp(`[
\rs]+|( )+`,"g"),"");return e.length===t.length}}},Ql={class:"vac-image-link-container"},$l={class:"vac-image-link-message"},Jl=["innerHTML"],ec=["innerHTML"];function tc(e,t,a,n,m,s){const R=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(["vac-format-message-wrapper",{"vac-text-ellipsis":a.singleLine}])},[a.textFormatting.disabled?(r.openBlock(),r.createElementBlock("div",{key:1,innerHTML:s.formattedContent},null,8,ec)):(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass({"vac-text-ellipsis":a.singleLine})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.linkifiedMessage,(E,N)=>(r.openBlock(),r.createElementBlock("div",{key:N,class:"vac-format-container"},[(r.openBlock(),r.createBlock(r.resolveDynamicComponent(E.url?"a":"span"),{class:r.normalizeClass({"vac-text-ellipsis":a.singleLine,"vac-text-bold":E.bold,"vac-text-italic":a.deleted||E.italic,"vac-text-strike":E.strike,"vac-text-underline":E.underline,"vac-text-inline-code":!a.singleLine&&E.inline,"vac-text-multiline-code":!a.singleLine&&E.multiline,"vac-text-tag":!a.singleLine&&!a.reply&&E.tag}),href:E.href,target:E.href?a.linkOptions.target:null,rel:E.href?a.linkOptions.rel:null,onClick:L=>s.openTag(E)},{default:r.withCtx(()=>[r.renderSlot(e.$slots,"deleted-icon",r.normalizeProps(r.guardReactiveProps({deleted:a.deleted})),()=>[a.deleted?(r.openBlock(),r.createBlock(R,{key:0,name:"deleted",class:"vac-icon-deleted"})):r.createCommentVNode("",!0)]),E.url&&E.image?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[r.createElementVNode("div",Ql,[r.createElementVNode("div",{class:"vac-image-link",style:r.normalizeStyle({"background-image":`url('${E.value}')`,height:E.height})},null,4)]),r.createElementVNode("div",$l,[r.createElementVNode("span",null,r.toDisplayString(E.value),1)])],64)):(r.openBlock(),r.createElementBlock("span",{key:1,innerHTML:E.value},null,8,Jl))]),_:2},1032,["class","href","target","rel","onClick"]))]))),128))],2))],2)}var Tr=Xe(Wl,[["render",tc]]);const Ba="__v-click-outside",yn=typeof window!="undefined",ac=typeof navigator!="undefined",rc=yn&&("ontouchstart"in window||ac&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"],oc=e=>{const t=typeof e=="function";if(!t&&typeof e!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:t?e:e.handler,middleware:e.middleware||(a=>a),events:e.events||rc,isActive:e.isActive!==!1,detectIframe:e.detectIframe!==!1,capture:Boolean(e.capture)}},xn=({event:e,handler:t,middleware:a})=>{a(e)&&t(e)},sc=({el:e,event:t,handler:a,middleware:n})=>{setTimeout(()=>{const{activeElement:m}=document;m&&m.tagName==="IFRAME"&&!e.contains(m)&&xn({event:t,handler:a,middleware:n})},0)},nc=({el:e,event:t,handler:a,middleware:n})=>{const m=t.path||t.composedPath&&t.composedPath();(m?m.indexOf(e)<0:!e.contains(t.target))&&xn({event:t,handler:a,middleware:n})},wn=(e,{value:t})=>{const{events:a,handler:n,middleware:m,isActive:s,detectIframe:R,capture:E}=oc(t);if(!!s){if(e[Ba]=a.map(N=>({event:N,srcTarget:document.documentElement,handler:L=>nc({el:e,event:L,handler:n,middleware:m}),capture:E})),R){const N={event:"blur",srcTarget:window,handler:L=>sc({el:e,event:L,handler:n,middleware:m}),capture:E};e[Ba]=[...e[Ba],N]}e[Ba].forEach(({event:N,srcTarget:L,handler:k})=>setTimeout(()=>{!e[Ba]||L.addEventListener(N,k,E)},0))}},Sn=e=>{(e[Ba]||[]).forEach(({event:a,srcTarget:n,handler:m,capture:s})=>n.removeEventListener(a,m,s)),delete e[Ba]};var io=yn?{beforeMount:wn,updated:(e,{value:t,oldValue:a})=>{JSON.stringify(t)!==JSON.stringify(a)&&(Sn(e),wn(e,{value:t}))},unmounted:Sn}:{},kn=(e,t,a)=>{if(e.typingUsers&&e.typingUsers.length){const n=e.users.filter(m=>{if(m._id!==t&&e.typingUsers.indexOf(m._id)!==-1&&!(m.status&&m.status.state==="offline"))return!0});return n.length?e.users.length===2?a.IS_TYPING:n.map(m=>m.username).join(", ")+" "+a.IS_TYPING:void 0}};function Br(e,t){if(!(!t||!t.type))return e.some(a=>t.type.toLowerCase().includes(a))}function Ja(e){return Br(as,e)}function Cr(e){return Br(bn,e)}function En(e){return Br(as,e)||Br(bn,e)}function lo(e){return Br(Zl,e)}const ic={name:"RoomsContent",components:{SvgIcon:bt,FormatMessage:Tr},directives:{clickOutside:io},props:{currentUserId:{type:[String,Number],required:!0},room:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},roomActions:{type:Array,required:!0}},emits:["room-action-handler"],data(){return{roomMenuOpened:null}},computed:{getLastMessage(){const e=this.typingUsers;if(e)return e;const t=this.room.lastMessage.deleted?this.textMessages.MESSAGE_DELETED:this.room.lastMessage.content;if(this.room.users.length<=2)return t;const a=this.room.users.find(n=>n._id===this.room.lastMessage.senderId);return this.room.lastMessage.username?`${this.room.lastMessage.username} - ${t}`:!a||a._id===this.currentUserId?t:`${a.username} - ${t}`},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(t=>t._id!==this.currentUserId);return e&&e.status?e.status.state:null},typingUsers(){return kn(this.room,this.currentUserId,this.textMessages)},isMessageCheckmarkVisible(){return!this.typingUsers&&this.room.lastMessage&&!this.room.lastMessage.deleted&&this.room.lastMessage.senderId===this.currentUserId&&(this.room.lastMessage.saved||this.room.lastMessage.distributed||this.room.lastMessage.seen)},formattedDuration(){var t,a;const e=(a=(t=this.room.lastMessage)==null?void 0:t.files)==null?void 0:a[0];if(e){if(!e.duration)return`${e.name}.${e.extension}`;let n=Math.floor(e.duration);return(n-(n%=60))/60+(n>9?":":":0")+n}return""},isAudio(){return this.room.lastMessage.files?lo(this.room.lastMessage.files[0]):!1}},methods:{roomActionHandler(e){this.closeRoomMenu(),this.$emit("room-action-handler",{action:e,roomId:this.room.roomId})},closeRoomMenu(){this.roomMenuOpened=null}}},lc={class:"vac-room-container"},cc={class:"vac-name-container vac-text-ellipsis"},dc={class:"vac-title-container"},mc={class:"vac-room-name vac-text-ellipsis"},hc={key:1,class:"vac-text-date"},uc={key:0},fc={key:1,class:"vac-text-ellipsis"},_c={key:3,class:"vac-text-ellipsis"},pc={class:"vac-room-options-container"},vc={key:0,class:"vac-badge-counter vac-room-badge"},gc={key:0,class:"vac-menu-options"},bc={class:"vac-menu-list"},yc=["onClick"];function xc(e,t,a,n,m,s){const R=r.resolveComponent("svg-icon"),E=r.resolveComponent("format-message"),N=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",lc,[r.renderSlot(e.$slots,"room-list-item",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[r.renderSlot(e.$slots,"room-list-avatar",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[a.room.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):r.createCommentVNode("",!0)]),r.createElementVNode("div",cc,[r.createElementVNode("div",dc,[s.userStatus?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-state-circle",{"vac-state-online":s.userStatus==="online"}])},null,2)):r.createCommentVNode("",!0),r.createElementVNode("div",mc,r.toDisplayString(a.room.roomName),1),a.room.lastMessage?(r.openBlock(),r.createElementBlock("div",hc,r.toDisplayString(a.room.lastMessage.timestamp),1)):r.createCommentVNode("",!0)]),r.createElementVNode("div",{class:r.normalizeClass(["vac-text-last",{"vac-message-new":a.room.lastMessage&&a.room.lastMessage.new&&!s.typingUsers}])},[s.isMessageCheckmarkVisible?(r.openBlock(),r.createElementBlock("span",uc,[r.renderSlot(e.$slots,"checkmark-icon",r.normalizeProps(r.guardReactiveProps({message:a.room.lastMessage})),()=>[r.createVNode(R,{name:a.room.lastMessage.distributed?"double-checkmark":"checkmark",param:a.room.lastMessage.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):r.createCommentVNode("",!0),a.room.lastMessage&&!a.room.lastMessage.deleted&&s.isAudio?(r.openBlock(),r.createElementBlock("div",fc,[r.renderSlot(e.$slots,"microphone-icon",{},()=>[r.createVNode(R,{name:"microphone",class:"vac-icon-microphone"})]),r.createTextVNode(" "+r.toDisplayString(s.formattedDuration),1)])):a.room.lastMessage?(r.openBlock(),r.createBlock(E,{key:2,content:s.getLastMessage,deleted:!!a.room.lastMessage.deleted&&!s.typingUsers,users:a.room.users,linkify:!1,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"single-line":!0},{"deleted-icon":r.withCtx(L=>[r.renderSlot(e.$slots,"deleted-icon",r.normalizeProps(r.guardReactiveProps(L)))]),_:3},8,["content","deleted","users","text-formatting","link-options"])):r.createCommentVNode("",!0),!a.room.lastMessage&&s.typingUsers?(r.openBlock(),r.createElementBlock("div",_c,r.toDisplayString(s.typingUsers),1)):r.createCommentVNode("",!0),r.createElementVNode("div",pc,[a.room.unreadCount?(r.openBlock(),r.createElementBlock("div",vc,r.toDisplayString(a.room.unreadCount),1)):r.createCommentVNode("",!0),r.renderSlot(e.$slots,"room-list-options",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[a.roomActions.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button vac-list-room-options",onClick:t[0]||(t[0]=r.withModifiers(L=>m.roomMenuOpened=a.room.roomId,["stop"]))},[r.renderSlot(e.$slots,"room-list-options-icon",{},()=>[r.createVNode(R,{name:"dropdown",param:"room"})])])):r.createCommentVNode("",!0),a.roomActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:1,name:"vac-slide-left"},{default:r.withCtx(()=>[m.roomMenuOpened===a.room.roomId?r.withDirectives((r.openBlock(),r.createElementBlock("div",gc,[r.createElementVNode("div",bc,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.roomActions,L=>(r.openBlock(),r.createElementBlock("div",{key:L.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:r.withModifiers(k=>s.roomActionHandler(L),["stop"])},r.toDisplayString(L.title),9,yc)]))),128))])])),[[N,s.closeRoomMenu]]):r.createCommentVNode("",!0)]),_:1})):r.createCommentVNode("",!0)])])],2)])])])}var wc=Xe(ic,[["render",xc]]),rs=(e,t,a,n=!1)=>!a||a===""?e:e.filter(m=>n?co(m[t]).startsWith(co(a)):co(m[t]).includes(co(a)));function co(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const Sc={name:"RoomsList",components:{Loader:Qr,RoomsSearch:I0,RoomContent:wc},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},showRoomsList:{type:Boolean,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0},roomsLoaded:{type:Boolean,required:!0},room:{type:Object,required:!0},roomActions:{type:Array,required:!0},scrollDistance:{type:Number,required:!0}},emits:["add-room","room-action-handler","loading-more-rooms","fetch-room","fetch-more-rooms"],data(){return{filteredRooms:this.rooms||[],observer:null,showLoader:!0,loadingMoreRooms:!1,selectedRoomId:""}},watch:{rooms:{deep:!0,handler(e,t){this.filteredRooms=e,(e.length!==t.length||this.roomsLoaded)&&(this.loadingMoreRooms=!1)}},loadingRooms(e){e||setTimeout(()=>this.initIntersectionObserver())},loadingMoreRooms(e){this.$emit("loading-more-rooms",e)},roomsLoaded:{immediate:!0,handler(e){e&&(this.loadingMoreRooms=!1,this.loadingRooms||(this.showLoader=!1))}},room:{immediate:!0,handler(e){e&&!this.isMobile&&(this.selectedRoomId=e.roomId)}}},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("infinite-loader-rooms");if(e){const t={root:document.querySelector("vue-advanced-chat").shadowRoot.getElementById("rooms-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreRooms()},t),this.observer.observe(e)}},searchRoom(e){this.filteredRooms=rs(this.rooms,"roomName",e.target.value)},openRoom(e){e.roomId===this.room.roomId&&!this.isMobile||(this.isMobile||(this.selectedRoomId=e.roomId),this.$emit("fetch-room",{room:e}))},loadMoreRooms(){if(!this.loadingMoreRooms){if(this.roomsLoaded){this.loadingMoreRooms=!1,this.showLoader=!1;return}this.$emit("fetch-more-rooms"),this.loadingMoreRooms=!0}}}},kc={key:0,class:"vac-rooms-empty"},Ec={key:1,id:"rooms-list",class:"vac-room-list"},Mc=["id","onClick"],Rc={key:0,id:"infinite-loader-rooms"};function Ac(e,t,a,n,m,s){const R=r.resolveComponent("rooms-search"),E=r.resolveComponent("loader"),N=r.resolveComponent("room-content");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(["vac-rooms-container",{"vac-rooms-container-full":a.isMobile,"vac-app-border-r":!a.isMobile}])},[r.renderSlot(e.$slots,"rooms-header"),r.renderSlot(e.$slots,"rooms-list-search",{},()=>[r.createVNode(R,{rooms:a.rooms,"loading-rooms":a.loadingRooms,"text-messages":a.textMessages,"show-search":a.showSearch,"show-add-room":a.showAddRoom,onSearchRoom:s.searchRoom,onAddRoom:t[0]||(t[0]=L=>e.$emit("add-room"))},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["rooms","loading-rooms","text-messages","show-search","show-add-room","onSearchRoom"])]),r.createVNode(E,{show:a.loadingRooms},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["show"]),!a.loadingRooms&&!a.rooms.length?(r.openBlock(),r.createElementBlock("div",kc,[r.renderSlot(e.$slots,"rooms-empty",{},()=>[r.createTextVNode(r.toDisplayString(a.textMessages.ROOMS_EMPTY),1)])])):r.createCommentVNode("",!0),a.loadingRooms?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",Ec,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(m.filteredRooms,L=>(r.openBlock(),r.createElementBlock("div",{id:L.roomId,key:L.roomId,class:r.normalizeClass(["vac-room-item",{"vac-room-selected":m.selectedRoomId===L.roomId}]),onClick:k=>s.openRoom(L)},[r.createVNode(N,{"current-user-id":a.currentUserId,room:L,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"text-messages":a.textMessages,"room-actions":a.roomActions,onRoomActionHandler:t[1]||(t[1]=k=>e.$emit("room-action-handler",k))},r.createSlots({_:2},[r.renderList(e.$slots,(k,f)=>({name:f,fn:r.withCtx(x=>[r.renderSlot(e.$slots,f,r.normalizeProps(r.guardReactiveProps(x)))])}))]),1032,["current-user-id","room","text-formatting","link-options","text-messages","room-actions"])],10,Mc))),128)),r.createVNode(r.Transition,{name:"vac-fade-message"},{default:r.withCtx(()=>[a.rooms.length&&!a.loadingRooms?(r.openBlock(),r.createElementBlock("div",Rc,[r.createVNode(E,{show:m.showLoader,infinite:!0},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["show"])])):r.createCommentVNode("",!0)]),_:3})]))],2)),[[r.vShow,a.showRoomsList]])}var Tc=Xe(Sc,[["render",Ac]]);const Bc={name:"RoomHeader",components:{SvgIcon:bt},directives:{clickOutside:io},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},room:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},messageSelectionActions:{type:Array,required:!0},selectedMessagesTotal:{type:Number,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","cancel-message-selection","message-selection-action-handler"],data(){return{menuOpened:!1,messageSelectionAnimationEnded:!0}},computed:{typingUsers(){return kn(this.room,this.currentUserId,this.textMessages)},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const e=this.room.users.find(a=>a._id!==this.currentUserId);if(!e.status)return;let t="";return e.status.state==="online"?t=this.textMessages.IS_ONLINE:e.status.lastChanged&&(t=this.textMessages.LAST_SEEN+e.status.lastChanged),t}},watch:{messageSelectionEnabled(e){e?this.messageSelectionAnimationEnded=!1:setTimeout(()=>{this.messageSelectionAnimationEnded=!0},300)}},methods:{menuActionHandler(e){this.closeMenu(),this.$emit("menu-action-handler",e)},closeMenu(){this.menuOpened=!1},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",e)}}},Cc={class:"vac-room-header vac-app-border-b"},Oc={class:"vac-room-wrapper"},Nc={key:0,class:"vac-room-selection"},Ic=["id"],Lc=["onClick"],Vc={class:"vac-selection-button-count"},jc={class:"vac-text-ellipsis"},Hc={class:"vac-room-name vac-text-ellipsis"},Pc={key:0,class:"vac-room-info vac-text-ellipsis"},Fc={key:1,class:"vac-room-info vac-text-ellipsis"},Dc={key:0,class:"vac-menu-options"},Uc={class:"vac-menu-list"},zc=["onClick"];function qc(e,t,a,n,m,s){const R=r.resolveComponent("svg-icon"),E=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",Cc,[r.renderSlot(e.$slots,"room-header",r.normalizeProps(r.guardReactiveProps({room:a.room,typingUsers:s.typingUsers,userStatus:s.userStatus})),()=>[r.createElementVNode("div",Oc,[r.createVNode(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.messageSelectionEnabled?(r.openBlock(),r.createElementBlock("div",Nc,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.messageSelectionActions,N=>(r.openBlock(),r.createElementBlock("div",{id:N.name,key:N.name},[r.createElementVNode("div",{class:"vac-selection-button",onClick:L=>s.messageSelectionActionHandler(N)},[r.createTextVNode(r.toDisplayString(N.title)+" ",1),r.createElementVNode("span",Vc,r.toDisplayString(a.selectedMessagesTotal),1)],8,Lc)],8,Ic))),128)),r.createElementVNode("div",{class:"vac-selection-cancel vac-item-clickable",onClick:t[0]||(t[0]=N=>e.$emit("cancel-message-selection"))},r.toDisplayString(a.textMessages.CANCEL_SELECT_MESSAGE),1)])):r.createCommentVNode("",!0)]),_:1}),!a.messageSelectionEnabled&&m.messageSelectionAnimationEnded?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[a.singleRoom?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-svg-button vac-toggle-button",{"vac-rotate-icon-init":!a.isMobile,"vac-rotate-icon":!a.showRoomsList&&!a.isMobile}]),onClick:t[1]||(t[1]=N=>e.$emit("toggle-rooms-list"))},[r.renderSlot(e.$slots,"toggle-icon",{},()=>[r.createVNode(R,{name:"toggle"})])],2)),r.createElementVNode("div",{class:r.normalizeClass(["vac-info-wrapper",{"vac-item-clickable":a.roomInfoEnabled}]),onClick:t[2]||(t[2]=N=>e.$emit("room-info"))},[r.renderSlot(e.$slots,"room-header-avatar",r.normalizeProps(r.guardReactiveProps({room:a.room})),()=>[a.room.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.room.avatar}')`})},null,4)):r.createCommentVNode("",!0)]),r.renderSlot(e.$slots,"room-header-info",r.normalizeProps(r.guardReactiveProps({room:a.room,typingUsers:s.typingUsers,userStatus:s.userStatus})),()=>[r.createElementVNode("div",jc,[r.createElementVNode("div",Hc,r.toDisplayString(a.room.roomName),1),s.typingUsers?(r.openBlock(),r.createElementBlock("div",Pc,r.toDisplayString(s.typingUsers),1)):(r.openBlock(),r.createElementBlock("div",Fc,r.toDisplayString(s.userStatus),1))])])],2),a.room.roomId?r.renderSlot(e.$slots,"room-options",{key:1},()=>[a.menuActions.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button vac-room-options",onClick:t[3]||(t[3]=N=>m.menuOpened=!m.menuOpened)},[r.renderSlot(e.$slots,"menu-icon",{},()=>[r.createVNode(R,{name:"menu"})])])):r.createCommentVNode("",!0),a.menuActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:1,name:"vac-slide-left"},{default:r.withCtx(()=>[m.menuOpened?r.withDirectives((r.openBlock(),r.createElementBlock("div",Dc,[r.createElementVNode("div",Uc,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.menuActions,N=>(r.openBlock(),r.createElementBlock("div",{key:N.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:L=>s.menuActionHandler(N)},r.toDisplayString(N.title),9,zc)]))),128))])])),[[E,s.closeMenu]]):r.createCommentVNode("",!0)]),_:1})):r.createCommentVNode("",!0)]):r.createCommentVNode("",!0)],64)):r.createCommentVNode("",!0)])])])}var Xc=Xe(Bc,[["render",qc]]);function mo(e){if(typeof e!="string"||!e)throw new Error("expected a non-empty string, got: "+e)}function os(e){if(typeof e!="number")throw new Error("expected a number, got: "+e)}const Yc=1,Gc=1,Ca="emoji",er="keyvalue",ss="favorites",Kc="tokens",Mn="tokens",Zc="unicode",Rn="count",Wc="group",Qc="order",An="group-order",ns="eTag",ho="url",Tn="skinTone",tr="readonly",is="readwrite",Bn="skinUnicodes",$c="skinUnicodes",Jc="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",e1="en";function t1(e,t){const a=new Set,n=[];for(const m of e){const s=t(m);a.has(s)||(a.add(s),n.push(m))}return n}function Cn(e){return t1(e,t=>t.unicode)}function a1(e){function t(a,n,m){const s=n?e.createObjectStore(a,{keyPath:n}):e.createObjectStore(a);if(m)for(const[R,[E,N]]of Object.entries(m))s.createIndex(R,E,{multiEntry:N});return s}t(er),t(Ca,Zc,{[Mn]:[Kc,!0],[An]:[[Wc,Qc]],[Bn]:[$c,!0]}),t(ss,void 0,{[Rn]:[""]})}const ls={},uo={},fo={};function On(e,t,a){a.onerror=()=>t(a.error),a.onblocked=()=>t(new Error("IDB blocked")),a.onsuccess=()=>e(a.result)}async function r1(e){const t=await new Promise((a,n)=>{const m=indexedDB.open(e,Yc);ls[e]=m,m.onupgradeneeded=s=>{s.oldVersion<Gc&&a1(m.result)},On(a,n,m)});return t.onclose=()=>cs(e),t}function o1(e){return uo[e]||(uo[e]=r1(e)),uo[e]}function ma(e,t,a,n){return new Promise((m,s)=>{const R=e.transaction(t,a,{durability:"relaxed"}),E=typeof t=="string"?R.objectStore(t):t.map(L=>R.objectStore(L));let N;n(E,R,L=>{N=L}),R.oncomplete=()=>m(N),R.onerror=()=>s(R.error)})}function cs(e){const t=ls[e],a=t&&t.result;if(a){a.close();const n=fo[e];if(n)for(const m of n)m()}delete ls[e],delete uo[e],delete fo[e]}function s1(e){return new Promise((t,a)=>{cs(e);const n=indexedDB.deleteDatabase(e);On(t,a,n)})}function n1(e,t){let a=fo[e];a||(a=fo[e]=[]),a.push(t)}const i1=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function ar(e){return e.split(/[\s_]+/).map(t=>!t.match(/\w/)||i1.has(t)?t.toLowerCase():t.replace(/[)(:,]/g,"").replace(//g,"'").toLowerCase()).filter(Boolean)}const l1=2;function Nn(e){return e.filter(Boolean).map(t=>t.toLowerCase()).filter(t=>t.length>=l1)}function c1(e){return e.map(({annotation:a,emoticon:n,group:m,order:s,shortcodes:R,skins:E,tags:N,emoji:L,version:k})=>{const f=[...new Set(Nn([...(R||[]).map(ar).flat(),...N.map(ar).flat(),...ar(a),n]))].sort(),x={annotation:a,group:m,order:s,tags:N,tokens:f,unicode:L,version:k};if(n&&(x.emoticon=n),R&&(x.shortcodes=R),E){x.skinTones=[],x.skinUnicodes=[],x.skinVersions=[];for(const{tone:y,emoji:o,version:S}of E)x.skinTones.push(y),x.skinUnicodes.push(o),x.skinVersions.push(S)}return x})}function In(e,t,a,n){e[t](a).onsuccess=m=>n&&n(m.target.result)}function Oa(e,t,a){In(e,"get",t,a)}function Ln(e,t,a){In(e,"getAll",t,a)}function ds(e){e.commit&&e.commit()}function d1(e,t){let a=e[0];for(let n=1;n<e.length;n++){const m=e[n];t(a)>t(m)&&(a=m)}return a}function Vn(e,t){const a=d1(e,m=>m.length),n=[];for(const m of a)e.some(s=>s.findIndex(R=>t(R)===t(m))===-1)||n.push(m);return n}async function m1(e){return!await ms(e,er,ho)}async function h1(e,t,a){const[n,m]=await Promise.all([ns,ho].map(s=>ms(e,er,s)));return n===a&&m===t}async function u1(e,t){return ma(e,Ca,tr,(n,m,s)=>{let R;const E=()=>{n.getAll(R&&IDBKeyRange.lowerBound(R,!0),50).onsuccess=N=>{const L=N.target.result;for(const k of L)if(R=k.unicode,t(k))return s(k);if(L.length<50)return s();E()}};E()})}async function jn(e,t,a,n){try{const m=c1(t);await ma(e,[Ca,er],is,([s,R],E)=>{let N,L,k=0;function f(){++k===2&&x()}function x(){if(!(N===n&&L===a)){s.clear();for(const y of m)s.put(y);R.put(n,ns),R.put(a,ho),ds(E)}}Oa(R,ns,y=>{N=y,f()}),Oa(R,ho,y=>{L=y,f()})})}finally{}}async function f1(e,t){return ma(e,Ca,tr,(a,n,m)=>{const s=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);Ln(a.index(An),s,m)})}async function Hn(e,t){const a=Nn(ar(t));return a.length?ma(e,Ca,tr,(n,m,s)=>{const R=[],E=()=>{R.length===a.length&&N()},N=()=>{const L=Vn(R,k=>k.unicode);s(L.sort((k,f)=>k.order<f.order?-1:1))};for(let L=0;L<a.length;L++){const k=a[L],f=L===a.length-1?IDBKeyRange.bound(k,k+"\uFFFF",!1,!0):IDBKeyRange.only(k);Ln(n.index(Mn),f,x=>{R.push(x),E()})}}):[]}async function _1(e,t){const a=await Hn(e,t);return a.length?a.filter(n=>(n.shortcodes||[]).map(s=>s.toLowerCase()).includes(t.toLowerCase()))[0]||null:await u1(e,m=>(m.shortcodes||[]).includes(t.toLowerCase()))||null}async function p1(e,t){return ma(e,Ca,tr,(a,n,m)=>Oa(a,t,s=>{if(s)return m(s);Oa(a.index(Bn),t,R=>m(R||null))}))}function ms(e,t,a){return ma(e,t,tr,(n,m,s)=>Oa(n,a,s))}function v1(e,t,a,n){return ma(e,t,is,(m,s)=>{m.put(n,a),ds(s)})}function g1(e,t){return ma(e,ss,is,(a,n)=>Oa(a,t,m=>{a.put((m||0)+1,t),ds(n)}))}function b1(e,t,a){return a===0?[]:ma(e,[ss,Ca],tr,([n,m],s,R)=>{const E=[];n.index(Rn).openCursor(void 0,"prev").onsuccess=N=>{const L=N.target.result;if(!L)return R(E);function k(y){if(E.push(y),E.length===a)return R(E);L.continue()}const f=L.primaryKey,x=t.byName(f);if(x)return k(x);Oa(m,f,y=>{if(y)return k(y);L.continue()})}})}const _o="";function y1(e,t){const a=new Map;for(const m of e){const s=t(m);for(const R of s){let E=a;for(let L=0;L<R.length;L++){const k=R.charAt(L);let f=E.get(k);f||(f=new Map,E.set(k,f)),E=f}let N=E.get(_o);N||(N=[],E.set(_o,N)),N.push(m)}}return(m,s)=>{let R=a;for(let L=0;L<m.length;L++){const k=m.charAt(L),f=R.get(k);if(f)R=f;else return[]}if(s)return R.get(_o)||[];const E=[],N=[R];for(;N.length;){const k=[...N.shift().entries()].sort((f,x)=>f[0]<x[0]?-1:1);for(const[f,x]of k)f===_o?E.push(...x):N.push(x)}return E}}const x1=["name","url"];function w1(e){const t=e&&Array.isArray(e),a=t&&e.length&&(!e[0]||x1.some(n=>!(n in e[0])));if(!t||a)throw new Error("Custom emojis are in the wrong format")}function Pn(e){w1(e);const t=(x,y)=>x.name.toLowerCase()<y.name.toLowerCase()?-1:1,a=e.sort(t),m=y1(e,x=>[...new Set((x.shortcodes||[]).map(y=>ar(y)).flat())]),s=x=>m(x,!0),R=x=>m(x,!1),E=x=>{const y=ar(x),o=y.map((S,j)=>(j<y.length-1?s:R)(S));return Vn(o,S=>S.name).sort(t)},N=new Map,L=new Map;for(const x of e){L.set(x.name.toLowerCase(),x);for(const y of x.shortcodes||[])N.set(y.toLowerCase(),x)}return{all:a,search:E,byShortcode:x=>N.get(x.toLowerCase()),byName:x=>L.get(x.toLowerCase())}}function Or(e){if(!e)return e;if(delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let a=0;a<t;a++)e.skins[a]={tone:e.skinTones[a],unicode:e.skinUnicodes[a],version:e.skinVersions[a]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function Fn(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const S1=["annotation","emoji","group","order","tags","version"];function k1(e){if(!e||!Array.isArray(e)||!e[0]||typeof e[0]!="object"||S1.some(t=>!(t in e[0])))throw new Error("Emoji data is in the wrong format")}function Dn(e,t){if(Math.floor(e.status/100)!==2)throw new Error("Failed to fetch: "+t+":  "+e.status)}async function E1(e){const t=await fetch(e,{method:"HEAD"});Dn(t,e);const a=t.headers.get("etag");return Fn(a),a}async function hs(e){const t=await fetch(e);Dn(t,e);const a=t.headers.get("etag");Fn(a);const n=await t.json();return k1(n),[a,n]}function M1(e){for(var t="",a=new Uint8Array(e),n=a.byteLength,m=-1;++m<n;)t+=String.fromCharCode(a[m]);return t}function R1(e){for(var t=e.length,a=new ArrayBuffer(t),n=new Uint8Array(a),m=-1;++m<t;)n[m]=e.charCodeAt(m);return a}async function Un(e){const t=JSON.stringify(e),a=R1(t),n=await crypto.subtle.digest("SHA-1",a),m=M1(n);return btoa(m)}async function A1(e,t){let a,n=await E1(t);if(!n){const m=await hs(t);n=m[0],a=m[1],n||(n=await Un(a))}await h1(e,t,n)||(a||(a=(await hs(t))[1]),await jn(e,a,t,n))}async function T1(e,t){let[a,n]=await hs(t);a||(a=await Un(n)),await jn(e,n,t,a)}class zn{constructor({dataSource:t=Jc,locale:a=e1,customEmoji:n=[]}={}){this.dataSource=t,this.locale=a,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=Pn(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const t=this._db=await o1(this._dbName);n1(this._dbName,this._clear);const a=this.dataSource;await m1(t)?await T1(t,a):this._lazyUpdate=A1(t,a)}async ready(){const t=async()=>(this._ready||(this._ready=this._init()),this._ready);await t(),this._db||await t()}async getEmojiByGroup(t){return os(t),await this.ready(),Cn(await f1(this._db,t)).map(Or)}async getEmojiBySearchQuery(t){mo(t),await this.ready();const a=this._custom.search(t),n=Cn(await Hn(this._db,t)).map(Or);return[...a,...n]}async getEmojiByShortcode(t){mo(t),await this.ready();const a=this._custom.byShortcode(t);return a||Or(await _1(this._db,t))}async getEmojiByUnicodeOrName(t){mo(t),await this.ready();const a=this._custom.byName(t);return a||Or(await p1(this._db,t))}async getPreferredSkinTone(){return await this.ready(),await ms(this._db,er,Tn)||0}async setPreferredSkinTone(t){return os(t),await this.ready(),v1(this._db,er,Tn,t)}async incrementFavoriteEmojiCount(t){return mo(t),await this.ready(),g1(this._db,t)}async getTopFavoriteEmoji(t){return os(t),await this.ready(),(await b1(this._db,this._custom,t)).map(Or)}set customEmoji(t){this._custom=Pn(t)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await cs(this._dbName)}async delete(){await this._shutdown(),await s1(this._dbName)}}function Nr(){}function qn(e){return e()}function Xn(){return Object.create(null)}function Ir(e){e.forEach(qn)}function Yn(e){return typeof e=="function"}function B1(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let po;function vo(e,t){return po||(po=document.createElement("a")),po.href=t,e===po.href}function C1(e){return Object.keys(e).length===0}function O1(e){return e&&Yn(e.destroy)?e.destroy:Nr}function Ge(e,t){e.appendChild(t)}function Kt(e,t,a){e.insertBefore(t,a||null)}function Zt(e){e.parentNode.removeChild(e)}function qe(e){return document.createElement(e)}function ra(e){return document.createTextNode(e)}function Wt(e,t,a,n){return e.addEventListener(t,a,n),()=>e.removeEventListener(t,a,n)}function W(e,t,a){a==null?e.removeAttribute(t):e.getAttribute(t)!==a&&e.setAttribute(t,a)}function oa(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function Gn(e,t){e.value=t==null?"":t}function ya(e,t,a,n){a===null?e.style.removeProperty(t):e.style.setProperty(t,a,n?"important":"")}let us;function Lr(e){us=e}const Vr=[],rr=[],go=[],Kn=[],Zn=Promise.resolve();let fs=!1;function Wn(){fs||(fs=!0,Zn.then(Qn))}function N1(){return Wn(),Zn}function _s(e){go.push(e)}const ps=new Set;let bo=0;function Qn(){const e=us;do{for(;bo<Vr.length;){const t=Vr[bo];bo++,Lr(t),I1(t.$$)}for(Lr(null),Vr.length=0,bo=0;rr.length;)rr.pop()();for(let t=0;t<go.length;t+=1){const a=go[t];ps.has(a)||(ps.add(a),a())}go.length=0}while(Vr.length);for(;Kn.length;)Kn.pop()();fs=!1,ps.clear(),Lr(e)}function I1(e){if(e.fragment!==null){e.update(),Ir(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(_s)}}const L1=new Set;function V1(e,t){e&&e.i&&(L1.delete(e),e.i(t))}const j1=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function jr(e,t){e.d(1),t.delete(e.key)}function Hr(e,t,a,n,m,s,R,E,N,L,k,f){let x=e.length,y=s.length,o=x;const S={};for(;o--;)S[e[o].key]=o;const j=[],I=new Map,v=new Map;for(o=y;o--;){const T=f(m,s,o),l=a(T);let B=R.get(l);B?n&&B.p(T,t):(B=L(l,T),B.c()),I.set(l,j[o]=B),l in S&&v.set(l,Math.abs(o-S[l]))}const g=new Set,O=new Set;function F(T){V1(T,1),T.m(E,k),R.set(T.key,T),k=T.first,y--}for(;x&&y;){const T=j[y-1],l=e[x-1],B=T.key,w=l.key;T===l?(k=T.first,x--,y--):I.has(w)?!R.has(B)||g.has(B)?F(T):O.has(w)?x--:v.get(B)>v.get(w)?(O.add(B),F(T)):(g.add(w),x--):(N(l,R),x--)}for(;x--;){const T=e[x];I.has(T.key)||N(T,R)}for(;y;)F(j[y-1]);return j}function H1(e,t,a,n){const{fragment:m,on_mount:s,on_destroy:R,after_update:E}=e.$$;m&&m.m(t,a),n||_s(()=>{const N=s.map(qn).filter(Yn);R?R.push(...N):Ir(N),e.$$.on_mount=[]}),E.forEach(_s)}function P1(e,t){const a=e.$$;a.fragment!==null&&(Ir(a.on_destroy),a.fragment&&a.fragment.d(t),a.on_destroy=a.fragment=null,a.ctx=[])}function F1(e,t){e.$$.dirty[0]===-1&&(Vr.push(e),Wn(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function D1(e,t,a,n,m,s,R,E=[-1]){const N=us;Lr(e);const L=e.$$={fragment:null,ctx:null,props:s,update:Nr,not_equal:m,bound:Xn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(N?N.$$.context:[]),callbacks:Xn(),dirty:E,skip_bound:!1,root:t.target||N.$$.root};R&&R(L.root);let k=!1;L.ctx=a?a(e,t.props||{},(f,x,...y)=>{const o=y.length?y[0]:x;return L.ctx&&m(L.ctx[f],L.ctx[f]=o)&&(!L.skip_bound&&L.bound[f]&&L.bound[f](o),k&&F1(e,f)),x}):[],L.update(),k=!0,Ir(L.before_update),L.fragment=n?n(L.ctx):!1,t.target&&(L.fragment&&L.fragment.c(),H1(e,t.target,void 0,void 0),Qn()),Lr(N)}class U1{$destroy(){P1(this,1),this.$destroy=Nr}$on(t,a){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(a),()=>{const m=n.indexOf(a);m!==-1&&n.splice(m,1)}}$set(t){this.$$set&&!C1(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const $n=[[-1,"\u2728","custom"],[0,"\u{1F600}","smileys-emotion"],[1,"\u{1F44B}","people-body"],[3,"\u{1F431}","animals-nature"],[4,"\u{1F34E}","food-drink"],[5,"\u{1F3E0}\uFE0F","travel-places"],[6,"\u26BD","activities"],[7,"\u{1F4DD}","objects"],[8,"\u26D4\uFE0F","symbols"],[9,"\u{1F3C1}","flags"]].map(([e,t,a])=>({id:e,emoji:t,name:a})),yo=$n.slice(1),z1=$n[0],q1=2,Jn=6,ei=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function ti(e){return e.unicode.includes("\u200D")}const X1={"\u{1FAE0}":14,"\u{1F972}":13.1,"\u{1F97B}":12.1,"\u{1F970}":11,"\u{1F929}":5,"\u{1F471}\u200D\u2640\uFE0F":4,"\u{1F923}":3,"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F":2,"\u{1F600}":1,"\u{1F610}\uFE0F":.7,"\u{1F603}":.6},Y1=1e3,G1="\u{1F590}\uFE0F",K1=8,Z1=["\u{1F60A}","\u{1F612}","\u2665\uFE0F","\u{1F44D}\uFE0F","\u{1F60D}","\u{1F602}","\u{1F62D}","\u263A\uFE0F","\u{1F614}","\u{1F629}","\u{1F60F}","\u{1F495}","\u{1F64C}","\u{1F618}"],ai='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',W1=(e,t)=>e<t?-1:e>t?1:0,ri=(e,t)=>{const a=document.createElement("canvas");a.width=a.height=1;const n=a.getContext("2d");return n.textBaseline="top",n.font=`100px ${ai}`,n.fillStyle=t,n.scale(.01,.01),n.fillText(e,0,0),n.getImageData(0,0,1,1).data},Q1=(e,t)=>{const a=[...e].join(","),n=[...t].join(",");return a===n&&!a.startsWith("0,0,0,")};function $1(e){const t=ri(e,"#000"),a=ri(e,"#fff");return t&&a&&Q1(t,a)}function J1(){const e=Object.entries(X1);try{for(const[t,a]of e)if($1(t))return a}catch{}finally{}return e[0][1]}const vs=new Promise(e=>ei(()=>e(J1()))),gs=new Map,ed="\uFE0F",td="\uD83C",ad="\u200D",rd=127995,od=57339;function sd(e,t){if(t===0)return e;const a=e.indexOf(ad);return a!==-1?e.substring(0,a)+String.fromCodePoint(rd+t-1)+e.substring(a):(e.endsWith(ed)&&(e=e.substring(0,e.length-1)),e+td+String.fromCodePoint(od+t-1))}function xa(e){e.preventDefault(),e.stopPropagation()}function bs(e,t,a){return t+=e?-1:1,t<0?t=a.length-1:t>=a.length&&(t=0),t}function oi(e,t){const a=new Set,n=[];for(const m of e){const s=t(m);a.has(s)||(a.add(s),n.push(m))}return n}function nd(e,t){const a=n=>{const m={};for(const s of n)typeof s.tone=="number"&&s.version<=t&&(m[s.tone]=s.unicode);return m};return e.map(({unicode:n,skins:m,shortcodes:s,url:R,name:E,category:N})=>({unicode:n,name:E,shortcodes:s,url:R,category:N,id:n||E,skins:m&&a(m),title:(s||[]).join(", ")}))}const xo=requestAnimationFrame;let id=typeof ResizeObserver=="function";function ld(e,t){let a;return id?(a=new ResizeObserver(n=>t(n[0].contentRect.width)),a.observe(e)):xo(()=>t(e.getBoundingClientRect().width)),{destroy(){a&&a.disconnect()}}}function si(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}let ys;function cd(e,t,a){for(const n of e){const m=a(n),s=si(m);typeof ys=="undefined"&&(ys=si(t));const R=s/1.8<ys;gs.set(n.unicode,R)}}function dd(e){return oi(e,t=>t)}const{Map:Pr}=j1;function ni(e,t,a){const n=e.slice();return n[63]=t[a],n[65]=a,n}function ii(e,t,a){const n=e.slice();return n[66]=t[a],n[65]=a,n}function li(e,t,a){const n=e.slice();return n[63]=t[a],n[65]=a,n}function ci(e,t,a){const n=e.slice();return n[69]=t[a],n}function di(e,t,a){const n=e.slice();return n[72]=t[a],n[65]=a,n}function mi(e,t){let a,n=t[72]+"",m,s,R,E,N,L;return{key:e,first:null,c(){a=qe("div"),m=ra(n),W(a,"id",s="skintone-"+t[65]),W(a,"class",R="emoji hide-focus "+(t[65]===t[20]?"active":"")),W(a,"aria-selected",E=t[65]===t[20]),W(a,"role","option"),W(a,"title",N=t[0].skinTones[t[65]]),W(a,"tabindex","-1"),W(a,"aria-label",L=t[0].skinTones[t[65]]),this.first=a},m(k,f){Kt(k,a,f),Ge(a,m)},p(k,f){t=k,f[0]&512&&n!==(n=t[72]+"")&&oa(m,n),f[0]&512&&s!==(s="skintone-"+t[65])&&W(a,"id",s),f[0]&1049088&&R!==(R="emoji hide-focus "+(t[65]===t[20]?"active":""))&&W(a,"class",R),f[0]&1049088&&E!==(E=t[65]===t[20])&&W(a,"aria-selected",E),f[0]&513&&N!==(N=t[0].skinTones[t[65]])&&W(a,"title",N),f[0]&513&&L!==(L=t[0].skinTones[t[65]])&&W(a,"aria-label",L)},d(k){k&&Zt(a)}}}function hi(e,t){let a,n,m=t[69].emoji+"",s,R,E,N,L,k,f;function x(){return t[49](t[69])}return{key:e,first:null,c(){a=qe("button"),n=qe("div"),s=ra(m),W(n,"class","nav-emoji emoji"),W(a,"role","tab"),W(a,"class","nav-button"),W(a,"aria-controls",R="tab-"+t[69].id),W(a,"aria-label",E=t[0].categories[t[69].name]),W(a,"aria-selected",N=!t[4]&&t[13].id===t[69].id),W(a,"title",L=t[0].categories[t[69].name]),this.first=a},m(y,o){Kt(y,a,o),Ge(a,n),Ge(n,s),k||(f=Wt(a,"click",x),k=!0)},p(y,o){t=y,o[0]&4096&&m!==(m=t[69].emoji+"")&&oa(s,m),o[0]&4096&&R!==(R="tab-"+t[69].id)&&W(a,"aria-controls",R),o[0]&4097&&E!==(E=t[0].categories[t[69].name])&&W(a,"aria-label",E),o[0]&12304&&N!==(N=!t[4]&&t[13].id===t[69].id)&&W(a,"aria-selected",N),o[0]&4097&&L!==(L=t[0].categories[t[69].name])&&W(a,"title",L)},d(y){y&&Zt(a),k=!1,f()}}}function md(e){let t,a;return{c(){t=qe("img"),W(t,"class","custom-emoji"),vo(t.src,a=e[63].url)||W(t,"src",a),W(t,"alt",""),W(t,"loading","lazy")},m(n,m){Kt(n,t,m)},p(n,m){m[0]&32768&&!vo(t.src,a=n[63].url)&&W(t,"src",a)},d(n){n&&Zt(t)}}}function hd(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=ra(t)},m(n,m){Kt(n,a,m)},p(n,m){m[0]&33024&&t!==(t=n[27](n[63],n[8])+"")&&oa(a,t)},d(n){n&&Zt(a)}}}function ui(e,t){let a,n,m,s,R,E,N;function L(x,y){return x[63].unicode?hd:md}let k=L(t),f=k(t);return{key:e,first:null,c(){a=qe("button"),f.c(),W(a,"role",n=t[4]?"option":"menuitem"),W(a,"aria-selected",m=t[4]?t[65]==t[5]:""),W(a,"aria-label",s=t[28](t[63],t[8])),W(a,"title",R=t[63].title),W(a,"class",E="emoji "+(t[4]&&t[65]===t[5]?"active":"")),W(a,"id",N="emo-"+t[63].id),this.first=a},m(x,y){Kt(x,a,y),f.m(a,null)},p(x,y){t=x,k===(k=L(t))&&f?f.p(t,y):(f.d(1),f=k(t),f&&(f.c(),f.m(a,null))),y[0]&16&&n!==(n=t[4]?"option":"menuitem")&&W(a,"role",n),y[0]&32816&&m!==(m=t[4]?t[65]==t[5]:"")&&W(a,"aria-selected",m),y[0]&33024&&s!==(s=t[28](t[63],t[8]))&&W(a,"aria-label",s),y[0]&32768&&R!==(R=t[63].title)&&W(a,"title",R),y[0]&32816&&E!==(E="emoji "+(t[4]&&t[65]===t[5]?"active":""))&&W(a,"class",E),y[0]&32768&&N!==(N="emo-"+t[63].id)&&W(a,"id",N)},d(x){x&&Zt(a),f.d()}}}function fi(e,t){let a,n=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"",m,s,R,E,N=[],L=new Pr,k,f,x,y=t[66].emojis;const o=S=>S[63].id;for(let S=0;S<y.length;S+=1){let j=li(t,y,S),I=o(j);L.set(I,N[S]=ui(I,j))}return{key:e,first:null,c(){a=qe("div"),m=ra(n),E=qe("div");for(let S=0;S<N.length;S+=1)N[S].c();W(a,"id",s="menu-label-"+t[65]),W(a,"class",R="category "+(t[15].length===1&&t[15][0].category===""?"gone":"")),W(a,"aria-hidden","true"),W(E,"class","emoji-menu"),W(E,"role",k=t[4]?"listbox":"menu"),W(E,"aria-labelledby",f="menu-label-"+t[65]),W(E,"id",x=t[4]?"search-results":""),this.first=a},m(S,j){Kt(S,a,j),Ge(a,m),Kt(S,E,j);for(let I=0;I<N.length;I+=1)N[I].m(E,null)},p(S,j){t=S,j[0]&40977&&n!==(n=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"")&&oa(m,n),j[0]&32768&&s!==(s="menu-label-"+t[65])&&W(a,"id",s),j[0]&32768&&R!==(R="category "+(t[15].length===1&&t[15][0].category===""?"gone":""))&&W(a,"class",R),j[0]&402686256&&(y=t[66].emojis,N=Hr(N,j,o,1,t,y,L,E,jr,ui,null,li)),j[0]&16&&k!==(k=t[4]?"listbox":"menu")&&W(E,"role",k),j[0]&32768&&f!==(f="menu-label-"+t[65])&&W(E,"aria-labelledby",f),j[0]&16&&x!==(x=t[4]?"search-results":"")&&W(E,"id",x)},d(S){S&&Zt(a),S&&Zt(E);for(let j=0;j<N.length;j+=1)N[j].d()}}}function ud(e){let t,a;return{c(){t=qe("img"),W(t,"class","custom-emoji"),vo(t.src,a=e[63].url)||W(t,"src",a),W(t,"alt",""),W(t,"loading","lazy")},m(n,m){Kt(n,t,m)},p(n,m){m[0]&1024&&!vo(t.src,a=n[63].url)&&W(t,"src",a)},d(n){n&&Zt(t)}}}function fd(e){let t=e[27](e[63],e[8])+"",a;return{c(){a=ra(t)},m(n,m){Kt(n,a,m)},p(n,m){m[0]&1280&&t!==(t=n[27](n[63],n[8])+"")&&oa(a,t)},d(n){n&&Zt(a)}}}function _i(e,t){let a,n,m,s;function R(L,k){return L[63].unicode?fd:ud}let E=R(t),N=E(t);return{key:e,first:null,c(){a=qe("button"),N.c(),W(a,"role","menuitem"),W(a,"aria-label",n=t[28](t[63],t[8])),W(a,"title",m=t[63].title),W(a,"class","emoji"),W(a,"id",s="fav-"+t[63].id),this.first=a},m(L,k){Kt(L,a,k),N.m(a,null)},p(L,k){t=L,E===(E=R(t))&&N?N.p(t,k):(N.d(1),N=E(t),N&&(N.c(),N.m(a,null))),k[0]&1280&&n!==(n=t[28](t[63],t[8]))&&W(a,"aria-label",n),k[0]&1024&&m!==(m=t[63].title)&&W(a,"title",m),k[0]&1024&&s!==(s="fav-"+t[63].id)&&W(a,"id",s)},d(L){L&&Zt(a),N.d()}}}function _d(e){let t,a,n,m,s,R,E,N,L,k=e[0].searchLabel+"",f,x,y=e[0].searchDescription+"",o,S,j,I,v,g,O,F=e[0].skinToneDescription+"",T,l,B=[],w=new Pr,d,h,b,i,u,_=[],A=new Pr,z,H,U,Q,c,p,K,J,ce=[],ue=new Pr,me,fe,we,ve,de,Ae=[],Fe=new Pr,Le,je,De,Ue,at,yt,ut=e[9];const ft=oe=>oe[72];for(let oe=0;oe<ut.length;oe+=1){let ge=di(e,ut,oe),ee=ft(ge);w.set(ee,B[oe]=mi(ee,ge))}let pt=e[12];const Gt=oe=>oe[69].id;for(let oe=0;oe<pt.length;oe+=1){let ge=ci(e,pt,oe),ee=Gt(ge);A.set(ee,_[oe]=hi(ee,ge))}let At=e[15];const vt=oe=>oe[66].category;for(let oe=0;oe<At.length;oe+=1){let ge=ii(e,At,oe),ee=vt(ge);ue.set(ee,ce[oe]=fi(ee,ge))}let xt=e[10];const Ft=oe=>oe[63].id;for(let oe=0;oe<xt.length;oe+=1){let ge=ni(e,xt,oe),ee=Ft(ge);Fe.set(ee,Ae[oe]=_i(ee,ge))}return{c(){t=qe("section"),a=qe("div"),n=qe("div"),m=qe("div"),s=qe("input"),L=qe("label"),f=ra(k),x=qe("span"),o=ra(y),S=qe("div"),j=qe("button"),I=ra(e[21]),O=qe("span"),T=ra(F),l=qe("div");for(let oe=0;oe<B.length;oe+=1)B[oe].c();u=qe("div");for(let oe=0;oe<_.length;oe+=1)_[oe].c();H=qe("div"),U=qe("div"),Q=qe("div"),c=ra(e[18]),K=qe("div"),J=qe("div");for(let oe=0;oe<ce.length;oe+=1)ce[oe].c();de=qe("div");for(let oe=0;oe<Ae.length;oe+=1)Ae[oe].c();De=qe("button"),De.textContent="\u{1F600}",W(a,"class","pad-top"),W(s,"id","search"),W(s,"class","search"),W(s,"type","search"),W(s,"role","combobox"),W(s,"enterkeyhint","search"),W(s,"placeholder",R=e[0].searchLabel),W(s,"autocapitalize","none"),W(s,"autocomplete","off"),W(s,"spellcheck","true"),W(s,"aria-expanded",E=!!(e[4]&&e[1].length)),W(s,"aria-controls","search-results"),W(s,"aria-describedby","search-description"),W(s,"aria-autocomplete","list"),W(s,"aria-activedescendant",N=e[26]?`emo-${e[26]}`:""),W(L,"class","sr-only"),W(L,"for","search"),W(x,"id","search-description"),W(x,"class","sr-only"),W(m,"class","search-wrapper"),W(j,"id","skintone-button"),W(j,"class",v="emoji "+(e[6]?"hide-focus":"")),W(j,"aria-label",e[23]),W(j,"title",e[23]),W(j,"aria-describedby","skintone-description"),W(j,"aria-haspopup","listbox"),W(j,"aria-expanded",e[6]),W(j,"aria-controls","skintone-list"),W(S,"class",g="skintone-button-wrapper "+(e[19]?"expanded":"")),W(O,"id","skintone-description"),W(O,"class","sr-only"),W(l,"id","skintone-list"),W(l,"class",d="skintone-list "+(e[6]?"":"hidden no-animate")),ya(l,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),W(l,"role","listbox"),W(l,"aria-label",h=e[0].skinTonesLabel),W(l,"aria-activedescendant",b="skintone-"+e[20]),W(l,"aria-hidden",i=!e[6]),W(n,"class","search-row"),W(u,"class","nav"),W(u,"role","tablist"),ya(u,"grid-template-columns","repeat("+e[12].length+", 1fr)"),W(u,"aria-label",z=e[0].categoriesLabel),W(U,"class","indicator"),ya(U,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),W(H,"class","indicator-wrapper"),W(Q,"class",p="message "+(e[18]?"":"gone")),W(Q,"role","alert"),W(Q,"aria-live","polite"),W(K,"class",me="tabpanel "+(!e[14]||e[18]?"gone":"")),W(K,"role",fe=e[4]?"region":"tabpanel"),W(K,"aria-label",we=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name]),W(K,"id",ve=e[4]?"":`tab-${e[13].id}`),W(K,"tabindex","0"),W(de,"class",Le="favorites emoji-menu "+(e[18]?"gone":"")),W(de,"role","menu"),W(de,"aria-label",je=e[0].favoritesLabel),ya(de,"padding-inline-end",e[25]+"px"),W(De,"aria-hidden","true"),W(De,"tabindex","-1"),W(De,"class","abs-pos hidden emoji"),W(t,"class","picker"),W(t,"aria-label",Ue=e[0].regionLabel),W(t,"style",e[22])},m(oe,ge){Kt(oe,t,ge),Ge(t,a),Ge(t,n),Ge(n,m),Ge(m,s),Gn(s,e[2]),Ge(m,L),Ge(L,f),Ge(m,x),Ge(x,o),Ge(n,S),Ge(S,j),Ge(j,I),Ge(n,O),Ge(O,T),Ge(n,l);for(let ee=0;ee<B.length;ee+=1)B[ee].m(l,null);e[48](l),Ge(t,u);for(let ee=0;ee<_.length;ee+=1)_[ee].m(u,null);Ge(t,H),Ge(H,U),Ge(t,Q),Ge(Q,c),Ge(t,K),Ge(K,J);for(let ee=0;ee<ce.length;ee+=1)ce[ee].m(J,null);e[50](K),Ge(t,de);for(let ee=0;ee<Ae.length;ee+=1)Ae[ee].m(de,null);Ge(t,De),e[51](De),e[52](t),at||(yt=[Wt(s,"input",e[47]),Wt(s,"keydown",e[30]),Wt(j,"click",e[35]),Wt(l,"focusout",e[38]),Wt(l,"click",e[34]),Wt(l,"keydown",e[36]),Wt(l,"keyup",e[37]),Wt(u,"keydown",e[32]),O1(e[29].call(null,J)),Wt(K,"click",e[33]),Wt(de,"click",e[33])],at=!0)},p(oe,ge){ge[0]&1&&R!==(R=oe[0].searchLabel)&&W(s,"placeholder",R),ge[0]&18&&E!==(E=!!(oe[4]&&oe[1].length))&&W(s,"aria-expanded",E),ge[0]&67108864&&N!==(N=oe[26]?`emo-${oe[26]}`:"")&&W(s,"aria-activedescendant",N),ge[0]&4&&Gn(s,oe[2]),ge[0]&1&&k!==(k=oe[0].searchLabel+"")&&oa(f,k),ge[0]&1&&y!==(y=oe[0].searchDescription+"")&&oa(o,y),ge[0]&2097152&&oa(I,oe[21]),ge[0]&64&&v!==(v="emoji "+(oe[6]?"hide-focus":""))&&W(j,"class",v),ge[0]&8388608&&W(j,"aria-label",oe[23]),ge[0]&8388608&&W(j,"title",oe[23]),ge[0]&64&&W(j,"aria-expanded",oe[6]),ge[0]&524288&&g!==(g="skintone-button-wrapper "+(oe[19]?"expanded":""))&&W(S,"class",g),ge[0]&1&&F!==(F=oe[0].skinToneDescription+"")&&oa(T,F),ge[0]&1049089&&(ut=oe[9],B=Hr(B,ge,ft,1,oe,ut,w,l,jr,mi,null,di)),ge[0]&64&&d!==(d="skintone-list "+(oe[6]?"":"hidden no-animate"))&&W(l,"class",d),ge[0]&64&&ya(l,"transform","translateY("+(oe[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),ge[0]&1&&h!==(h=oe[0].skinTonesLabel)&&W(l,"aria-label",h),ge[0]&1048576&&b!==(b="skintone-"+oe[20])&&W(l,"aria-activedescendant",b),ge[0]&64&&i!==(i=!oe[6])&&W(l,"aria-hidden",i),ge[0]&12305|ge[1]&1&&(pt=oe[12],_=Hr(_,ge,Gt,1,oe,pt,A,u,jr,hi,null,ci)),ge[0]&4096&&ya(u,"grid-template-columns","repeat("+oe[12].length+", 1fr)"),ge[0]&1&&z!==(z=oe[0].categoriesLabel)&&W(u,"aria-label",z),ge[0]&16779264&&ya(U,"transform","translateX("+(oe[24]?-1:1)*oe[11]*100+"%)"),ge[0]&262144&&oa(c,oe[18]),ge[0]&262144&&p!==(p="message "+(oe[18]?"":"gone"))&&W(Q,"class",p),ge[0]&402694449&&(At=oe[15],ce=Hr(ce,ge,vt,1,oe,At,ue,J,jr,fi,null,ii)),ge[0]&278528&&me!==(me="tabpanel "+(!oe[14]||oe[18]?"gone":""))&&W(K,"class",me),ge[0]&16&&fe!==(fe=oe[4]?"region":"tabpanel")&&W(K,"role",fe),ge[0]&8209&&we!==(we=oe[4]?oe[0].searchResultsLabel:oe[0].categories[oe[13].name])&&W(K,"aria-label",we),ge[0]&8208&&ve!==(ve=oe[4]?"":`tab-${oe[13].id}`)&&W(K,"id",ve),ge[0]&402654464&&(xt=oe[10],Ae=Hr(Ae,ge,Ft,1,oe,xt,Fe,de,jr,_i,null,ni)),ge[0]&262144&&Le!==(Le="favorites emoji-menu "+(oe[18]?"gone":""))&&W(de,"class",Le),ge[0]&1&&je!==(je=oe[0].favoritesLabel)&&W(de,"aria-label",je),ge[0]&33554432&&ya(de,"padding-inline-end",oe[25]+"px"),ge[0]&1&&Ue!==(Ue=oe[0].regionLabel)&&W(t,"aria-label",Ue),ge[0]&4194304&&W(t,"style",oe[22])},i:Nr,o:Nr,d(oe){oe&&Zt(t);for(let ge=0;ge<B.length;ge+=1)B[ge].d();e[48](null);for(let ge=0;ge<_.length;ge+=1)_[ge].d();for(let ge=0;ge<ce.length;ge+=1)ce[ge].d();e[50](null);for(let ge=0;ge<Ae.length;ge+=1)Ae[ge].d();e[51](null),e[52](null),at=!1,Ir(yt)}}}function pd(e,t,a){let{skinToneEmoji:n}=t,{i18n:m}=t,{database:s}=t,{customEmoji:R}=t,{customCategorySorting:E}=t,N=!0,L=[],k=[],f="",x="",y,o,S,j=!1,I=-1,v,g=!1,O=!1,F,T=0,l=0,B,w,d="",h=[],b=[],i,u=K1,_=!1,A=0,z=0,H=yo,U,Q=!1,c;const p=ee=>{y.getRootNode().getElementById(ee).focus()},K=(ee,xe)=>{y.dispatchEvent(new CustomEvent(ee,{detail:xe,bubbles:!0,composed:!0}))},J=(ee,xe)=>xe&&ee.skins&&ee.skins[xe]||ee.unicode,ce=(ee,xe)=>dd([ee.name||J(ee,xe),...ee.shortcodes||[]]).join(", "),ue=ee=>/^skintone-/.test(ee.id);vs.then(ee=>{ee||a(18,v=m.emojiUnsupportedMessage)});function me(ee){return ld(ee,xe=>{{const Te=getComputedStyle(y),M=parseInt(Te.getPropertyValue("--num-columns"),10),C=Te.getPropertyValue("direction")==="rtl",D=ee.parentElement.getBoundingClientRect().width-xe;a(46,u=M),a(25,A=D),a(24,_=C)}})}function fe(ee){const xe=y.getRootNode();cd(ee,o,M=>xe.getElementById(`emo-${M.id}`)),a(1,L=L)}function we(ee){return!ee.unicode||!ti(ee)||gs.get(ee.unicode)}async function ve(ee){const xe=await vs;return ee.filter(({version:Te})=>!Te||Te<=xe)}async function de(ee){return nd(ee,await vs)}async function Ae(ee){if(typeof ee=="undefined")return[];const xe=ee===-1?R:await s.getEmojiByGroup(ee);return de(await ve(xe))}async function Fe(ee){return de(await ve(await s.getEmojiBySearchQuery(ee)))}function Le(ee){if(!j||!L.length)return;const xe=Te=>{xa(ee),a(5,I=bs(Te,I,L))};switch(ee.key){case"ArrowDown":return xe(!1);case"ArrowUp":return xe(!0);case"Enter":if(I!==-1)return xa(ee),Ue(L[I].id);L.length&&a(5,I=0)}}function je(ee){a(2,f=""),a(44,x=""),a(5,I=-1),a(11,z=H.findIndex(xe=>xe.id===ee.id))}function De(ee){const{target:xe,key:Te}=ee,M=C=>{C&&(xa(ee),C.focus())};switch(Te){case"ArrowLeft":return M(xe.previousSibling);case"ArrowRight":return M(xe.nextSibling);case"Home":return M(xe.parentElement.firstChild);case"End":return M(xe.parentElement.lastChild)}}async function Ue(ee){const xe=await s.getEmojiByUnicodeOrName(ee),Te=[...L,...b].find(C=>C.id===ee),M=Te.unicode&&J(Te,T);await s.incrementFavoriteEmojiCount(ee),K("emoji-click",{emoji:xe,skinTone:T,...M&&{unicode:M},...Te.name&&{name:Te.name}})}async function at(ee){const{target:xe}=ee;if(!xe.classList.contains("emoji"))return;xa(ee);const Te=xe.id.substring(4);Ue(Te)}async function yt(ee){const{target:xe}=ee;if(!ue(xe))return;xa(ee);const Te=parseInt(xe.id.slice(9),10);a(8,T=Te),a(6,g=!1),p("skintone-button"),K("skin-tone-change",{skinTone:Te}),s.setPreferredSkinTone(Te)}async function ut(ee){a(6,g=!g),a(20,l=T),g&&(xa(ee),xo(()=>p(`skintone-${l}`)))}function ft(ee){if(!g)return;const xe=async Te=>{xa(ee),a(20,l=Te),await N1(),p(`skintone-${l}`)};switch(ee.key){case"ArrowUp":return xe(bs(!0,l,h));case"ArrowDown":return xe(bs(!1,l,h));case"Home":return xe(0);case"End":return xe(h.length-1);case"Enter":return yt(ee);case"Escape":return xa(ee),a(6,g=!1),p("skintone-button")}}function pt(ee){if(!!g)switch(ee.key){case" ":return yt(ee)}}async function Gt(ee){const{relatedTarget:xe}=ee;(!xe||!ue(xe))&&a(6,g=!1)}function At(){f=this.value,a(2,f)}function vt(ee){rr[ee?"unshift":"push"](()=>{F=ee,a(7,F)})}const xt=ee=>je(ee);function Ft(ee){rr[ee?"unshift":"push"](()=>{S=ee,a(3,S)})}function oe(ee){rr[ee?"unshift":"push"](()=>{o=ee,a(17,o)})}function ge(ee){rr[ee?"unshift":"push"](()=>{y=ee,a(16,y)})}return e.$$set=ee=>{"skinToneEmoji"in ee&&a(40,n=ee.skinToneEmoji),"i18n"in ee&&a(0,m=ee.i18n),"database"in ee&&a(39,s=ee.database),"customEmoji"in ee&&a(41,R=ee.customEmoji),"customCategorySorting"in ee&&a(42,E=ee.customCategorySorting)},e.$$.update=()=>{if(e.$$.dirty[1]&1280&&R&&s&&a(39,s.customEmoji=R,s),e.$$.dirty[0]&1|e.$$.dirty[1]&256){async function ee(){let xe=!1;const Te=setTimeout(()=>{xe=!0,a(18,v=m.loadingMessage)},Y1);try{await s.ready(),a(14,Q=!0)}catch(M){console.error(M),a(18,v=m.networkErrorMessage)}finally{clearTimeout(Te),xe&&(xe=!1,a(18,v=""))}}s&&ee()}if(e.$$.dirty[0]&6144|e.$$.dirty[1]&1024&&(R&&R.length?a(12,H=[z1,...yo]):H!==yo&&(z&&a(11,z--,z),a(12,H=yo))),e.$$.dirty[0]&4&&ei(()=>{a(44,x=(f||"").trim()),a(5,I=-1)}),e.$$.dirty[0]&6144&&a(13,U=H[z]),e.$$.dirty[0]&24576|e.$$.dirty[1]&8192){async function ee(){if(!Q)a(1,L=[]),a(4,j=!1);else if(x.length>=q1){const xe=x,Te=await Fe(xe);xe===x&&(a(1,L=Te),a(4,j=!0))}else if(U){const xe=U.id,Te=await Ae(xe);xe===U.id&&(a(1,L=Te),a(4,j=!1))}}ee()}if(e.$$.dirty[0]&4112&&a(22,w=`
  --font-family: ${ai};
  --num-groups: ${H.length}; 
  --indicator-opacity: ${j?0:1}; 
  --num-skintones: ${Jn};`),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function ee(){Q&&a(8,T=await s.getPreferredSkinTone())}ee()}if(e.$$.dirty[1]&512&&a(9,h=Array(Jn).fill().map((ee,xe)=>sd(n,xe))),e.$$.dirty[0]&768&&a(21,B=h[T]),e.$$.dirty[0]&257&&a(23,d=m.skinToneLabel.replace("{skinTone}",m.skinTones[T])),e.$$.dirty[0]&16384|e.$$.dirty[1]&256){async function ee(){a(45,i=(await Promise.all(Z1.map(xe=>s.getEmojiByUnicodeOrName(xe)))).filter(Boolean))}Q&&ee()}if(e.$$.dirty[0]&16384|e.$$.dirty[1]&49408){async function ee(){const xe=await s.getTopFavoriteEmoji(u),Te=await de(oi([...xe,...i],M=>M.unicode||M.name).slice(0,u));a(10,b=Te)}Q&&i&&ee()}if(e.$$.dirty[0]&10){const ee=L.filter(xe=>xe.unicode).filter(xe=>ti(xe)&&!gs.has(xe.unicode));ee.length?xo(()=>fe(ee)):(a(1,L=L.filter(we)),xo(()=>{(S||{}).scrollTop=0}))}e.$$.dirty[0]&1026|e.$$.dirty[1]&4096,e.$$.dirty[0]&18|e.$$.dirty[1]&2048&&a(15,k=function(){if(j)return[{category:"",emojis:L}];const xe=new Map;for(const Te of L){const M=Te.category||"";let C=xe.get(M);C||(C=[],xe.set(M,C)),C.push(Te)}return[...xe.entries()].map(([Te,M])=>({category:Te,emojis:M})).sort((Te,M)=>E(Te.category,M.category))}()),e.$$.dirty[0]&34&&a(26,c=I!==-1&&L[I].id),e.$$.dirty[0]&192&&(g?F.addEventListener("transitionend",()=>{a(19,O=!0)},{once:!0}):a(19,O=!1))},[m,L,f,S,j,I,g,F,T,h,b,z,H,U,Q,k,y,o,v,O,l,B,w,d,_,A,c,J,ce,me,Le,je,De,at,yt,ut,ft,pt,Gt,s,n,R,E,N,x,i,u,At,vt,xt,Ft,oe,ge]}class vd extends U1{constructor(t){super(),D1(this,t,pd,_d,B1,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42},null,[-1,-1,-1])}}const gd="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",bd="en";var yd={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading\u2026",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const pi=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji"];class vi extends HTMLElement{constructor(t){super(),this.attachShadow({mode:"open"});const a=document.createElement("style");a.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}",this.shadowRoot.appendChild(a),this._ctx={locale:bd,dataSource:gd,skinToneEmoji:G1,customCategorySorting:W1,customEmoji:null,i18n:yd,...t};for(const n of pi)n!=="database"&&Object.prototype.hasOwnProperty.call(this,n)&&(this._ctx[n]=this[n],delete this[n]);this._dbFlush()}connectedCallback(){this._cmp=new vd({target:this.shadowRoot,props:this._ctx})}disconnectedCallback(){this._cmp.$destroy(),this._cmp=void 0;const{database:t}=this._ctx;t&&t.close().catch(a=>console.error(a))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji"]}attributeChangedCallback(t,a,n){this._set(t.replace(/-([a-z])/g,(m,s)=>s.toUpperCase()),n)}_set(t,a){this._ctx[t]=a,this._cmp&&this._cmp.$set({[t]:a}),["locale","dataSource"].includes(t)&&this._dbFlush()}_dbCreate(){const{locale:t,dataSource:a,database:n}=this._ctx;(!n||n.locale!==t||n.dataSource!==a)&&this._set("database",new zn({locale:t,dataSource:a}))}_dbFlush(){Promise.resolve().then(()=>this._dbCreate())}}const gi={};for(const e of pi)gi[e]={get(){return e==="database"&&this._dbCreate(),this._ctx[e]},set(t){if(e==="database")throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(vi.prototype,gi),customElements.get("emoji-picker")||customElements.define("emoji-picker",vi);const xd={name:"EmojiPickerContainer",components:{SvgIcon:bt},props:{emojiOpened:{type:Boolean,default:!1},emojiReaction:{type:Boolean,default:!1},positionTop:{type:Boolean,default:!1},positionRight:{type:Boolean,default:!1}},emits:["add-emoji","open-emoji"],data(){return{emojiPickerHeight:320,emojiPickerTop:0,emojiPickerRight:""}},watch:{emojiOpened(e){e&&setTimeout(()=>{this.addCustomStyling(),this.$refs.emojiPicker.shadowRoot.addEventListener("emoji-click",({detail:t})=>{this.$emit("add-emoji",{unicode:t.unicode})})},0)}},methods:{addCustomStyling(){const e=`.picker {
				border: none;
			}`,t=`.nav {
				overflow-x: auto;
			}`,a=`.search-wrapper {
				padding-right: 2px;
				padding-left: 2px;
			}`,n=`input.search {
				height: 32px;
				font-size: 14px;
				border-radius: 10rem;
				border: var(--chat-border-style);
				padding: 5px 10px;
				outline: none;
				background: var(--chat-bg-color-input);
				color: var(--chat-color);
			}`,m=document.createElement("style");m.textContent=e+t+a+n,this.$refs.emojiPicker.shadowRoot.appendChild(m)},openEmoji(e){this.$emit("open-emoji",!this.emojiOpened),this.setEmojiPickerPosition(e.clientY,e.view.innerWidth,e.view.innerHeight)},setEmojiPickerPosition(e,t,a){const n=t<500||a<700,m=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer");if(!m){n&&(this.emojiPickerRight="-50px");return}n?(this.emojiPickerRight=t/2-(this.positionTop?200:150)+"px",this.emojiPickerTop=100,this.emojiPickerHeight=a-200):(m.getBoundingClientRect().top-e>this.emojiPickerHeight-50?this.emojiPickerTop=e+10:this.emojiPickerTop=e-this.emojiPickerHeight-10,this.emojiPickerRight=this.positionTop?"0px":this.positionRight?"60px":"")}}},wd={class:"vac-emoji-wrapper"},Sd={ref:"emojiPicker","v-if":"emojiOpened"};function kd(e,t,a,n,m,s){const R=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",wd,[r.createElementVNode("div",{class:r.normalizeClass(["vac-svg-button",{"vac-emoji-reaction":a.emojiReaction}]),onClick:t[0]||(t[0]=(...E)=>s.openEmoji&&s.openEmoji(...E))},[r.renderSlot(e.$slots,"emoji-picker-icon",{},()=>[r.createVNode(R,{name:"emoji",param:a.emojiReaction?"reaction":""},null,8,["param"])])],2),a.emojiOpened?(r.openBlock(),r.createBlock(r.Transition,{key:0,name:"vac-slide-up",appear:""},{default:r.withCtx(()=>[r.createElementVNode("div",{class:r.normalizeClass(["vac-emoji-picker",{"vac-picker-reaction":a.emojiReaction}]),style:r.normalizeStyle({height:`${m.emojiPickerHeight}px`,top:a.positionTop?m.emojiPickerHeight:`${m.emojiPickerTop}px`,right:m.emojiPickerRight,display:m.emojiPickerTop||!a.emojiReaction?"initial":"none"})},[r.createElementVNode("emoji-picker",Sd,null,512)],6)]),_:1})):r.createCommentVNode("",!0)])}var bi=Xe(xd,[["render",kd]]);const Ed={name:"RoomFiles",components:{Loader:Qr,SvgIcon:bt},props:{file:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["remove-file"],computed:{isImage(){return Ja(this.file)},isVideo(){return Cr(this.file)}}},Md={class:"vac-room-file-container"},Rd=["src"],Ad={class:"vac-text-ellipsis"},Td={key:0,class:"vac-text-ellipsis vac-text-extension"};function Bd(e,t,a,n,m,s){const R=r.resolveComponent("loader"),E=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",Md,[r.createVNode(R,{show:a.file.loading},r.createSlots({_:2},[r.renderList(e.$slots,(N,L)=>({name:L,fn:r.withCtx(k=>[r.renderSlot(e.$slots,L,r.normalizeProps(r.guardReactiveProps(k)))])}))]),1032,["show"]),r.createElementVNode("div",{class:"vac-svg-button vac-icon-remove",onClick:t[0]||(t[0]=N=>e.$emit("remove-file",a.index))},[r.renderSlot(e.$slots,"image-close-icon",{},()=>[r.createVNode(E,{name:"close",param:"image"})])]),s.isImage?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-message-image",{"vac-blur-loading":a.file.loading}]),style:r.normalizeStyle({"background-image":`url('${a.file.localUrl||a.file.url}')`})},null,6)):s.isVideo?(r.openBlock(),r.createElementBlock("video",{key:1,controls:"",class:r.normalizeClass({"vac-blur-loading":a.file.loading})},[r.createElementVNode("source",{src:a.file.localUrl||a.file.url},null,8,Rd)],2)):(r.openBlock(),r.createElementBlock("div",{key:2,class:r.normalizeClass(["vac-file-container",{"vac-blur-loading":a.file.loading}])},[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(E,{name:"file"})])]),r.createElementVNode("div",Ad,r.toDisplayString(a.file.name),1),a.file.extension?(r.openBlock(),r.createElementBlock("div",Td,r.toDisplayString(a.file.extension),1)):r.createCommentVNode("",!0)],2))])}var Cd=Xe(Ed,[["render",Bd]]);const Od={name:"RoomFiles",components:{SvgIcon:bt,RoomFile:Cd},props:{files:{type:Array,required:!0}},emits:["remove-file","reset-message"],computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}}},Nd={class:"vac-files-box"},Id={class:"vac-icon-close"};function Ld(e,t,a,n,m,s){const R=r.resolveComponent("room-file"),E=r.resolveComponent("svg-icon");return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.files.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-room-files-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[r.createElementVNode("div",Nd,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.files,(N,L)=>(r.openBlock(),r.createElementBlock("div",{key:L},[r.createVNode(R,{file:N,index:L,onRemoveFile:t[0]||(t[0]=k=>e.$emit("remove-file",k))},null,8,["file","index"])]))),128))]),r.createElementVNode("div",Id,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[1]||(t[1]=N=>e.$emit("reset-message"))},[r.renderSlot(e.$slots,"reply-close-icon",{},()=>[r.createVNode(E,{name:"close-outline"})])])])],4)):r.createCommentVNode("",!0)]),_:3})}var Vd=Xe(Od,[["render",Ld]]);const jd={props:{percentage:{type:Number,default:0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","change-linehead"],data(){return{isMouseDown:!1}},methods:{onMouseDown(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!0;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onMouseUp(e){if(this.messageSelectionEnabled)return;this.isMouseDown=!1,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove);const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},onMouseMove(e){if(this.messageSelectionEnabled)return;const t=this.calculateLineHeadPosition(e,this.$refs.progress);this.$emit("change-linehead",t)},calculateLineHeadPosition(e,t){const a=t.getBoundingClientRect().width,n=t.getBoundingClientRect().left;let m=(e.clientX-n)/a;return m=m<0?0:m,m=m>1?1:m,m}}},Hd={class:"vac-player-progress"},Pd={class:"vac-line-container"};function Fd(e,t,a,n,m,s){return r.openBlock(),r.createElementBlock("div",{ref:"progress",class:"vac-player-bar",onMousedown:t[0]||(t[0]=(...R)=>s.onMouseDown&&s.onMouseDown(...R)),onMouseover:t[1]||(t[1]=R=>e.$emit("hover-audio-progress",!0)),onMouseout:t[2]||(t[2]=R=>e.$emit("hover-audio-progress",!1))},[r.createElementVNode("div",Hd,[r.createElementVNode("div",Pd,[r.createElementVNode("div",{class:"vac-line-progress",style:r.normalizeStyle({width:`${a.percentage}%`})},null,4),r.createElementVNode("div",{class:r.normalizeClass(["vac-line-dot",{"vac-line-dot__active":m.isMouseDown}]),style:r.normalizeStyle({left:`${a.percentage}%`})},null,6)])])],544)}var Dd=Xe(jd,[["render",Fd]]);const Ud={name:"AudioPlayer",components:{SvgIcon:bt,AudioControl:Dd},props:{messageId:{type:[String,Number],default:null},src:{type:String,default:null},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","update-progress-time"],data(){return{isPlaying:!1,duration:this.convertTimeMMSS(0),playedTime:this.convertTimeMMSS(0),progress:0}},computed:{playerUniqId(){return`audio-player${this.messageId}`},audioSource(){return this.src?this.src:(this.resetProgress(),null)}},mounted(){this.player=document.querySelector("vue-advanced-chat").shadowRoot.getElementById(this.playerUniqId),this.player.addEventListener("ended",()=>{this.isPlaying=!1}),this.player.addEventListener("loadeddata",()=>{this.resetProgress(),this.duration=this.convertTimeMMSS(this.player.duration),this.updateProgressTime()}),this.player.addEventListener("timeupdate",this.onTimeUpdate)},methods:{convertTimeMMSS(e){return new Date(e*1e3).toISOString().substr(14,5)},playback(){this.messageSelectionEnabled||!this.audioSource||(this.isPlaying?this.player.pause():setTimeout(()=>this.player.play()),this.isPlaying=!this.isPlaying)},resetProgress(){this.isPlaying&&this.player.pause(),this.duration=this.convertTimeMMSS(0),this.playedTime=this.convertTimeMMSS(0),this.progress=0,this.isPlaying=!1,this.updateProgressTime()},onTimeUpdate(){this.playedTime=this.convertTimeMMSS(this.player.currentTime),this.progress=this.player.currentTime/this.player.duration*100,this.updateProgressTime()},onUpdateProgress(e){e&&(this.player.currentTime=e*this.player.duration)},updateProgressTime(){this.$emit("update-progress-time",this.progress>1?this.playedTime:this.duration)}}},zd={class:"vac-audio-player"},qd=["id","src"];function Xd(e,t,a,n,m,s){const R=r.resolveComponent("svg-icon"),E=r.resolveComponent("audio-control");return r.openBlock(),r.createElementBlock("div",null,[r.createElementVNode("div",zd,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=(...N)=>s.playback&&s.playback(...N))},[m.isPlaying?r.renderSlot(e.$slots,"audio-pause-icon",{key:0},()=>[r.createVNode(R,{name:"audio-pause"})]):r.renderSlot(e.$slots,"audio-play-icon",{key:1},()=>[r.createVNode(R,{name:"audio-play"})])]),r.createVNode(E,{percentage:m.progress,"message-selection-enabled":a.messageSelectionEnabled,onChangeLinehead:s.onUpdateProgress,onHoverAudioProgress:t[1]||(t[1]=N=>e.$emit("hover-audio-progress",N))},null,8,["percentage","message-selection-enabled","onChangeLinehead"]),r.createElementVNode("audio",{id:s.playerUniqId,src:s.audioSource},null,8,qd)])])}var xs=Xe(Ud,[["render",Xd]]);const Yd={name:"RoomMessageReply",components:{SvgIcon:bt,FormatMessage:Tr,AudioPlayer:xs},props:{room:{type:Object,required:!0},messageReply:{type:Object,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["reset-message"],computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight},firstFile(){var e,t;return(t=(e=this.messageReply)==null?void 0:e.files)!=null&&t.length?this.messageReply.files[0]:{}},isImage(){return Ja(this.firstFile)},isVideo(){return Cr(this.firstFile)},isAudio(){return lo(this.firstFile)},isOtherFile(){var e,t;return((t=(e=this.messageReply)==null?void 0:e.files)==null?void 0:t.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},Gd={class:"vac-reply-box"},Kd={class:"vac-reply-info"},Zd={class:"vac-reply-username"},Wd={class:"vac-reply-content"},Qd=["src"],$d={key:1,controls:"",class:"vac-image-reply"},Jd=["src"],em={key:3,class:"vac-image-reply vac-file-container"},tm={class:"vac-text-ellipsis"},am={key:0,class:"vac-text-ellipsis vac-text-extension"},rm={class:"vac-icon-reply"};function om(e,t,a,n,m,s){const R=r.resolveComponent("format-message"),E=r.resolveComponent("audio-player"),N=r.resolveComponent("svg-icon");return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.messageReply?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-reply-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[r.createElementVNode("div",Gd,[r.createElementVNode("div",Kd,[r.createElementVNode("div",Zd,r.toDisplayString(a.messageReply.username),1),r.createElementVNode("div",Wd,[r.createVNode(R,{content:a.messageReply.content,users:a.room.users,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["content","users","text-formatting","link-options"])])]),s.isImage?(r.openBlock(),r.createElementBlock("img",{key:0,src:s.firstFile.url,class:"vac-image-reply"},null,8,Qd)):s.isVideo?(r.openBlock(),r.createElementBlock("video",$d,[r.createElementVNode("source",{src:s.firstFile.url},null,8,Jd)])):s.isAudio?(r.openBlock(),r.createBlock(E,{key:2,src:s.firstFile.url,class:"vac-audio-reply"},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["src"])):s.isOtherFile?(r.openBlock(),r.createElementBlock("div",em,[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(N,{name:"file"})])]),r.createElementVNode("div",tm,r.toDisplayString(s.firstFile.name),1),s.firstFile.extension?(r.openBlock(),r.createElementBlock("div",am,r.toDisplayString(s.firstFile.extension),1)):r.createCommentVNode("",!0)])):r.createCommentVNode("",!0)]),r.createElementVNode("div",rm,[r.createElementVNode("div",{class:"vac-svg-button",onClick:t[0]||(t[0]=L=>e.$emit("reset-message"))},[r.renderSlot(e.$slots,"reply-close-icon",{},()=>[r.createVNode(N,{name:"close-outline"})])])])],4)):r.createCommentVNode("",!0)]),_:3})}var sm=Xe(Yd,[["render",om]]);const nm={name:"RoomUsersTag",props:{filteredUsersTag:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-user-tag","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredUsersTag(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-user-tag",this.filteredUsersTag[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredUsersTag.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},im=["onMouseover","onClick"],lm={class:"vac-tags-info"},cm={class:"vac-tags-username"};function dm(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredUsersTag.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-tags-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredUsersTag,(R,E)=>(r.openBlock(),r.createElementBlock("div",{key:R._id,class:r.normalizeClass(["vac-tags-box",{"vac-tags-box-active":E===m.activeItem}]),onMouseover:N=>m.activeItem=E,onClick:N=>e.$emit("select-user-tag",R)},[r.createElementVNode("div",lm,[R.avatar?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar vac-tags-avatar",style:r.normalizeStyle({"background-image":`url('${R.avatar}')`})},null,4)):r.createCommentVNode("",!0),r.createElementVNode("div",cm,r.toDisplayString(R.username),1)])],42,im))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var mm=Xe(nm,[["render",dm]]);const hm={name:"RoomEmojis",props:{filteredEmojis:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-emoji","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredEmojis(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-emoji",this.filteredEmojis[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredEmojis.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},um=["onMouseover","onClick"];function fm(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredEmojis.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-emojis-container",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredEmojis,(R,E)=>(r.openBlock(),r.createElementBlock("div",{key:R,class:r.normalizeClass(["vac-emoji-element",{"vac-emoji-element-active":E===m.activeItem}]),onMouseover:N=>m.activeItem=E,onClick:N=>e.$emit("select-emoji",R)},r.toDisplayString(R),43,um))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var _m=Xe(hm,[["render",fm]]);const pm={name:"RoomTemplatesText",props:{filteredTemplatesText:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-template-text","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredTemplatesText(e,t){(!t.length||e.length!==t.length)&&(this.activeItem=0)},selectItem(e){e&&this.$emit("select-template-text",this.filteredTemplatesText[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredTemplatesText.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},vm=["onMouseover","onClick"],gm={class:"vac-template-info"},bm={class:"vac-template-tag"},ym={class:"vac-template-text"};function xm(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-slide-up"},{default:r.withCtx(()=>[a.filteredTemplatesText.length?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-template-container vac-app-box-shadow",style:r.normalizeStyle({bottom:`${s.footerHeight}px`})},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.filteredTemplatesText,(R,E)=>(r.openBlock(),r.createElementBlock("div",{key:E,class:r.normalizeClass(["vac-template-box",{"vac-template-active":E===m.activeItem}]),onMouseover:N=>m.activeItem=E,onClick:N=>e.$emit("select-template-text",R)},[r.createElementVNode("div",gm,[r.createElementVNode("div",bm," /"+r.toDisplayString(R.tag),1),r.createElementVNode("div",ym,r.toDisplayString(R.text),1)])],42,vm))),128))],4)):r.createCommentVNode("",!0)]),_:1})}var wm=Xe(pm,[["render",xm]]);function Sm(e){return new Int8Array(e)}function yi(e){return new Int16Array(e)}function xi(e){return new Int32Array(e)}function wi(e){return new Float32Array(e)}function km(e){return new Float64Array(e)}function Si(e){if(e.length==1)return wi(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(Si(e));return a}function ki(e){if(e.length==1)return xi(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(ki(e));return a}function Ei(e){if(e.length==1)return yi(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(Ei(e));return a}function Mi(e){if(e.length==1)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var a=[],n=0;n<t;n++)a.push(Mi(e));return a}var Ri={};Ri.fill=function(e,t,a,n){if(arguments.length==2)for(var m=0;m<e.length;m++)e[m]=arguments[1];else for(var m=t;m<a;m++)e[m]=n};var Fr={};Fr.arraycopy=function(e,t,a,n,m){for(var s=t+m;t<s;)a[n++]=e[t++]},Fr.out={},Fr.out.println=function(e){console.log(e)},Fr.out.printf=function(){console.log.apply(console,arguments)};var wo={};wo.SQRT2=1.4142135623730951,wo.FAST_LOG10=function(e){return Math.log10(e)},wo.FAST_LOG10_X=function(e,t){return Math.log10(e)*t};function ha(e){this.ordinal=e}ha.short_block_allowed=new ha(0),ha.short_block_coupled=new ha(1),ha.short_block_dispensed=new ha(2),ha.short_block_forced=new ha(3);var Ai={};Ai.MAX_VALUE=34028235e31;function jt(e){this.ordinal=e}jt.vbr_off=new jt(0),jt.vbr_mt=new jt(1),jt.vbr_rh=new jt(2),jt.vbr_abr=new jt(3),jt.vbr_mtrh=new jt(4),jt.vbr_default=jt.vbr_mtrh;var Em=function(e){},We={System:Fr,VbrMode:jt,Float:Ai,ShortBlock:ha,Util:wo,Arrays:Ri,new_array_n:Mi,new_byte:Sm,new_double:km,new_float:wi,new_float_n:Si,new_int:xi,new_int_n:ki,new_short:yi,new_short_n:Ei,assert:Em};function Qt(e){var t=e;this.ordinal=function(){return t}}Qt.STEREO=new Qt(0),Qt.JOINT_STEREO=new Qt(1),Qt.DUAL_CHANNEL=new Qt(2),Qt.MONO=new Qt(3),Qt.NOT_SET=new Qt(4);var Dr=Qt,So=We,Mm=So.System,rt=So.Util,Rm=So.Arrays,Am=So.new_float,Ht=Rt;function Tm(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*rt.SQRT2*.5/2384e-9,.017876148*rt.SQRT2*.5/2384e-9,.003134727*rt.SQRT2*.5/2384e-9,.002457142*rt.SQRT2*.5/2384e-9,971317e-9*rt.SQRT2*.5/2384e-9,218868e-9*rt.SQRT2*.5/2384e-9,101566e-9*rt.SQRT2*.5/2384e-9,13828e-9*rt.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],t=12,a=36,n=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],m=n[Ht.SHORT_TYPE],s=n[Ht.SHORT_TYPE],R=n[Ht.SHORT_TYPE],E=n[Ht.SHORT_TYPE],N=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function L(x,y,o){for(var S=10,j=y+238-14-286,I=-15;I<0;I++){var v,g,O;v=e[S+-10],g=x[j+-224]*v,O=x[y+224]*v,v=e[S+-9],g+=x[j+-160]*v,O+=x[y+160]*v,v=e[S+-8],g+=x[j+-96]*v,O+=x[y+96]*v,v=e[S+-7],g+=x[j+-32]*v,O+=x[y+32]*v,v=e[S+-6],g+=x[j+32]*v,O+=x[y+-32]*v,v=e[S+-5],g+=x[j+96]*v,O+=x[y+-96]*v,v=e[S+-4],g+=x[j+160]*v,O+=x[y+-160]*v,v=e[S+-3],g+=x[j+224]*v,O+=x[y+-224]*v,v=e[S+-2],g+=x[y+-256]*v,O-=x[j+256]*v,v=e[S+-1],g+=x[y+-192]*v,O-=x[j+192]*v,v=e[S+0],g+=x[y+-128]*v,O-=x[j+128]*v,v=e[S+1],g+=x[y+-64]*v,O-=x[j+64]*v,v=e[S+2],g+=x[y+0]*v,O-=x[j+0]*v,v=e[S+3],g+=x[y+64]*v,O-=x[j+-64]*v,v=e[S+4],g+=x[y+128]*v,O-=x[j+-128]*v,v=e[S+5],g+=x[y+192]*v,O-=x[j+-192]*v,g*=e[S+6],v=O-g,o[30+I*2]=O+g,o[31+I*2]=e[S+7]*v,S+=18,y--,j++}{var g,O,F,T;O=x[y+-16]*e[S+-10],g=x[y+-32]*e[S+-2],O+=(x[y+-48]-x[y+16])*e[S+-9],g+=x[y+-96]*e[S+-1],O+=(x[y+-80]+x[y+48])*e[S+-8],g+=x[y+-160]*e[S+0],O+=(x[y+-112]-x[y+80])*e[S+-7],g+=x[y+-224]*e[S+1],O+=(x[y+-144]+x[y+112])*e[S+-6],g-=x[y+32]*e[S+2],O+=(x[y+-176]-x[y+144])*e[S+-5],g-=x[y+96]*e[S+3],O+=(x[y+-208]+x[y+176])*e[S+-4],g-=x[y+160]*e[S+4],O+=(x[y+-240]-x[y+208])*e[S+-3],g-=x[y+224],F=g-O,T=g+O,O=o[14],g=o[15]-O,o[31]=T+O,o[30]=F+g,o[15]=F-g,o[14]=T-O}{var l;l=o[28]-o[0],o[0]+=o[28],o[28]=l*e[S+-2*18+7],l=o[29]-o[1],o[1]+=o[29],o[29]=l*e[S+-2*18+7],l=o[26]-o[2],o[2]+=o[26],o[26]=l*e[S+-4*18+7],l=o[27]-o[3],o[3]+=o[27],o[27]=l*e[S+-4*18+7],l=o[24]-o[4],o[4]+=o[24],o[24]=l*e[S+-6*18+7],l=o[25]-o[5],o[5]+=o[25],o[25]=l*e[S+-6*18+7],l=o[22]-o[6],o[6]+=o[22],o[22]=l*rt.SQRT2,l=o[23]-o[7],o[7]+=o[23],o[23]=l*rt.SQRT2-o[7],o[7]-=o[6],o[22]-=o[7],o[23]-=o[22],l=o[6],o[6]=o[31]-l,o[31]=o[31]+l,l=o[7],o[7]=o[30]-l,o[30]=o[30]+l,l=o[22],o[22]=o[15]-l,o[15]=o[15]+l,l=o[23],o[23]=o[14]-l,o[14]=o[14]+l,l=o[20]-o[8],o[8]+=o[20],o[20]=l*e[S+-10*18+7],l=o[21]-o[9],o[9]+=o[21],o[21]=l*e[S+-10*18+7],l=o[18]-o[10],o[10]+=o[18],o[18]=l*e[S+-12*18+7],l=o[19]-o[11],o[11]+=o[19],o[19]=l*e[S+-12*18+7],l=o[16]-o[12],o[12]+=o[16],o[16]=l*e[S+-14*18+7],l=o[17]-o[13],o[13]+=o[17],o[17]=l*e[S+-14*18+7],l=-o[20]+o[24],o[20]+=o[24],o[24]=l*e[S+-12*18+7],l=-o[21]+o[25],o[21]+=o[25],o[25]=l*e[S+-12*18+7],l=o[4]-o[8],o[4]+=o[8],o[8]=l*e[S+-12*18+7],l=o[5]-o[9],o[5]+=o[9],o[9]=l*e[S+-12*18+7],l=o[0]-o[12],o[0]+=o[12],o[12]=l*e[S+-4*18+7],l=o[1]-o[13],o[1]+=o[13],o[13]=l*e[S+-4*18+7],l=o[16]-o[28],o[16]+=o[28],o[28]=l*e[S+-4*18+7],l=-o[17]+o[29],o[17]+=o[29],o[29]=l*e[S+-4*18+7],l=rt.SQRT2*(o[2]-o[10]),o[2]+=o[10],o[10]=l,l=rt.SQRT2*(o[3]-o[11]),o[3]+=o[11],o[11]=l,l=rt.SQRT2*(-o[18]+o[26]),o[18]+=o[26],o[26]=l-o[18],l=rt.SQRT2*(-o[19]+o[27]),o[19]+=o[27],o[27]=l-o[19],l=o[2],o[19]-=o[3],o[3]-=l,o[2]=o[31]-l,o[31]+=l,l=o[3],o[11]-=o[19],o[18]-=l,o[3]=o[30]-l,o[30]+=l,l=o[18],o[27]-=o[11],o[19]-=l,o[18]=o[15]-l,o[15]+=l,l=o[19],o[10]-=l,o[19]=o[14]-l,o[14]+=l,l=o[10],o[11]-=l,o[10]=o[23]-l,o[23]+=l,l=o[11],o[26]-=l,o[11]=o[22]-l,o[22]+=l,l=o[26],o[27]-=l,o[26]=o[7]-l,o[7]+=l,l=o[27],o[27]=o[6]-l,o[6]+=l,l=rt.SQRT2*(o[0]-o[4]),o[0]+=o[4],o[4]=l,l=rt.SQRT2*(o[1]-o[5]),o[1]+=o[5],o[5]=l,l=rt.SQRT2*(o[16]-o[20]),o[16]+=o[20],o[20]=l,l=rt.SQRT2*(o[17]-o[21]),o[17]+=o[21],o[21]=l,l=-rt.SQRT2*(o[8]-o[12]),o[8]+=o[12],o[12]=l-o[8],l=-rt.SQRT2*(o[9]-o[13]),o[9]+=o[13],o[13]=l-o[9],l=-rt.SQRT2*(o[25]-o[29]),o[25]+=o[29],o[29]=l-o[25],l=-rt.SQRT2*(o[24]+o[28]),o[24]-=o[28],o[28]=l-o[24],l=o[24]-o[16],o[24]=l,l=o[20]-l,o[20]=l,l=o[28]-l,o[28]=l,l=o[25]-o[17],o[25]=l,l=o[21]-l,o[21]=l,l=o[29]-l,o[29]=l,l=o[17]-o[1],o[17]=l,l=o[9]-l,o[9]=l,l=o[25]-l,o[25]=l,l=o[5]-l,o[5]=l,l=o[21]-l,o[21]=l,l=o[13]-l,o[13]=l,l=o[29]-l,o[29]=l,l=o[1]-o[0],o[1]=l,l=o[16]-l,o[16]=l,l=o[17]-l,o[17]=l,l=o[8]-l,o[8]=l,l=o[9]-l,o[9]=l,l=o[24]-l,o[24]=l,l=o[25]-l,o[25]=l,l=o[4]-l,o[4]=l,l=o[5]-l,o[5]=l,l=o[20]-l,o[20]=l,l=o[21]-l,o[21]=l,l=o[12]-l,o[12]=l,l=o[13]-l,o[13]=l,l=o[28]-l,o[28]=l,l=o[29]-l,o[29]=l,l=o[0],o[0]+=o[31],o[31]-=l,l=o[1],o[1]+=o[30],o[30]-=l,l=o[16],o[16]+=o[15],o[15]-=l,l=o[17],o[17]+=o[14],o[14]-=l,l=o[8],o[8]+=o[23],o[23]-=l,l=o[9],o[9]+=o[22],o[22]-=l,l=o[24],o[24]+=o[7],o[7]-=l,l=o[25],o[25]+=o[6],o[6]-=l,l=o[4],o[4]+=o[27],o[27]-=l,l=o[5],o[5]+=o[26],o[26]-=l,l=o[20],o[20]+=o[11],o[11]-=l,l=o[21],o[21]+=o[10],o[10]-=l,l=o[12],o[12]+=o[19],o[19]-=l,l=o[13],o[13]+=o[18],o[18]-=l,l=o[28],o[28]+=o[3],o[3]-=l,l=o[29],o[29]+=o[2],o[2]-=l}}function k(x,y){for(var o=0;o<3;o++){var S,j,I,v,g,O;v=x[y+2*3]*n[Ht.SHORT_TYPE][0]-x[y+5*3],S=x[y+0*3]*n[Ht.SHORT_TYPE][2]-x[y+3*3],j=v+S,I=v-S,v=x[y+5*3]*n[Ht.SHORT_TYPE][0]+x[y+2*3],S=x[y+3*3]*n[Ht.SHORT_TYPE][2]+x[y+0*3],g=v+S,O=-v+S,S=(x[y+1*3]*n[Ht.SHORT_TYPE][1]-x[y+4*3])*2069978111953089e-26,v=(x[y+4*3]*n[Ht.SHORT_TYPE][1]+x[y+1*3])*2069978111953089e-26,x[y+3*0]=j*190752519173728e-25+S,x[y+3*5]=-g*190752519173728e-25+v,I=I*.8660254037844387*1907525191737281e-26,g=g*.5*1907525191737281e-26+v,x[y+3*1]=I-g,x[y+3*2]=I+g,j=j*.5*1907525191737281e-26-S,O=O*.8660254037844387*1907525191737281e-26,x[y+3*3]=j+O,x[y+3*4]=j-O,y++}}function f(x,y,o){var S,j;{var I,v,g,O,F,T,l,B;I=o[17]-o[9],g=o[15]-o[11],O=o[14]-o[12],F=o[0]+o[8],T=o[1]+o[7],l=o[2]+o[6],B=o[3]+o[5],x[y+17]=F+l-B-(T-o[4]),j=(F+l-B)*s[12+7]+(T-o[4]),S=(I-g-O)*s[12+6],x[y+5]=S+j,x[y+6]=S-j,v=(o[16]-o[10])*s[12+6],T=T*s[12+7]+o[4],S=I*s[12+0]+v+g*s[12+1]+O*s[12+2],j=-F*s[12+4]+T-l*s[12+5]+B*s[12+3],x[y+1]=S+j,x[y+2]=S-j,S=I*s[12+1]-v-g*s[12+2]+O*s[12+0],j=-F*s[12+5]+T-l*s[12+3]+B*s[12+4],x[y+9]=S+j,x[y+10]=S-j,S=I*s[12+2]-v+g*s[12+0]-O*s[12+1],j=F*s[12+3]-T+l*s[12+4]-B*s[12+5],x[y+13]=S+j,x[y+14]=S-j}{var w,d,h,b,i,u,_,A;w=o[8]-o[0],h=o[6]-o[2],b=o[5]-o[3],i=o[17]+o[9],u=o[16]+o[10],_=o[15]+o[11],A=o[14]+o[12],x[y+0]=i+_+A+(u+o[13]),S=(i+_+A)*s[12+7]-(u+o[13]),j=(w-h+b)*s[12+6],x[y+11]=S+j,x[y+12]=S-j,d=(o[7]-o[1])*s[12+6],u=o[13]-u*s[12+7],S=i*s[12+3]-u+_*s[12+4]+A*s[12+5],j=w*s[12+2]+d+h*s[12+0]+b*s[12+1],x[y+3]=S+j,x[y+4]=S-j,S=-i*s[12+5]+u-_*s[12+3]-A*s[12+4],j=w*s[12+1]+d-h*s[12+2]-b*s[12+0],x[y+7]=S+j,x[y+8]=S-j,S=-i*s[12+4]+u-_*s[12+5]-A*s[12+3],j=w*s[12+0]-d+h*s[12+1]-b*s[12+2],x[y+15]=S+j,x[y+16]=S-j}}this.mdct_sub48=function(x,y,o){for(var S=y,j=286,I=0;I<x.channels_out;I++){for(var v=0;v<x.mode_gr;v++){for(var g,O=x.l3_side.tt[v][I],F=O.xr,T=0,l=x.sb_sample[I][1-v],B=0,w=0;w<18/2;w++)for(L(S,j,l[B]),L(S,j+32,l[B+1]),B+=2,j+=64,g=1;g<32;g+=2)l[B-1][g]*=-1;for(g=0;g<32;g++,T+=18){var d=O.block_type,h=x.sb_sample[I][v],b=x.sb_sample[I][1-v];if(O.mixed_block_flag!=0&&g<2&&(d=0),x.amp_filter[g]<1e-12)Rm.fill(F,T+0,T+18,0);else{if(x.amp_filter[g]<1)for(var w=0;w<18;w++)b[w][N[g]]*=x.amp_filter[g];if(d==Ht.SHORT_TYPE){for(var w=-t/4;w<0;w++){var i=n[Ht.SHORT_TYPE][w+3];F[T+w*3+9]=h[9+w][N[g]]*i-h[8-w][N[g]],F[T+w*3+18]=h[14-w][N[g]]*i+h[15+w][N[g]],F[T+w*3+10]=h[15+w][N[g]]*i-h[14-w][N[g]],F[T+w*3+19]=b[2-w][N[g]]*i+b[3+w][N[g]],F[T+w*3+11]=b[3+w][N[g]]*i-b[2-w][N[g]],F[T+w*3+20]=b[8-w][N[g]]*i+b[9+w][N[g]]}k(F,T)}else{for(var u=Am(18),w=-a/4;w<0;w++){var _,A;_=n[d][w+27]*b[w+9][N[g]]+n[d][w+36]*b[8-w][N[g]],A=n[d][w+9]*h[w+9][N[g]]-n[d][w+18]*h[8-w][N[g]],u[w+9]=_-A*m[3+w+9],u[w+18]=_*m[3+w+9]+A}f(F,T,u)}}if(d!=Ht.SHORT_TYPE&&g!=0)for(var w=7;w>=0;--w){var z,H;z=F[T+w]*R[20+w]+F[T+-1-w]*E[28+w],H=F[T+w]*E[28+w]-F[T+-1-w]*R[20+w],F[T+-1-w]=z,F[T+w]=H}}}if(S=o,j=286,x.mode_gr==1)for(var U=0;U<18;U++)Mm.arraycopy(x.sb_sample[I][1][U],0,x.sb_sample[I][0][U],0,32)}}}var Bm=Tm,ko=Rt,ws=We,Cm=ws.System,Om=ws.new_float,Nm=ws.new_float_n;function Im(){this.l=Om(ko.SBMAX_l),this.s=Nm([ko.SBMAX_s,3]);var e=this;this.assign=function(t){Cm.arraycopy(t.l,0,e.l,0,ko.SBMAX_l);for(var a=0;a<ko.SBMAX_s;a++)for(var n=0;n<3;n++)e.s[a][n]=t.s[a][n]}}var Ti=Im,Bi=Ti;function Lm(){this.thm=new Bi,this.en=new Bi}var Vm=Lm,Na=We,Ci=Na.System,Eo=Na.VbrMode,Oi=Na.new_array_n,Ni=Na.new_float,jm=Na.new_float_n,Hm=Na.new_int,Mo=Na.assert;Ne.ENCDELAY=576,Ne.POSTDELAY=1152,Ne.MDCTDELAY=48,Ne.FFTOFFSET=224+Ne.MDCTDELAY,Ne.DECDELAY=528,Ne.SBLIMIT=32,Ne.CBANDS=64,Ne.SBPSY_l=21,Ne.SBPSY_s=12,Ne.SBMAX_l=22,Ne.SBMAX_s=13,Ne.PSFB21=6,Ne.PSFB12=6,Ne.BLKSIZE=1024,Ne.HBLKSIZE=Ne.BLKSIZE/2+1,Ne.BLKSIZE_s=256,Ne.HBLKSIZE_s=Ne.BLKSIZE_s/2+1,Ne.NORM_TYPE=0,Ne.START_TYPE=1,Ne.SHORT_TYPE=2,Ne.STOP_TYPE=3,Ne.MPG_MD_LR_LR=0,Ne.MPG_MD_LR_I=1,Ne.MPG_MD_MS_LR=2,Ne.MPG_MD_MS_I=3,Ne.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function Ne(){var e=Dr,t=Bm,a=Vm,n=Ne.FFTOFFSET,m=Ne.MPG_MD_MS_LR,s=null;this.psy=null;var R=null,E=null,N=null;this.setModules=function(y,o,S,j){s=y,this.psy=o,R=o,E=j,N=S};var L=new t;function k(y){var o,S;if(y.ATH.useAdjust==0){y.ATH.adjust=1;return}if(S=y.loudness_sq[0][0],o=y.loudness_sq[1][0],y.channels_out==2?(S+=y.loudness_sq[0][1],o+=y.loudness_sq[1][1]):(S+=S,o+=o),y.mode_gr==2&&(S=Math.max(S,o)),S*=.5,S*=y.ATH.aaSensitivityP,S>.03125)y.ATH.adjust>=1?y.ATH.adjust=1:y.ATH.adjust<y.ATH.adjustLimit&&(y.ATH.adjust=y.ATH.adjustLimit),y.ATH.adjustLimit=1;else{var j=31.98*S+625e-6;y.ATH.adjust>=j?(y.ATH.adjust*=j*.075+.925,y.ATH.adjust<j&&(y.ATH.adjust=j)):y.ATH.adjustLimit>=j?y.ATH.adjust=j:y.ATH.adjust<y.ATH.adjustLimit&&(y.ATH.adjust=y.ATH.adjustLimit),y.ATH.adjustLimit=j}}function f(y){var o,S;for(Mo(0<=y.bitrate_index&&y.bitrate_index<16),Mo(0<=y.mode_ext&&y.mode_ext<4),y.bitrate_stereoMode_Hist[y.bitrate_index][4]++,y.bitrate_stereoMode_Hist[15][4]++,y.channels_out==2&&(y.bitrate_stereoMode_Hist[y.bitrate_index][y.mode_ext]++,y.bitrate_stereoMode_Hist[15][y.mode_ext]++),o=0;o<y.mode_gr;++o)for(S=0;S<y.channels_out;++S){var j=y.l3_side.tt[o][S].block_type|0;y.l3_side.tt[o][S].mixed_block_flag!=0&&(j=4),y.bitrate_blockType_Hist[y.bitrate_index][j]++,y.bitrate_blockType_Hist[y.bitrate_index][5]++,y.bitrate_blockType_Hist[15][j]++,y.bitrate_blockType_Hist[15][5]++}}function x(y,o){var S=y.internal_flags,j,I;if(S.lame_encode_frame_init==0){var v,g,O=Ni(2014),F=Ni(286+1152+576);for(S.lame_encode_frame_init=1,v=0,g=0;v<286+576*(1+S.mode_gr);++v)v<576*S.mode_gr?(O[v]=0,S.channels_out==2&&(F[v]=0)):(O[v]=o[0][g],S.channels_out==2&&(F[v]=o[1][g]),++g);for(I=0;I<S.mode_gr;I++)for(j=0;j<S.channels_out;j++)S.l3_side.tt[I][j].block_type=Ne.SHORT_TYPE;L.mdct_sub48(S,O,F),Mo(S.mf_size>=Ne.BLKSIZE+y.framesize-Ne.FFTOFFSET),Mo(S.mf_size>=512+y.framesize-32)}}this.lame_encode_mp3_frame=function(y,o,S,j,I,v){var g,O=Oi([2,2]);O[0][0]=new a,O[0][1]=new a,O[1][0]=new a,O[1][1]=new a;var F=Oi([2,2]);F[0][0]=new a,F[0][1]=new a,F[1][0]=new a,F[1][1]=new a;var T,l=[null,null],B=y.internal_flags,w=jm([2,4]),d=[.5,.5],h=[[0,0],[0,0]],b=[[0,0],[0,0]],i,u,_;if(l[0]=o,l[1]=S,B.lame_encode_frame_init==0&&x(y,l),B.padding=0,(B.slot_lag-=B.frac_SpF)<0&&(B.slot_lag+=y.out_samplerate,B.padding=1),B.psymodel!=0){var A,z=[null,null],H=0,U=Hm(2);for(_=0;_<B.mode_gr;_++){for(u=0;u<B.channels_out;u++)z[u]=l[u],H=576+_*576-Ne.FFTOFFSET;if(y.VBR==Eo.vbr_mtrh||y.VBR==Eo.vbr_mt?A=R.L3psycho_anal_vbr(y,z,H,_,O,F,h[_],b[_],w[_],U):A=R.L3psycho_anal_ns(y,z,H,_,O,F,h[_],b[_],w[_],U),A!=0)return-4;for(y.mode==e.JOINT_STEREO&&(d[_]=w[_][2]+w[_][3],d[_]>0&&(d[_]=w[_][3]/d[_])),u=0;u<B.channels_out;u++){var Q=B.l3_side.tt[_][u];Q.block_type=U[u],Q.mixed_block_flag=0}}}else for(_=0;_<B.mode_gr;_++)for(u=0;u<B.channels_out;u++)B.l3_side.tt[_][u].block_type=Ne.NORM_TYPE,B.l3_side.tt[_][u].mixed_block_flag=0,b[_][u]=h[_][u]=700;if(k(B),L.mdct_sub48(B,l[0],l[1]),B.mode_ext=Ne.MPG_MD_LR_LR,y.force_ms)B.mode_ext=Ne.MPG_MD_MS_LR;else if(y.mode==e.JOINT_STEREO){var c=0,p=0;for(_=0;_<B.mode_gr;_++)for(u=0;u<B.channels_out;u++)c+=b[_][u],p+=h[_][u];if(c<=1*p){var K=B.l3_side.tt[0],J=B.l3_side.tt[B.mode_gr-1];K[0].block_type==K[1].block_type&&J[0].block_type==J[1].block_type&&(B.mode_ext=Ne.MPG_MD_MS_LR)}}if(B.mode_ext==m?(T=F,i=b):(T=O,i=h),y.analysis&&B.pinfo!=null)for(_=0;_<B.mode_gr;_++)for(u=0;u<B.channels_out;u++)B.pinfo.ms_ratio[_]=B.ms_ratio[_],B.pinfo.ms_ener_ratio[_]=d[_],B.pinfo.blocktype[_][u]=B.l3_side.tt[_][u].block_type,B.pinfo.pe[_][u]=i[_][u],Ci.arraycopy(B.l3_side.tt[_][u].xr,0,B.pinfo.xr[_][u],0,576),B.mode_ext==m&&(B.pinfo.ers[_][u]=B.pinfo.ers[_][u+2],Ci.arraycopy(B.pinfo.energy[_][u+2],0,B.pinfo.energy[_][u],0,B.pinfo.energy[_][u].length));if(y.VBR==Eo.vbr_off||y.VBR==Eo.vbr_abr){var ce,ue;for(ce=0;ce<18;ce++)B.nsPsy.pefirbuf[ce]=B.nsPsy.pefirbuf[ce+1];for(ue=0,_=0;_<B.mode_gr;_++)for(u=0;u<B.channels_out;u++)ue+=i[_][u];for(B.nsPsy.pefirbuf[18]=ue,ue=B.nsPsy.pefirbuf[9],ce=0;ce<9;ce++)ue+=(B.nsPsy.pefirbuf[ce]+B.nsPsy.pefirbuf[18-ce])*Ne.fircoef[ce];for(ue=670*5*B.mode_gr*B.channels_out/ue,_=0;_<B.mode_gr;_++)for(u=0;u<B.channels_out;u++)i[_][u]*=ue}if(B.iteration_loop.iteration_loop(y,i,d,T),s.format_bitstream(y),g=s.copy_buffer(B,j,I,v,1),y.bWriteVbrTag&&E.addVbrFrame(y),y.analysis&&B.pinfo!=null){for(u=0;u<B.channels_out;u++){var me;for(me=0;me<n;me++)B.pinfo.pcmdata[u][me]=B.pinfo.pcmdata[u][me+y.framesize];for(me=n;me<1600;me++)B.pinfo.pcmdata[u][me]=l[u][me-n]}N.set_frame_pinfo(y,T)}return f(B),g}}var Rt=Ne,Ii=We,Li=Ii.Util,Vi=Ii.new_float,lt=Rt;function Pm(){var e=Vi(lt.BLKSIZE),t=Vi(lt.BLKSIZE_s/2),a=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function n(s,R,E){var N=0,L,k,f;E<<=1;var x=R+E;L=4;do{var y,o,S,j,I,v,g;g=L>>1,j=L,I=L<<1,v=I+j,L=I<<1,k=R,f=k+g;do{var O,F,T,l;F=s[k+0]-s[k+j],O=s[k+0]+s[k+j],l=s[k+I]-s[k+v],T=s[k+I]+s[k+v],s[k+I]=O-T,s[k+0]=O+T,s[k+v]=F-l,s[k+j]=F+l,F=s[f+0]-s[f+j],O=s[f+0]+s[f+j],l=Li.SQRT2*s[f+v],T=Li.SQRT2*s[f+I],s[f+I]=O-T,s[f+0]=O+T,s[f+v]=F-l,s[f+j]=F+l,f+=L,k+=L}while(k<x);for(o=a[N+0],y=a[N+1],S=1;S<g;S++){var B,w;B=1-2*y*y,w=2*y*o,k=R+S,f=R+j-S;do{var d,h,b,O,F,i,T,u,l,_;h=w*s[k+j]-B*s[f+j],d=B*s[k+j]+w*s[f+j],F=s[k+0]-d,O=s[k+0]+d,i=s[f+0]-h,b=s[f+0]+h,h=w*s[k+v]-B*s[f+v],d=B*s[k+v]+w*s[f+v],l=s[k+I]-d,T=s[k+I]+d,_=s[f+I]-h,u=s[f+I]+h,h=y*T-o*_,d=o*T+y*_,s[k+I]=O-d,s[k+0]=O+d,s[f+v]=i-h,s[f+j]=i+h,h=o*u-y*l,d=y*u+o*l,s[f+I]=b-d,s[f+0]=b+d,s[k+v]=F-h,s[k+j]=F+h,f+=L,k+=L}while(k<x);B=o,o=B*a[N+0]-y*a[N+1],y=B*a[N+1]+y*a[N+0]}N+=2}while(L<E)}var m=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,R,E,N,L){for(var k=0;k<3;k++){var f=lt.BLKSIZE_s/2,x=65535&576/3*(k+1),y=lt.BLKSIZE_s/8-1;do{var o,S,j,I,v,g=m[y<<2]&255;o=t[g]*N[E][L+g+x],v=t[127-g]*N[E][L+g+x+128],S=o-v,o=o+v,j=t[g+64]*N[E][L+g+x+64],v=t[63-g]*N[E][L+g+x+192],I=j-v,j=j+v,f-=4,R[k][f+0]=o+j,R[k][f+2]=o-j,R[k][f+1]=S+I,R[k][f+3]=S-I,o=t[g+1]*N[E][L+g+x+1],v=t[126-g]*N[E][L+g+x+129],S=o-v,o=o+v,j=t[g+65]*N[E][L+g+x+65],v=t[62-g]*N[E][L+g+x+193],I=j-v,j=j+v,R[k][f+lt.BLKSIZE_s/2+0]=o+j,R[k][f+lt.BLKSIZE_s/2+2]=o-j,R[k][f+lt.BLKSIZE_s/2+1]=S+I,R[k][f+lt.BLKSIZE_s/2+3]=S-I}while(--y>=0);n(R[k],f,lt.BLKSIZE_s/2)}},this.fft_long=function(s,R,E,N,L){var k=lt.BLKSIZE/8-1,f=lt.BLKSIZE/2;do{var x,y,o,S,j,I=m[k]&255;x=e[I]*N[E][L+I],j=e[I+512]*N[E][L+I+512],y=x-j,x=x+j,o=e[I+256]*N[E][L+I+256],j=e[I+768]*N[E][L+I+768],S=o-j,o=o+j,f-=4,R[f+0]=x+o,R[f+2]=x-o,R[f+1]=y+S,R[f+3]=y-S,x=e[I+1]*N[E][L+I+1],j=e[I+513]*N[E][L+I+513],y=x-j,x=x+j,o=e[I+257]*N[E][L+I+257],j=e[I+769]*N[E][L+I+769],S=o-j,o=o+j,R[f+lt.BLKSIZE/2+0]=x+o,R[f+lt.BLKSIZE/2+2]=x-o,R[f+lt.BLKSIZE/2+1]=y+S,R[f+lt.BLKSIZE/2+3]=y-S}while(--k>=0);n(R,f,lt.BLKSIZE/2)},this.init_fft=function(s){for(var R=0;R<lt.BLKSIZE;R++)e[R]=.42-.5*Math.cos(2*Math.PI*(R+.5)/lt.BLKSIZE)+.08*Math.cos(4*Math.PI*(R+.5)/lt.BLKSIZE);for(var R=0;R<lt.BLKSIZE_s/2;R++)t[R]=.5*(1-Math.cos(2*Math.PI*(R+.5)/lt.BLKSIZE_s))}}var Fm=Pm,ua=We,or=ua.VbrMode,ji=ua.Float,sr=ua.ShortBlock,Ct=ua.Util,Dm=ua.Arrays,dt=ua.new_float,Xt=ua.new_float_n,Ia=ua.new_int,Ce=ua.assert,Um=Fm,re=Rt;function zm(){var e=Dr,t=new Um,a=2.302585092994046,n=2,m=16,s=2,R=16,E=.34,N=1/(14752*14752)/(re.BLKSIZE/2),L=.01,k=.8,f=.6,x=.3,y=3.5,o=21,S=.2302585093;function j(M){return M}function I(M,C){for(var P=0,D=0;D<re.BLKSIZE/2;++D)P+=M[D]*C.ATH.eql_w[D];return P*=N,P}function v(M,C,P,D,X,V,Y,G,q,te,Z){var ae=M.internal_flags;if(q<2)t.fft_long(ae,D[X],q,te,Z),t.fft_short(ae,V[Y],q,te,Z);else if(q==2){for(var _e=re.BLKSIZE-1;_e>=0;--_e){var Ee=D[X+0][_e],se=D[X+1][_e];D[X+0][_e]=(Ee+se)*Ct.SQRT2*.5,D[X+1][_e]=(Ee-se)*Ct.SQRT2*.5}for(var ke=2;ke>=0;--ke)for(var _e=re.BLKSIZE_s-1;_e>=0;--_e){var Ee=V[Y+0][ke][_e],se=V[Y+1][ke][_e];V[Y+0][ke][_e]=(Ee+se)*Ct.SQRT2*.5,V[Y+1][ke][_e]=(Ee-se)*Ct.SQRT2*.5}}C[0]=D[X+0][0],C[0]*=C[0];for(var _e=re.BLKSIZE/2-1;_e>=0;--_e){var $=D[X+0][re.BLKSIZE/2-_e],be=D[X+0][re.BLKSIZE/2+_e];C[re.BLKSIZE/2-_e]=($*$+be*be)*.5}for(var ke=2;ke>=0;--ke){P[ke][0]=V[Y+0][ke][0],P[ke][0]*=P[ke][0];for(var _e=re.BLKSIZE_s/2-1;_e>=0;--_e){var $=V[Y+0][ke][re.BLKSIZE_s/2-_e],be=V[Y+0][ke][re.BLKSIZE_s/2+_e];P[ke][re.BLKSIZE_s/2-_e]=($*$+be*be)*.5}}{for(var Be=0,_e=11;_e<re.HBLKSIZE;_e++)Be+=C[_e];ae.tot_ener[q]=Be}if(M.analysis){for(var _e=0;_e<re.HBLKSIZE;_e++)ae.pinfo.energy[G][q][_e]=ae.pinfo.energy_save[q][_e],ae.pinfo.energy_save[q][_e]=C[_e];ae.pinfo.pe[G][q]=ae.pe[q]}M.athaa_loudapprox==2&&q<2&&(ae.loudness_sq[G][q]=ae.loudness_sq_save[q],ae.loudness_sq_save[q]=I(C,ae))}var g=8,O=23,F=15,T,l,B,w=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function d(){T=Math.pow(10,(g+1)/16),l=Math.pow(10,(O+1)/16),B=Math.pow(10,F/10)}var h=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],b=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],i=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function u(M,C,P,D,X,V){var Y;if(C>M)if(C<M*l)Y=C/M;else return M+C;else{if(M>=C*l)return M+C;Y=M/C}if(M+=C,D+3<=3+3){if(Y>=T)return M;var G=0|Ct.FAST_LOG10_X(Y,16);return M*b[G]}var G=0|Ct.FAST_LOG10_X(Y,16);if(V!=0?C=X.ATH.cb_s[P]*X.ATH.adjust:C=X.ATH.cb_l[P]*X.ATH.adjust,M<B*C){if(M>C){var q,te;return q=1,G<=13&&(q=i[G]),te=Ct.FAST_LOG10_X(M/C,10/15),M*((h[G]-q)*te+q)}return G>13?M:M*i[G]}return M*h[G]}var _=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function A(M,C,P){var D;if(M<0&&(M=0),C<0&&(C=0),M<=0)return C;if(C<=0)return M;if(C>M?D=C/M:D=M/C,-2<=P&&P<=2){if(D>=T)return M+C;var X=0|Ct.FAST_LOG10_X(D,16);return(M+C)*_[X]}return D<l?M+C:(M<C&&(M=C),M)}function z(M,C){var P=M.internal_flags;if(P.channels_out>1){for(var D=0;D<re.SBMAX_l;D++){var X=P.thm[0].l[D],V=P.thm[1].l[D];P.thm[0].l[D]+=V*C,P.thm[1].l[D]+=X*C}for(var D=0;D<re.SBMAX_s;D++)for(var Y=0;Y<3;Y++){var X=P.thm[0].s[D][Y],V=P.thm[1].s[D][Y];P.thm[0].s[D][Y]+=V*C,P.thm[1].s[D][Y]+=X*C}}}function H(M){for(var C=0;C<re.SBMAX_l;C++)if(!(M.thm[0].l[C]>1.58*M.thm[1].l[C]||M.thm[1].l[C]>1.58*M.thm[0].l[C])){var P=M.mld_l[C]*M.en[3].l[C],D=Math.max(M.thm[2].l[C],Math.min(M.thm[3].l[C],P));P=M.mld_l[C]*M.en[2].l[C];var X=Math.max(M.thm[3].l[C],Math.min(M.thm[2].l[C],P));M.thm[2].l[C]=D,M.thm[3].l[C]=X}for(var C=0;C<re.SBMAX_s;C++)for(var V=0;V<3;V++)if(!(M.thm[0].s[C][V]>1.58*M.thm[1].s[C][V]||M.thm[1].s[C][V]>1.58*M.thm[0].s[C][V])){var P=M.mld_s[C]*M.en[3].s[C][V],D=Math.max(M.thm[2].s[C][V],Math.min(M.thm[3].s[C][V],P));P=M.mld_s[C]*M.en[2].s[C][V];var X=Math.max(M.thm[3].s[C][V],Math.min(M.thm[2].s[C][V],P));M.thm[2].s[C][V]=D,M.thm[3].s[C][V]=X}}function U(M,C,P){var D=C,X=Math.pow(10,P);C*=2,D*=2;for(var V=0;V<re.SBMAX_l;V++){var Y,G,q,te;if(te=M.ATH.cb_l[M.bm_l[V]]*X,Y=Math.min(Math.max(M.thm[0].l[V],te),Math.max(M.thm[1].l[V],te)),G=Math.max(M.thm[2].l[V],te),q=Math.max(M.thm[3].l[V],te),Y*C<G+q){var Z=Y*D/(G+q);G*=Z,q*=Z}M.thm[2].l[V]=Math.min(G,M.thm[2].l[V]),M.thm[3].l[V]=Math.min(q,M.thm[3].l[V])}X*=re.BLKSIZE_s/re.BLKSIZE;for(var V=0;V<re.SBMAX_s;V++)for(var ae=0;ae<3;ae++){var Y,G,q,te;if(te=M.ATH.cb_s[M.bm_s[V]]*X,Y=Math.min(Math.max(M.thm[0].s[V][ae],te),Math.max(M.thm[1].s[V][ae],te)),G=Math.max(M.thm[2].s[V][ae],te),q=Math.max(M.thm[3].s[V][ae],te),Y*C<G+q){var Z=Y*C/(G+q);G*=Z,q*=Z}M.thm[2].s[V][ae]=Math.min(M.thm[2].s[V][ae],G),M.thm[3].s[V][ae]=Math.min(M.thm[3].s[V][ae],q)}}function Q(M,C,P,D,X){var V,Y,G=0,q=0;for(V=Y=0;V<re.SBMAX_s;++Y,++V){for(var te=M.bo_s[V],Z=M.npart_s,ae=te<Z?te:Z;Y<ae;)Ce(C[Y]>=0),Ce(P[Y]>=0),G+=C[Y],q+=P[Y],Y++;if(M.en[D].s[V][X]=G,M.thm[D].s[V][X]=q,Y>=Z){++V;break}Ce(C[Y]>=0),Ce(P[Y]>=0);{var _e=M.PSY.bo_s_weight[V],Ee=1-_e;G=_e*C[Y],q=_e*P[Y],M.en[D].s[V][X]+=G,M.thm[D].s[V][X]+=q,G=Ee*C[Y],q=Ee*P[Y]}}for(;V<re.SBMAX_s;++V)M.en[D].s[V][X]=0,M.thm[D].s[V][X]=0}function c(M,C,P,D){var X,V,Y=0,G=0;for(X=V=0;X<re.SBMAX_l;++V,++X){for(var q=M.bo_l[X],te=M.npart_l,Z=q<te?q:te;V<Z;)Ce(C[V]>=0),Ce(P[V]>=0),Y+=C[V],G+=P[V],V++;if(M.en[D].l[X]=Y,M.thm[D].l[X]=G,V>=te){++X;break}Ce(C[V]>=0),Ce(P[V]>=0);{var ae=M.PSY.bo_l_weight[X],_e=1-ae;Y=ae*C[V],G=ae*P[V],M.en[D].l[X]+=Y,M.thm[D].l[X]+=G,Y=_e*C[V],G=_e*P[V]}}for(;X<re.SBMAX_l;++X)M.en[D].l[X]=0,M.thm[D].l[X]=0}function p(M,C,P,D,X,V){var Y=M.internal_flags,G,q;for(q=G=0;q<Y.npart_s;++q){for(var te=0,Z=Y.numlines_s[q],ae=0;ae<Z;++ae,++G){var _e=C[V][G];te+=_e}P[q]=te}for(Ce(q==Y.npart_s),G=q=0;q<Y.npart_s;q++){var Ee=Y.s3ind_s[q][0],se=Y.s3_ss[G++]*P[Ee];for(++Ee;Ee<=Y.s3ind_s[q][1];)se+=Y.s3_ss[G]*P[Ee],++G,++Ee;{var ke=s*Y.nb_s1[X][q];D[q]=Math.min(se,ke)}if(Y.blocktype_old[X&1]==re.SHORT_TYPE){var ke=R*Y.nb_s2[X][q],$=D[q];D[q]=Math.min(ke,$)}Y.nb_s2[X][q]=Y.nb_s1[X][q],Y.nb_s1[X][q]=se,Ce(D[q]>=0)}for(;q<=re.CBANDS;++q)P[q]=0,D[q]=0}function K(M,C,P,D){var X=M.internal_flags;M.short_blocks==sr.short_block_coupled&&!(C[0]!=0&&C[1]!=0)&&(C[0]=C[1]=0);for(var V=0;V<X.channels_out;V++)D[V]=re.NORM_TYPE,M.short_blocks==sr.short_block_dispensed&&(C[V]=1),M.short_blocks==sr.short_block_forced&&(C[V]=0),C[V]!=0?(Ce(X.blocktype_old[V]!=re.START_TYPE),X.blocktype_old[V]==re.SHORT_TYPE&&(D[V]=re.STOP_TYPE)):(D[V]=re.SHORT_TYPE,X.blocktype_old[V]==re.NORM_TYPE&&(X.blocktype_old[V]=re.START_TYPE),X.blocktype_old[V]==re.STOP_TYPE&&(X.blocktype_old[V]=re.SHORT_TYPE)),P[V]=X.blocktype_old[V],X.blocktype_old[V]=D[V]}function J(M,C,P){return P>=1?M:P<=0?C:C>0?Math.pow(M/C,P)*C:0}var ce=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function ue(M,C){for(var P=309.07,D=0;D<re.SBMAX_s-1;D++)for(var X=0;X<3;X++){var V=M.thm.s[D][X];if(V>0){var Y=V*C,G=M.en.s[D][X];G>Y&&(G>Y*1e10?P+=ce[D]*(10*a):P+=ce[D]*Ct.FAST_LOG10(G/Y))}}return P}var me=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function fe(M,C){for(var P=281.0575,D=0;D<re.SBMAX_l-1;D++){var X=M.thm.l[D];if(X>0){var V=X*C,Y=M.en.l[D];Y>V&&(Y>V*1e10?P+=me[D]*(10*a):P+=me[D]*Ct.FAST_LOG10(Y/V))}}return P}function we(M,C,P,D,X){var V,Y;for(V=Y=0;V<M.npart_l;++V){var G=0,q=0,te;for(te=0;te<M.numlines_l[V];++te,++Y){var Z=C[Y];G+=Z,q<Z&&(q=Z)}P[V]=G,D[V]=q,X[V]=G*M.rnumlines_l[V],Ce(M.rnumlines_l[V]>=0),Ce(P[V]>=0),Ce(D[V]>=0),Ce(X[V]>=0)}}function ve(M,C,P,D){var X=w.length-1,V=0,Y=P[V]+P[V+1];if(Y>0){var G=C[V];G<C[V+1]&&(G=C[V+1]),Ce(M.numlines_l[V]+M.numlines_l[V+1]-1>0),Y=20*(G*2-Y)/(Y*(M.numlines_l[V]+M.numlines_l[V+1]-1));var q=0|Y;q>X&&(q=X),D[V]=q}else D[V]=0;for(V=1;V<M.npart_l-1;V++)if(Y=P[V-1]+P[V]+P[V+1],Y>0){var G=C[V-1];G<C[V]&&(G=C[V]),G<C[V+1]&&(G=C[V+1]),Ce(M.numlines_l[V-1]+M.numlines_l[V]+M.numlines_l[V+1]-1>0),Y=20*(G*3-Y)/(Y*(M.numlines_l[V-1]+M.numlines_l[V]+M.numlines_l[V+1]-1));var q=0|Y;q>X&&(q=X),D[V]=q}else D[V]=0;if(Ce(V==M.npart_l-1),Y=P[V-1]+P[V],Y>0){var G=C[V-1];G<C[V]&&(G=C[V]),Ce(M.numlines_l[V-1]+M.numlines_l[V]-1>0),Y=20*(G*2-Y)/(Y*(M.numlines_l[V-1]+M.numlines_l[V]-1));var q=0|Y;q>X&&(q=X),D[V]=q}else D[V]=0;Ce(V==M.npart_l-1)}var de=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(M,C,P,D,X,V,Y,G,q,te){var Z=M.internal_flags,ae=Xt([2,re.BLKSIZE]),_e=Xt([2,3,re.BLKSIZE_s]),Ee=dt(re.CBANDS+1),se=dt(re.CBANDS+1),ke=dt(re.CBANDS+2),$=Ia(2),be=Ia(2),Be,ne,ye,ie,Me,Ze,pe,Re,Oe=Xt([2,576]),Qe,Dt=Ia(re.CBANDS+2),ct=Ia(re.CBANDS+2);for(Dm.fill(ct,0),Be=Z.channels_out,M.mode==e.JOINT_STEREO&&(Be=4),M.VBR==or.vbr_off?Qe=Z.ResvMax==0?0:Z.ResvSize/Z.ResvMax*.5:M.VBR==or.vbr_rh||M.VBR==or.vbr_mtrh||M.VBR==or.vbr_mt?Qe=.6:Qe=1,ne=0;ne<Z.channels_out;ne++){var $e=C[ne],It=P+576-350-o+192;for(ie=0;ie<576;ie++){var Ut,zt;for(Ut=$e[It+ie+10],zt=0,Me=0;Me<(o-1)/2-1;Me+=2)Ut+=de[Me]*($e[It+ie+Me]+$e[It+ie+o-Me]),zt+=de[Me+1]*($e[It+ie+Me+1]+$e[It+ie+o-Me-1]);Oe[ne][ie]=Ut+zt}X[D][ne].en.assign(Z.en[ne]),X[D][ne].thm.assign(Z.thm[ne]),Be>2&&(V[D][ne].en.assign(Z.en[ne+2]),V[D][ne].thm.assign(Z.thm[ne+2]))}for(ne=0;ne<Be;ne++){var Jt,ea,Et=dt(12),ca=[0,0,0,0],ur=dt(12),Ds=1,p0,v0=dt(re.CBANDS),g0=dt(re.CBANDS),Je=[0,0,0,0],b0=dt(re.HBLKSIZE),y0=Xt([3,re.HBLKSIZE_s]);for(Ce(Z.npart_s<=re.CBANDS),Ce(Z.npart_l<=re.CBANDS),ie=0;ie<3;ie++)Et[ie]=Z.nsPsy.last_en_subshort[ne][ie+6],Ce(Z.nsPsy.last_en_subshort[ne][ie+4]>0),ur[ie]=Et[ie]/Z.nsPsy.last_en_subshort[ne][ie+4],ca[0]+=Et[ie];if(ne==2)for(ie=0;ie<576;ie++){var Us,zs;Us=Oe[0][ie],zs=Oe[1][ie],Oe[0][ie]=Us+zs,Oe[1][ie]=Us-zs}{var x0=Oe[ne&1],Gr=0;for(ie=0;ie<9;ie++){for(var Mf=Gr+64,gt=1;Gr<Mf;Gr++)gt<Math.abs(x0[Gr])&&(gt=Math.abs(x0[Gr]));Z.nsPsy.last_en_subshort[ne][ie]=Et[ie+3]=gt,ca[1+ie/3]+=gt,gt>Et[ie+3-2]?(Ce(Et[ie+3-2]>0),gt=gt/Et[ie+3-2]):Et[ie+3-2]>gt*10?gt=Et[ie+3-2]/(gt*10):gt=0,ur[ie+3]=gt}}if(M.analysis){var qs=ur[0];for(ie=1;ie<12;ie++)qs<ur[ie]&&(qs=ur[ie]);Z.pinfo.ers[D][ne]=Z.pinfo.ers_save[ne],Z.pinfo.ers_save[ne]=qs}for(p0=ne==3?Z.nsPsy.attackthre_s:Z.nsPsy.attackthre,ie=0;ie<12;ie++)Je[ie/3]==0&&ur[ie]>p0&&(Je[ie/3]=ie%3+1);for(ie=1;ie<4;ie++){var Xs;ca[ie-1]>ca[ie]?(Ce(ca[ie]>0),Xs=ca[ie-1]/ca[ie]):(Ce(ca[ie-1]>0),Xs=ca[ie]/ca[ie-1]),Xs<1.7&&(Je[ie]=0,ie==1&&(Je[0]=0))}for(Je[0]!=0&&Z.nsPsy.lastAttacks[ne]!=0&&(Je[0]=0),(Z.nsPsy.lastAttacks[ne]==3||Je[0]+Je[1]+Je[2]+Je[3]!=0)&&(Ds=0,Je[1]!=0&&Je[0]!=0&&(Je[1]=0),Je[2]!=0&&Je[1]!=0&&(Je[2]=0),Je[3]!=0&&Je[2]!=0&&(Je[3]=0)),ne<2?be[ne]=Ds:Ds==0&&(be[0]=be[1]=0),q[ne]=Z.tot_ener[ne],ea=_e,Jt=ae,v(M,b0,y0,Jt,ne&1,ea,ne&1,D,ne,C,P),we(Z,b0,Ee,v0,g0),ve(Z,v0,g0,Dt),Re=0;Re<3;Re++){var Ys,Lt;for(p(M,y0,se,ke,ne,Re),Q(Z,se,ke,ne,Re),pe=0;pe<re.SBMAX_s;pe++){if(Lt=Z.thm[ne].s[pe][Re],Lt*=k,Je[Re]>=2||Je[Re+1]==1){var Kr=Re!=0?Re-1:2,gt=J(Z.thm[ne].s[pe][Kr],Lt,f*Qe);Lt=Math.min(Lt,gt)}if(Je[Re]==1){var Kr=Re!=0?Re-1:2,gt=J(Z.thm[ne].s[pe][Kr],Lt,x*Qe);Lt=Math.min(Lt,gt)}else if(Re!=0&&Je[Re-1]==3||Re==0&&Z.nsPsy.lastAttacks[ne]==3){var Kr=Re!=2?Re+1:0,gt=J(Z.thm[ne].s[pe][Kr],Lt,x*Qe);Lt=Math.min(Lt,gt)}Ys=Et[Re*3+3]+Et[Re*3+4]+Et[Re*3+5],Et[Re*3+5]*6<Ys&&(Lt*=.5,Et[Re*3+4]*6<Ys&&(Lt*=.5)),Z.thm[ne].s[pe][Re]=Lt}}for(Z.nsPsy.lastAttacks[ne]=Je[2],Ze=0,ye=0;ye<Z.npart_l;ye++){for(var Ya=Z.s3ind[ye][0],Gs=Ee[Ya]*w[Dt[Ya]],Ga=Z.s3_ll[Ze++]*Gs;++Ya<=Z.s3ind[ye][1];)Gs=Ee[Ya]*w[Dt[Ya]],Ga=u(Ga,Z.s3_ll[Ze++]*Gs,Ya,Ya-ye,Z,0);Ga*=.158489319246111,Z.blocktype_old[ne&1]==re.SHORT_TYPE?ke[ye]=Ga:ke[ye]=J(Math.min(Ga,Math.min(n*Z.nb_1[ne][ye],m*Z.nb_2[ne][ye])),Ga,Qe),Z.nb_2[ne][ye]=Z.nb_1[ne][ye],Z.nb_1[ne][ye]=Ga}for(;ye<=re.CBANDS;++ye)Ee[ye]=0,ke[ye]=0;c(Z,Ee,ke,ne)}if((M.mode==e.STEREO||M.mode==e.JOINT_STEREO)&&M.interChRatio>0&&z(M,M.interChRatio),M.mode==e.JOINT_STEREO){var Ks;H(Z),Ks=M.msfix,Math.abs(Ks)>0&&U(Z,Ks,M.ATHlower*Z.ATH.adjust)}for(K(M,be,te,$),ne=0;ne<Be;ne++){var Zr,Wr=0,Fo,Do;ne>1?(Zr=G,Wr=-2,Fo=re.NORM_TYPE,(te[0]==re.SHORT_TYPE||te[1]==re.SHORT_TYPE)&&(Fo=re.SHORT_TYPE),Do=V[D][ne-2]):(Zr=Y,Wr=0,Fo=te[ne],Do=X[D][ne]),Fo==re.SHORT_TYPE?Zr[Wr+ne]=ue(Do,Z.masking_lower):Zr[Wr+ne]=fe(Do,Z.masking_lower),M.analysis&&(Z.pinfo.pe[D][ne]=Zr[Wr+ne])}return 0};function Ae(M,C,P,D,X,V,Y,G){var q=M.internal_flags;if(D<2)t.fft_long(q,Y[G],D,C,P);else if(D==2)for(var te=re.BLKSIZE-1;te>=0;--te){var Z=Y[G+0][te],ae=Y[G+1][te];Y[G+0][te]=(Z+ae)*Ct.SQRT2*.5,Y[G+1][te]=(Z-ae)*Ct.SQRT2*.5}V[0]=Y[G+0][0],V[0]*=V[0];for(var te=re.BLKSIZE/2-1;te>=0;--te){var _e=Y[G+0][re.BLKSIZE/2-te],Ee=Y[G+0][re.BLKSIZE/2+te];V[re.BLKSIZE/2-te]=(_e*_e+Ee*Ee)*.5}{for(var se=0,te=11;te<re.HBLKSIZE;te++)se+=V[te];q.tot_ener[D]=se}if(M.analysis){for(var te=0;te<re.HBLKSIZE;te++)q.pinfo.energy[X][D][te]=q.pinfo.energy_save[D][te],q.pinfo.energy_save[D][te]=V[te];q.pinfo.pe[X][D]=q.pe[D]}}function Fe(M,C,P,D,X,V,Y,G){var q=M.internal_flags;if(X==0&&D<2&&t.fft_short(q,Y[G],D,C,P),D==2)for(var te=re.BLKSIZE_s-1;te>=0;--te){var Z=Y[G+0][X][te],ae=Y[G+1][X][te];Y[G+0][X][te]=(Z+ae)*Ct.SQRT2*.5,Y[G+1][X][te]=(Z-ae)*Ct.SQRT2*.5}V[X][0]=Y[G+0][X][0],V[X][0]*=V[X][0];for(var te=re.BLKSIZE_s/2-1;te>=0;--te){var _e=Y[G+0][X][re.BLKSIZE_s/2-te],Ee=Y[G+0][X][re.BLKSIZE_s/2+te];V[X][re.BLKSIZE_s/2-te]=(_e*_e+Ee*Ee)*.5}}function Le(M,C,P,D){var X=M.internal_flags;M.athaa_loudapprox==2&&P<2&&(X.loudness_sq[C][P]=X.loudness_sq_save[P],X.loudness_sq_save[P]=I(D,X))}var je=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function De(M,C,P,D,X,V,Y,G,q,te){for(var Z=Xt([2,576]),ae=M.internal_flags,_e=ae.channels_out,Ee=M.mode==e.JOINT_STEREO?4:_e,se=0;se<_e;se++){firbuf=C[se];for(var ke=P+576-350-o+192,$=0;$<576;$++){var be,Be;be=firbuf[ke+$+10],Be=0;for(var ne=0;ne<(o-1)/2-1;ne+=2)be+=je[ne]*(firbuf[ke+$+ne]+firbuf[ke+$+o-ne]),Be+=je[ne+1]*(firbuf[ke+$+ne+1]+firbuf[ke+$+o-ne-1]);Z[se][$]=be+Be}X[D][se].en.assign(ae.en[se]),X[D][se].thm.assign(ae.thm[se]),Ee>2&&(V[D][se].en.assign(ae.en[se+2]),V[D][se].thm.assign(ae.thm[se+2]))}for(var se=0;se<Ee;se++){var ye=dt(12),ie=dt(12),Me=[0,0,0,0],Ze=Z[se&1],pe=0,Re=se==3?ae.nsPsy.attackthre_s:ae.nsPsy.attackthre,Oe=1;if(se==2)for(var $=0,ne=576;ne>0;++$,--ne){var Qe=Z[0][$],Dt=Z[1][$];Z[0][$]=Qe+Dt,Z[1][$]=Qe-Dt}for(var $=0;$<3;$++)ie[$]=ae.nsPsy.last_en_subshort[se][$+6],Ce(ae.nsPsy.last_en_subshort[se][$+4]>0),ye[$]=ie[$]/ae.nsPsy.last_en_subshort[se][$+4],Me[0]+=ie[$];for(var $=0;$<9;$++){for(var ct=pe+64,$e=1;pe<ct;pe++)$e<Math.abs(Ze[pe])&&($e=Math.abs(Ze[pe]));ae.nsPsy.last_en_subshort[se][$]=ie[$+3]=$e,Me[1+$/3]+=$e,$e>ie[$+3-2]?(Ce(ie[$+3-2]>0),$e=$e/ie[$+3-2]):ie[$+3-2]>$e*10?$e=ie[$+3-2]/($e*10):$e=0,ye[$+3]=$e}for(var $=0;$<3;++$){var It=ie[$*3+3]+ie[$*3+4]+ie[$*3+5],Ut=1;ie[$*3+5]*6<It&&(Ut*=.5,ie[$*3+4]*6<It&&(Ut*=.5)),G[se][$]=Ut}if(M.analysis){for(var zt=ye[0],$=1;$<12;$++)zt<ye[$]&&(zt=ye[$]);ae.pinfo.ers[D][se]=ae.pinfo.ers_save[se],ae.pinfo.ers_save[se]=zt}for(var $=0;$<12;$++)q[se][$/3]==0&&ye[$]>Re&&(q[se][$/3]=$%3+1);for(var $=1;$<4;$++){var Jt=Me[$-1],ea=Me[$],Et=Math.max(Jt,ea);Et<4e4&&Jt<1.7*ea&&ea<1.7*Jt&&($==1&&q[se][0]<=q[se][$]&&(q[se][0]=0),q[se][$]=0)}q[se][0]<=ae.nsPsy.lastAttacks[se]&&(q[se][0]=0),(ae.nsPsy.lastAttacks[se]==3||q[se][0]+q[se][1]+q[se][2]+q[se][3]!=0)&&(Oe=0,q[se][1]!=0&&q[se][0]!=0&&(q[se][1]=0),q[se][2]!=0&&q[se][1]!=0&&(q[se][2]=0),q[se][3]!=0&&q[se][2]!=0&&(q[se][3]=0)),se<2?te[se]=Oe:Oe==0&&(te[0]=te[1]=0),Y[se]=ae.tot_ener[se]}}function Ue(M,C,P){if(P==0)for(var D=0;D<M.npart_s;D++)M.nb_s2[C][D]=M.nb_s1[C][D],M.nb_s1[C][D]=0}function at(M,C){for(var P=0;P<M.npart_l;P++)M.nb_2[C][P]=M.nb_1[C][P],M.nb_1[C][P]=0}function yt(M,C,P,D){var X=w.length-1,V=0,Y=P[V]+P[V+1];if(Y>0){var G=C[V];G<C[V+1]&&(G=C[V+1]),Ce(M.numlines_s[V]+M.numlines_s[V+1]-1>0),Y=20*(G*2-Y)/(Y*(M.numlines_s[V]+M.numlines_s[V+1]-1));var q=0|Y;q>X&&(q=X),D[V]=q}else D[V]=0;for(V=1;V<M.npart_s-1;V++)if(Y=P[V-1]+P[V]+P[V+1],Ce(V+1<M.npart_s),Y>0){var G=C[V-1];G<C[V]&&(G=C[V]),G<C[V+1]&&(G=C[V+1]),Ce(M.numlines_s[V-1]+M.numlines_s[V]+M.numlines_s[V+1]-1>0),Y=20*(G*3-Y)/(Y*(M.numlines_s[V-1]+M.numlines_s[V]+M.numlines_s[V+1]-1));var q=0|Y;q>X&&(q=X),D[V]=q}else D[V]=0;if(Ce(V==M.npart_s-1),Y=P[V-1]+P[V],Y>0){var G=C[V-1];G<C[V]&&(G=C[V]),Ce(M.numlines_s[V-1]+M.numlines_s[V]-1>0),Y=20*(G*2-Y)/(Y*(M.numlines_s[V-1]+M.numlines_s[V]-1));var q=0|Y;q>X&&(q=X),D[V]=q}else D[V]=0;Ce(V==M.npart_s-1)}function ut(M,C,P,D,X,V){var Y=M.internal_flags,G=new float[re.CBANDS],q=dt(re.CBANDS),te,Z,ae,_e=new int[re.CBANDS];for(ae=Z=0;ae<Y.npart_s;++ae){var Ee=0,se=0,ke=Y.numlines_s[ae];for(te=0;te<ke;++te,++Z){var $=C[V][Z];Ee+=$,se<$&&(se=$)}P[ae]=Ee,G[ae]=se,q[ae]=Ee/ke,Ce(q[ae]>=0)}for(Ce(ae==Y.npart_s);ae<re.CBANDS;++ae)G[ae]=0,q[ae]=0;for(yt(Y,G,q,_e),Z=ae=0;ae<Y.npart_s;ae++){var be=Y.s3ind_s[ae][0],Be=Y.s3ind_s[ae][1],ne,ye,ie,Me,Ze;for(ne=_e[be],ye=1,Me=Y.s3_ss[Z]*P[be]*w[_e[be]],++Z,++be;be<=Be;)ne+=_e[be],ye+=1,ie=Y.s3_ss[Z]*P[be]*w[_e[be]],Me=A(Me,ie,be-ae),++Z,++be;ne=(1+2*ne)/(2*ye),Ze=w[ne]*.5,Me*=Ze,D[ae]=Me,Y.nb_s2[X][ae]=Y.nb_s1[X][ae],Y.nb_s1[X][ae]=Me,ie=G[ae],ie*=Y.minval_s[ae],ie*=Ze,D[ae]>ie&&(D[ae]=ie),Y.masking_lower>1&&(D[ae]*=Y.masking_lower),D[ae]>P[ae]&&(D[ae]=P[ae]),Y.masking_lower<1&&(D[ae]*=Y.masking_lower),Ce(D[ae]>=0)}for(;ae<re.CBANDS;++ae)P[ae]=0,D[ae]=0}function ft(M,C,P,D,X){var V=dt(re.CBANDS),Y=dt(re.CBANDS),G=Ia(re.CBANDS+2),q;we(M,C,P,V,Y),ve(M,V,Y,G);var te=0;for(q=0;q<M.npart_l;q++){var Z,ae,_e,Ee,se=M.s3ind[q][0],ke=M.s3ind[q][1],$=0,be=0;for($=G[se],be+=1,ae=M.s3_ll[te]*P[se]*w[G[se]],++te,++se;se<=ke;)$+=G[se],be+=1,Z=M.s3_ll[te]*P[se]*w[G[se]],Ee=A(ae,Z,se-q),ae=Ee,++te,++se;if($=(1+2*$)/(2*be),_e=w[$]*.5,ae*=_e,M.blocktype_old[X&1]==re.SHORT_TYPE){var Be=n*M.nb_1[X][q];Be>0?D[q]=Math.min(ae,Be):D[q]=Math.min(ae,P[q]*x)}else{var ne=m*M.nb_2[X][q],ye=n*M.nb_1[X][q],Be;ne<=0&&(ne=ae),ye<=0&&(ye=ae),M.blocktype_old[X&1]==re.NORM_TYPE?Be=Math.min(ye,ne):Be=ye,D[q]=Math.min(ae,Be)}M.nb_2[X][q]=M.nb_1[X][q],M.nb_1[X][q]=ae,Z=V[q],Z*=M.minval_l[q],Z*=_e,D[q]>Z&&(D[q]=Z),M.masking_lower>1&&(D[q]*=M.masking_lower),D[q]>P[q]&&(D[q]=P[q]),M.masking_lower<1&&(D[q]*=M.masking_lower),Ce(D[q]>=0)}for(;q<re.CBANDS;++q)P[q]=0,D[q]=0}function pt(M,C){var P=M.internal_flags;M.short_blocks==sr.short_block_coupled&&!(C[0]!=0&&C[1]!=0)&&(C[0]=C[1]=0);for(var D=0;D<P.channels_out;D++)M.short_blocks==sr.short_block_dispensed&&(C[D]=1),M.short_blocks==sr.short_block_forced&&(C[D]=0)}function Gt(M,C,P){for(var D=M.internal_flags,X=0;X<D.channels_out;X++){var V=re.NORM_TYPE;C[X]!=0?(Ce(D.blocktype_old[X]!=re.START_TYPE),D.blocktype_old[X]==re.SHORT_TYPE&&(V=re.STOP_TYPE)):(V=re.SHORT_TYPE,D.blocktype_old[X]==re.NORM_TYPE&&(D.blocktype_old[X]=re.START_TYPE),D.blocktype_old[X]==re.STOP_TYPE&&(D.blocktype_old[X]=re.SHORT_TYPE)),P[X]=D.blocktype_old[X],D.blocktype_old[X]=V}}function At(M,C,P,D,X,V,Y){for(var G=V*2,q=V>0?Math.pow(10,X):1,te,Z,ae=0;ae<Y;++ae){var _e=M[2][ae],Ee=M[3][ae],se=C[0][ae],ke=C[1][ae],$=C[2][ae],be=C[3][ae];if(se<=1.58*ke&&ke<=1.58*se){var Be=P[ae]*Ee,ne=P[ae]*_e;Z=Math.max($,Math.min(be,Be)),te=Math.max(be,Math.min($,ne))}else Z=$,te=be;if(V>0){var ye,ie,Me=D[ae]*q;if(ye=Math.min(Math.max(se,Me),Math.max(ke,Me)),$=Math.max(Z,Me),be=Math.max(te,Me),ie=$+be,ie>0&&ye*G<ie){var Ze=ye*G/ie;$*=Ze,be*=Ze}Z=Math.min($,Z),te=Math.min(be,te)}Z>_e&&(Z=_e),te>Ee&&(te=Ee),C[2][ae]=Z,C[3][ae]=te}}this.L3psycho_anal_vbr=function(M,C,P,D,X,V,Y,G,q,te){var Z=M.internal_flags,ae,_e,Ee=dt(re.HBLKSIZE),se=Xt([3,re.HBLKSIZE_s]),ke=Xt([2,re.BLKSIZE]),$=Xt([2,3,re.BLKSIZE_s]),be=Xt([4,re.CBANDS]),Be=Xt([4,re.CBANDS]),ne=Xt([4,3]),ye=.6,ie=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Me=Ia(2),Ze=M.mode==e.JOINT_STEREO?4:Z.channels_out;De(M,C,P,D,X,V,q,ne,ie,Me),pt(M,Me);{for(var pe=0;pe<Ze;pe++){var Re=pe&1;ae=ke,Ae(M,C,P,pe,D,Ee,ae,Re),Le(M,D,pe,Ee),Me[Re]!=0?ft(Z,Ee,be[pe],Be[pe],pe):at(Z,pe)}Me[0]+Me[1]==2&&M.mode==e.JOINT_STEREO&&At(be,Be,Z.mld_cb_l,Z.ATH.cb_l,M.ATHlower*Z.ATH.adjust,M.msfix,Z.npart_l);for(var pe=0;pe<Ze;pe++){var Re=pe&1;Me[Re]!=0&&c(Z,be[pe],Be[pe],pe)}}{for(var Oe=0;Oe<3;Oe++){for(var pe=0;pe<Ze;++pe){var Re=pe&1;Me[Re]!=0?Ue(Z,pe,Oe):(_e=$,Fe(M,C,P,pe,Oe,se,_e,Re),ut(M,se,be[pe],Be[pe],pe,Oe))}Me[0]+Me[1]==0&&M.mode==e.JOINT_STEREO&&At(be,Be,Z.mld_cb_s,Z.ATH.cb_s,M.ATHlower*Z.ATH.adjust,M.msfix,Z.npart_s);for(var pe=0;pe<Ze;++pe){var Re=pe&1;Me[Re]==0&&Q(Z,be[pe],Be[pe],pe,Oe)}}for(var pe=0;pe<Ze;pe++){var Re=pe&1;if(Me[Re]==0)for(var Qe=0;Qe<re.SBMAX_s;Qe++){for(var Dt=dt(3),Oe=0;Oe<3;Oe++){var ct=Z.thm[pe].s[Qe][Oe];if(ct*=k,ie[pe][Oe]>=2||ie[pe][Oe+1]==1){var $e=Oe!=0?Oe-1:2,It=J(Z.thm[pe].s[Qe][$e],ct,f*ye);ct=Math.min(ct,It)}else if(ie[pe][Oe]==1){var $e=Oe!=0?Oe-1:2,It=J(Z.thm[pe].s[Qe][$e],ct,x*ye);ct=Math.min(ct,It)}else if(Oe!=0&&ie[pe][Oe-1]==3||Oe==0&&Z.nsPsy.lastAttacks[pe]==3){var $e=Oe!=2?Oe+1:0,It=J(Z.thm[pe].s[Qe][$e],ct,x*ye);ct=Math.min(ct,It)}ct*=ne[pe][Oe],Dt[Oe]=ct}for(var Oe=0;Oe<3;Oe++)Z.thm[pe].s[Qe][Oe]=Dt[Oe]}}}for(var pe=0;pe<Ze;pe++)Z.nsPsy.lastAttacks[pe]=ie[pe][2];Gt(M,Me,te);for(var pe=0;pe<Ze;pe++){var Ut,zt,Jt,ea;pe>1?(Ut=G,zt=-2,Jt=re.NORM_TYPE,(te[0]==re.SHORT_TYPE||te[1]==re.SHORT_TYPE)&&(Jt=re.SHORT_TYPE),ea=V[D][pe-2]):(Ut=Y,zt=0,Jt=te[pe],ea=X[D][pe]),Jt==re.SHORT_TYPE?Ut[zt+pe]=ue(ea,Z.masking_lower):Ut[zt+pe]=fe(ea,Z.masking_lower),M.analysis&&(Z.pinfo.pe[D][pe]=Ut[zt+pe])}return 0};function vt(M,C){var P=M,D;return P>=0?D=-P*27:D=P*C,D<=-72?0:Math.exp(D*S)}function xt(M){var C=0,P=0;{var D=0,X,V;for(D=0;vt(D,M)>1e-20;D-=1);for(X=D,V=0;Math.abs(V-X)>1e-12;)D=(V+X)/2,vt(D,M)>0?V=D:X=D;C=X}{var D=0,X,V;for(D=0;vt(D,M)>1e-20;D+=1);for(X=0,V=D;Math.abs(V-X)>1e-12;)D=(V+X)/2,vt(D,M)>0?X=D:V=D;P=V}{var Y=0,G=1e3,q;for(q=0;q<=G;++q){var D=C+q*(P-C)/G,te=vt(D,M);Y+=te}{var Z=(G+1)/(Y*(P-C));return Z}}}function Ft(M){var C,P,D,X;return C=M,C>=0?C*=3:C*=1.5,C>=.5&&C<=2.5?(X=C-.5,P=8*(X*X-2*X)):P=0,C+=.474,D=15.811389+7.5*C-17.5*Math.sqrt(1+C*C),D<=-60?0:(C=Math.exp((P+D)*S),C/=.6609193,C)}function oe(M){return M<0&&(M=0),M=M*.001,13*Math.atan(.76*M)+3.5*Math.atan(M*M/(7.5*7.5))}function ge(M,C,P,D,X,V,Y,G,q,te,Z,ae){var _e=dt(re.CBANDS+1),Ee=G/(ae>15?2*576:2*192),se=Ia(re.HBLKSIZE),ke;G/=q;var $=0,be=0;for(ke=0;ke<re.CBANDS;ke++){var Be,ne;for(Be=oe(G*$),_e[ke]=G*$,ne=$;oe(G*ne)-Be<E&&ne<=q/2;ne++);for(M[ke]=ne-$,be=ke+1;$<ne;)se[$++]=ke;if($>q/2){$=q/2,++ke;break}}_e[ke]=G*$;for(var ye=0;ye<ae;ye++){var ie,Me,Ze,pe,Re;Ze=te[ye],pe=te[ye+1],ie=0|Math.floor(.5+Z*(Ze-.5)),ie<0&&(ie=0),Me=0|Math.floor(.5+Z*(pe-.5)),Me>q/2&&(Me=q/2),P[ye]=(se[ie]+se[Me])/2,C[ye]=se[Me];var Oe=Ee*pe;Y[ye]=(Oe-_e[C[ye]])/(_e[C[ye]+1]-_e[C[ye]]),Y[ye]<0?Y[ye]=0:Y[ye]>1&&(Y[ye]=1),Re=oe(G*te[ye]*Z),Re=Math.min(Re,15.5)/15.5,V[ye]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Re))-2.5)}$=0;for(var Qe=0;Qe<be;Qe++){var Dt=M[Qe],Be,ct;Be=oe(G*$),ct=oe(G*($+Dt-1)),D[Qe]=.5*(Be+ct),Be=oe(G*($-.5)),ct=oe(G*($+Dt-.5)),X[Qe]=ct-Be,$+=Dt}return be}function ee(M,C,P,D,X,V){var Y=Xt([re.CBANDS,re.CBANDS]),G,q=0;if(V)for(var te=0;te<C;te++)for(G=0;G<C;G++){var Z=Ft(P[te]-P[G])*D[G];Y[te][G]=Z*X[te]}else for(G=0;G<C;G++)for(var ae=15+Math.min(21/P[G],12),_e=xt(ae),te=0;te<C;te++){var Z=_e*vt(P[te]-P[G],ae)*D[G];Y[te][G]=Z*X[te]}for(var te=0;te<C;te++){for(G=0;G<C&&!(Y[te][G]>0);G++);for(M[te][0]=G,G=C-1;G>0&&!(Y[te][G]>0);G--);M[te][1]=G,q+=M[te][1]-M[te][0]+1}for(var Ee=dt(q),se=0,te=0;te<C;te++)for(G=M[te][0];G<=M[te][1];G++)Ee[se++]=Y[te][G];return Ee}function xe(M){var C=oe(M);return C=Math.min(C,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*C))-2.5)}this.psymodel_init=function(M){var C=M.internal_flags,P,D=!0,X=13,V=24,Y=0,G=0,q=-8.25,te=-4.5,Z=dt(re.CBANDS),ae=dt(re.CBANDS),_e=dt(re.CBANDS),Ee=M.out_samplerate;switch(M.experimentalZ){default:case 0:D=!0;break;case 1:D=!(M.VBR==or.vbr_mtrh||M.VBR==or.vbr_mt);break;case 2:D=!1;break;case 3:X=8,Y=-1.75,G=-.0125,q=-8.25,te=-2.25;break}for(C.ms_ener_ratio_old=.25,C.blocktype_old[0]=C.blocktype_old[1]=re.NORM_TYPE,P=0;P<4;++P){for(var $=0;$<re.CBANDS;++$)C.nb_1[P][$]=1e20,C.nb_2[P][$]=1e20,C.nb_s1[P][$]=C.nb_s2[P][$]=1;for(var se=0;se<re.SBMAX_l;se++)C.en[P].l[se]=1e20,C.thm[P].l[se]=1e20;for(var $=0;$<3;++$){for(var se=0;se<re.SBMAX_s;se++)C.en[P].s[se][$]=1e20,C.thm[P].s[se][$]=1e20;C.nsPsy.lastAttacks[P]=0}for(var $=0;$<9;$++)C.nsPsy.last_en_subshort[P][$]=10}for(C.loudness_sq_save[0]=C.loudness_sq_save[1]=0,C.npart_l=ge(C.numlines_l,C.bo_l,C.bm_l,Z,ae,C.mld_l,C.PSY.bo_l_weight,Ee,re.BLKSIZE,C.scalefac_band.l,re.BLKSIZE/(2*576),re.SBMAX_l),Ce(C.npart_l<re.CBANDS),P=0;P<C.npart_l;P++){var ke=Y;Z[P]>=X&&(ke=G*(Z[P]-X)/(V-X)+Y*(V-Z[P])/(V-X)),_e[P]=Math.pow(10,ke/10),C.numlines_l[P]>0?C.rnumlines_l[P]=1/C.numlines_l[P]:C.rnumlines_l[P]=0}C.s3_ll=ee(C.s3ind,C.npart_l,Z,ae,_e,D);var $=0;for(P=0;P<C.npart_l;P++){var be;be=ji.MAX_VALUE;for(var Be=0;Be<C.numlines_l[P];Be++,$++){var ne=Ee*$/(1e3*re.BLKSIZE),ye;ye=this.ATHformula(ne*1e3,M)-20,ye=Math.pow(10,.1*ye),ye*=C.numlines_l[P],be>ye&&(be=ye)}C.ATH.cb_l[P]=be,be=-20+Z[P]*20/10,be>6&&(be=100),be<-15&&(be=-15),be-=8,C.minval_l[P]=Math.pow(10,be/10)*C.numlines_l[P]}for(C.npart_s=ge(C.numlines_s,C.bo_s,C.bm_s,Z,ae,C.mld_s,C.PSY.bo_s_weight,Ee,re.BLKSIZE_s,C.scalefac_band.s,re.BLKSIZE_s/(2*192),re.SBMAX_s),Ce(C.npart_s<re.CBANDS),$=0,P=0;P<C.npart_s;P++){var be,ke=q;Z[P]>=X&&(ke=te*(Z[P]-X)/(V-X)+q*(V-Z[P])/(V-X)),_e[P]=Math.pow(10,ke/10),be=ji.MAX_VALUE;for(var Be=0;Be<C.numlines_s[P];Be++,$++){var ne=Ee*$/(1e3*re.BLKSIZE_s),ye;ye=this.ATHformula(ne*1e3,M)-20,ye=Math.pow(10,.1*ye),ye*=C.numlines_s[P],be>ye&&(be=ye)}C.ATH.cb_s[P]=be,be=-7+Z[P]*7/12,Z[P]>12&&(be*=1+Math.log(1+be)*3.1),Z[P]<12&&(be*=1+Math.log(1-be)*2.3),be<-15&&(be=-15),be-=8,C.minval_s[P]=Math.pow(10,be/10)*C.numlines_s[P]}C.s3_ss=ee(C.s3ind_s,C.npart_s,Z,ae,_e,D),d(),t.init_fft(C),C.decay=Math.exp(-1*a/(L*Ee/192));{var ie;ie=y,(M.exp_nspsytune&2)!=0&&(ie=1),Math.abs(M.msfix)>0&&(ie=M.msfix),M.msfix=ie;for(var Me=0;Me<C.npart_l;Me++)C.s3ind[Me][1]>C.npart_l-1&&(C.s3ind[Me][1]=C.npart_l-1)}var Ze=576*C.mode_gr/Ee;if(C.ATH.decay=Math.pow(10,-12/10*Ze),C.ATH.adjust=.01,C.ATH.adjustLimit=1,Ce(C.bo_l[re.SBMAX_l-1]<=C.npart_l),Ce(C.bo_s[re.SBMAX_s-1]<=C.npart_s),M.ATHtype!=-1){var ne,pe=M.out_samplerate/re.BLKSIZE,Re=0;for(ne=0,P=0;P<re.BLKSIZE/2;++P)ne+=pe,C.ATH.eql_w[P]=1/Math.pow(10,this.ATHformula(ne,M)/10),Re+=C.ATH.eql_w[P];for(Re=1/Re,P=re.BLKSIZE/2;--P>=0;)C.ATH.eql_w[P]*=Re}{for(var Me=$=0;Me<C.npart_s;++Me)for(P=0;P<C.numlines_s[Me];++P)++$;for(var Me=$=0;Me<C.npart_l;++Me)for(P=0;P<C.numlines_l[Me];++P)++$}for($=0,P=0;P<C.npart_l;P++){var ne=Ee*($+C.numlines_l[P]/2)/(1*re.BLKSIZE);C.mld_cb_l[P]=xe(ne),$+=C.numlines_l[P]}for(;P<re.CBANDS;++P)C.mld_cb_l[P]=1;for($=0,P=0;P<C.npart_s;P++){var ne=Ee*($+C.numlines_s[P]/2)/(1*re.BLKSIZE_s);C.mld_cb_s[P]=xe(ne),$+=C.numlines_s[P]}for(;P<re.CBANDS;++P)C.mld_cb_s[P]=1;return 0};function Te(M,C){M<-.3&&(M=3410),M/=1e3,M=Math.max(.1,M);var P=3.64*Math.pow(M,-.8)-6.8*Math.exp(-.6*Math.pow(M-3.4,2))+6*Math.exp(-.15*Math.pow(M-8.7,2))+(.6+.04*C)*.001*Math.pow(M,4);return P}this.ATHformula=function(M,C){var P;switch(C.ATHtype){case 0:P=Te(M,9);break;case 1:P=Te(M,-1);break;case 2:P=Te(M,0);break;case 3:P=Te(M,1)+6;break;case 4:P=Te(M,C.ATHcurve);break;default:P=Te(M,0);break}return P}}var qm=zm,Xm=Dr;function Ym(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=Xm.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var Gm=Ym,Km=Rt,Hi={};Hi.SFBMAX=Km.SBMAX_s*3;var Ro=Hi,Pi=We,Zm=Pi.new_float,La=Pi.new_int,Ss=Ro;function Wm(){this.xr=Zm(576),this.l3_enc=La(576),this.scalefac=La(Ss.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=La(3),this.subblock_gain=La(3+1),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=La(Ss.SFBMAX),this.window=La(Ss.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=La(4),this.max_nonzero_coeff=0;var e=this;function t(n){return new Int32Array(n)}function a(n){return new Float32Array(n)}this.assign=function(n){e.xr=a(n.xr),e.l3_enc=t(n.l3_enc),e.scalefac=t(n.scalefac),e.xrpow_max=n.xrpow_max,e.part2_3_length=n.part2_3_length,e.big_values=n.big_values,e.count1=n.count1,e.global_gain=n.global_gain,e.scalefac_compress=n.scalefac_compress,e.block_type=n.block_type,e.mixed_block_flag=n.mixed_block_flag,e.table_select=t(n.table_select),e.subblock_gain=t(n.subblock_gain),e.region0_count=n.region0_count,e.region1_count=n.region1_count,e.preflag=n.preflag,e.scalefac_scale=n.scalefac_scale,e.count1table_select=n.count1table_select,e.part2_length=n.part2_length,e.sfb_lmax=n.sfb_lmax,e.sfb_smin=n.sfb_smin,e.psy_lmax=n.psy_lmax,e.sfbmax=n.sfbmax,e.psymax=n.psymax,e.sfbdivide=n.sfbdivide,e.width=t(n.width),e.window=t(n.window),e.count1bits=n.count1bits,e.sfb_partition_table=n.sfb_partition_table.slice(0),e.slen=t(n.slen),e.max_nonzero_coeff=n.max_nonzero_coeff}}var ks=Wm,Qm=We,Fi=Qm.new_int,$m=ks;function Jm(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[Fi(4),Fi(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new $m}var e2=Jm,Di=We,Ao=Di.System,To=Di.new_int,Bo=Rt;function t2(e,t,a,n){this.l=To(1+Bo.SBMAX_l),this.s=To(1+Bo.SBMAX_s),this.psfb21=To(1+Bo.PSFB21),this.psfb12=To(1+Bo.PSFB12);var m=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Ao.arraycopy(this.arrL,0,m,0,Math.min(this.arrL.length,this.l.length)),Ao.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),Ao.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Ao.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Ui=t2,Es=We,Ms=Es.new_float,a2=Es.new_float_n,r2=Es.new_int,zi=Rt;function o2(){this.last_en_subshort=a2([4,9]),this.lastAttacks=r2(4),this.pefirbuf=Ms(19),this.longfact=Ms(zi.SBMAX_l),this.shortfact=Ms(zi.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var s2=o2;function n2(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var i2=n2,nr=We,l2=nr.new_byte,c2=nr.new_double,Yt=nr.new_float,Va=nr.new_float_n,$t=nr.new_int,Co=nr.new_int_n,d2=e2,m2=Ui,h2=s2,u2=i2,qi=Ti,ot=Rt,f2=Ro;fa.MFSIZE=3*1152+ot.ENCDELAY-ot.MDCTDELAY,fa.MAX_HEADER_BUF=256,fa.MAX_BITS_PER_CHANNEL=4095,fa.MAX_BITS_PER_GRANULE=7680,fa.BPC=320;function fa(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Va([2,fa.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new d2,this.ms_ratio=Yt(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=$t(2),this.CurrentStep=$t(2),this.masking_lower=0,this.bv_scf=$t(576),this.pseudohalf=$t(f2.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*fa.BPC+1),this.itime=c2(2),this.sideinfo_len=0,this.sb_sample=Va([2,2,18,ot.SBLIMIT]),this.amp_filter=Yt(32);function t(){this.write_timing=0,this.ptr=0,this.buf=l2(e)}this.header=new Array(fa.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new m2,this.minval_l=Yt(ot.CBANDS),this.minval_s=Yt(ot.CBANDS),this.nb_1=Va([4,ot.CBANDS]),this.nb_2=Va([4,ot.CBANDS]),this.nb_s1=Va([4,ot.CBANDS]),this.nb_s2=Va([4,ot.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Yt(4),this.loudness_sq=Va([2,2]),this.loudness_sq_save=Yt(2),this.mld_l=Yt(ot.SBMAX_l),this.mld_s=Yt(ot.SBMAX_s),this.bm_l=$t(ot.SBMAX_l),this.bo_l=$t(ot.SBMAX_l),this.bm_s=$t(ot.SBMAX_s),this.bo_s=$t(ot.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Co([ot.CBANDS,2]),this.s3ind_s=Co([ot.CBANDS,2]),this.numlines_s=$t(ot.CBANDS),this.numlines_l=$t(ot.CBANDS),this.rnumlines_l=Yt(ot.CBANDS),this.mld_cb_l=Yt(ot.CBANDS),this.mld_cb_s=Yt(ot.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Yt(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=$t(2),this.nsPsy=new h2,this.VBR_seek_table=new u2,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Co([16,4+1]),this.bitrate_blockType_Hist=Co([16,4+1+1]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var a=0;a<this.en.length;a++)this.en[a]=new qi;for(var a=0;a<this.thm.length;a++)this.thm[a]=new qi;for(var a=0;a<this.header.length;a++)this.header[a]=new t}var Oo=fa,_2=We,ja=_2.new_float,Ha=Rt;function p2(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=ja(Ha.SBMAX_l),this.s=ja(Ha.SBMAX_s),this.psfb21=ja(Ha.PSFB21),this.psfb12=ja(Ha.PSFB12),this.cb_l=ja(Ha.CBANDS),this.cb_s=ja(Ha.CBANDS),this.eql_w=ja(Ha.BLKSIZE/2)}var v2=p2,Xi=We,Ot=Xi.System,Yi=Xi.Arrays;st.STEPS_per_dB=100,st.MAX_dB=120,st.GAIN_NOT_ENOUGH_SAMPLES=-24601,st.GAIN_ANALYSIS_ERROR=0,st.GAIN_ANALYSIS_OK=1,st.INIT_GAIN_ANALYSIS_ERROR=0,st.INIT_GAIN_ANALYSIS_OK=1,st.YULE_ORDER=10,st.MAX_ORDER=st.YULE_ORDER,st.MAX_SAMP_FREQ=48e3,st.RMS_WINDOW_TIME_NUMERATOR=1,st.RMS_WINDOW_TIME_DENOMINATOR=20,st.MAX_SAMPLES_PER_WINDOW=st.MAX_SAMP_FREQ*st.RMS_WINDOW_TIME_NUMERATOR/st.RMS_WINDOW_TIME_DENOMINATOR+1;function st(){var e=64.82,t=.95,a=st.RMS_WINDOW_TIME_NUMERATOR,n=st.RMS_WINDOW_TIME_DENOMINATOR,m=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function R(f,x,y,o,S,j){for(;S--!=0;)y[o]=1e-10+f[x+0]*j[0]-y[o-1]*j[1]+f[x-1]*j[2]-y[o-2]*j[3]+f[x-2]*j[4]-y[o-3]*j[5]+f[x-3]*j[6]-y[o-4]*j[7]+f[x-4]*j[8]-y[o-5]*j[9]+f[x-5]*j[10]-y[o-6]*j[11]+f[x-6]*j[12]-y[o-7]*j[13]+f[x-7]*j[14]-y[o-8]*j[15]+f[x-8]*j[16]-y[o-9]*j[17]+f[x-9]*j[18]-y[o-10]*j[19]+f[x-10]*j[20],++o,++x}function E(f,x,y,o,S,j){for(;S--!=0;)y[o]=f[x+0]*j[0]-y[o-1]*j[1]+f[x-1]*j[2]-y[o-2]*j[3]+f[x-2]*j[4],++o,++x}function N(f,x){for(var y=0;y<MAX_ORDER;y++)f.linprebuf[y]=f.lstepbuf[y]=f.loutbuf[y]=f.rinprebuf[y]=f.rstepbuf[y]=f.routbuf[y]=0;switch(0|x){case 48e3:f.reqindex=0;break;case 44100:f.reqindex=1;break;case 32e3:f.reqindex=2;break;case 24e3:f.reqindex=3;break;case 22050:f.reqindex=4;break;case 16e3:f.reqindex=5;break;case 12e3:f.reqindex=6;break;case 11025:f.reqindex=7;break;case 8e3:f.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return f.sampleWindow=0|(x*a+n-1)/n,f.lsum=0,f.rsum=0,f.totsamp=0,Yi.ill(f.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(f,x){return N(f,x)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(f.linpre=MAX_ORDER,f.rinpre=MAX_ORDER,f.lstep=MAX_ORDER,f.rstep=MAX_ORDER,f.lout=MAX_ORDER,f.rout=MAX_ORDER,Yi.fill(f.B,0),INIT_GAIN_ANALYSIS_OK)};function L(f){return f*f}this.AnalyzeSamples=function(f,x,y,o,S,j,I){var v,g,O,F,T,l,B;if(j==0)return GAIN_ANALYSIS_OK;switch(B=0,T=j,I){case 1:o=x,S=y;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(j<MAX_ORDER?(Ot.arraycopy(x,y,f.linprebuf,MAX_ORDER,j),Ot.arraycopy(o,S,f.rinprebuf,MAX_ORDER,j)):(Ot.arraycopy(x,y,f.linprebuf,MAX_ORDER,MAX_ORDER),Ot.arraycopy(o,S,f.rinprebuf,MAX_ORDER,MAX_ORDER));T>0;){l=T>f.sampleWindow-f.totsamp?f.sampleWindow-f.totsamp:T,B<MAX_ORDER?(v=f.linpre+B,g=f.linprebuf,O=f.rinpre+B,F=f.rinprebuf,l>MAX_ORDER-B&&(l=MAX_ORDER-B)):(v=y+B,g=x,O=S+B,F=o),R(g,v,f.lstepbuf,f.lstep+f.totsamp,l,m[f.reqindex]),R(F,O,f.rstepbuf,f.rstep+f.totsamp,l,m[f.reqindex]),E(f.lstepbuf,f.lstep+f.totsamp,f.loutbuf,f.lout+f.totsamp,l,s[f.reqindex]),E(f.rstepbuf,f.rstep+f.totsamp,f.routbuf,f.rout+f.totsamp,l,s[f.reqindex]),v=f.lout+f.totsamp,g=f.loutbuf,O=f.rout+f.totsamp,F=f.routbuf;for(var w=l%8;w--!=0;)f.lsum+=L(g[v++]),f.rsum+=L(F[O++]);for(w=l/8;w--!=0;)f.lsum+=L(g[v+0])+L(g[v+1])+L(g[v+2])+L(g[v+3])+L(g[v+4])+L(g[v+5])+L(g[v+6])+L(g[v+7]),v+=8,f.rsum+=L(F[O+0])+L(F[O+1])+L(F[O+2])+L(F[O+3])+L(F[O+4])+L(F[O+5])+L(F[O+6])+L(F[O+7]),O+=8;if(T-=l,B+=l,f.totsamp+=l,f.totsamp==f.sampleWindow){var d=st.STEPS_per_dB*10*Math.log10((f.lsum+f.rsum)/f.totsamp*.5+1e-37),h=d<=0?0:0|d;h>=f.A.length&&(h=f.A.length-1),f.A[h]++,f.lsum=f.rsum=0,Ot.arraycopy(f.loutbuf,f.totsamp,f.loutbuf,0,MAX_ORDER),Ot.arraycopy(f.routbuf,f.totsamp,f.routbuf,0,MAX_ORDER),Ot.arraycopy(f.lstepbuf,f.totsamp,f.lstepbuf,0,MAX_ORDER),Ot.arraycopy(f.rstepbuf,f.totsamp,f.rstepbuf,0,MAX_ORDER),f.totsamp=0}if(f.totsamp>f.sampleWindow)return GAIN_ANALYSIS_ERROR}return j<MAX_ORDER?(Ot.arraycopy(f.linprebuf,j,f.linprebuf,0,MAX_ORDER-j),Ot.arraycopy(f.rinprebuf,j,f.rinprebuf,0,MAX_ORDER-j),Ot.arraycopy(x,y,f.linprebuf,MAX_ORDER-j,j),Ot.arraycopy(o,S,f.rinprebuf,MAX_ORDER-j,j)):(Ot.arraycopy(x,y+j-MAX_ORDER,f.linprebuf,0,MAX_ORDER),Ot.arraycopy(o,S+j-MAX_ORDER,f.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function k(f,x){var y,o=0;for(y=0;y<x;y++)o+=f[y];if(o==0)return GAIN_NOT_ENOUGH_SAMPLES;var S=0|Math.ceil(o*(1-t));for(y=x;y-- >0&&!((S-=f[y])<=0););return e-y/st.STEPS_per_dB}this.GetTitleGain=function(f){for(var x=k(f.A,f.A.length),y=0;y<f.A.length;y++)f.B[y]+=f.A[y],f.A[y]=0;for(var y=0;y<MAX_ORDER;y++)f.linprebuf[y]=f.lstepbuf[y]=f.loutbuf[y]=f.rinprebuf[y]=f.rstepbuf[y]=f.routbuf[y]=0;return f.totsamp=0,f.lsum=f.rsum=0,x}}var Gi=st,Ki=We,ir=Ki.new_float,Zi=Ki.new_int,Nt=Gi;function g2(){this.linprebuf=ir(Nt.MAX_ORDER*2),this.linpre=0,this.lstepbuf=ir(Nt.MAX_SAMPLES_PER_WINDOW+Nt.MAX_ORDER),this.lstep=0,this.loutbuf=ir(Nt.MAX_SAMPLES_PER_WINDOW+Nt.MAX_ORDER),this.lout=0,this.rinprebuf=ir(Nt.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=ir(Nt.MAX_SAMPLES_PER_WINDOW+Nt.MAX_ORDER),this.rstep=0,this.routbuf=ir(Nt.MAX_SAMPLES_PER_WINDOW+Nt.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Zi(0|Nt.STEPS_per_dB*Nt.MAX_dB),this.B=Zi(0|Nt.STEPS_per_dB*Nt.MAX_dB)}var b2=g2;function y2(e){this.bits=e}var Wi=y2,Rs=We,Qi=Rs.new_float,x2=Rs.new_int,$i=Rs.assert,w2=Wi,Ji=Rt,S2=Ro,k2=Oo;function E2(e){var t=e;this.quantize=t,this.iteration_loop=function(a,n,m,s){var R=a.internal_flags,E=Qi(S2.SFBMAX),N=Qi(576),L=x2(2),k=0,f,x=R.l3_side,y=new w2(k);this.quantize.rv.ResvFrameBegin(a,y),k=y.bits;for(var o=0;o<R.mode_gr;o++){f=this.quantize.qupvt.on_pe(a,n,L,k,o,o),R.mode_ext==Ji.MPG_MD_MS_LR&&(this.quantize.ms_convert(R.l3_side,o),this.quantize.qupvt.reduce_side(L,m[o],k,f));for(var S=0;S<R.channels_out;S++){var j,I,v=x.tt[o][S];v.block_type!=Ji.SHORT_TYPE?(j=0,I=R.PSY.mask_adjust-j):(j=0,I=R.PSY.mask_adjust_short-j),R.masking_lower=Math.pow(10,I*.1),this.quantize.init_outer_loop(R,v),this.quantize.init_xrpow(R,v,N)&&(this.quantize.qupvt.calc_xmin(a,s[o][S],v,E),this.quantize.outer_loop(a,v,E,N,S,L[S])),this.quantize.iteration_finish_one(R,o,S),$i(v.part2_3_length<=k2.MAX_BITS_PER_CHANNEL),$i(v.part2_3_length<=L[S])}}this.quantize.rv.ResvFrameEnd(R,k)}}var M2=E2;function He(e,t,a,n){this.xlen=e,this.linmax=t,this.table=a,this.hlen=n}var le={};le.t1HB=[1,1,1,0],le.t2HB=[1,2,1,3,1,1,3,2,0],le.t3HB=[3,2,1,1,1,1,3,2,0],le.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],le.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],le.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],le.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],le.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],le.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],le.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],le.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],le.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],le.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],le.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],le.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],le.t32HB=[1<<0,5<<1,4<<1,5<<2,6<<1,5<<2,4<<2,4<<3,7<<1,3<<2,6<<2,0<<3,7<<2,2<<3,3<<3,1<<4],le.t33HB=[15<<0,14<<1,13<<1,12<<2,11<<1,10<<2,9<<2,8<<3,7<<1,6<<2,5<<2,4<<3,3<<2,2<<3,1<<3,0<<4],le.t1l=[1,4,3,5],le.t2l=[1,4,7,4,5,7,6,7,8],le.t3l=[2,3,7,4,4,7,6,7,8],le.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],le.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],le.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],le.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],le.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],le.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],le.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],le.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],le.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],le.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],le.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],le.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],le.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],le.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4],le.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4],le.ht=[new He(0,0,null,null),new He(2,0,le.t1HB,le.t1l),new He(3,0,le.t2HB,le.t2l),new He(3,0,le.t3HB,le.t3l),new He(0,0,null,null),new He(4,0,le.t5HB,le.t5l),new He(4,0,le.t6HB,le.t6l),new He(6,0,le.t7HB,le.t7l),new He(6,0,le.t8HB,le.t8l),new He(6,0,le.t9HB,le.t9l),new He(8,0,le.t10HB,le.t10l),new He(8,0,le.t11HB,le.t11l),new He(8,0,le.t12HB,le.t12l),new He(16,0,le.t13HB,le.t13l),new He(0,0,null,le.t16_5l),new He(16,0,le.t15HB,le.t15l),new He(1,1,le.t16HB,le.t16l),new He(2,3,le.t16HB,le.t16l),new He(3,7,le.t16HB,le.t16l),new He(4,15,le.t16HB,le.t16l),new He(6,63,le.t16HB,le.t16l),new He(8,255,le.t16HB,le.t16l),new He(10,1023,le.t16HB,le.t16l),new He(13,8191,le.t16HB,le.t16l),new He(4,15,le.t24HB,le.t24l),new He(5,31,le.t24HB,le.t24l),new He(6,63,le.t24HB,le.t24l),new He(7,127,le.t24HB,le.t24l),new He(8,255,le.t24HB,le.t24l),new He(9,511,le.t24HB,le.t24l),new He(11,2047,le.t24HB,le.t24l),new He(13,8191,le.t24HB,le.t24l),new He(0,0,le.t32HB,le.t32l),new He(0,0,le.t33HB,le.t33l)],le.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],le.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],le.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],le.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],le.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],le.scfsi_band=[0,6,11,16,21];var As=le,_a=Ui,lr=We,Pa=lr.VbrMode,No=lr.Float,Ts=lr.Util,Fa=lr.new_float,R2=lr.new_int,Ur=lr.assert,_t=Rt,A2=Wi,Pt=Oo;pa.Q_MAX=256+1,pa.Q_MAX2=116,pa.LARGE_BITS=1e5,pa.IXMAX_VAL=8206;function pa(){var e=Ns,t=null,a=null,n=null;this.setModules=function(g,O,F){t=g,a=O,n=F};function m(g){return x[g+pa.Q_MAX2]}this.IPOW20=function(g){return y[g]};var s=2220446049250313e-31,R=pa.IXMAX_VAL,E=R+2,N=pa.Q_MAX,L=pa.Q_MAX2,k=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var f=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=f,this.sfBandIndex=[new _a([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new _a([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new _a([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new _a([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new _a([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new _a([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new _a([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new _a([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new _a([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var x=Fa(N+L+1),y=Fa(N),o=Fa(E),S=Fa(E);this.adj43=S;function j(g,O){var F=n.ATHformula(O,g);return F-=k,F=Math.pow(10,F/10+g.ATHlower),F}function I(g){for(var O=g.internal_flags.ATH.l,F=g.internal_flags.ATH.psfb21,T=g.internal_flags.ATH.s,l=g.internal_flags.ATH.psfb12,B=g.internal_flags,w=g.out_samplerate,d=0;d<_t.SBMAX_l;d++){var h=B.scalefac_band.l[d],b=B.scalefac_band.l[d+1];O[d]=No.MAX_VALUE;for(var i=h;i<b;i++){var u=i*w/1152,_=j(g,u);O[d]=Math.min(O[d],_)}}for(var d=0;d<_t.PSFB21;d++){var h=B.scalefac_band.psfb21[d],b=B.scalefac_band.psfb21[d+1];F[d]=No.MAX_VALUE;for(var i=h;i<b;i++){var u=i*w/1152,_=j(g,u);F[d]=Math.min(F[d],_)}}for(var d=0;d<_t.SBMAX_s;d++){var h=B.scalefac_band.s[d],b=B.scalefac_band.s[d+1];T[d]=No.MAX_VALUE;for(var i=h;i<b;i++){var u=i*w/384,_=j(g,u);T[d]=Math.min(T[d],_)}T[d]*=B.scalefac_band.s[d+1]-B.scalefac_band.s[d]}for(var d=0;d<_t.PSFB12;d++){var h=B.scalefac_band.psfb12[d],b=B.scalefac_band.psfb12[d+1];l[d]=No.MAX_VALUE;for(var i=h;i<b;i++){var u=i*w/384,_=j(g,u);l[d]=Math.min(l[d],_)}l[d]*=B.scalefac_band.s[13]-B.scalefac_band.s[12]}if(g.noATH){for(var d=0;d<_t.SBMAX_l;d++)O[d]=1e-20;for(var d=0;d<_t.PSFB21;d++)F[d]=1e-20;for(var d=0;d<_t.SBMAX_s;d++)T[d]=1e-20;for(var d=0;d<_t.PSFB12;d++)l[d]=1e-20}B.ATH.floor=10*Math.log10(j(g,-1))}this.iteration_init=function(g){var O=g.internal_flags,F=O.l3_side,T;if(O.iteration_init_init==0){for(O.iteration_init_init=1,F.main_data_begin=0,I(g),o[0]=0,T=1;T<E;T++)o[T]=Math.pow(T,4/3);for(T=0;T<E-1;T++)S[T]=T+1-Math.pow(.5*(o[T]+o[T+1]),.75);for(S[T]=.5,T=0;T<N;T++)y[T]=Math.pow(2,(T-210)*-.1875);for(T=0;T<=N+L;T++)x[T]=Math.pow(2,(T-210-L)*.25);t.huffman_init(O);{var l,B,w,d;for(T=g.exp_nspsytune>>2&63,T>=32&&(T-=64),l=Math.pow(10,T/4/10),T=g.exp_nspsytune>>8&63,T>=32&&(T-=64),B=Math.pow(10,T/4/10),T=g.exp_nspsytune>>14&63,T>=32&&(T-=64),w=Math.pow(10,T/4/10),T=g.exp_nspsytune>>20&63,T>=32&&(T-=64),d=w*Math.pow(10,T/4/10),T=0;T<_t.SBMAX_l;T++){var h;T<=6?h=l:T<=13?h=B:T<=20?h=w:h=d,O.nsPsy.longfact[T]=h}for(T=0;T<_t.SBMAX_s;T++){var h;T<=5?h=l:T<=10?h=B:T<=11?h=w:h=d,O.nsPsy.shortfact[T]=h}}}},this.on_pe=function(g,O,F,T,l,B){var w=g.internal_flags,d=0,h,b=R2(2),i,u=new A2(d),_=a.ResvMaxBits(g,T,u,B);d=u.bits;var A=d+_;for(A>Pt.MAX_BITS_PER_GRANULE&&(A=Pt.MAX_BITS_PER_GRANULE),h=0,i=0;i<w.channels_out;++i)F[i]=Math.min(Pt.MAX_BITS_PER_CHANNEL,d/w.channels_out),b[i]=0|F[i]*O[l][i]/700-F[i],b[i]>T*3/4&&(b[i]=T*3/4),b[i]<0&&(b[i]=0),b[i]+F[i]>Pt.MAX_BITS_PER_CHANNEL&&(b[i]=Math.max(0,Pt.MAX_BITS_PER_CHANNEL-F[i])),h+=b[i];if(h>_)for(i=0;i<w.channels_out;++i)b[i]=_*b[i]/h;for(i=0;i<w.channels_out;++i)F[i]+=b[i],_-=b[i];for(h=0,i=0;i<w.channels_out;++i)h+=F[i];if(h>Pt.MAX_BITS_PER_GRANULE){var z=0;for(i=0;i<w.channels_out;++i)F[i]*=Pt.MAX_BITS_PER_GRANULE,F[i]/=h,z+=F[i]}return A},this.reduce_side=function(g,O,F,T){Ur(g[0]+g[1]<=Pt.MAX_BITS_PER_GRANULE);var l=.33*(.5-O)/.5;l<0&&(l=0),l>.5&&(l=.5);var B=0|l*.5*(g[0]+g[1]);B>Pt.MAX_BITS_PER_CHANNEL-g[0]&&(B=Pt.MAX_BITS_PER_CHANNEL-g[0]),B<0&&(B=0),g[1]>=125&&(g[1]-B>125?(g[0]<F&&(g[0]+=B),g[1]-=B):(g[0]+=g[1]-125,g[1]=125)),B=g[0]+g[1],B>T&&(g[0]=T*g[0]/B,g[1]=T*g[1]/B),Ur(g[0]<=Pt.MAX_BITS_PER_CHANNEL),Ur(g[1]<=Pt.MAX_BITS_PER_CHANNEL),Ur(g[0]+g[1]<=Pt.MAX_BITS_PER_GRANULE)},this.athAdjust=function(g,O,F){var T=90.30873362,l=94.82444863,B=Ts.FAST_LOG10_X(O,10),w=g*g,d=0;return B-=F,w>1e-20&&(d=1+Ts.FAST_LOG10_X(w,10/T)),d<0&&(d=0),B*=d,B+=F+T-l,Math.pow(10,.1*B)},this.calc_xmin=function(g,O,F,T){var l=0,B=g.internal_flags,w,d=0,h=0,b=B.ATH,i=F.xr,u=g.VBR==Pa.vbr_mtrh?1:0,_=B.masking_lower;for((g.VBR==Pa.vbr_mtrh||g.VBR==Pa.vbr_mt)&&(_=1),w=0;w<F.psy_lmax;w++){var A,z,H,U,Q,c;g.VBR==Pa.vbr_rh||g.VBR==Pa.vbr_mtrh?z=athAdjust(b.adjust,b.l[w],b.floor):z=b.adjust*b.l[w],Q=F.width[w],H=z/Q,U=s,c=Q>>1,A=0;do{var p,K;p=i[d]*i[d],A+=p,U+=p<H?p:H,d++,K=i[d]*i[d],A+=K,U+=K<H?K:H,d++}while(--c>0);if(A>z&&h++,w==_t.SBPSY_l){var J=z*B.nsPsy.longfact[w];U<J&&(U=J)}if(u!=0&&(z=U),!g.ATHonly){var ce=O.en.l[w];if(ce>0){var J;J=A*O.thm.l[w]*_/ce,u!=0&&(J*=B.nsPsy.longfact[w]),z<J&&(z=J)}}u!=0?T[l++]=z:T[l++]=z*B.nsPsy.longfact[w]}var ue=575;if(F.block_type!=_t.SHORT_TYPE)for(var me=576;me--!=0&&e.EQ(i[me],0);)ue=me;F.max_nonzero_coeff=ue;for(var fe=F.sfb_smin;w<F.psymax;fe++,w+=3){var Q,we,ve;for(g.VBR==Pa.vbr_rh||g.VBR==Pa.vbr_mtrh?ve=athAdjust(b.adjust,b.s[fe],b.floor):ve=b.adjust*b.s[fe],Q=F.width[w],we=0;we<3;we++){var A=0,z,H,U,c=Q>>1;H=ve/Q,U=s;do{var p,K;p=i[d]*i[d],A+=p,U+=p<H?p:H,d++,K=i[d]*i[d],A+=K,U+=K<H?K:H,d++}while(--c>0);if(A>ve&&h++,fe==_t.SBPSY_s){var J=ve*B.nsPsy.shortfact[fe];U<J&&(U=J)}if(u!=0?z=U:z=ve,!g.ATHonly&&!g.ATHshort){var ce=O.en.s[fe][we];if(ce>0){var J;J=A*O.thm.s[fe][we]*_/ce,u!=0&&(J*=B.nsPsy.shortfact[fe]),z<J&&(z=J)}}u!=0?T[l++]=z:T[l++]=z*B.nsPsy.shortfact[fe]}g.useTemporal&&(T[l-3]>T[l-3+1]&&(T[l-3+1]+=(T[l-3]-T[l-3+1])*B.decay),T[l-3+1]>T[l-3+2]&&(T[l-3+2]+=(T[l-3+1]-T[l-3+2])*B.decay))}return h};function v(g){this.s=g}this.calc_noise_core=function(g,O,F,T){var l=0,B=O.s,w=g.l3_enc;if(B>g.count1)for(;F--!=0;){var d;d=g.xr[B],B++,l+=d*d,d=g.xr[B],B++,l+=d*d}else if(B>g.big_values){var h=Fa(2);for(h[0]=0,h[1]=T;F--!=0;){var d;d=Math.abs(g.xr[B])-h[w[B]],B++,l+=d*d,d=Math.abs(g.xr[B])-h[w[B]],B++,l+=d*d}}else for(;F--!=0;){var d;d=Math.abs(g.xr[B])-o[w[B]]*T,B++,l+=d*d,d=Math.abs(g.xr[B])-o[w[B]]*T,B++,l+=d*d}return O.s=B,l},this.calc_noise=function(g,O,F,T,l){var B=0,w=0,d,h,b=0,i=0,u=0,_=-20,A=0,z=g.scalefac,H=0;for(T.over_SSD=0,d=0;d<g.psymax;d++){var U=g.global_gain-(z[H++]+(g.preflag!=0?f[d]:0)<<g.scalefac_scale+1)-g.subblock_gain[g.window[d]]*8,Q=0;if(l!=null&&l.step[d]==U)Q=l.noise[d],A+=g.width[d],F[B++]=Q/O[w++],Q=l.noise_log[d];else{var c=m(U);if(h=g.width[d]>>1,A+g.width[d]>g.max_nonzero_coeff){var p;p=g.max_nonzero_coeff-A+1,p>0?h=p>>1:h=0}var K=new v(A);Q=this.calc_noise_core(g,K,h,c),A=K.s,l!=null&&(l.step[d]=U,l.noise[d]=Q),Q=F[B++]=Q/O[w++],Q=Ts.FAST_LOG10(Math.max(Q,1e-20)),l!=null&&(l.noise_log[d]=Q)}if(l!=null&&(l.global_gain=g.global_gain),u+=Q,Q>0){var J;J=Math.max(0|Q*10+.5,1),T.over_SSD+=J*J,b++,i+=Q}_=Math.max(_,Q)}return T.over_count=b,T.tot_noise=u,T.over_noise=i,T.max_noise=_,b},this.set_pinfo=function(g,O,F,T,l){var B=g.internal_flags,w,d,h,b,i,u=O.scalefac_scale==0?.5:1,_=O.scalefac,A=Fa(L3Side.SFBMAX),z=Fa(L3Side.SFBMAX),H=new CalcNoiseResult;calc_xmin(g,F,O,A),calc_noise(O,A,z,H,null);var U=0;for(d=O.sfb_lmax,O.block_type!=_t.SHORT_TYPE&&O.mixed_block_flag==0&&(d=22),w=0;w<d;w++){var Q=B.scalefac_band.l[w],c=B.scalefac_band.l[w+1],p=c-Q;for(b=0;U<c;U++)b+=O.xr[U]*O.xr[U];b/=p,i=1e15,B.pinfo.en[T][l][w]=i*b,B.pinfo.xfsf[T][l][w]=i*A[w]*z[w]/p,F.en.l[w]>0&&!g.ATHonly?b=b/F.en.l[w]:b=0,B.pinfo.thr[T][l][w]=i*Math.max(b*F.thm.l[w],B.ATH.l[w]),B.pinfo.LAMEsfb[T][l][w]=0,O.preflag!=0&&w>=11&&(B.pinfo.LAMEsfb[T][l][w]=-u*f[w]),w<_t.SBPSY_l&&(Ur(_[w]>=0),B.pinfo.LAMEsfb[T][l][w]-=u*_[w])}if(O.block_type==_t.SHORT_TYPE)for(d=w,w=O.sfb_smin;w<_t.SBMAX_s;w++)for(var Q=B.scalefac_band.s[w],c=B.scalefac_band.s[w+1],p=c-Q,K=0;K<3;K++){for(b=0,h=Q;h<c;h++)b+=O.xr[U]*O.xr[U],U++;b=Math.max(b/p,1e-20),i=1e15,B.pinfo.en_s[T][l][3*w+K]=i*b,B.pinfo.xfsf_s[T][l][3*w+K]=i*A[d]*z[d]/p,F.en.s[w][K]>0?b=b/F.en.s[w][K]:b=0,(g.ATHonly||g.ATHshort)&&(b=0),B.pinfo.thr_s[T][l][3*w+K]=i*Math.max(b*F.thm.s[w][K],B.ATH.s[w]),B.pinfo.LAMEsfb_s[T][l][3*w+K]=-2*O.subblock_gain[K],w<_t.SBPSY_s&&(B.pinfo.LAMEsfb_s[T][l][3*w+K]-=u*_[d]),d++}B.pinfo.LAMEqss[T][l]=O.global_gain,B.pinfo.LAMEmainbits[T][l]=O.part2_3_length+O.part2_length,B.pinfo.LAMEsfbits[T][l]=O.part2_length,B.pinfo.over[T][l]=H.over_count,B.pinfo.max_noise[T][l]=H.max_noise*10,B.pinfo.over_noise[T][l]=H.over_noise*10,B.pinfo.tot_noise[T][l]=H.tot_noise*10,B.pinfo.over_SSD[T][l]=H.over_SSD}}var e0=pa,Io=We,T2=Io.System,B2=Io.Arrays,zr=Io.new_int,Bs=Io.assert,nt=Rt,tt=As,C2=ks,Da=e0;function Cs(){var e=null;this.qupvt=null,this.setModules=function(d){this.qupvt=d,e=d};function t(d){this.bits=0|d}var a=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function n(d,h,b,i,u,_){var A=.5946/h;for(d=d>>1;d--!=0;)u[_++]=A>b[i++]?0:1,u[_++]=A>b[i++]?0:1}function m(d,h,b,i,u,_){d=d>>1;var A=d%2;for(d=d>>1;d--!=0;){var z,H,U,Q,c,p,K,J;z=b[i++]*h,H=b[i++]*h,c=0|z,U=b[i++]*h,p=0|H,Q=b[i++]*h,K=0|U,z+=e.adj43[c],J=0|Q,H+=e.adj43[p],u[_++]=0|z,U+=e.adj43[K],u[_++]=0|H,Q+=e.adj43[J],u[_++]=0|U,u[_++]=0|Q}if(A!=0){var z,H,c,p;z=b[i++]*h,H=b[i++]*h,c=0|z,p=0|H,z+=e.adj43[c],H+=e.adj43[p],u[_++]=0|z,u[_++]=0|H}}function s(d,h,b,i,u){var _,A,z=0,H,U=0,Q=0,c=0,p=h,K=0,J=p,ce=0,ue=d,me=0;for(H=u!=null&&i.global_gain==u.global_gain,i.block_type==nt.SHORT_TYPE?A=38:A=21,_=0;_<=A;_++){var fe=-1;if((H||i.block_type==nt.NORM_TYPE)&&(fe=i.global_gain-(i.scalefac[_]+(i.preflag!=0?e.pretab[_]:0)<<i.scalefac_scale+1)-i.subblock_gain[i.window[_]]*8),Bs(i.width[_]>=0),H&&u.step[_]==fe)U!=0&&(m(U,b,ue,me,J,ce),U=0),Q!=0&&(n(Q,b,ue,me,J,ce),Q=0);else{var we=i.width[_];if(z+i.width[_]>i.max_nonzero_coeff){var ve;ve=i.max_nonzero_coeff-z+1,B2.fill(h,i.max_nonzero_coeff,576,0),we=ve,we<0&&(we=0),_=A+1}if(U==0&&Q==0&&(J=p,ce=K,ue=d,me=c),u!=null&&u.sfb_count1>0&&_>=u.sfb_count1&&u.step[_]>0&&fe>=u.step[_]?(U!=0&&(m(U,b,ue,me,J,ce),U=0,J=p,ce=K,ue=d,me=c),Q+=we):(Q!=0&&(n(Q,b,ue,me,J,ce),Q=0,J=p,ce=K,ue=d,me=c),U+=we),we<=0){Q!=0&&(n(Q,b,ue,me,J,ce),Q=0),U!=0&&(m(U,b,ue,me,J,ce),U=0);break}}_<=A&&(K+=i.width[_],c+=i.width[_],z+=i.width[_])}U!=0&&(m(U,b,ue,me,J,ce),U=0),Q!=0&&(n(Q,b,ue,me,J,ce),Q=0)}function R(d,h,b){var i=0,u=0;do{var _=d[h++],A=d[h++];i<_&&(i=_),u<A&&(u=A)}while(h<b);return i<u&&(i=u),i}function E(d,h,b,i,u,_){var A=tt.ht[i].xlen*65536+tt.ht[u].xlen,z=0,H;do{var U=d[h++],Q=d[h++];U!=0&&(U>14&&(U=15,z+=A),U*=16),Q!=0&&(Q>14&&(Q=15,z+=A),U+=Q),z+=tt.largetbl[U]}while(h<b);return H=z&65535,z>>=16,z>H&&(z=H,i=u),_.bits+=z,i}function N(d,h,b,i){var u=0,_=tt.ht[1].hlen;do{var A=d[h+0]*2+d[h+1];h+=2,u+=_[A]}while(h<b);return i.bits+=u,1}function L(d,h,b,i,u){var _=0,A,z=tt.ht[i].xlen,H;i==2?H=tt.table23:H=tt.table56;do{var U=d[h+0]*z+d[h+1];h+=2,_+=H[U]}while(h<b);return A=_&65535,_>>=16,_>A&&(_=A,i++),u.bits+=_,i}function k(d,h,b,i,u){var _=0,A=0,z=0,H=tt.ht[i].xlen,U=tt.ht[i].hlen,Q=tt.ht[i+1].hlen,c=tt.ht[i+2].hlen;do{var p=d[h+0]*H+d[h+1];h+=2,_+=U[p],A+=Q[p],z+=c[p]}while(h<b);var K=i;return _>A&&(_=A,K++),_>z&&(_=z,K=i+2),u.bits+=_,K}var f=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function x(d,h,b,i){var u=R(d,h,b);switch(u){case 0:return u;case 1:return N(d,h,b,i);case 2:case 3:return L(d,h,b,f[u-1],i);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return k(d,h,b,f[u-1],i);default:if(u>Da.IXMAX_VAL)return i.bits=Da.LARGE_BITS,-1;u-=15;var _;for(_=24;_<32&&!(tt.ht[_].linmax>=u);_++);var A;for(A=_-8;A<24&&!(tt.ht[A].linmax>=u);A++);return E(d,h,b,A,_,i)}}this.noquant_count_bits=function(d,h,b){var i=h.l3_enc,u=Math.min(576,h.max_nonzero_coeff+2>>1<<1);for(b!=null&&(b.sfb_count1=0);u>1&&(i[u-1]|i[u-2])==0;u-=2);h.count1=u;for(var _=0,A=0;u>3;u-=4){var z;if(((i[u-1]|i[u-2]|i[u-3]|i[u-4])&2147483647)>1)break;z=((i[u-4]*2+i[u-3])*2+i[u-2])*2+i[u-1],_+=tt.t32l[z],A+=tt.t33l[z]}var H=_;if(h.count1table_select=0,_>A&&(H=A,h.count1table_select=1),h.count1bits=H,h.big_values=u,u==0)return H;if(h.block_type==nt.SHORT_TYPE)_=3*d.scalefac_band.s[3],_>h.big_values&&(_=h.big_values),A=h.big_values;else if(h.block_type==nt.NORM_TYPE){if(_=h.region0_count=d.bv_scf[u-2],A=h.region1_count=d.bv_scf[u-1],A=d.scalefac_band.l[_+A+2],_=d.scalefac_band.l[_+1],A<u){var U=new t(H);h.table_select[2]=x(i,A,u,U),H=U.bits}}else h.region0_count=7,h.region1_count=nt.SBMAX_l-1-7-1,_=d.scalefac_band.l[7+1],A=u,_>A&&(_=A);if(_=Math.min(_,u),A=Math.min(A,u),0<_){var U=new t(H);h.table_select[0]=x(i,0,_,U),H=U.bits}if(_<A){var U=new t(H);h.table_select[1]=x(i,_,A,U),H=U.bits}if(d.use_best_huffman==2&&(h.part2_3_length=H,best_huffman_divide(d,h),H=h.part2_3_length),b!=null&&h.block_type==nt.NORM_TYPE){for(var Q=0;d.scalefac_band.l[Q]<h.big_values;)Q++;b.sfb_count1=Q}return H},this.count_bits=function(d,h,b,i){var u=b.l3_enc,_=Da.IXMAX_VAL/e.IPOW20(b.global_gain);if(b.xrpow_max>_)return Da.LARGE_BITS;if(s(h,u,e.IPOW20(b.global_gain),b,i),(d.substep_shaping&2)!=0)for(var A=0,z=b.global_gain+b.scalefac_scale,H=.634521682242439/e.IPOW20(z),U=0;U<b.sfbmax;U++){var Q=b.width[U];if(d.pseudohalf[U]==0)A+=Q;else{var c;for(c=A,A+=Q;c<A;++c)u[c]=h[c]>=H?u[c]:0}}return this.noquant_count_bits(d,b,i)};function y(d,h,b,i,u,_,A){for(var z=h.big_values,H=0;H<=7+15;H++)i[H]=Da.LARGE_BITS;for(var H=0;H<16;H++){var U=d.scalefac_band.l[H+1];if(U>=z)break;var Q=0,c=new t(Q),p=x(b,0,U,c);Q=c.bits;for(var K=0;K<8;K++){var J=d.scalefac_band.l[H+K+2];if(J>=z)break;var ce=Q;c=new t(ce);var ue=x(b,U,J,c);ce=c.bits,i[H+K]>ce&&(i[H+K]=ce,u[H+K]=H,_[H+K]=p,A[H+K]=ue)}}}function o(d,h,b,i,u,_,A,z){for(var H=h.big_values,U=2;U<nt.SBMAX_l+1;U++){var Q=d.scalefac_band.l[U];if(Q>=H)break;var c=u[U-2]+h.count1bits;if(b.part2_3_length<=c)break;var p=new t(c),K=x(i,Q,H,p);c=p.bits,!(b.part2_3_length<=c)&&(b.assign(h),b.part2_3_length=c,b.region0_count=_[U-2],b.region1_count=U-2-_[U-2],b.table_select[0]=A[U-2],b.table_select[1]=z[U-2],b.table_select[2]=K)}}this.best_huffman_divide=function(d,h){var b=new C2,i=h.l3_enc,u=zr(7+15+1),_=zr(7+15+1),A=zr(7+15+1),z=zr(7+15+1);if(!(h.block_type==nt.SHORT_TYPE&&d.mode_gr==1)){b.assign(h),h.block_type==nt.NORM_TYPE&&(y(d,h,i,u,_,A,z),o(d,b,h,i,u,_,A,z));var H=b.big_values;if(!(H==0||(i[H-2]|i[H-1])>1)&&(H=h.count1+2,!(H>576))){b.assign(h),b.count1=H;for(var U=0,Q=0;H>b.big_values;H-=4){var c=((i[H-4]*2+i[H-3])*2+i[H-2])*2+i[H-1];U+=tt.t32l[c],Q+=tt.t33l[c]}if(b.big_values=H,b.count1table_select=0,U>Q&&(U=Q,b.count1table_select=1),b.count1bits=U,b.block_type==nt.NORM_TYPE)o(d,b,h,i,u,_,A,z);else{if(b.part2_3_length=U,U=d.scalefac_band.l[7+1],U>H&&(U=H),U>0){var p=new t(b.part2_3_length);b.table_select[0]=x(i,0,U,p),b.part2_3_length=p.bits}if(H>U){var p=new t(b.part2_3_length);b.table_select[1]=x(i,U,H,p),b.part2_3_length=p.bits}h.part2_3_length>b.part2_3_length&&h.assign(b)}}}};var S=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],j=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],I=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],v=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];Cs.slen1_tab=I,Cs.slen2_tab=v;function g(d,h){for(var b,i=h.tt[1][d],u=h.tt[0][d],_=0;_<tt.scfsi_band.length-1;_++){for(b=tt.scfsi_band[_];b<tt.scfsi_band[_+1]&&!(u.scalefac[b]!=i.scalefac[b]&&i.scalefac[b]>=0);b++);if(b==tt.scfsi_band[_+1]){for(b=tt.scfsi_band[_];b<tt.scfsi_band[_+1];b++)i.scalefac[b]=-1;h.scfsi[d][_]=1}}var A=0,z=0;for(b=0;b<11;b++)i.scalefac[b]!=-1&&(z++,A<i.scalefac[b]&&(A=i.scalefac[b]));for(var H=0,U=0;b<nt.SBPSY_l;b++)i.scalefac[b]!=-1&&(U++,H<i.scalefac[b]&&(H=i.scalefac[b]));for(var _=0;_<16;_++)if(A<S[_]&&H<j[_]){var Q=I[_]*z+v[_]*U;i.part2_length>Q&&(i.part2_length=Q,i.scalefac_compress=_)}}this.best_scalefac_store=function(d,h,b,i){var u=i.tt[h][b],_,A,z,H,U=0;for(z=0,_=0;_<u.sfbmax;_++){var Q=u.width[_];for(z+=Q,H=-Q;H<0&&u.l3_enc[H+z]==0;H++);H==0&&(u.scalefac[_]=U=-2)}if(u.scalefac_scale==0&&u.preflag==0){var c=0;for(_=0;_<u.sfbmax;_++)u.scalefac[_]>0&&(c|=u.scalefac[_]);if((c&1)==0&&c!=0){for(_=0;_<u.sfbmax;_++)u.scalefac[_]>0&&(u.scalefac[_]>>=1);u.scalefac_scale=U=1}}if(u.preflag==0&&u.block_type!=nt.SHORT_TYPE&&d.mode_gr==2){for(_=11;_<nt.SBPSY_l&&!(u.scalefac[_]<e.pretab[_]&&u.scalefac[_]!=-2);_++);if(_==nt.SBPSY_l){for(_=11;_<nt.SBPSY_l;_++)u.scalefac[_]>0&&(u.scalefac[_]-=e.pretab[_]);u.preflag=U=1}}for(A=0;A<4;A++)i.scfsi[b][A]=0;for(d.mode_gr==2&&h==1&&i.tt[0][b].block_type!=nt.SHORT_TYPE&&i.tt[1][b].block_type!=nt.SHORT_TYPE&&(g(b,i),U=0),_=0;_<u.sfbmax;_++)u.scalefac[_]==-2&&(u.scalefac[_]=0);U!=0&&(d.mode_gr==2?this.scale_bitcount(u):this.scale_bitcount_lsf(d,u))};function O(d,h){for(var b=0;b<h;++b)if(d[b]<0)return!1;return!0}var F=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],T=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],l=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(d){var h,b,i=0,u=0,_,A=d.scalefac;if(Bs(O(A,d.sfbmax)),d.block_type==nt.SHORT_TYPE)_=F,d.mixed_block_flag!=0&&(_=T);else if(_=l,d.preflag==0){for(b=11;b<nt.SBPSY_l&&!(A[b]<e.pretab[b]);b++);if(b==nt.SBPSY_l)for(d.preflag=1,b=11;b<nt.SBPSY_l;b++)A[b]-=e.pretab[b]}for(b=0;b<d.sfbdivide;b++)i<A[b]&&(i=A[b]);for(;b<d.sfbmax;b++)u<A[b]&&(u=A[b]);for(d.part2_length=Da.LARGE_BITS,h=0;h<16;h++)i<S[h]&&u<j[h]&&d.part2_length>_[h]&&(d.part2_length=_[h],d.scalefac_compress=h);return d.part2_length==Da.LARGE_BITS};var B=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(d,h){var b,i,u,_,A,z,H,U,Q=zr(4),c=h.scalefac;for(h.preflag!=0?b=2:b=0,H=0;H<4;H++)Q[H]=0;if(h.block_type==nt.SHORT_TYPE){i=1;var p=e.nr_of_sfb_block[b][i];for(U=0,u=0;u<4;u++)for(_=p[u]/3,H=0;H<_;H++,U++)for(A=0;A<3;A++)c[U*3+A]>Q[u]&&(Q[u]=c[U*3+A])}else{i=0;var p=e.nr_of_sfb_block[b][i];for(U=0,u=0;u<4;u++)for(_=p[u],H=0;H<_;H++,U++)c[U]>Q[u]&&(Q[u]=c[U])}for(z=!1,u=0;u<4;u++)Q[u]>B[b][u]&&(z=!0);if(!z){var K,J,ce,ue;for(h.sfb_partition_table=e.nr_of_sfb_block[b][i],u=0;u<4;u++)h.slen[u]=w[Q[u]];switch(K=h.slen[0],J=h.slen[1],ce=h.slen[2],ue=h.slen[3],b){case 0:h.scalefac_compress=(K*5+J<<4)+(ce<<2)+ue;break;case 1:h.scalefac_compress=400+(K*5+J<<2)+ce;break;case 2:h.scalefac_compress=500+K*3+J;break;default:T2.err.printf(`intensity stereo not implemented yet
`);break}}if(!z)for(Bs(h.sfb_partition_table!=null),h.part2_length=0,u=0;u<4;u++)h.part2_length+=h.slen[u]*h.sfb_partition_table[u];return z};var w=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(d){for(var h=2;h<=576;h+=2){for(var b=0,i;d.scalefac_band.l[++b]<h;);for(i=a[b][0];d.scalefac_band.l[i+1]>h;)i--;for(i<0&&(i=a[b][0]),d.bv_scf[h-2]=i,i=a[b][1];d.scalefac_band.l[i+d.bv_scf[h-2]+2]>h;)i--;i<0&&(i=a[b][1]),d.bv_scf[h-1]=i}}}var t0=Cs,cr=We,sa=cr.System,O2=cr.Arrays,N2=cr.new_byte,I2=cr.new_float_n,L2=cr.new_int,mt=cr.assert,a0=t0,Os=As,Lo=Rt,Ua=Oo;Vo.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=Math.abs(e)*1e-6:Math.abs(e-t)<=Math.abs(t)*1e-6},Vo.NEQ=function(e,t){return!Vo.EQ(e,t)};function Vo(){var e=Vs,t=this,a=32773,n=null,m=null,s=null,R=null;this.setModules=function(w,d,h,b){n=w,m=d,s=h,R=b};var E=null,N=0,L=0,k=0;this.getframebits=function(w){var d=w.internal_flags,h;d.bitrate_index!=0?h=Os.bitrate_table[w.version][d.bitrate_index]:h=w.brate;var b=0|(w.version+1)*72e3*h/w.out_samplerate+d.padding;return 8*b};function f(w){sa.arraycopy(w.header[w.w_ptr].buf,0,E,L,w.sideinfo_len),L+=w.sideinfo_len,N+=w.sideinfo_len*8,w.w_ptr=w.w_ptr+1&Ua.MAX_HEADER_BUF-1}function x(w,d,h){for(;h>0;){var b;k==0&&(k=8,L++,mt(w.header[w.w_ptr].write_timing>=N),w.header[w.w_ptr].write_timing==N&&f(w),E[L]=0),b=Math.min(h,k),h-=b,k-=b,E[L]|=d>>h<<k,N+=b}}function y(w,d,h){for(;h>0;){var b;k==0&&(k=8,L++,E[L]=0),b=Math.min(h,k),h-=b,k-=b,E[L]|=d>>h<<k,N+=b}}function o(w,d){var h=w.internal_flags,b;if(d>=8&&(x(h,76,8),d-=8),d>=8&&(x(h,65,8),d-=8),d>=8&&(x(h,77,8),d-=8),d>=8&&(x(h,69,8),d-=8),d>=32){var i=s.getLameShortVersion();if(d>=32)for(b=0;b<i.length&&d>=8;++b)d-=8,x(h,i.charAt(b),8)}for(;d>=1;d-=1)x(h,h.ancillary_flag,1),h.ancillary_flag^=w.disable_reservoir?0:1}function S(w,d,h){for(var b=w.header[w.h_ptr].ptr;h>0;){var i=Math.min(h,8-(b&7));h-=i,w.header[w.h_ptr].buf[b>>3]|=d>>h<<8-(b&7)-i,b+=i}w.header[w.h_ptr].ptr=b}function j(w,d){w<<=8;for(var h=0;h<8;h++)w<<=1,d<<=1,((d^w)&65536)!=0&&(d^=a);return d}this.CRC_writeheader=function(w,d){var h=65535;h=j(d[2]&255,h),h=j(d[3]&255,h);for(var b=6;b<w.sideinfo_len;b++)h=j(d[b]&255,h);d[4]=byte(h>>8),d[5]=byte(h&255)};function I(w,d){var h=w.internal_flags,b,i,u;if(b=h.l3_side,h.header[h.h_ptr].ptr=0,O2.fill(h.header[h.h_ptr].buf,0,h.sideinfo_len,0),w.out_samplerate<16e3?S(h,4094,12):S(h,4095,12),S(h,w.version,1),S(h,4-3,2),S(h,w.error_protection?0:1,1),S(h,h.bitrate_index,4),S(h,h.samplerate_index,2),S(h,h.padding,1),S(h,w.extension,1),S(h,w.mode.ordinal(),2),S(h,h.mode_ext,2),S(h,w.copyright,1),S(h,w.original,1),S(h,w.emphasis,2),w.error_protection&&S(h,0,16),w.version==1){for(mt(b.main_data_begin>=0),S(h,b.main_data_begin,9),h.channels_out==2?S(h,b.private_bits,3):S(h,b.private_bits,5),u=0;u<h.channels_out;u++){var _;for(_=0;_<4;_++)S(h,b.scfsi[u][_],1)}for(i=0;i<2;i++)for(u=0;u<h.channels_out;u++){var A=b.tt[i][u];S(h,A.part2_3_length+A.part2_length,12),S(h,A.big_values/2,9),S(h,A.global_gain,8),S(h,A.scalefac_compress,4),A.block_type!=Lo.NORM_TYPE?(S(h,1,1),S(h,A.block_type,2),S(h,A.mixed_block_flag,1),A.table_select[0]==14&&(A.table_select[0]=16),S(h,A.table_select[0],5),A.table_select[1]==14&&(A.table_select[1]=16),S(h,A.table_select[1],5),S(h,A.subblock_gain[0],3),S(h,A.subblock_gain[1],3),S(h,A.subblock_gain[2],3)):(S(h,0,1),A.table_select[0]==14&&(A.table_select[0]=16),S(h,A.table_select[0],5),A.table_select[1]==14&&(A.table_select[1]=16),S(h,A.table_select[1],5),A.table_select[2]==14&&(A.table_select[2]=16),S(h,A.table_select[2],5),mt(0<=A.region0_count&&A.region0_count<16),mt(0<=A.region1_count&&A.region1_count<8),S(h,A.region0_count,4),S(h,A.region1_count,3)),S(h,A.preflag,1),S(h,A.scalefac_scale,1),S(h,A.count1table_select,1)}}else for(mt(b.main_data_begin>=0),S(h,b.main_data_begin,8),S(h,b.private_bits,h.channels_out),i=0,u=0;u<h.channels_out;u++){var A=b.tt[i][u];S(h,A.part2_3_length+A.part2_length,12),S(h,A.big_values/2,9),S(h,A.global_gain,8),S(h,A.scalefac_compress,9),A.block_type!=Lo.NORM_TYPE?(S(h,1,1),S(h,A.block_type,2),S(h,A.mixed_block_flag,1),A.table_select[0]==14&&(A.table_select[0]=16),S(h,A.table_select[0],5),A.table_select[1]==14&&(A.table_select[1]=16),S(h,A.table_select[1],5),S(h,A.subblock_gain[0],3),S(h,A.subblock_gain[1],3),S(h,A.subblock_gain[2],3)):(S(h,0,1),A.table_select[0]==14&&(A.table_select[0]=16),S(h,A.table_select[0],5),A.table_select[1]==14&&(A.table_select[1]=16),S(h,A.table_select[1],5),A.table_select[2]==14&&(A.table_select[2]=16),S(h,A.table_select[2],5),mt(0<=A.region0_count&&A.region0_count<16),mt(0<=A.region1_count&&A.region1_count<8),S(h,A.region0_count,4),S(h,A.region1_count,3)),S(h,A.scalefac_scale,1),S(h,A.count1table_select,1)}w.error_protection&&CRC_writeheader(h,h.header[h.h_ptr].buf);{var z=h.h_ptr;mt(h.header[z].ptr==h.sideinfo_len*8),h.h_ptr=z+1&Ua.MAX_HEADER_BUF-1,h.header[h.h_ptr].write_timing=h.header[z].write_timing+d,h.h_ptr==h.w_ptr&&sa.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function v(w,d){var h=Os.ht[d.count1table_select+32],b,i=0,u=d.big_values,_=d.big_values;for(mt(d.count1table_select<2),b=(d.count1-d.big_values)/4;b>0;--b){var A=0,z=0,H;H=d.l3_enc[u+0],H!=0&&(z+=8,d.xr[_+0]<0&&A++),H=d.l3_enc[u+1],H!=0&&(z+=4,A*=2,d.xr[_+1]<0&&A++),H=d.l3_enc[u+2],H!=0&&(z+=2,A*=2,d.xr[_+2]<0&&A++),H=d.l3_enc[u+3],H!=0&&(z++,A*=2,d.xr[_+3]<0&&A++),u+=4,_+=4,x(w,A+h.table[z],h.hlen[z]),i+=h.hlen[z]}return i}function g(w,d,h,b,i){var u=Os.ht[d],_=0;if(d==0)return _;for(var A=h;A<b;A+=2){var z=0,H=0,U=u.xlen,Q=u.xlen,c=0,p=i.l3_enc[A],K=i.l3_enc[A+1];if(p!=0&&(i.xr[A]<0&&c++,z--),d>15){if(p>14){var J=p-15;mt(J<=u.linmax),c|=J<<1,H=U,p=15}if(K>14){var ce=K-15;mt(ce<=u.linmax),c<<=U,c|=ce,H+=U,K=15}Q=16}K!=0&&(c<<=1,i.xr[A+1]<0&&c++,z--),p=p*Q+K,H-=z,z+=u.hlen[p],x(w,u.table[p],z),x(w,c,H),_+=z+H}return _}function O(w,d){var h=3*w.scalefac_band.s[3];h>d.big_values&&(h=d.big_values);var b=g(w,d.table_select[0],0,h,d);return b+=g(w,d.table_select[1],h,d.big_values,d),b}function F(w,d){var h,b,i,u;h=d.big_values;var _=d.region0_count+1;return mt(_<w.scalefac_band.l.length),i=w.scalefac_band.l[_],_+=d.region1_count+1,mt(_<w.scalefac_band.l.length),u=w.scalefac_band.l[_],i>h&&(i=h),u>h&&(u=h),b=g(w,d.table_select[0],0,i,d),b+=g(w,d.table_select[1],i,u,d),b+=g(w,d.table_select[2],u,h,d),b}function T(w){var d,h,b,i,u=0,_=w.internal_flags,A=_.l3_side;if(w.version==1)for(d=0;d<2;d++)for(h=0;h<_.channels_out;h++){var z=A.tt[d][h],H=a0.slen1_tab[z.scalefac_compress],U=a0.slen2_tab[z.scalefac_compress];for(i=0,b=0;b<z.sfbdivide;b++)z.scalefac[b]!=-1&&(x(_,z.scalefac[b],H),i+=H);for(;b<z.sfbmax;b++)z.scalefac[b]!=-1&&(x(_,z.scalefac[b],U),i+=U);mt(i==z.part2_length),z.block_type==Lo.SHORT_TYPE?i+=O(_,z):i+=F(_,z),i+=v(_,z),mt(i==z.part2_3_length+z.part2_length),u+=i}else for(d=0,h=0;h<_.channels_out;h++){var z=A.tt[d][h],Q,c,p=0;if(mt(z.sfb_partition_table!=null),i=0,b=0,c=0,z.block_type==Lo.SHORT_TYPE){for(;c<4;c++){var K=z.sfb_partition_table[c]/3,J=z.slen[c];for(Q=0;Q<K;Q++,b++)x(_,Math.max(z.scalefac[b*3+0],0),J),x(_,Math.max(z.scalefac[b*3+1],0),J),x(_,Math.max(z.scalefac[b*3+2],0),J),p+=3*J}i+=O(_,z)}else{for(;c<4;c++){var K=z.sfb_partition_table[c],J=z.slen[c];for(Q=0;Q<K;Q++,b++)x(_,Math.max(z.scalefac[b],0),J),p+=J}i+=F(_,z)}i+=v(_,z),mt(i==z.part2_3_length),mt(p==z.part2_length),u+=p+i}return u}function l(){this.total=0}function B(w,d){var h=w.internal_flags,b,i,u,_,A;return A=h.w_ptr,_=h.h_ptr-1,_==-1&&(_=Ua.MAX_HEADER_BUF-1),b=h.header[_].write_timing-N,d.total=b,b>=0&&(i=1+_-A,_<A&&(i=1+_-A+Ua.MAX_HEADER_BUF),b-=i*8*h.sideinfo_len),u=t.getframebits(w),b+=u,d.total+=u,d.total%8!=0?d.total=1+d.total/8:d.total=d.total/8,d.total+=L+1,b<0&&sa.err.println(`strange error flushing buffer ... 
`),b}this.flush_bitstream=function(w){var d=w.internal_flags,h,b,i=d.h_ptr-1;if(i==-1&&(i=Ua.MAX_HEADER_BUF-1),h=d.l3_side,!((b=B(w,new l))<0)){if(o(w,b),mt(d.header[i].write_timing+this.getframebits(w)==N),d.ResvSize=0,h.main_data_begin=0,d.findReplayGain){var u=n.GetTitleGain(d.rgdata);mt(NEQ(u,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),d.RadioGain=Math.floor(u*10+.5)|0}d.findPeakSample&&(d.noclipGainChange=Math.ceil(Math.log10(d.PeakSample/32767)*20*10)|0,d.noclipGainChange>0&&(EQ(w.scale,1)||EQ(w.scale,0))?d.noclipScale=Math.floor(32767/d.PeakSample*100)/100:d.noclipScale=-1)}},this.add_dummy_byte=function(w,d,h){for(var b=w.internal_flags,i;h-- >0;)for(y(b,d,8),i=0;i<Ua.MAX_HEADER_BUF;++i)b.header[i].write_timing+=8},this.format_bitstream=function(w){var d=w.internal_flags,h;h=d.l3_side;var b=this.getframebits(w);o(w,h.resvDrain_pre),I(w,b);var i=8*d.sideinfo_len;if(i+=T(w),o(w,h.resvDrain_post),i+=h.resvDrain_post,h.main_data_begin+=(b-i)/8,B(w,new l)!=d.ResvSize&&sa.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),h.main_data_begin*8!=d.ResvSize&&(sa.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*h.main_data_begin,d.ResvSize,h.resvDrain_post,h.resvDrain_pre,8*d.sideinfo_len,i-h.resvDrain_post-8*d.sideinfo_len,i,i%8,b),sa.err.println("This is a fatal error.  It has several possible causes:"),sa.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),sa.err.println(" 9%%  Your system is overclocked"),sa.err.println(" 1%%  bug in LAME encoding library"),d.ResvSize=h.main_data_begin*8),N>1e9){var u;for(u=0;u<Ua.MAX_HEADER_BUF;++u)d.header[u].write_timing-=N;N=0}return 0},this.copy_buffer=function(w,d,h,b,i){var u=L+1;if(u<=0)return 0;if(b!=0&&u>b)return-1;if(sa.arraycopy(E,0,d,h,u),L=-1,k=0,i!=0){var _=L2(1);if(_[0]=w.nMusicCRC,R.updateMusicCRC(_,d,h,u),w.nMusicCRC=_[0],u>0&&(w.VBR_seek_table.nBytesWritten+=u),w.decode_on_the_fly){for(var A=I2([2,1152]),z=u,H=-1,U;H!=0;)if(H=m.hip_decode1_unclipped(w.hip,d,h,z,A[0],A[1]),z=0,H==-1&&(H=0),H>0){if(w.findPeakSample){for(U=0;U<H;U++)A[0][U]>w.PeakSample?w.PeakSample=A[0][U]:-A[0][U]>w.PeakSample&&(w.PeakSample=-A[0][U]);if(w.channels_out>1)for(U=0;U<H;U++)A[1][U]>w.PeakSample?w.PeakSample=A[1][U]:-A[1][U]>w.PeakSample&&(w.PeakSample=-A[1][U])}if(w.findReplayGain&&n.AnalyzeSamples(w.rgdata,A[0],0,A[1],0,H,w.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return u},this.init_bit_stream_w=function(w){E=N2(e.LAME_MAXMP3BUFFER),w.h_ptr=w.w_ptr=0,w.header[w.h_ptr].write_timing=0,L=-1,k=0,N=0}}var Ns=Vo,za=We,V2=za.System,Ke=za.VbrMode,Is=za.ShortBlock,qa=za.new_float,r0=za.new_int_n,j2=za.new_short_n,wa=za.assert,Ls=qm,H2=Gm,jo=Oo,P2=v2,F2=b2,D2=M2,Xa=Ns,na=As,it=Rt;function ht(){var e=Dr,t=this,a=128*1024;ht.V9=410,ht.V8=420,ht.V7=430,ht.V6=440,ht.V5=450,ht.V4=460,ht.V3=470,ht.V2=480,ht.V1=490,ht.V0=500,ht.R3MIX=1e3,ht.STANDARD=1001,ht.EXTREME=1002,ht.INSANE=1003,ht.STANDARD_FAST=1004,ht.EXTREME_FAST=1005,ht.MEDIUM=1006,ht.MEDIUM_FAST=1007;var n=16384+a;ht.LAME_MAXMP3BUFFER=n;var m,s,R,E,N,L=new Ls,k,f,x;this.enc=new it,this.setModules=function(c,p,K,J,ce,ue,me,fe,we){m=c,s=p,R=K,E=J,N=ce,k=ue,f=fe,x=we,this.enc.setModules(s,L,E,k)};function y(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=qa(it.SBMAX_l),this.bo_s_weight=qa(it.SBMAX_s)}function o(){this.lowerlimit=0}function S(c,p){this.lowpass=p}var j=4294479419;function I(c){var p;return c.class_id=j,p=c.internal_flags=new jo,c.mode=e.NOT_SET,c.original=1,c.in_samplerate=44100,c.num_channels=2,c.num_samples=-1,c.bWriteVbrTag=!0,c.quality=-1,c.short_blocks=null,p.subblock_gain=-1,c.lowpassfreq=0,c.highpassfreq=0,c.lowpasswidth=-1,c.highpasswidth=-1,c.VBR=Ke.vbr_off,c.VBR_q=4,c.ATHcurve=-1,c.VBR_mean_bitrate_kbps=128,c.VBR_min_bitrate_kbps=0,c.VBR_max_bitrate_kbps=0,c.VBR_hard_min=0,p.VBR_min_bitrate=1,p.VBR_max_bitrate=13,c.quant_comp=-1,c.quant_comp_short=-1,c.msfix=-1,p.resample_ratio=1,p.OldValue[0]=180,p.OldValue[1]=180,p.CurrentStep[0]=4,p.CurrentStep[1]=4,p.masking_lower=1,p.nsPsy.attackthre=-1,p.nsPsy.attackthre_s=-1,c.scale=-1,c.athaa_type=-1,c.ATHtype=-1,c.athaa_loudapprox=-1,c.athaa_sensitivity=0,c.useTemporal=null,c.interChRatio=-1,p.mf_samples_to_encode=it.ENCDELAY+it.POSTDELAY,c.encoder_padding=0,p.mf_size=it.ENCDELAY-it.MDCTDELAY,c.findReplayGain=!1,c.decode_on_the_fly=!1,p.decode_on_the_fly=!1,p.findReplayGain=!1,p.findPeakSample=!1,p.RadioGain=0,p.AudiophileGain=0,p.noclipGainChange=0,p.noclipScale=-1,c.preset=0,c.write_id3tag_automatic=!0,0}this.lame_init=function(){var c=new H2;return I(c),c.lame_allocated_gfp=1,c};function v(c){return c>1?0:c<=0?1:Math.cos(Math.PI/2*c)}this.nearestBitrateFullIndex=function(c){var p=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],K=0,J=0,ce=0,ue=0;ue=p[16],ce=16,J=p[16],K=16;for(var me=0;me<16;me++)if(Math.max(c,p[me+1])!=c){ue=p[me+1],ce=me+1,J=p[me],K=me;break}return ue-c>c-J?K:ce};function g(c,p){var K=44100;return p>=48e3?K=48e3:p>=44100?K=44100:p>=32e3?K=32e3:p>=24e3?K=24e3:p>=22050?K=22050:p>=16e3?K=16e3:p>=12e3?K=12e3:p>=11025?K=11025:p>=8e3&&(K=8e3),c==-1?K:(c<=15960&&(K=44100),c<=15250&&(K=32e3),c<=11220&&(K=24e3),c<=9970&&(K=22050),c<=7230&&(K=16e3),c<=5420&&(K=12e3),c<=4510&&(K=11025),c<=3970&&(K=8e3),p<K?p>44100?48e3:p>32e3?44100:p>24e3?32e3:p>22050?24e3:p>16e3?22050:p>12e3?16e3:p>11025?12e3:p>8e3?11025:8e3:K)}function O(c,p){switch(c){case 44100:return p.version=1,0;case 48e3:return p.version=1,1;case 32e3:return p.version=1,2;case 22050:return p.version=0,0;case 24e3:return p.version=0,1;case 16e3:return p.version=0,2;case 11025:return p.version=0,0;case 12e3:return p.version=0,1;case 8e3:return p.version=0,2;default:return p.version=0,-1}}function F(c,p,K){K<16e3&&(p=2);for(var J=na.bitrate_table[p][1],ce=2;ce<=14;ce++)na.bitrate_table[p][ce]>0&&Math.abs(na.bitrate_table[p][ce]-c)<Math.abs(J-c)&&(J=na.bitrate_table[p][ce]);return J}function T(c,p,K){K<16e3&&(p=2);for(var J=0;J<=14;J++)if(na.bitrate_table[p][J]>0&&na.bitrate_table[p][J]==c)return J;return-1}function l(c,p){var K=[new S(8,2e3),new S(16,3700),new S(24,3900),new S(32,5500),new S(40,7e3),new S(48,7500),new S(56,1e4),new S(64,11e3),new S(80,13500),new S(96,15100),new S(112,15600),new S(128,17e3),new S(160,17500),new S(192,18600),new S(224,19400),new S(256,19700),new S(320,20500)],J=t.nearestBitrateFullIndex(p);c.lowerlimit=K[J].lowpass}function B(c){var p=c.internal_flags,K=32,J=-1;if(p.lowpass1>0){for(var ce=999,ue=0;ue<=31;ue++){var me=ue/31;me>=p.lowpass2&&(K=Math.min(K,ue)),p.lowpass1<me&&me<p.lowpass2&&(ce=Math.min(ce,ue))}ce==999?p.lowpass1=(K-.75)/31:p.lowpass1=(ce-.75)/31,p.lowpass2=K/31}if(p.highpass2>0&&p.highpass2<.9*(.75/31)&&(p.highpass1=0,p.highpass2=0,V2.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),p.highpass2>0){for(var fe=-1,ue=0;ue<=31;ue++){var me=ue/31;me<=p.highpass1&&(J=Math.max(J,ue)),p.highpass1<me&&me<p.highpass2&&(fe=Math.max(fe,ue))}p.highpass1=J/31,fe==-1?p.highpass2=(J+.75)/31:p.highpass2=(fe+.75)/31}for(var ue=0;ue<32;ue++){var we,ve,me=ue/31;p.highpass2>p.highpass1?we=v((p.highpass2-me)/(p.highpass2-p.highpass1+1e-20)):we=1,p.lowpass2>p.lowpass1?ve=v((me-p.lowpass1)/(p.lowpass2-p.lowpass1+1e-20)):ve=1,p.amp_filter[ue]=we*ve}}function w(c){var p=c.internal_flags;switch(c.quality){default:case 9:p.psymodel=0,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 8:c.quality=7;case 7:p.psymodel=1,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 6:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 5:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 4:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 3:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 2:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 1:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 0:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break}}function d(c){var p=c.internal_flags;c.frameNum=0,c.write_id3tag_automatic&&f.id3tag_write_v2(c),p.bitrate_stereoMode_Hist=r0([16,4+1]),p.bitrate_blockType_Hist=r0([16,4+1+1]),p.PeakSample=0,c.bWriteVbrTag&&k.InitVbrTag(c)}this.lame_init_params=function(c){var p=c.internal_flags;if(p.Class_ID=0,p.ATH==null&&(p.ATH=new P2),p.PSY==null&&(p.PSY=new y),p.rgdata==null&&(p.rgdata=new F2),p.channels_in=c.num_channels,p.channels_in==1&&(c.mode=e.MONO),p.channels_out=c.mode==e.MONO?1:2,p.mode_ext=it.MPG_MD_MS_LR,c.mode==e.MONO&&(c.force_ms=!1),c.VBR==Ke.vbr_off&&c.VBR_mean_bitrate_kbps!=128&&c.brate==0&&(c.brate=c.VBR_mean_bitrate_kbps),c.VBR==Ke.vbr_off||c.VBR==Ke.vbr_mtrh||c.VBR==Ke.vbr_mt||(c.free_format=!1),c.VBR==Ke.vbr_off&&c.brate==0&&Xa.EQ(c.compression_ratio,0)&&(c.compression_ratio=11.025),c.VBR==Ke.vbr_off&&c.compression_ratio>0&&(c.out_samplerate==0&&(c.out_samplerate=map2MP3Frequency(int(.97*c.in_samplerate))),c.brate=0|c.out_samplerate*16*p.channels_out/(1e3*c.compression_ratio),p.samplerate_index=O(c.out_samplerate,c),c.free_format||(c.brate=F(c.brate,c.version,c.out_samplerate))),c.out_samplerate!=0&&(c.out_samplerate<16e3?(c.VBR_mean_bitrate_kbps=Math.max(c.VBR_mean_bitrate_kbps,8),c.VBR_mean_bitrate_kbps=Math.min(c.VBR_mean_bitrate_kbps,64)):c.out_samplerate<32e3?(c.VBR_mean_bitrate_kbps=Math.max(c.VBR_mean_bitrate_kbps,8),c.VBR_mean_bitrate_kbps=Math.min(c.VBR_mean_bitrate_kbps,160)):(c.VBR_mean_bitrate_kbps=Math.max(c.VBR_mean_bitrate_kbps,32),c.VBR_mean_bitrate_kbps=Math.min(c.VBR_mean_bitrate_kbps,320))),c.lowpassfreq==0){var K=16e3;switch(c.VBR){case Ke.vbr_off:{var J=new o;l(J,c.brate),K=J.lowerlimit;break}case Ke.vbr_abr:{var J=new o;l(J,c.VBR_mean_bitrate_kbps),K=J.lowerlimit;break}case Ke.vbr_rh:{var ce=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=c.VBR_q&&c.VBR_q<=9){var ue=ce[c.VBR_q],me=ce[c.VBR_q+1],fe=c.VBR_q_frac;K=linear_int(ue,me,fe)}else K=19500;break}default:{var ce=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=c.VBR_q&&c.VBR_q<=9){var ue=ce[c.VBR_q],me=ce[c.VBR_q+1],fe=c.VBR_q_frac;K=linear_int(ue,me,fe)}else K=19500}}c.mode==e.MONO&&(c.VBR==Ke.vbr_off||c.VBR==Ke.vbr_abr)&&(K*=1.5),c.lowpassfreq=K|0}if(c.out_samplerate==0&&(2*c.lowpassfreq>c.in_samplerate&&(c.lowpassfreq=c.in_samplerate/2),c.out_samplerate=g(c.lowpassfreq|0,c.in_samplerate)),c.lowpassfreq=Math.min(20500,c.lowpassfreq),c.lowpassfreq=Math.min(c.out_samplerate/2,c.lowpassfreq),c.VBR==Ke.vbr_off&&(c.compression_ratio=c.out_samplerate*16*p.channels_out/(1e3*c.brate)),c.VBR==Ke.vbr_abr&&(c.compression_ratio=c.out_samplerate*16*p.channels_out/(1e3*c.VBR_mean_bitrate_kbps)),c.bWriteVbrTag||(c.findReplayGain=!1,c.decode_on_the_fly=!1,p.findPeakSample=!1),p.findReplayGain=c.findReplayGain,p.decode_on_the_fly=c.decode_on_the_fly,p.decode_on_the_fly&&(p.findPeakSample=!0),p.findReplayGain&&m.InitGainAnalysis(p.rgdata,c.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return c.internal_flags=null,-6;switch(p.decode_on_the_fly&&!c.decode_only&&(p.hip!=null&&x.hip_decode_exit(p.hip),p.hip=x.hip_decode_init()),p.mode_gr=c.out_samplerate<=24e3?1:2,c.framesize=576*p.mode_gr,c.encoder_delay=it.ENCDELAY,p.resample_ratio=c.in_samplerate/c.out_samplerate,c.VBR){case Ke.vbr_mt:case Ke.vbr_rh:case Ke.vbr_mtrh:{var we=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];c.compression_ratio=we[c.VBR_q]}break;case Ke.vbr_abr:c.compression_ratio=c.out_samplerate*16*p.channels_out/(1e3*c.VBR_mean_bitrate_kbps);break;default:c.compression_ratio=c.out_samplerate*16*p.channels_out/(1e3*c.brate);break}if(c.mode==e.NOT_SET&&(c.mode=e.JOINT_STEREO),c.highpassfreq>0?(p.highpass1=2*c.highpassfreq,c.highpasswidth>=0?p.highpass2=2*(c.highpassfreq+c.highpasswidth):p.highpass2=(1+0)*2*c.highpassfreq,p.highpass1/=c.out_samplerate,p.highpass2/=c.out_samplerate):(p.highpass1=0,p.highpass2=0),c.lowpassfreq>0?(p.lowpass2=2*c.lowpassfreq,c.lowpasswidth>=0?(p.lowpass1=2*(c.lowpassfreq-c.lowpasswidth),p.lowpass1<0&&(p.lowpass1=0)):p.lowpass1=(1-0)*2*c.lowpassfreq,p.lowpass1/=c.out_samplerate,p.lowpass2/=c.out_samplerate):(p.lowpass1=0,p.lowpass2=0),B(c),p.samplerate_index=O(c.out_samplerate,c),p.samplerate_index<0)return c.internal_flags=null,-1;if(c.VBR==Ke.vbr_off){if(c.free_format)p.bitrate_index=0;else if(c.brate=F(c.brate,c.version,c.out_samplerate),p.bitrate_index=T(c.brate,c.version,c.out_samplerate),p.bitrate_index<=0)return c.internal_flags=null,-1}else p.bitrate_index=1;c.analysis&&(c.bWriteVbrTag=!1),p.pinfo!=null&&(c.bWriteVbrTag=!1),s.init_bit_stream_w(p);for(var ve=p.samplerate_index+3*c.version+6*(c.out_samplerate<16e3?1:0),de=0;de<it.SBMAX_l+1;de++)p.scalefac_band.l[de]=E.sfBandIndex[ve].l[de];for(var de=0;de<it.PSFB21+1;de++){var Ae=(p.scalefac_band.l[22]-p.scalefac_band.l[21])/it.PSFB21,Fe=p.scalefac_band.l[21]+de*Ae;p.scalefac_band.psfb21[de]=Fe}p.scalefac_band.psfb21[it.PSFB21]=576;for(var de=0;de<it.SBMAX_s+1;de++)p.scalefac_band.s[de]=E.sfBandIndex[ve].s[de];for(var de=0;de<it.PSFB12+1;de++){var Ae=(p.scalefac_band.s[13]-p.scalefac_band.s[12])/it.PSFB12,Fe=p.scalefac_band.s[12]+de*Ae;p.scalefac_band.psfb12[de]=Fe}p.scalefac_band.psfb12[it.PSFB12]=192,c.version==1?p.sideinfo_len=p.channels_out==1?4+17:4+32:p.sideinfo_len=p.channels_out==1?4+9:4+17,c.error_protection&&(p.sideinfo_len+=2),d(c),p.Class_ID=j;{var Le;for(Le=0;Le<19;Le++)p.nsPsy.pefirbuf[Le]=700*p.mode_gr*p.channels_out;c.ATHtype==-1&&(c.ATHtype=4)}switch(wa(c.VBR_q<=9),wa(c.VBR_q>=0),c.VBR){case Ke.vbr_mt:c.VBR=Ke.vbr_mtrh;case Ke.vbr_mtrh:{c.useTemporal==null&&(c.useTemporal=!1),R.apply_preset(c,500-c.VBR_q*10,0),c.quality<0&&(c.quality=LAME_DEFAULT_QUALITY),c.quality<5&&(c.quality=0),c.quality>5&&(c.quality=5),p.PSY.mask_adjust=c.maskingadjust,p.PSY.mask_adjust_short=c.maskingadjust_short,c.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=c.out_samplerate>44e3,p.iteration_loop=new VBRNewIterationLoop(N);break}case Ke.vbr_rh:{R.apply_preset(c,500-c.VBR_q*10,0),p.PSY.mask_adjust=c.maskingadjust,p.PSY.mask_adjust_short=c.maskingadjust_short,c.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=c.out_samplerate>44e3,c.quality>6&&(c.quality=6),c.quality<0&&(c.quality=LAME_DEFAULT_QUALITY),p.iteration_loop=new VBROldIterationLoop(N);break}default:{var je;p.sfb21_extra=!1,c.quality<0&&(c.quality=LAME_DEFAULT_QUALITY),je=c.VBR,je==Ke.vbr_off&&(c.VBR_mean_bitrate_kbps=c.brate),R.apply_preset(c,c.VBR_mean_bitrate_kbps,0),c.VBR=je,p.PSY.mask_adjust=c.maskingadjust,p.PSY.mask_adjust_short=c.maskingadjust_short,je==Ke.vbr_off?p.iteration_loop=new D2(N):p.iteration_loop=new ABRIterationLoop(N);break}}if(wa(c.scale>=0),c.VBR!=Ke.vbr_off){if(p.VBR_min_bitrate=1,p.VBR_max_bitrate=14,c.out_samplerate<16e3&&(p.VBR_max_bitrate=8),c.VBR_min_bitrate_kbps!=0&&(c.VBR_min_bitrate_kbps=F(c.VBR_min_bitrate_kbps,c.version,c.out_samplerate),p.VBR_min_bitrate=T(c.VBR_min_bitrate_kbps,c.version,c.out_samplerate),p.VBR_min_bitrate<0)||c.VBR_max_bitrate_kbps!=0&&(c.VBR_max_bitrate_kbps=F(c.VBR_max_bitrate_kbps,c.version,c.out_samplerate),p.VBR_max_bitrate=T(c.VBR_max_bitrate_kbps,c.version,c.out_samplerate),p.VBR_max_bitrate<0))return-1;c.VBR_min_bitrate_kbps=na.bitrate_table[c.version][p.VBR_min_bitrate],c.VBR_max_bitrate_kbps=na.bitrate_table[c.version][p.VBR_max_bitrate],c.VBR_mean_bitrate_kbps=Math.min(na.bitrate_table[c.version][p.VBR_max_bitrate],c.VBR_mean_bitrate_kbps),c.VBR_mean_bitrate_kbps=Math.max(na.bitrate_table[c.version][p.VBR_min_bitrate],c.VBR_mean_bitrate_kbps)}return c.tune&&(p.PSY.mask_adjust+=c.tune_value_a,p.PSY.mask_adjust_short+=c.tune_value_a),w(c),wa(c.scale>=0),c.athaa_type<0?p.ATH.useAdjust=3:p.ATH.useAdjust=c.athaa_type,p.ATH.aaSensitivityP=Math.pow(10,c.athaa_sensitivity/-10),c.short_blocks==null&&(c.short_blocks=Is.short_block_allowed),c.short_blocks==Is.short_block_allowed&&(c.mode==e.JOINT_STEREO||c.mode==e.STEREO)&&(c.short_blocks=Is.short_block_coupled),c.quant_comp<0&&(c.quant_comp=1),c.quant_comp_short<0&&(c.quant_comp_short=0),c.msfix<0&&(c.msfix=0),c.exp_nspsytune=c.exp_nspsytune|1,c.internal_flags.nsPsy.attackthre<0&&(c.internal_flags.nsPsy.attackthre=Ls.NSATTACKTHRE),c.internal_flags.nsPsy.attackthre_s<0&&(c.internal_flags.nsPsy.attackthre_s=Ls.NSATTACKTHRE_S),wa(c.scale>=0),c.scale<0&&(c.scale=1),c.ATHtype<0&&(c.ATHtype=4),c.ATHcurve<0&&(c.ATHcurve=4),c.athaa_loudapprox<0&&(c.athaa_loudapprox=2),c.interChRatio<0&&(c.interChRatio=0),c.useTemporal==null&&(c.useTemporal=!0),p.slot_lag=p.frac_SpF=0,c.VBR==Ke.vbr_off&&(p.slot_lag=p.frac_SpF=(c.version+1)*72e3*c.brate%c.out_samplerate|0),E.iteration_init(c),L.psymodel_init(c),wa(c.scale>=0),0};function h(c,p){(c.in_buffer_0==null||c.in_buffer_nsamples<p)&&(c.in_buffer_0=qa(p),c.in_buffer_1=qa(p),c.in_buffer_nsamples=p)}this.lame_encode_flush=function(c,p,K,J){var ce=c.internal_flags,ue=j2([2,1152]),me=0,fe,we,ve,de,Ae=ce.mf_samples_to_encode-it.POSTDELAY,Fe=b(c);if(ce.mf_samples_to_encode<1)return 0;for(fe=0,c.in_samplerate!=c.out_samplerate&&(Ae+=16*c.out_samplerate/c.in_samplerate),ve=c.framesize-Ae%c.framesize,ve<576&&(ve+=c.framesize),c.encoder_padding=ve,de=(Ae+ve)/c.framesize;de>0&&me>=0;){var Le=Fe-ce.mf_size,je=c.frameNum;Le*=c.in_samplerate,Le/=c.out_samplerate,Le>1152&&(Le=1152),Le<1&&(Le=1),we=J-fe,J==0&&(we=0),me=this.lame_encode_buffer(c,ue[0],ue[1],Le,p,K,we),K+=me,fe+=me,de-=je!=c.frameNum?1:0}if(ce.mf_samples_to_encode=0,me<0||(we=J-fe,J==0&&(we=0),s.flush_bitstream(c),me=s.copy_buffer(ce,p,K,we,1),me<0))return me;if(K+=me,fe+=me,we=J-fe,J==0&&(we=0),c.write_id3tag_automatic){if(f.id3tag_write_v1(c),me=s.copy_buffer(ce,p,K,we,0),me<0)return me;fe+=me}return fe},this.lame_encode_buffer=function(c,p,K,J,ce,ue,me){var fe=c.internal_flags,we=[null,null];if(fe.Class_ID!=j)return-3;if(J==0)return 0;h(fe,J),we[0]=fe.in_buffer_0,we[1]=fe.in_buffer_1;for(var ve=0;ve<J;ve++)we[0][ve]=p[ve],fe.channels_in>1&&(we[1][ve]=K[ve]);return i(c,we[0],we[1],J,ce,ue,me)};function b(c){var p=it.BLKSIZE+c.framesize-it.FFTOFFSET;return p=Math.max(p,512+c.framesize-32),p}function i(c,p,K,J,ce,ue,me){var fe=c.internal_flags,we=0,ve,de,Ae,Fe,Le,je=[null,null],De=[null,null];if(fe.Class_ID!=j)return-3;if(J==0)return 0;if(Le=s.copy_buffer(fe,ce,ue,me,0),Le<0)return Le;if(ue+=Le,we+=Le,De[0]=p,De[1]=K,Xa.NEQ(c.scale,0)&&Xa.NEQ(c.scale,1))for(de=0;de<J;++de)De[0][de]*=c.scale,fe.channels_out==2&&(De[1][de]*=c.scale);if(Xa.NEQ(c.scale_left,0)&&Xa.NEQ(c.scale_left,1))for(de=0;de<J;++de)De[0][de]*=c.scale_left;if(Xa.NEQ(c.scale_right,0)&&Xa.NEQ(c.scale_right,1))for(de=0;de<J;++de)De[1][de]*=c.scale_right;if(c.num_channels==2&&fe.channels_out==1)for(de=0;de<J;++de)De[0][de]=.5*(De[0][de]+De[1][de]),De[1][de]=0;Fe=b(c),je[0]=fe.mfbuf[0],je[1]=fe.mfbuf[1];for(var Ue=0;J>0;){var at=[null,null],yt=0,ut=0;at[0]=De[0],at[1]=De[1];var ft=new _;if(Q(c,je,at,Ue,J,ft),yt=ft.n_in,ut=ft.n_out,fe.findReplayGain&&!fe.decode_on_the_fly&&m.AnalyzeSamples(fe.rgdata,je[0],fe.mf_size,je[1],fe.mf_size,ut,fe.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(J-=yt,Ue+=yt,fe.channels_out==2,fe.mf_size+=ut,wa(fe.mf_size<=jo.MFSIZE),fe.mf_samples_to_encode<1&&(fe.mf_samples_to_encode=it.ENCDELAY+it.POSTDELAY),fe.mf_samples_to_encode+=ut,fe.mf_size>=Fe){var pt=me-we;if(me==0&&(pt=0),ve=u(c,je[0],je[1],ce,ue,pt),ve<0)return ve;for(ue+=ve,we+=ve,fe.mf_size-=c.framesize,fe.mf_samples_to_encode-=c.framesize,Ae=0;Ae<fe.channels_out;Ae++)for(de=0;de<fe.mf_size;de++)je[Ae][de]=je[Ae][de+c.framesize]}}return we}function u(c,p,K,J,ce,ue){var me=t.enc.lame_encode_mp3_frame(c,p,K,J,ce,ue);return c.frameNum++,me}function _(){this.n_in=0,this.n_out=0}function A(){this.num_used=0}function z(c,p){return p!=0?z(p,c%p):c}function H(c,p,K){var J=Math.PI*p;c/=K,c<0&&(c=0),c>1&&(c=1);var ce=c-.5,ue=.42-.5*Math.cos(2*c*Math.PI)+.08*Math.cos(4*c*Math.PI);return Math.abs(ce)<1e-9?J/Math.PI:ue*Math.sin(K*J*ce)/(Math.PI*K*ce)}function U(c,p,K,J,ce,ue,me,fe,we){var ve=c.internal_flags,de,Ae=0,Fe,Le=c.out_samplerate/z(c.out_samplerate,c.in_samplerate);Le>jo.BPC&&(Le=jo.BPC);var je=Math.abs(ve.resample_ratio-Math.floor(.5+ve.resample_ratio))<1e-4?1:0,De=1/ve.resample_ratio;De>1&&(De=1);var Ue=31;Ue%2==0&&--Ue,Ue+=je;var at=Ue+1;if(ve.fill_buffer_resample_init==0){for(ve.inbuf_old[0]=qa(at),ve.inbuf_old[1]=qa(at),de=0;de<=2*Le;++de)ve.blackfilt[de]=qa(at);for(ve.itime[0]=0,ve.itime[1]=0,Ae=0;Ae<=2*Le;Ae++){var yt=0,ut=(Ae-Le)/(2*Le);for(de=0;de<=Ue;de++)yt+=ve.blackfilt[Ae][de]=H(de-ut,De,Ue);for(de=0;de<=Ue;de++)ve.blackfilt[Ae][de]/=yt}ve.fill_buffer_resample_init=1}var ft=ve.inbuf_old[we];for(Fe=0;Fe<J;Fe++){var pt,Gt;if(pt=Fe*ve.resample_ratio,Ae=0|Math.floor(pt-ve.itime[we]),Ue+Ae-Ue/2>=me)break;var ut=pt-ve.itime[we]-(Ae+.5*(Ue%2));Gt=0|Math.floor(ut*2*Le+Le+.5);var At=0;for(de=0;de<=Ue;++de){var vt=0|de+Ae-Ue/2,xt;xt=vt<0?ft[at+vt]:ce[ue+vt],At+=xt*ve.blackfilt[Gt][de]}p[K+Fe]=At}if(fe.num_used=Math.min(me,Ue+Ae-Ue/2),ve.itime[we]+=fe.num_used-Fe*ve.resample_ratio,fe.num_used>=at)for(de=0;de<at;de++)ft[de]=ce[ue+fe.num_used+de-at];else{var Ft=at-fe.num_used;for(de=0;de<Ft;++de)ft[de]=ft[de+fe.num_used];for(Ae=0;de<at;++de,++Ae)ft[de]=ce[ue+Ae];wa(Ae==fe.num_used)}return Fe}function Q(c,p,K,J,ce,ue){var me=c.internal_flags;if(me.resample_ratio<.9999||me.resample_ratio>1.0001)for(var fe=0;fe<me.channels_out;fe++){var we=new A;ue.n_out=U(c,p[fe],me.mf_size,c.framesize,K[fe],J,ce,we,fe),ue.n_in=we.num_used}else{ue.n_out=Math.min(c.framesize,ce),ue.n_in=ue.n_out;for(var ve=0;ve<ue.n_out;++ve)p[0][me.mf_size+ve]=K[0][J+ve],me.channels_out==2&&(p[1][me.mf_size+ve]=K[1][J+ve])}}}var Vs=ht,U2=We,ia=U2.VbrMode;function z2(){var e=Vs;function t(k,f,x,y,o,S,j,I,v,g,O,F,T,l,B){this.vbr_q=k,this.quant_comp=f,this.quant_comp_s=x,this.expY=y,this.st_lrm=o,this.st_s=S,this.masking_adj=j,this.masking_adj_short=I,this.ath_lower=v,this.ath_curve=g,this.ath_sensitivity=O,this.interch=F,this.safejoint=T,this.sfb21mod=l,this.msfix=B}function a(k,f,x,y,o,S,j,I,v,g,O,F,T,l){this.quant_comp=f,this.quant_comp_s=x,this.safejoint=y,this.nsmsfix=o,this.st_lrm=S,this.st_s=j,this.nsbass=I,this.scale=v,this.masking_adj=g,this.ath_lower=O,this.ath_curve=F,this.interch=T,this.sfscale=l}var n;this.setModules=function(k){n=k};var m=[new t(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new t(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new t(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new t(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new t(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new t(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new t(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new t(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new t(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new t(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new t(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],s=[new t(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new t(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new t(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new t(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new t(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new t(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new t(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new t(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new t(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new t(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new t(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function R(k,f,x){var y=k.VBR==ia.vbr_rh?m:s,o=k.VBR_q_frac,S=y[f],j=y[f+1],I=S;S.st_lrm=S.st_lrm+o*(j.st_lrm-S.st_lrm),S.st_s=S.st_s+o*(j.st_s-S.st_s),S.masking_adj=S.masking_adj+o*(j.masking_adj-S.masking_adj),S.masking_adj_short=S.masking_adj_short+o*(j.masking_adj_short-S.masking_adj_short),S.ath_lower=S.ath_lower+o*(j.ath_lower-S.ath_lower),S.ath_curve=S.ath_curve+o*(j.ath_curve-S.ath_curve),S.ath_sensitivity=S.ath_sensitivity+o*(j.ath_sensitivity-S.ath_sensitivity),S.interch=S.interch+o*(j.interch-S.interch),S.msfix=S.msfix+o*(j.msfix-S.msfix),L(k,I.vbr_q),x!=0?k.quant_comp=I.quant_comp:Math.abs(k.quant_comp- -1)>0||(k.quant_comp=I.quant_comp),x!=0?k.quant_comp_short=I.quant_comp_s:Math.abs(k.quant_comp_short- -1)>0||(k.quant_comp_short=I.quant_comp_s),I.expY!=0&&(k.experimentalY=I.expY!=0),x!=0?k.internal_flags.nsPsy.attackthre=I.st_lrm:Math.abs(k.internal_flags.nsPsy.attackthre- -1)>0||(k.internal_flags.nsPsy.attackthre=I.st_lrm),x!=0?k.internal_flags.nsPsy.attackthre_s=I.st_s:Math.abs(k.internal_flags.nsPsy.attackthre_s- -1)>0||(k.internal_flags.nsPsy.attackthre_s=I.st_s),x!=0?k.maskingadjust=I.masking_adj:Math.abs(k.maskingadjust-0)>0||(k.maskingadjust=I.masking_adj),x!=0?k.maskingadjust_short=I.masking_adj_short:Math.abs(k.maskingadjust_short-0)>0||(k.maskingadjust_short=I.masking_adj_short),x!=0?k.ATHlower=-I.ath_lower/10:Math.abs(-k.ATHlower*10-0)>0||(k.ATHlower=-I.ath_lower/10),x!=0?k.ATHcurve=I.ath_curve:Math.abs(k.ATHcurve- -1)>0||(k.ATHcurve=I.ath_curve),x!=0?k.athaa_sensitivity=I.ath_sensitivity:Math.abs(k.athaa_sensitivity- -1)>0||(k.athaa_sensitivity=I.ath_sensitivity),I.interch>0&&(x!=0?k.interChRatio=I.interch:Math.abs(k.interChRatio- -1)>0||(k.interChRatio=I.interch)),I.safejoint>0&&(k.exp_nspsytune=k.exp_nspsytune|I.safejoint),I.sfb21mod>0&&(k.exp_nspsytune=k.exp_nspsytune|I.sfb21mod<<20),x!=0?k.msfix=I.msfix:Math.abs(k.msfix- -1)>0||(k.msfix=I.msfix),x==0&&(k.VBR_q=f,k.VBR_q_frac=o)}var E=[new a(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new a(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new a(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new a(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new a(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new a(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new a(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new a(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new a(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new a(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new a(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new a(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new a(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new a(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new a(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new a(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new a(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function N(k,f,x){var y=f,o=n.nearestBitrateFullIndex(f);if(k.VBR=ia.vbr_abr,k.VBR_mean_bitrate_kbps=y,k.VBR_mean_bitrate_kbps=Math.min(k.VBR_mean_bitrate_kbps,320),k.VBR_mean_bitrate_kbps=Math.max(k.VBR_mean_bitrate_kbps,8),k.brate=k.VBR_mean_bitrate_kbps,k.VBR_mean_bitrate_kbps>320&&(k.disable_reservoir=!0),E[o].safejoint>0&&(k.exp_nspsytune=k.exp_nspsytune|2),E[o].sfscale>0&&(k.internal_flags.noise_shaping=2),Math.abs(E[o].nsbass)>0){var S=int(E[o].nsbass*4);S<0&&(S+=64),k.exp_nspsytune=k.exp_nspsytune|S<<2}return x!=0?k.quant_comp=E[o].quant_comp:Math.abs(k.quant_comp- -1)>0||(k.quant_comp=E[o].quant_comp),x!=0?k.quant_comp_short=E[o].quant_comp_s:Math.abs(k.quant_comp_short- -1)>0||(k.quant_comp_short=E[o].quant_comp_s),x!=0?k.msfix=E[o].nsmsfix:Math.abs(k.msfix- -1)>0||(k.msfix=E[o].nsmsfix),x!=0?k.internal_flags.nsPsy.attackthre=E[o].st_lrm:Math.abs(k.internal_flags.nsPsy.attackthre- -1)>0||(k.internal_flags.nsPsy.attackthre=E[o].st_lrm),x!=0?k.internal_flags.nsPsy.attackthre_s=E[o].st_s:Math.abs(k.internal_flags.nsPsy.attackthre_s- -1)>0||(k.internal_flags.nsPsy.attackthre_s=E[o].st_s),x!=0?k.scale=E[o].scale:Math.abs(k.scale- -1)>0||(k.scale=E[o].scale),x!=0?k.maskingadjust=E[o].masking_adj:Math.abs(k.maskingadjust-0)>0||(k.maskingadjust=E[o].masking_adj),E[o].masking_adj>0?x!=0?k.maskingadjust_short=E[o].masking_adj*.9:Math.abs(k.maskingadjust_short-0)>0||(k.maskingadjust_short=E[o].masking_adj*.9):x!=0?k.maskingadjust_short=E[o].masking_adj*1.1:Math.abs(k.maskingadjust_short-0)>0||(k.maskingadjust_short=E[o].masking_adj*1.1),x!=0?k.ATHlower=-E[o].ath_lower/10:Math.abs(-k.ATHlower*10-0)>0||(k.ATHlower=-E[o].ath_lower/10),x!=0?k.ATHcurve=E[o].ath_curve:Math.abs(k.ATHcurve- -1)>0||(k.ATHcurve=E[o].ath_curve),x!=0?k.interChRatio=E[o].interch:Math.abs(k.interChRatio- -1)>0||(k.interChRatio=E[o].interch),f}this.apply_preset=function(k,f,x){switch(f){case e.R3MIX:{f=e.V3,k.VBR=ia.vbr_mtrh;break}case e.MEDIUM:{f=e.V4,k.VBR=ia.vbr_rh;break}case e.MEDIUM_FAST:{f=e.V4,k.VBR=ia.vbr_mtrh;break}case e.STANDARD:{f=e.V2,k.VBR=ia.vbr_rh;break}case e.STANDARD_FAST:{f=e.V2,k.VBR=ia.vbr_mtrh;break}case e.EXTREME:{f=e.V0,k.VBR=ia.vbr_rh;break}case e.EXTREME_FAST:{f=e.V0,k.VBR=ia.vbr_mtrh;break}case e.INSANE:return f=320,k.preset=f,N(k,f,x),k.VBR=ia.vbr_off,f}switch(k.preset=f,f){case e.V9:return R(k,9,x),f;case e.V8:return R(k,8,x),f;case e.V7:return R(k,7,x),f;case e.V6:return R(k,6,x),f;case e.V5:return R(k,5,x),f;case e.V4:return R(k,4,x),f;case e.V3:return R(k,3,x),f;case e.V2:return R(k,2,x),f;case e.V1:return R(k,1,x),f;case e.V0:return R(k,0,x),f}return 8<=f&&f<=320?N(k,f,x):(k.preset=0,f)};function L(k,f){var x=0;return 0>f&&(x=-1,f=0),9<f&&(x=-1,f=9),k.VBR_q=f,k.VBR_q_frac=0,x}}var q2=z2;function X2(){this.setModules=function(e,t){}}var Y2=X2;function G2(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var K2=G2,o0=We,s0=o0.new_float,Z2=o0.new_int;function W2(){this.global_gain=0,this.sfb_count1=0,this.step=Z2(39),this.noise=s0(39),this.noise_log=s0(39)}var Q2=W2,dr=We,Sa=dr.System,n0=dr.VbrMode,js=dr.Util,mr=dr.Arrays,qr=dr.new_float,Xr=dr.assert,$2=Y2,Hs=K2,J2=Q2,Pe=Rt,i0=ks,l0=Ro;function eh(){var e;this.rv=null;var t;this.qupvt=null;var a,n=new $2,m;this.setModules=function(I,v,g,O){e=I,t=v,this.rv=v,a=g,this.qupvt=g,m=O,n.setModules(a,m)},this.ms_convert=function(I,v){for(var g=0;g<576;++g){var O=I.tt[v][0].xr[g],F=I.tt[v][1].xr[g];I.tt[v][0].xr[g]=(O+F)*(js.SQRT2*.5),I.tt[v][1].xr[g]=(O-F)*(js.SQRT2*.5)}};function s(I,v,g,O){O=0;for(var F=0;F<=g;++F){var T=Math.abs(I.xr[F]);O+=T,v[F]=Math.sqrt(T*Math.sqrt(T)),v[F]>I.xrpow_max&&(I.xrpow_max=v[F])}return O}this.init_xrpow=function(I,v,g){var O=0,F=0|v.max_nonzero_coeff;if(v.xrpow_max=0,mr.fill(g,F,576,0),O=s(v,g,F,O),O>1e-20){var T=0;(I.substep_shaping&2)!=0&&(T=1);for(var l=0;l<v.psymax;l++)I.pseudohalf[l]=T;return!0}return mr.fill(v.l3_enc,0,576,0),!1};function R(I,v){var g=I.ATH,O=v.xr;if(v.block_type!=Pe.SHORT_TYPE)for(var F=!1,T=Pe.PSFB21-1;T>=0&&!F;T--){var l=I.scalefac_band.psfb21[T],B=I.scalefac_band.psfb21[T+1],w=a.athAdjust(g.adjust,g.psfb21[T],g.floor);I.nsPsy.longfact[21]>1e-12&&(w*=I.nsPsy.longfact[21]);for(var d=B-1;d>=l;d--)if(Math.abs(O[d])<w)O[d]=0;else{F=!0;break}}else for(var h=0;h<3;h++)for(var F=!1,T=Pe.PSFB12-1;T>=0&&!F;T--){var l=I.scalefac_band.s[12]*3+(I.scalefac_band.s[13]-I.scalefac_band.s[12])*h+(I.scalefac_band.psfb12[T]-I.scalefac_band.psfb12[0]),B=l+(I.scalefac_band.psfb12[T+1]-I.scalefac_band.psfb12[T]),b=a.athAdjust(g.adjust,g.psfb12[T],g.floor);I.nsPsy.shortfact[12]>1e-12&&(b*=I.nsPsy.shortfact[12]);for(var d=B-1;d>=l;d--)if(Math.abs(O[d])<b)O[d]=0;else{F=!0;break}}}this.init_outer_loop=function(I,v){v.part2_3_length=0,v.big_values=0,v.count1=0,v.global_gain=210,v.scalefac_compress=0,v.table_select[0]=0,v.table_select[1]=0,v.table_select[2]=0,v.subblock_gain[0]=0,v.subblock_gain[1]=0,v.subblock_gain[2]=0,v.subblock_gain[3]=0,v.region0_count=0,v.region1_count=0,v.preflag=0,v.scalefac_scale=0,v.count1table_select=0,v.part2_length=0,v.sfb_lmax=Pe.SBPSY_l,v.sfb_smin=Pe.SBPSY_s,v.psy_lmax=I.sfb21_extra?Pe.SBMAX_l:Pe.SBPSY_l,v.psymax=v.psy_lmax,v.sfbmax=v.sfb_lmax,v.sfbdivide=11;for(var g=0;g<Pe.SBMAX_l;g++)v.width[g]=I.scalefac_band.l[g+1]-I.scalefac_band.l[g],v.window[g]=3;if(v.block_type==Pe.SHORT_TYPE){var O=qr(576);v.sfb_smin=0,v.sfb_lmax=0,v.mixed_block_flag!=0&&(v.sfb_smin=3,v.sfb_lmax=I.mode_gr*2+4),v.psymax=v.sfb_lmax+3*((I.sfb21_extra?Pe.SBMAX_s:Pe.SBPSY_s)-v.sfb_smin),v.sfbmax=v.sfb_lmax+3*(Pe.SBPSY_s-v.sfb_smin),v.sfbdivide=v.sfbmax-18,v.psy_lmax=v.sfb_lmax;var F=I.scalefac_band.l[v.sfb_lmax];Sa.arraycopy(v.xr,0,O,0,576);for(var g=v.sfb_smin;g<Pe.SBMAX_s;g++)for(var T=I.scalefac_band.s[g],l=I.scalefac_band.s[g+1],B=0;B<3;B++)for(var w=T;w<l;w++)v.xr[F++]=O[3*w+B];for(var d=v.sfb_lmax,g=v.sfb_smin;g<Pe.SBMAX_s;g++)v.width[d]=v.width[d+1]=v.width[d+2]=I.scalefac_band.s[g+1]-I.scalefac_band.s[g],v.window[d]=0,v.window[d+1]=1,v.window[d+2]=2,d+=3}v.count1bits=0,v.sfb_partition_table=a.nr_of_sfb_block[0][0],v.slen[0]=0,v.slen[1]=0,v.slen[2]=0,v.slen[3]=0,v.max_nonzero_coeff=575,mr.fill(v.scalefac,0),R(I,v)};function E(I){this.ordinal=I}E.BINSEARCH_NONE=new E(0),E.BINSEARCH_UP=new E(1),E.BINSEARCH_DOWN=new E(2);function N(I,v,g,O,F){var T,l=I.CurrentStep[O],B=!1,w=I.OldValue[O],d=E.BINSEARCH_NONE;for(v.global_gain=w,g-=v.part2_length;;){var h;if(T=m.count_bits(I,F,v,null),l==1||T==g)break;T>g?(d==E.BINSEARCH_DOWN&&(B=!0),B&&(l/=2),d=E.BINSEARCH_UP,h=l):(d==E.BINSEARCH_UP&&(B=!0),B&&(l/=2),d=E.BINSEARCH_DOWN,h=-l),v.global_gain+=h,v.global_gain<0&&(v.global_gain=0,B=!0),v.global_gain>255&&(v.global_gain=255,B=!0)}for(Xr(v.global_gain>=0),Xr(v.global_gain<256);T>g&&v.global_gain<255;)v.global_gain++,T=m.count_bits(I,F,v,null);return I.CurrentStep[O]=w-v.global_gain>=4?4:2,I.OldValue[O]=v.global_gain,v.part2_3_length=T,T}this.trancate_smallspectrums=function(I,v,g,O){var F=qr(l0.SFBMAX);if(!((I.substep_shaping&4)==0&&v.block_type==Pe.SHORT_TYPE||(I.substep_shaping&128)!=0)){a.calc_noise(v,g,F,new Hs,null);for(var l=0;l<576;l++){var T=0;v.l3_enc[l]!=0&&(T=Math.abs(v.xr[l])),O[l]=T}var l=0,B=8;v.block_type==Pe.SHORT_TYPE&&(B=6);do{var w,d,h,b,i=v.width[B];if(l+=i,!(F[B]>=1)&&(mr.sort(O,l-i,i),!BitStream.EQ(O[l-1],0))){w=(1-F[B])*g[B],d=0,b=0;do{var u;for(h=1;b+h<i&&!BitStream.NEQ(O[b+l-i],O[b+l+h-i]);h++);if(u=O[b+l-i]*O[b+l-i]*h,w<u){b!=0&&(d=O[b+l-i-1]);break}w-=u,b+=h}while(b<i);if(!BitStream.EQ(d,0))do Math.abs(v.xr[l-i])<=d&&(v.l3_enc[l-i]=0);while(--i>0)}}while(++B<v.psymax);v.part2_3_length=m.noquant_count_bits(I,v,null)}};function L(I){for(var v=0;v<I.sfbmax;v++)if(I.scalefac[v]+I.subblock_gain[I.window[v]]==0)return!1;return!0}function k(I){return js.FAST_LOG10(.368+.632*I*I*I)}function f(I,v){for(var g=1e-37,O=0;O<v.psymax;O++)g+=k(I[O]);return Math.max(1e-20,g)}function x(I,v,g,O,F){var T;switch(I){default:case 9:{v.over_count>0?(T=g.over_SSD<=v.over_SSD,g.over_SSD==v.over_SSD&&(T=g.bits<v.bits)):T=g.max_noise<0&&g.max_noise*10+g.bits<=v.max_noise*10+v.bits;break}case 0:T=g.over_count<v.over_count||g.over_count==v.over_count&&g.over_noise<v.over_noise||g.over_count==v.over_count&&BitStream.EQ(g.over_noise,v.over_noise)&&g.tot_noise<v.tot_noise;break;case 8:g.max_noise=f(F,O);case 1:T=g.max_noise<v.max_noise;break;case 2:T=g.tot_noise<v.tot_noise;break;case 3:T=g.tot_noise<v.tot_noise&&g.max_noise<v.max_noise;break;case 4:T=g.max_noise<=0&&v.max_noise>.2||g.max_noise<=0&&v.max_noise<0&&v.max_noise>g.max_noise-.2&&g.tot_noise<v.tot_noise||g.max_noise<=0&&v.max_noise>0&&v.max_noise>g.max_noise-.2&&g.tot_noise<v.tot_noise+v.over_noise||g.max_noise>0&&v.max_noise>-.05&&v.max_noise>g.max_noise-.1&&g.tot_noise+g.over_noise<v.tot_noise+v.over_noise||g.max_noise>0&&v.max_noise>-.1&&v.max_noise>g.max_noise-.15&&g.tot_noise+g.over_noise+g.over_noise<v.tot_noise+v.over_noise+v.over_noise;break;case 5:T=g.over_noise<v.over_noise||BitStream.EQ(g.over_noise,v.over_noise)&&g.tot_noise<v.tot_noise;break;case 6:T=g.over_noise<v.over_noise||BitStream.EQ(g.over_noise,v.over_noise)&&(g.max_noise<v.max_noise||BitStream.EQ(g.max_noise,v.max_noise)&&g.tot_noise<=v.tot_noise);break;case 7:T=g.over_count<v.over_count||g.over_noise<v.over_noise;break}return v.over_count==0&&(T=T&&g.bits<v.bits),T}function y(I,v,g,O,F){var T=I.internal_flags,l;v.scalefac_scale==0?l=1.2968395546510096:l=1.6817928305074292;for(var B=0,w=0;w<v.sfbmax;w++)B<g[w]&&(B=g[w]);var d=T.noise_shaping_amp;switch(d==3&&(F?d=2:d=1),d){case 2:break;case 1:B>1?B=Math.pow(B,.5):B*=.95;break;case 0:default:B>1?B=1:B*=.95;break}for(var h=0,w=0;w<v.sfbmax;w++){var b=v.width[w],i;if(h+=b,!(g[w]<B)){if((T.substep_shaping&2)!=0&&(T.pseudohalf[w]=T.pseudohalf[w]==0?1:0,T.pseudohalf[w]==0&&T.noise_shaping_amp==2))return;for(v.scalefac[w]++,i=-b;i<0;i++)O[h+i]*=l,O[h+i]>v.xrpow_max&&(v.xrpow_max=O[h+i]);if(T.noise_shaping_amp==2)return}}}function o(I,v){for(var g=1.2968395546510096,O=0,F=0;F<I.sfbmax;F++){var T=I.width[F],l=I.scalefac[F];if(I.preflag!=0&&(l+=a.pretab[F]),O+=T,(l&1)!=0){l++;for(var B=-T;B<0;B++)v[O+B]*=g,v[O+B]>I.xrpow_max&&(I.xrpow_max=v[O+B])}I.scalefac[F]=l>>1}I.preflag=0,I.scalefac_scale=1}function S(I,v,g){var O,F=v.scalefac;for(O=0;O<v.sfb_lmax;O++)if(F[O]>=16)return!0;for(var T=0;T<3;T++){var l=0,B=0;for(O=v.sfb_lmax+T;O<v.sfbdivide;O+=3)l<F[O]&&(l=F[O]);for(;O<v.sfbmax;O+=3)B<F[O]&&(B=F[O]);if(!(l<16&&B<8)){if(v.subblock_gain[T]>=7)return!0;v.subblock_gain[T]++;var w=I.scalefac_band.l[v.sfb_lmax];for(O=v.sfb_lmax+T;O<v.sfbmax;O+=3){var d,h=v.width[O],b=F[O];if(b=b-(4>>v.scalefac_scale),b>=0){F[O]=b,w+=h*3;continue}F[O]=0;{var i=210+(b<<v.scalefac_scale+1);d=a.IPOW20(i)}w+=h*(T+1);for(var u=-h;u<0;u++)g[w+u]*=d,g[w+u]>v.xrpow_max&&(v.xrpow_max=g[w+u]);w+=h*(3-T-1)}{var d=a.IPOW20(202);w+=v.width[O]*(T+1);for(var u=-v.width[O];u<0;u++)g[w+u]*=d,g[w+u]>v.xrpow_max&&(v.xrpow_max=g[w+u])}}}return!1}function j(I,v,g,O,F){var T=I.internal_flags;y(I,v,g,O,F);var l=L(v);return l?!1:(T.mode_gr==2?l=m.scale_bitcount(v):l=m.scale_bitcount_lsf(T,v),l?(T.noise_shaping>1&&(mr.fill(T.pseudohalf,0),v.scalefac_scale==0?(o(v,O),l=!1):v.block_type==Pe.SHORT_TYPE&&T.subblock_gain>0&&(l=S(T,v,O)||L(v))),l||(T.mode_gr==2?l=m.scale_bitcount(v):l=m.scale_bitcount_lsf(T,v)),!l):!0)}this.outer_loop=function(I,v,g,O,F,T){var l=I.internal_flags,B=new i0,w=qr(576),d=qr(l0.SFBMAX),h=new Hs,b,i=new J2,u=9999999,_=!1,A=!1,z=0;if(N(l,v,T,F,O),l.noise_shaping==0)return 100;a.calc_noise(v,g,d,h,i),h.bits=v.part2_3_length,B.assign(v);var H=0;for(Sa.arraycopy(O,0,w,0,576);!_;){do{var U=new Hs,Q,c=255;if((l.substep_shaping&2)!=0?Q=20:Q=3,l.sfb21_extra&&(d[B.sfbmax]>1||B.block_type==Pe.SHORT_TYPE&&(d[B.sfbmax+1]>1||d[B.sfbmax+2]>1))||!j(I,B,d,O,A))break;B.scalefac_scale!=0&&(c=254);var p=T-B.part2_length;if(p<=0)break;for(;(B.part2_3_length=m.count_bits(l,O,B,i))>p&&B.global_gain<=c;)B.global_gain++;if(B.global_gain>c)break;if(h.over_count==0){for(;(B.part2_3_length=m.count_bits(l,O,B,i))>u&&B.global_gain<=c;)B.global_gain++;if(B.global_gain>c)break}if(a.calc_noise(B,g,d,U,i),U.bits=B.part2_3_length,v.block_type!=Pe.SHORT_TYPE?b=I.quant_comp:b=I.quant_comp_short,b=x(b,h,U,B,d)?1:0,b!=0)u=v.part2_3_length,h=U,v.assign(B),H=0,Sa.arraycopy(O,0,w,0,576);else if(l.full_outer_loop==0&&(++H>Q&&h.over_count==0||l.noise_shaping_amp==3&&A&&H>30||l.noise_shaping_amp==3&&A&&B.global_gain-z>15))break}while(B.global_gain+B.scalefac_scale<255);l.noise_shaping_amp==3?A?_=!0:(B.assign(v),Sa.arraycopy(w,0,O,0,576),H=0,z=B.global_gain,A=!0):_=!0}return Xr(v.global_gain+v.scalefac_scale<=255),I.VBR==n0.vbr_rh||I.VBR==n0.vbr_mtrh?Sa.arraycopy(w,0,O,0,576):(l.substep_shaping&1)!=0&&trancate_smallspectrums(l,v,g,O),h.over_count},this.iteration_finish_one=function(I,v,g){var O=I.l3_side,F=O.tt[v][g];m.best_scalefac_store(I,v,g,O),I.use_best_huffman==1&&m.best_huffman_divide(I,F),t.ResvAdjust(I,F)},this.VBR_encode_granule=function(I,v,g,O,F,T,l){var B=I.internal_flags,w=new i0,d=qr(576),h=l,b=l+1,i=(l+T)/2,u,_,A=0,z=B.sfb21_extra;Xr(h<=LameInternalFlags.MAX_BITS_PER_CHANNEL),mr.fill(w.l3_enc,0);do i>h-42?B.sfb21_extra=!1:B.sfb21_extra=z,_=outer_loop(I,v,g,O,F,i),_<=0?(A=1,b=v.part2_3_length,w.assign(v),Sa.arraycopy(O,0,d,0,576),l=b-32,u=l-T,i=(l+T)/2):(T=i+32,u=l-T,i=(l+T)/2,A!=0&&(A=2,v.assign(w),Sa.arraycopy(d,0,O,0,576)));while(u>12);B.sfb21_extra=z,A==2&&Sa.arraycopy(w.l3_enc,0,v.l3_enc,0,576),Xr(v.part2_3_length<=h)},this.get_framebits=function(I,v){var g=I.internal_flags;g.bitrate_index=g.VBR_min_bitrate;var O=e.getframebits(I);g.bitrate_index=1,O=e.getframebits(I);for(var F=1;F<=g.VBR_max_bitrate;F++){g.bitrate_index=F;var T=new MeanBits(O);v[F]=t.ResvFrameBegin(I,T),O=T.bits}},this.VBR_old_prepare=function(I,v,g,O,F,T,l,B,w){var d=I.internal_flags,h,b=0,i=1,u=0;d.bitrate_index=d.VBR_max_bitrate;var _=t.ResvFrameBegin(I,new MeanBits(0))/d.mode_gr;get_framebits(I,T);for(var A=0;A<d.mode_gr;A++){var z=a.on_pe(I,v,B[A],_,A,0);d.mode_ext==Pe.MPG_MD_MS_LR&&(ms_convert(d.l3_side,A),a.reduce_side(B[A],g[A],_,z));for(var H=0;H<d.channels_out;++H){var U=d.l3_side.tt[A][H];U.block_type!=Pe.SHORT_TYPE?(b=1.28/(1+Math.exp(3.5-v[A][H]/300))-.05,h=d.PSY.mask_adjust-b):(b=2.56/(1+Math.exp(3.5-v[A][H]/300))-.14,h=d.PSY.mask_adjust_short-b),d.masking_lower=Math.pow(10,h*.1),init_outer_loop(d,U),w[A][H]=a.calc_xmin(I,O[A][H],U,F[A][H]),w[A][H]!=0&&(i=0),l[A][H]=126,u+=B[A][H]}}for(var A=0;A<d.mode_gr;A++)for(var H=0;H<d.channels_out;H++)u>T[d.VBR_max_bitrate]&&(B[A][H]*=T[d.VBR_max_bitrate],B[A][H]/=u),l[A][H]>B[A][H]&&(l[A][H]=B[A][H]);return i},this.bitpressure_strategy=function(I,v,g,O){for(var F=0;F<I.mode_gr;F++)for(var T=0;T<I.channels_out;T++){for(var l=I.l3_side.tt[F][T],B=v[F][T],w=0,d=0;d<l.psy_lmax;d++)B[w++]*=1+.029*d*d/Pe.SBMAX_l/Pe.SBMAX_l;if(l.block_type==Pe.SHORT_TYPE)for(var d=l.sfb_smin;d<Pe.SBMAX_s;d++)B[w++]*=1+.029*d*d/Pe.SBMAX_s/Pe.SBMAX_s,B[w++]*=1+.029*d*d/Pe.SBMAX_s/Pe.SBMAX_s,B[w++]*=1+.029*d*d/Pe.SBMAX_s/Pe.SBMAX_s;O[F][T]=0|Math.max(g[F][T],.9*O[F][T])}},this.VBR_new_prepare=function(I,v,g,O,F,T){var l=I.internal_flags,B=1,w=0,d=0,h;if(I.free_format){l.bitrate_index=0;var b=new MeanBits(w);h=t.ResvFrameBegin(I,b),w=b.bits,F[0]=h}else{l.bitrate_index=l.VBR_max_bitrate;var b=new MeanBits(w);t.ResvFrameBegin(I,b),w=b.bits,get_framebits(I,F),h=F[l.VBR_max_bitrate]}for(var i=0;i<l.mode_gr;i++){a.on_pe(I,v,T[i],w,i,0),l.mode_ext==Pe.MPG_MD_MS_LR&&ms_convert(l.l3_side,i);for(var u=0;u<l.channels_out;++u){var _=l.l3_side.tt[i][u];l.masking_lower=Math.pow(10,l.PSY.mask_adjust*.1),init_outer_loop(l,_),a.calc_xmin(I,g[i][u],_,O[i][u])!=0&&(B=0),d+=T[i][u]}}for(var i=0;i<l.mode_gr;i++)for(var u=0;u<l.channels_out;u++)d>h&&(T[i][u]*=h,T[i][u]/=d);return B},this.calc_target_bits=function(I,v,g,O,F,T){var l=I.internal_flags,B=l.l3_side,w,d,h,b,i=0;l.bitrate_index=l.VBR_max_bitrate;var u=new MeanBits(i);for(T[0]=t.ResvFrameBegin(I,u),i=u.bits,l.bitrate_index=1,i=e.getframebits(I)-l.sideinfo_len*8,F[0]=i/(l.mode_gr*l.channels_out),i=I.VBR_mean_bitrate_kbps*I.framesize*1e3,(l.substep_shaping&1)!=0&&(i*=1.09),i/=I.out_samplerate,i-=l.sideinfo_len*8,i/=l.mode_gr*l.channels_out,w=.93+.07*(11-I.compression_ratio)/(11-5.5),w<.9&&(w=.9),w>1&&(w=1),d=0;d<l.mode_gr;d++){var _=0;for(h=0;h<l.channels_out;h++){if(O[d][h]=int(w*i),v[d][h]>700){var A=int((v[d][h]-700)/1.4),z=B.tt[d][h];O[d][h]=int(w*i),z.block_type==Pe.SHORT_TYPE&&A<i/2&&(A=i/2),A>i*3/2?A=i*3/2:A<0&&(A=0),O[d][h]+=A}O[d][h]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(O[d][h]=LameInternalFlags.MAX_BITS_PER_CHANNEL),_+=O[d][h]}if(_>LameInternalFlags.MAX_BITS_PER_GRANULE)for(h=0;h<l.channels_out;++h)O[d][h]*=LameInternalFlags.MAX_BITS_PER_GRANULE,O[d][h]/=_}if(l.mode_ext==Pe.MPG_MD_MS_LR)for(d=0;d<l.mode_gr;d++)a.reduce_side(O[d],g[d],i*l.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(b=0,d=0;d<l.mode_gr;d++)for(h=0;h<l.channels_out;h++)O[d][h]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(O[d][h]=LameInternalFlags.MAX_BITS_PER_CHANNEL),b+=O[d][h];if(b>T[0])for(d=0;d<l.mode_gr;d++)for(h=0;h<l.channels_out;h++)O[d][h]*=T[0],O[d][h]/=b}}var th=eh,ah=We,c0=ah.assert;function rh(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,a){var n=t.internal_flags,m,s=n.l3_side,R=e.getframebits(t);a.bits=(R-n.sideinfo_len*8)/n.mode_gr;var E=8*256*n.mode_gr-8;t.brate>320?m=8*int(t.brate*1e3/(t.out_samplerate/1152)/8+.5):(m=8*1440,t.strict_ISO&&(m=8*int(32e4/(t.out_samplerate/1152)/8+.5))),n.ResvMax=m-R,n.ResvMax>E&&(n.ResvMax=E),(n.ResvMax<0||t.disable_reservoir)&&(n.ResvMax=0);var N=a.bits*n.mode_gr+Math.min(n.ResvSize,n.ResvMax);return N>m&&(N=m),c0(n.ResvMax%8==0),c0(n.ResvMax>=0),s.resvDrain_pre=0,n.pinfo!=null&&(n.pinfo.mean_bits=a.bits/2,n.pinfo.resvsize=n.ResvSize),N},this.ResvMaxBits=function(t,a,n,m){var s=t.internal_flags,R,E=s.ResvSize,N=s.ResvMax;m!=0&&(E+=a),(s.substep_shaping&1)!=0&&(N*=.9),n.bits=a,E*10>N*9?(R=E-N*9/10,n.bits+=R,s.substep_shaping|=128):(R=0,s.substep_shaping&=127,!t.disable_reservoir&&(s.substep_shaping&1)==0&&(n.bits-=.1*a));var L=E<s.ResvMax*6/10?E:s.ResvMax*6/10;return L-=R,L<0&&(L=0),L},this.ResvAdjust=function(t,a){t.ResvSize-=a.part2_3_length+a.part2_length},this.ResvFrameEnd=function(t,a){var n,m=t.l3_side;t.ResvSize+=a*t.mode_gr;var s=0;m.resvDrain_post=0,m.resvDrain_pre=0,(n=t.ResvSize%8)!=0&&(s+=n),n=t.ResvSize-s-t.ResvMax,n>0&&(s+=n);{var R=Math.min(m.main_data_begin*8,s)/8;m.resvDrain_pre+=8*R,s-=8*R,t.ResvSize-=8*R,m.main_data_begin-=R}m.resvDrain_post+=s,t.ResvSize-=s}}var oh=rh;function sh(){var e="http://www.mp3dev.org/",t=3,a=98,n=4,m=0,s=93;this.getLameVersion=function(){return t+"."+a+"."+n},this.getLameShortVersion=function(){return t+"."+a+"."+n},this.getLameVeryShortVersion=function(){return"LAME"+t+"."+a+"r"},this.getPsyVersion=function(){return m+"."+s},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var nh=sh,hr=We,ih=hr.System,Ps=hr.VbrMode,d0=hr.ShortBlock,lh=hr.Arrays,Ho=hr.new_byte,ch=hr.assert;Yr.NUMTOCENTRIES=100,Yr.MAXFRAMESIZE=2880;function Yr(){var e,t,a;this.setModules=function(i,u,_){e=i,t=u,a=_};var n=1,m=2,s=4,R=8,E=Yr.NUMTOCENTRIES,N=Yr.MAXFRAMESIZE,L=E+4+4+4+4+4,k=L+9+1+1+8+1+1+3+1+1+2+4+2+2,f=128,x=64,y=32,o=null,S="Xing",j="Info",I=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function v(i,u){if(i.nVbrNumFrames++,i.sum+=u,i.seen++,!(i.seen<i.want)&&(i.pos<i.size&&(i.bag[i.pos]=i.sum,i.pos++,i.seen=0),i.pos==i.size)){for(var _=1;_<i.size;_+=2)i.bag[_/2]=i.bag[_];i.want*=2,i.pos/=2}}function g(i,u){if(!(i.pos<=0))for(var _=1;_<E;++_){var A=_/E,z,H,U=0|Math.floor(A*i.pos);U>i.pos-1&&(U=i.pos-1),z=i.bag[U],H=i.sum;var Q=0|256*z/H;Q>255&&(Q=255),u[_]=255&Q}}this.addVbrFrame=function(i){var u=i.internal_flags,_=Tables.bitrate_table[i.version][u.bitrate_index];ch(u.VBR_seek_table.bag!=null),v(u.VBR_seek_table,_)};function O(i,u){var _=i[u+0]&255;return _<<=8,_|=i[u+1]&255,_<<=8,_|=i[u+2]&255,_<<=8,_|=i[u+3]&255,_}function F(i,u,_){i[u+0]=255&(_>>24&255),i[u+1]=255&(_>>16&255),i[u+2]=255&(_>>8&255),i[u+3]=255&(_&255)}function T(i,u,_){i[u+0]=255&(_>>8&255),i[u+1]=255&(_&255)}function l(i,u){return new String(i,u,S.length(),o).equals(S)||new String(i,u,j.length(),o).equals(j)}function B(i,u,_){return 255&(i<<u|_&~(-1<<u))}function w(i,u){var _=i.internal_flags;u[0]=B(u[0],8,255),u[1]=B(u[1],3,7),u[1]=B(u[1],1,i.out_samplerate<16e3?0:1),u[1]=B(u[1],1,i.version),u[1]=B(u[1],2,4-3),u[1]=B(u[1],1,i.error_protection?0:1),u[2]=B(u[2],4,_.bitrate_index),u[2]=B(u[2],2,_.samplerate_index),u[2]=B(u[2],1,0),u[2]=B(u[2],1,i.extension),u[3]=B(u[3],2,i.mode.ordinal()),u[3]=B(u[3],2,_.mode_ext),u[3]=B(u[3],1,i.copyright),u[3]=B(u[3],1,i.original),u[3]=B(u[3],2,i.emphasis),u[0]=255;var A=255&(u[1]&241),z;i.version==1?z=f:i.out_samplerate<16e3?z=y:z=x,i.VBR==Ps.vbr_off&&(z=i.brate);var H;i.free_format?H=0:H=255&16*e.BitrateIndex(z,i.version,i.out_samplerate),i.version==1?(u[1]=255&(A|10),A=255&(u[2]&13),u[2]=255&(H|A)):(u[1]=255&(A|2),A=255&(u[2]&13),u[2]=255&(H|A))}this.getVbrTag=function(i){var u=new VBRTagData,_=0;u.flags=0;var A=i[_+1]>>3&1,z=i[_+2]>>2&3,H=i[_+3]>>6&3,U=i[_+2]>>4&15;if(U=Tables.bitrate_table[A][U],i[_+1]>>4==14?u.samprate=Tables.samplerate_table[2][z]:u.samprate=Tables.samplerate_table[A][z],A!=0?H!=3?_+=32+4:_+=17+4:H!=3?_+=17+4:_+=9+4,!l(i,_))return null;_+=4,u.hId=A;var Q=u.flags=O(i,_);if(_+=4,(Q&n)!=0&&(u.frames=O(i,_),_+=4),(Q&m)!=0&&(u.bytes=O(i,_),_+=4),(Q&s)!=0){if(u.toc!=null)for(var c=0;c<E;c++)u.toc[c]=i[_+c];_+=E}u.vbrScale=-1,(Q&R)!=0&&(u.vbrScale=O(i,_),_+=4),u.headersize=(A+1)*72e3*U/u.samprate,_+=21;var p=i[_+0]<<4;p+=i[_+1]>>4;var K=(i[_+1]&15)<<8;return K+=i[_+2]&255,(p<0||p>3e3)&&(p=-1),(K<0||K>3e3)&&(K=-1),u.encDelay=p,u.encPadding=K,u},this.InitVbrTag=function(i){var u=i.internal_flags,_;i.version==1?_=f:i.out_samplerate<16e3?_=y:_=x,i.VBR==Ps.vbr_off&&(_=i.brate);var A=(i.version+1)*72e3*_/i.out_samplerate,z=u.sideinfo_len+k;if(u.VBR_seek_table.TotalFrameSize=A,A<z||A>N){i.bWriteVbrTag=!1;return}u.VBR_seek_table.nVbrNumFrames=0,u.VBR_seek_table.nBytesWritten=0,u.VBR_seek_table.sum=0,u.VBR_seek_table.seen=0,u.VBR_seek_table.want=1,u.VBR_seek_table.pos=0,u.VBR_seek_table.bag==null&&(u.VBR_seek_table.bag=new int[400],u.VBR_seek_table.size=400);var H=Ho(N);w(i,H);for(var U=u.VBR_seek_table.TotalFrameSize,Q=0;Q<U;++Q)t.add_dummy_byte(i,H[Q]&255,1)};function d(i,u){var _=u^i;return u=u>>8^I[_&255],u}this.updateMusicCRC=function(i,u,_,A){for(var z=0;z<A;++z)i[0]=d(u[_+z],i[0])};function h(i,u,_,A,z){var H=i.internal_flags,U=0,Q=i.encoder_delay,c=i.encoder_padding,p=100-10*i.VBR_q-i.quality,K=a.getLameVeryShortVersion(),J,ce=0,ue,me=[1,5,3,2,4,0,3],fe=0|(i.lowpassfreq/100+.5>255?255:i.lowpassfreq/100+.5),we=0,ve=0,de=0,Ae=i.internal_flags.noise_shaping,Fe=0,Le=0,je=0,De=0,Ue=0,at=(i.exp_nspsytune&1)!=0,yt=(i.exp_nspsytune&2)!=0,ut=!1,ft=!1,pt=i.internal_flags.nogap_total,Gt=i.internal_flags.nogap_current,At=i.ATHtype,vt=0,xt;switch(i.VBR){case vbr_abr:xt=i.VBR_mean_bitrate_kbps;break;case vbr_off:xt=i.brate;break;default:xt=i.VBR_min_bitrate_kbps}switch(i.VBR.ordinal()<me.length?J=me[i.VBR.ordinal()]:J=0,ue=16*ce+J,H.findReplayGain&&(H.RadioGain>510&&(H.RadioGain=510),H.RadioGain<-510&&(H.RadioGain=-510),ve=8192,ve|=3072,H.RadioGain>=0?ve|=H.RadioGain:(ve|=512,ve|=-H.RadioGain)),H.findPeakSample&&(we=Math.abs(0|H.PeakSample/32767*Math.pow(2,23)+.5)),pt!=-1&&(Gt>0&&(ft=!0),Gt<pt-1&&(ut=!0)),vt=At+((at?1:0)<<4)+((yt?1:0)<<5)+((ut?1:0)<<6)+((ft?1:0)<<7),p<0&&(p=0),i.mode){case MONO:Fe=0;break;case STEREO:Fe=1;break;case DUAL_CHANNEL:Fe=2;break;case JOINT_STEREO:i.force_ms?Fe=4:Fe=3;break;case NOT_SET:default:Fe=7;break}i.in_samplerate<=32e3?je=0:i.in_samplerate==48e3?je=2:i.in_samplerate>48e3?je=3:je=1,(i.short_blocks==d0.short_block_forced||i.short_blocks==d0.short_block_dispensed||i.lowpassfreq==-1&&i.highpassfreq==-1||i.scale_left<i.scale_right||i.scale_left>i.scale_right||i.disable_reservoir&&i.brate<320||i.noATH||i.ATHonly||At==0||i.in_samplerate<=32e3)&&(Le=1),De=Ae+(Fe<<2)+(Le<<5)+(je<<6),Ue=H.nMusicCRC,F(_,A+U,p),U+=4;for(var Ft=0;Ft<9;Ft++)_[A+U+Ft]=255&K.charAt(Ft);U+=9,_[A+U]=255&ue,U++,_[A+U]=255&fe,U++,F(_,A+U,we),U+=4,T(_,A+U,ve),U+=2,T(_,A+U,de),U+=2,_[A+U]=255&vt,U++,xt>=255?_[A+U]=255:_[A+U]=255&xt,U++,_[A+U]=255&Q>>4,_[A+U+1]=255&(Q<<4)+(c>>8),_[A+U+2]=255&c,U+=3,_[A+U]=255&De,U++,_[A+U++]=0,T(_,A+U,i.preset),U+=2,F(_,A+U,u),U+=4,T(_,A+U,Ue),U+=2;for(var oe=0;oe<U;oe++)z=d(_[A+oe],z);return T(_,A+U,z),U+=2,U}function b(i){i.seek(0);var u=Ho(10);i.readFully(u);var _;return new String(u,"ISO-8859-1").startsWith("ID3")?_=0:_=((u[6]&127)<<21|(u[7]&127)<<14|(u[8]&127)<<7|u[9]&127)+u.length,_}this.getLameTagFrame=function(i,u){var _=i.internal_flags;if(!i.bWriteVbrTag||_.Class_ID!=Lame.LAME_ID||_.VBR_seek_table.pos<=0)return 0;if(u.length<_.VBR_seek_table.TotalFrameSize)return _.VBR_seek_table.TotalFrameSize;lh.fill(u,0,_.VBR_seek_table.TotalFrameSize,0),w(i,u);var A=Ho(E);if(i.free_format)for(var z=1;z<E;++z)A[z]=255&255*z/100;else g(_.VBR_seek_table,A);var H=_.sideinfo_len;i.error_protection&&(H-=2),i.VBR==Ps.vbr_off?(u[H++]=255&j.charAt(0),u[H++]=255&j.charAt(1),u[H++]=255&j.charAt(2),u[H++]=255&j.charAt(3)):(u[H++]=255&S.charAt(0),u[H++]=255&S.charAt(1),u[H++]=255&S.charAt(2),u[H++]=255&S.charAt(3)),F(u,H,n+m+s+R),H+=4,F(u,H,_.VBR_seek_table.nVbrNumFrames),H+=4;var U=_.VBR_seek_table.nBytesWritten+_.VBR_seek_table.TotalFrameSize;F(u,H,0|U),H+=4,ih.arraycopy(A,0,u,H,A.length),H+=A.length,i.error_protection&&t.CRC_writeheader(_,u);for(var Q=0,z=0;z<H;z++)Q=d(u[z],Q);return H+=h(i,U,u,H,Q),_.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(i,u){var _=i.internal_flags;if(_.VBR_seek_table.pos<=0||(u.seek(u.length()),u.length()==0))return-1;var A=b(u);u.seek(A);var z=Ho(N),H=getLameTagFrame(i,z);return H>z.length?-1:(H<1||u.write(z,0,H),0)}}var dh=Yr,m0=We,h0=m0.new_byte,mh=m0.assert;console.log("hey");var hh=Vs,uh=q2,fh=Gi,_h=e0,ph=th,vh=t0,gh=oh,bh=Dr,yh=Ns,xh=nh,wh=dh;function Sh(){this.setModules=function(e,t){}}function kh(){this.setModules=function(e,t,a){}}function Eh(){}function Mh(){this.setModules=function(e,t){}}function Rh(e,t,a){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,a=128);var n=new hh,m=new Sh,s=new fh,R=new yh,E=new uh,N=new _h,L=new ph,k=new wh,f=new xh,x=new Mh,y=new gh,o=new vh,S=new kh,j=new Eh;n.setModules(s,R,E,N,L,k,f,x,j),R.setModules(s,j,f,k),x.setModules(R,f),E.setModules(n),L.setModules(R,y,N,o),N.setModules(o,y,n.enc.psy),y.setModules(R),o.setModules(N),k.setModules(n,R,f),m.setModules(S,j),S.setModules(f,x,E);var I=n.lame_init();I.num_channels=e,I.in_samplerate=t,I.brate=a,I.mode=bh.STEREO,I.quality=3,I.bWriteVbrTag=!1,I.disable_reservoir=!0,I.write_id3tag_automatic=!1,n.lame_init_params(I);var v=1152,g=0|1.25*v+7200,O=h0(g);this.encodeBuffer=function(F,T){e==1&&(T=F),mh(F.length==T.length),F.length>v&&(v=F.length,g=0|1.25*v+7200,O=h0(g));var l=n.lame_encode_buffer(I,F,T,F.length,O,0,g);return new Int8Array(O.subarray(0,l))},this.flush=function(){var F=n.lame_encode_flush(I,O,0,g);return new Int8Array(O.subarray(0,F))}}function la(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function Po(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}la.RIFF=Po("RIFF"),la.WAVE=Po("WAVE"),la.fmt_=Po("fmt "),la.data=Po("data"),la.readHeader=function(e){var t=new la,a=e.getUint32(0,!1);if(la.RIFF==a&&(e.getUint32(4,!0),la.WAVE==e.getUint32(8,!1)&&la.fmt_==e.getUint32(12,!1))){var n=e.getUint32(16,!0),m=16+4;switch(n){case 16:case 18:t.channels=e.getUint16(m+2,!0),t.sampleRate=e.getUint32(m+4,!0);break;default:throw"extended fmt chunk not implemented"}m+=n;for(var s=la.data,R=0;s!=a&&(a=e.getUint32(m,!1),R=e.getUint32(m+4,!0),s!=a);)m+=R+8;return t.dataLen=R,t.dataOffset=m+8,t}};var Ah=Rh;class Th{constructor(t){this.bitRate=t.bitRate,this.sampleRate=t.sampleRate,this.dataBuffer=[],this.encoder=new Ah(1,this.sampleRate,this.bitRate)}encode(t){const n=this._convertBuffer(t);let m=n.length;for(let s=0;m>=0;s+=1152){const R=n.subarray(s,s+1152),E=this.encoder.encodeBuffer(R);this.dataBuffer.push(new Int8Array(E)),m-=1152}}finish(){this.dataBuffer.push(this.encoder.flush());const t=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:t,url:URL.createObjectURL(t)}}_floatTo16BitPCM(t,a){for(let n=0;n<t.length;n++){const m=Math.max(-1,Math.min(1,t[n]));a[n]=m<0?m*32768:m*32767}}_convertBuffer(t){const a=new Float32Array(t),n=new Int16Array(t.length);return this._floatTo16BitPCM(a,n),n}}class Bh{constructor(t={}){this.beforeRecording=t.beforeRecording,this.pauseRecording=t.pauseRecording,this.afterRecording=t.afterRecording,this.micFailed=t.micFailed,this.encoderOptions={bitRate:t.bitRate,sampleRate:t.sampleRate},this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this._duration=0}start(){const t={video:!1,audio:{channelCount:1,echoCancellation:!1}};this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia(t).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0,this.lameEncoder||(this.lameEncoder=new Th(this.encoderOptions))}stop(){this.stream.getTracks().forEach(a=>a.stop()),this.input.disconnect(),this.processor.disconnect(),this.context.close();let t=null;t=this.lameEncoder.finish(),t.duration=this.duration,this.records.push(t),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(t)}pause(){this.stream.getTracks().forEach(t=>t.stop()),this.input.disconnect(),this.processor.disconnect(),this._duration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}_micCaptured(t){this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this._duration,this.input=this.context.createMediaStreamSource(t),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=t,this.processor.onaudioprocess=a=>{const n=a.inputBuffer.getChannelData(0);let m=0;this.lameEncoder&&this.lameEncoder.encode(n);for(let s=0;s<n.length;++s)m+=n[s]*n[s];this.duration=parseFloat(this._duration)+parseFloat(this.context.currentTime.toFixed(2)),this.volume=Math.sqrt(m/n.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}_micError(t){this.micFailed&&this.micFailed(t)}}function u0(){var e=Ch(),t=e.substr(0,4);return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw(n|u)|c55\/|capi|ccwa|cdm|cell|chtm|cldc|cmd|co(mp|nd)|craw|da(it|ll|ng)|dbte|dcs|devi|dica|dmob|do(c|p)o|ds(12|d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(|_)|g1 u|g560|gene|gf5|gmo|go(\.w|od)|gr(ad|un)|haie|hcit|hd(m|p|t)|hei|hi(pt|ta)|hp( i|ip)|hsc|ht(c(| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i(20|go|ma)|i230|iac( ||\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|[a-w])|libw|lynx|m1w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|mcr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|([1-8]|c))|phil|pire|pl(ay|uc)|pn2|po(ck|rt|se)|prox|psio|ptg|qaa|qc(07|12|21|32|60|[2-7]|i)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h|oo|p)|sdk\/|se(c(|0|1)|47|mc|nd|ri)|sgh|shar|sie(|m)|sk0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h|v|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl|tdg|tel(i|m)|tim|tmo|to(pl|sh)|ts(70|m|m3|m5)|tx9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas|your|zeto|zte/i.test(t)}function Ch(){var e=navigator.userAgent||navigator.vendor||window.opera||null;if(!e)throw new Error("Failed to look for user agent information.");return e}const Oh={name:"RoomFooter",components:{SvgIcon:bt,EmojiPickerContainer:bi,RoomFiles:Vd,RoomMessageReply:sm,RoomUsersTag:mm,RoomEmojis:_m,RoomTemplatesText:wm},directives:{clickOutside:io},props:{room:{type:Object,required:!0},roomId:{type:[String,Number],required:!0},roomMessage:{type:String,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},showEmojis:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},templatesText:{type:Array,default:null},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},initReplyMessage:{type:Object,default:null},initEditMessage:{type:Object,default:null}},emits:["edit-message","send-message","update-edited-message-id","textarea-action-handler","typing-message"],data(){return{message:"",editedMessage:{},messageReply:null,cursorRangePosition:null,files:[],fileDialog:!1,selectUsersTagItem:null,selectEmojiItem:null,selectTemplatesTextItem:null,format:"mp3",activeUpOrDownEmojis:null,activeUpOrDownUsersTag:null,activeUpOrDownTemplatesText:null,emojisDB:new zn,emojiOpened:!1,keepKeyboardOpen:!1,filteredEmojis:[],filteredUsersTag:[],selectedUsersTag:[],filteredTemplatesText:[],recorder:this.initRecorder(),isRecording:!1}},computed:{isMessageEmpty(){return!this.files.length&&!this.message.trim()},isFileLoading(){return this.files.some(e=>e.loading)},recordedTime(){return new Date(this.recorder.duration*1e3).toISOString().substr(14,5)},shadowFooter(){return!!this.filteredEmojis.length||!!this.filteredUsersTag.length||!!this.filteredTemplatesText.length||!!this.files.length||!!this.messageReply}},watch:{roomId(){this.resetMessage(!0,!0),this.roomMessage&&(this.message=this.roomMessage,setTimeout(()=>this.onChangeInput()))},message(e){this.getTextareaRef().value=e},roomMessage:{immediate:!0,handler(e){e&&(this.message=this.roomMessage)}},editedMessage(e){this.$emit("update-edited-message-id",e._id)},initReplyMessage(e){this.replyMessage(e)},initEditMessage(e){this.editMessage(e)}},mounted(){const e=u0();let t=!0;this.getTextareaRef().addEventListener("keyup",a=>{a.key==="Enter"&&!a.shiftKey&&!this.fileDialog&&(e?(this.message=this.message+`
`,setTimeout(()=>this.onChangeInput())):t&&!this.filteredEmojis.length&&!this.filteredUsersTag.length&&!this.filteredTemplatesText.length&&this.sendMessage()),t=!a.isComposing,setTimeout(()=>{this.updateFooterLists()},60)}),this.getTextareaRef().addEventListener("click",()=>{e&&(this.keepKeyboardOpen=!0),this.updateFooterLists()}),this.getTextareaRef().addEventListener("blur",()=>{this.resetFooterList(),e&&setTimeout(()=>this.keepKeyboardOpen=!1)})},beforeUnmount(){this.stopRecorder()},methods:{getTextareaRef(){return this.$refs.roomTextarea},focusTextarea(e){u0()&&e||!this.getTextareaRef()||(this.getTextareaRef().focus(),this.cursorRangePosition&&setTimeout(()=>{this.getTextareaRef().setSelectionRange(this.cursorRangePosition,this.cursorRangePosition),this.cursorRangePosition=null}))},onChangeInput(){var e,t,a;(((e=this.getTextareaRef())==null?void 0:e.value)||((t=this.getTextareaRef())==null?void 0:t.value)==="")&&(this.message=(a=this.getTextareaRef())==null?void 0:a.value),this.keepKeyboardOpen=!0,this.resizeTextarea(),this.$emit("typing-message",this.message)},resizeTextarea(){const e=this.getTextareaRef();if(!e)return;const t=window.getComputedStyle(e,null).getPropertyValue("padding-top").replace("px","");e.style.height=0,e.style.height=e.scrollHeight-t*2+"px"},escapeTextarea(){this.filteredEmojis.length?this.filteredEmojis=[]:this.filteredUsersTag.length?this.filteredUsersTag=[]:this.filteredTemplatesText.length?this.filteredTemplatesText=[]:this.resetMessage()},onPasteImage(e){var a;const t=(a=e.clipboardData)==null?void 0:a.items;t&&Array.from(t).forEach(n=>{if(n.type.includes("image")){const m=n.getAsFile();this.onFileChange([m])}})},updateActiveUpOrDown(e){this.filteredEmojis.length?this.activeUpOrDownEmojis=e:this.filteredUsersTag.length?this.activeUpOrDownUsersTag=e:this.filteredTemplatesText.length&&(this.activeUpOrDownTemplatesText=e)},selectItem(){this.filteredEmojis.length?this.selectEmojiItem=!0:this.filteredUsersTag.length?this.selectUsersTagItem=!0:this.filteredTemplatesText.length&&(this.selectTemplatesTextItem=!0)},selectEmoji(e){if(this.selectEmojiItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition(":");this.message=this.message.substr(0,t-1)+e+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t,this.focusTextarea()},selectTemplateText(e){if(this.selectTemplatesTextItem=!1,!e)return;const{position:t,endPosition:a}=this.getCharPosition("/"),n=this.message.substr(a,a).length?"":" ";this.message=this.message.substr(0,t-1)+e.text+n+this.message.substr(a,this.message.length-1),this.cursorRangePosition=t+e.text.length+n.length+1,this.focusTextarea()},addEmoji(e){this.message+=e.unicode,this.focusTextarea(!0)},launchFilePicker(){this.$refs.file.value="",this.$refs.file.click()},async onFileChange(e){this.fileDialog=!0,this.focusTextarea(),Array.from(e).forEach(async t=>{const a=URL.createObjectURL(t),n=t.name.lastIndexOf(".");this.files.push({loading:!0,name:t.name.substring(0,n),size:t.size,type:t.type,extension:t.name.substring(n+1),localUrl:a});const m=await fetch(a).then(R=>R.blob());let s=this.files.find(R=>R.localUrl===a);s&&(s.blob=m,s.loading=!1,delete s.loading)}),setTimeout(()=>this.fileDialog=!1,500)},removeFile(e){this.files.splice(e,1),this.focusTextarea()},toggleRecorder(e){if(this.isRecording=e,!this.recorder.isRecording)setTimeout(()=>this.recorder.start(),200);else try{this.recorder.stop();const t=this.recorder.records[0];this.files.push({blob:t.blob,name:`audio.${this.format}`,size:t.blob.size,duration:t.duration,type:t.blob.type,audio:!0,localUrl:URL.createObjectURL(t.blob)}),this.recorder=this.initRecorder(),this.sendMessage()}catch{setTimeout(()=>this.stopRecorder(),100)}},stopRecorder(){if(this.recorder.isRecording)try{this.recorder.stop(),this.recorder=this.initRecorder()}catch{setTimeout(()=>this.stopRecorder(),100)}},textareaActionHandler(){this.$emit("textarea-action-handler",this.message)},sendMessage(){var a;let e=this.message.trim();if(!this.files.length&&!e||this.isFileLoading)return;this.selectedUsersTag.forEach(n=>{e=e.replace(`@${n.username}`,`<usertag>${n._id}</usertag>`)});const t=this.files.length?this.files:null;this.editedMessage._id?(this.editedMessage.content!==e||((a=this.editedMessage.files)==null?void 0:a.length)||this.files.length)&&this.$emit("edit-message",{messageId:this.editedMessage._id,newContent:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}):this.$emit("send-message",{content:e,files:t,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}),this.resetMessage(!0)},editMessage(e){this.resetMessage(),this.editedMessage={...e};let t=e.content;const a=t,n="<usertag>",m="</usertag>";[...t.matchAll(new RegExp(n,"gi"))].map(R=>R.index).forEach(R=>{const E=a.substring(R+n.length,a.indexOf(m,R)),N=this.room.users.find(L=>L._id===E);t=t.replace(`${n}${E}${m}`,`@${(N==null?void 0:N.username)||"unknown"}`),this.selectUserTag(N,!0)}),this.message=t,e.files&&(this.files=[...e.files]),setTimeout(()=>this.resizeTextarea())},replyMessage(e){this.editedMessage={},this.messageReply=e,this.focusTextarea()},updateFooterLists(){this.updateFooterList("@"),this.updateFooterList(":"),this.updateFooterList("/")},updateFooterList(e){if(!this.getTextareaRef()||e===":"&&!this.emojisSuggestionEnabled||e==="@"&&(!this.userTagsEnabled||!this.room.users)||e==="/"&&!this.templatesText)return;const t=this.getTextareaRef().selectionStart;let a=t;for(;a>0&&this.message.charAt(a-1)!==e&&(this.message.charAt(a-1)!==" "||e!==":");)a--;const n=this.message.charAt(a-2),m=!n.match(/^[0-9a-zA-Z]+$/);if(this.message.charAt(a-1)===e&&(!n||n===" "||m)){const s=this.message.substring(a,t);e===":"?this.updateEmojis(s):e==="@"?this.updateShowUsersTag(s):e==="/"&&this.updateShowTemplatesText(s)}else this.resetFooterList(e)},updateShowUsersTag(e){this.filteredUsersTag=rs(this.room.users,"username",e,!0).filter(t=>t._id!==this.currentUserId)},selectUserTag(e,t=!1){if(this.selectUsersTagItem=!1,!e)return;const{position:a,endPosition:n}=this.getCharPosition("@"),m=this.message.substr(n,n).length?"":" ";this.message=this.message.substr(0,a)+e.username+m+this.message.substr(n,this.message.length-1),this.selectedUsersTag=[...this.selectedUsersTag,{...e}],t||(this.cursorRangePosition=a+e.username.length+m.length+1),this.focusTextarea()},updateShowTemplatesText(e){this.filteredTemplatesText=rs(this.templatesText,"tag",e,!0)},getCharPosition(e){let a=this.getTextareaRef().selectionStart;for(;a>0&&this.message.charAt(a-1)!==e;)a--;const n=this.getTextareaRef().selectionEnd;return{position:a,endPosition:n}},async updateEmojis(e){if(!e)return;const t=await this.emojisDB.getEmojiBySearchQuery(e);this.filteredEmojis=t.map(a=>a.unicode)},resetFooterList(e=null){e===":"?this.filteredEmojis=[]:e==="@"?this.filteredUsersTag=[]:e==="/"?this.filteredTemplatesText=[]:(this.filteredEmojis=[],this.filteredUsersTag=[],this.filteredTemplatesText=[])},resetMessage(e=!1,t=!1){t||this.$emit("typing-message",null),this.selectedUsersTag=[],this.resetFooterList(),this.resetTextareaSize(),this.message="",this.editedMessage={},this.messageReply=null,this.files=[],this.emojiOpened=!1,this.preventKeyboardFromClosing(),(this.textareaAutoFocus||!t)&&setTimeout(()=>this.focusTextarea(e))},resetTextareaSize(){this.getTextareaRef()&&(this.getTextareaRef().style.height="20px")},preventKeyboardFromClosing(){this.keepKeyboardOpen&&this.getTextareaRef().focus()},initRecorder(){return this.isRecording=!1,new Bh({bitRate:Number(this.audioBitRate),sampleRate:Number(this.audioSampleRate),beforeRecording:null,afterRecording:null,pauseRecording:null,micFailed:this.micFailed})},micFailed(){this.isRecording=!1,this.recorder=this.initRecorder()}}},Nh={key:0,class:"vac-icon-textarea-left"},Ih=r.createElementVNode("div",{class:"vac-dot-audio-record"},null,-1),Lh={class:"vac-dot-audio-record-time"},Vh=["placeholder"],jh={class:"vac-icon-textarea"},Hh={key:1},Ph=["accept"];function Fh(e,t,a,n,m,s){const R=r.resolveComponent("room-emojis"),E=r.resolveComponent("room-users-tag"),N=r.resolveComponent("room-templates-text"),L=r.resolveComponent("room-message-reply"),k=r.resolveComponent("room-files"),f=r.resolveComponent("svg-icon"),x=r.resolveComponent("emoji-picker-container"),y=r.resolveDirective("click-outside");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{id:"room-footer",class:r.normalizeClass(["vac-room-footer",{"vac-app-box-shadow":s.shadowFooter}])},[r.createVNode(R,{"filtered-emojis":m.filteredEmojis,"select-item":m.selectEmojiItem,"active-up-or-down":m.activeUpOrDownEmojis,onSelectEmoji:t[0]||(t[0]=o=>s.selectEmoji(o)),onActivateItem:t[1]||(t[1]=o=>m.activeUpOrDownEmojis=0)},null,8,["filtered-emojis","select-item","active-up-or-down"]),r.createVNode(E,{"filtered-users-tag":m.filteredUsersTag,"select-item":m.selectUsersTagItem,"active-up-or-down":m.activeUpOrDownUsersTag,onSelectUserTag:t[2]||(t[2]=o=>s.selectUserTag(o)),onActivateItem:t[3]||(t[3]=o=>m.activeUpOrDownUsersTag=0)},null,8,["filtered-users-tag","select-item","active-up-or-down"]),r.createVNode(N,{"filtered-templates-text":m.filteredTemplatesText,"select-item":m.selectTemplatesTextItem,"active-up-or-down":m.activeUpOrDownTemplatesText,onSelectTemplateText:t[4]||(t[4]=o=>s.selectTemplateText(o)),onActivateItem:t[5]||(t[5]=o=>m.activeUpOrDownTemplatesText=0)},null,8,["filtered-templates-text","select-item","active-up-or-down"]),r.createVNode(L,{room:a.room,"message-reply":m.messageReply,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onResetMessage:s.resetMessage},r.createSlots({_:2},[r.renderList(e.$slots,(o,S)=>({name:S,fn:r.withCtx(j=>[r.renderSlot(e.$slots,S,r.normalizeProps(r.guardReactiveProps(j)))])}))]),1032,["room","message-reply","text-formatting","link-options","onResetMessage"]),r.createVNode(k,{files:m.files,onRemoveFile:s.removeFile,onResetMessage:s.resetMessage},r.createSlots({_:2},[r.renderList(e.$slots,(o,S)=>({name:S,fn:r.withCtx(j=>[r.renderSlot(e.$slots,S,r.normalizeProps(r.guardReactiveProps(j)))])}))]),1032,["files","onRemoveFile","onResetMessage"]),r.createElementVNode("div",{class:r.normalizeClass(["vac-box-footer",{"vac-box-footer-border":!m.files.length}])},[a.showAudio&&!m.files.length?(r.openBlock(),r.createElementBlock("div",Nh,[m.isRecording?(r.openBlock(),r.createElementBlock(r.Fragment,{key:0},[r.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-stop",onClick:t[6]||(t[6]=(...o)=>s.stopRecorder&&s.stopRecorder(...o))},[r.renderSlot(e.$slots,"audio-stop-icon",{},()=>[r.createVNode(f,{name:"close-outline"})])]),Ih,r.createElementVNode("div",Lh,r.toDisplayString(s.recordedTime),1),r.createElementVNode("div",{class:"vac-svg-button vac-icon-audio-confirm",onClick:t[7]||(t[7]=o=>s.toggleRecorder(!1))},[r.renderSlot(e.$slots,"audio-stop-icon",{},()=>[r.createVNode(f,{name:"checkmark"})])])],64)):(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-svg-button",onClick:t[8]||(t[8]=o=>s.toggleRecorder(!0))},[r.renderSlot(e.$slots,"microphone-icon",{},()=>[r.createVNode(f,{name:"microphone",class:"vac-icon-microphone"})])]))])):r.createCommentVNode("",!0),r.createElementVNode("textarea",{id:"roomTextarea",ref:"roomTextarea",placeholder:a.textMessages.TYPE_MESSAGE,class:r.normalizeClass(["vac-textarea",{"vac-textarea-outline":m.editedMessage._id}]),style:{"min-height":"20px","padding-left":"12px"},onInput:t[9]||(t[9]=(...o)=>s.onChangeInput&&s.onChangeInput(...o)),onKeydown:[t[10]||(t[10]=r.withKeys((...o)=>s.escapeTextarea&&s.escapeTextarea(...o),["esc"])),t[11]||(t[11]=r.withKeys(r.withModifiers((...o)=>s.selectItem&&s.selectItem(...o),["exact","prevent"]),["enter"])),t[13]||(t[13]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["tab"])),t[14]||(t[14]=r.withKeys((...o)=>s.selectItem&&s.selectItem(...o),["tab"])),t[15]||(t[15]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["up"])),t[16]||(t[16]=r.withKeys(o=>s.updateActiveUpOrDown(-1),["up"])),t[17]||(t[17]=r.withKeys(r.withModifiers(()=>{},["exact","prevent"]),["down"])),t[18]||(t[18]=r.withKeys(o=>s.updateActiveUpOrDown(1),["down"]))],onPaste:t[12]||(t[12]=(...o)=>s.onPasteImage&&s.onPasteImage(...o))},null,42,Vh),r.createElementVNode("div",jh,[m.editedMessage._id?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-svg-button",onClick:t[19]||(t[19]=(...o)=>s.resetMessage&&s.resetMessage(...o))},[r.renderSlot(e.$slots,"edit-close-icon",{},()=>[r.createVNode(f,{name:"close-outline"})])])):r.createCommentVNode("",!0),a.showEmojis?r.withDirectives((r.openBlock(),r.createElementBlock("div",Hh,[r.renderSlot(e.$slots,"emoji-picker",r.mergeProps({emojiOpened:m.emojiOpened},{addEmoji:s.addEmoji}),()=>[r.createVNode(x,{"emoji-opened":m.emojiOpened,"position-top":!0,onAddEmoji:s.addEmoji,onOpenEmoji:t[20]||(t[20]=o=>m.emojiOpened=o)},{"emoji-picker-icon":r.withCtx(()=>[r.renderSlot(e.$slots,"emoji-picker-icon")]),_:3},8,["emoji-opened","onAddEmoji"])])])),[[y,()=>m.emojiOpened=!1]]):r.createCommentVNode("",!0),a.showFiles?(r.openBlock(),r.createElementBlock("div",{key:2,class:"vac-svg-button",onClick:t[21]||(t[21]=(...o)=>s.launchFilePicker&&s.launchFilePicker(...o))},[r.renderSlot(e.$slots,"paperclip-icon",{},()=>[r.createVNode(f,{name:"paperclip"})])])):r.createCommentVNode("",!0),a.textareaActionEnabled?(r.openBlock(),r.createElementBlock("div",{key:3,class:"vac-svg-button",onClick:t[22]||(t[22]=(...o)=>s.textareaActionHandler&&s.textareaActionHandler(...o))},[r.renderSlot(e.$slots,"custom-action-icon",{},()=>[r.createVNode(f,{name:"deleted"})])])):r.createCommentVNode("",!0),a.showFiles?(r.openBlock(),r.createElementBlock("input",{key:4,ref:"file",type:"file",multiple:"",accept:a.acceptedFiles,style:{display:"none"},onChange:t[23]||(t[23]=o=>s.onFileChange(o.target.files))},null,40,Ph)):r.createCommentVNode("",!0),a.showSendIcon?(r.openBlock(),r.createElementBlock("div",{key:5,class:r.normalizeClass(["vac-svg-button",{"vac-send-disabled":s.isMessageEmpty}]),onClick:t[24]||(t[24]=(...o)=>s.sendMessage&&s.sendMessage(...o))},[r.renderSlot(e.$slots,"send-icon",{},()=>[r.createVNode(f,{name:"send",param:s.isMessageEmpty||s.isFileLoading?"disabled":""},null,8,["param"])])],2)):r.createCommentVNode("",!0)])],2)],2)),[[r.vShow,Object.keys(a.room).length&&a.showFooter]])}var Dh=Xe(Oh,[["render",Fh]]);const Uh={name:"MessageReply",components:{AudioPlayer:xs,SvgIcon:bt,FormatMessage:Tr},props:{message:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},roomUsers:{type:Array,required:!0}},computed:{replyUsername(){const{senderId:e}=this.message.replyMessage,t=this.roomUsers.find(a=>a._id===e);return t?t.username:""},firstFile(){var e,t;return(t=(e=this.message.replyMessage)==null?void 0:e.files)!=null&&t.length?this.message.replyMessage.files[0]:{}},isAudio(){return lo(this.firstFile)},isImage(){return Ja(this.firstFile)},isVideo(){return Cr(this.firstFile)},isOtherFile(){var e;return((e=this.message.replyMessage.files)==null?void 0:e.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},zh={class:"vac-reply-message"},qh={class:"vac-reply-username"},Xh={key:0,class:"vac-image-reply-container"},Yh={key:1,class:"vac-video-reply-container"},Gh={width:"100%",height:"100%",controls:""},Kh=["src"],Zh={key:3,class:"vac-file-container"},Wh={class:"vac-text-ellipsis"},Qh={key:0,class:"vac-text-ellipsis vac-text-extension"},$h={class:"vac-reply-content"};function Jh(e,t,a,n,m,s){const R=r.resolveComponent("audio-player"),E=r.resolveComponent("svg-icon"),N=r.resolveComponent("format-message");return r.openBlock(),r.createElementBlock("div",zh,[r.createElementVNode("div",qh,r.toDisplayString(s.replyUsername),1),s.isImage?(r.openBlock(),r.createElementBlock("div",Xh,[r.createElementVNode("div",{class:"vac-message-image vac-message-image-reply",style:r.normalizeStyle({"background-image":`url('${s.firstFile.url}')`})},null,4)])):s.isVideo?(r.openBlock(),r.createElementBlock("div",Yh,[r.createElementVNode("video",Gh,[r.createElementVNode("source",{src:s.firstFile.url},null,8,Kh)])])):s.isAudio?(r.openBlock(),r.createBlock(R,{key:2,src:s.firstFile.url,onUpdateProgressTime:t[0]||(t[0]=L=>e.progressTime=L),onHoverAudioProgress:t[1]||(t[1]=L=>e.hoverAudioProgress=L)},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["src"])):s.isOtherFile?(r.openBlock(),r.createElementBlock("div",Zh,[r.createElementVNode("div",null,[r.renderSlot(e.$slots,"file-icon",{},()=>[r.createVNode(E,{name:"file"})])]),r.createElementVNode("div",Wh,r.toDisplayString(s.firstFile.name),1),s.firstFile.extension?(r.openBlock(),r.createElementBlock("div",Qh,r.toDisplayString(s.firstFile.extension),1)):r.createCommentVNode("",!0)])):r.createCommentVNode("",!0),r.createElementVNode("div",$h,[r.createVNode(N,{content:a.message.replyMessage.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,reply:!0},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["content","users","text-formatting","link-options"])])])}var eu=Xe(Uh,[["render",Jh]]);const tu={name:"ProgressBar",props:{progress:{type:Number,default:0}},data(){const n=54*Math.PI;return{radius:35,stroke:4,normalizedRadius:27,circumference:n}},computed:{strokeDashoffset(){return this.circumference-this.progress/100*this.circumference}}},au={ref:"progress",class:"vac-progress-wrapper"},ru=["height","width"],ou=["stroke-dasharray","stroke-width","r","cx","cy"],su={class:"vac-progress-text"},nu=r.createElementVNode("span",{class:"vac-progress-pourcent"},"%",-1);function iu(e,t,a,n,m,s){return r.openBlock(),r.createBlock(r.Transition,{name:"vac-fade-spinner",appear:""},{default:r.withCtx(()=>[r.createElementVNode("div",au,[(r.openBlock(),r.createElementBlock("svg",{height:m.radius*2,width:m.radius*2},[r.createElementVNode("circle",{stroke:"rgba(255, 255, 255, 0.7)","stroke-dasharray":m.circumference+" "+m.circumference,style:r.normalizeStyle({strokeDashoffset:s.strokeDashoffset,strokeLinecap:"round"}),"stroke-width":m.stroke,fill:"transparent",r:m.normalizedRadius,cx:m.radius,cy:m.radius},null,12,ou)],8,ru)),r.createElementVNode("div",{class:"vac-progress-content",style:r.normalizeStyle({height:m.radius*2-19+"px",width:m.radius*2-19+"px"})},[r.createElementVNode("div",su,[r.createTextVNode(r.toDisplayString(a.progress),1),nu])],4)],512)]),_:1})}var f0=Xe(tu,[["render",iu]]);const lu={name:"MessageFile",components:{SvgIcon:bt,Loader:Qr,ProgressBar:f0},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},file:{type:Object,required:!0},index:{type:Number,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file"],data(){return{imageResponsive:"",imageLoading:!1,imageHover:!1}},computed:{isImageLoading(){return this.file.url.indexOf("blob:http")!==-1||this.imageLoading},isImage(){return Ja(this.file)},isVideo(){return Cr(this.file)}},watch:{file:{immediate:!0,handler(){this.checkImgLoad()}}},mounted(){const e=this.$refs["imageRef"+this.index];e&&(this.imageResponsive={maxHeight:e.clientWidth-18,loaderTop:e.clientHeight/2-9})},methods:{checkImgLoad(){if(!Ja(this.file))return;this.imageLoading=!0;const e=new Image;e.src=this.file.url,e.addEventListener("load",()=>this.imageLoading=!1)},openFile(e,t){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:this.file,action:t}))}}},cu={class:"vac-message-file-container"},du={key:0,class:"vac-image-buttons"},mu={width:"100%",height:"100%",controls:""},hu=["src"];function uu(e,t,a,n,m,s){const R=r.resolveComponent("progress-bar"),E=r.resolveComponent("loader"),N=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",cu,[s.isImage?(r.openBlock(),r.createElementBlock("div",{key:0,ref:"imageRef"+a.index,class:"vac-message-image-container",onMouseover:t[2]||(t[2]=L=>m.imageHover=!0),onMouseleave:t[3]||(t[3]=L=>m.imageHover=!1),onClick:t[4]||(t[4]=L=>s.openFile(L,"preview"))},[a.file.progress>=0?(r.openBlock(),r.createBlock(R,{key:0,progress:a.file.progress,style:r.normalizeStyle({top:`${m.imageResponsive.loaderTop}px`})},null,8,["progress","style"])):(r.openBlock(),r.createBlock(E,{key:1,show:s.isImageLoading,style:r.normalizeStyle({top:`${m.imageResponsive.loaderTop}px`})},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["show","style"])),r.createElementVNode("div",{class:r.normalizeClass(["vac-message-image",{"vac-blur-loading":s.isImageLoading&&a.message.senderId===a.currentUserId}]),style:r.normalizeStyle({"background-image":`url('${s.isImageLoading&&a.file.preview||a.file.url}')`,"max-height":`${m.imageResponsive.maxHeight}px`})},[r.createVNode(r.Transition,{name:"vac-fade-image"},{default:r.withCtx(()=>[!a.messageSelectionEnabled&&m.imageHover&&!s.isImageLoading?(r.openBlock(),r.createElementBlock("div",du,[r.createElementVNode("div",{class:"vac-svg-button vac-button-view",onClick:t[0]||(t[0]=L=>s.openFile(L,"preview"))},[r.renderSlot(e.$slots,"eye-icon",{},()=>[r.createVNode(N,{name:"eye"})])]),r.createElementVNode("div",{class:"vac-svg-button vac-button-download",onClick:t[1]||(t[1]=L=>s.openFile(L,"download"))},[r.renderSlot(e.$slots,"document-icon",{},()=>[r.createVNode(N,{name:"document"})])])])):r.createCommentVNode("",!0)]),_:3})],6)],544)):s.isVideo?(r.openBlock(),r.createElementBlock("div",{key:1,class:"vac-video-container",onClick:t[5]||(t[5]=r.withModifiers(L=>s.openFile("preview"),["prevent"]))},[a.file.progress>=0?(r.openBlock(),r.createBlock(R,{key:0,progress:a.file.progress},null,8,["progress"])):r.createCommentVNode("",!0),r.createElementVNode("video",mu,[r.createElementVNode("source",{src:a.file.url},null,8,hu)])])):r.createCommentVNode("",!0)])}var fu=Xe(lu,[["render",uu]]);const _u={name:"MessageFiles",components:{SvgIcon:bt,FormatMessage:Tr,ProgressBar:f0,MessageFile:fu},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},roomUsers:{type:Array,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file","open-user-tag"],computed:{imageVideoFiles(){return this.message.files.filter(e=>En(e))},otherFiles(){return this.message.files.filter(e=>!En(e))}},methods:{openFile(e,t,a){this.messageSelectionEnabled||(e.stopPropagation(),this.$emit("open-file",{file:t,action:a}))}}},pu={class:"vac-message-files-container"},vu=["onClick"],gu={class:"vac-svg-button"},bu={class:"vac-text-ellipsis"},yu={key:0,class:"vac-text-ellipsis vac-text-extension"};function xu(e,t,a,n,m,s){const R=r.resolveComponent("message-file"),E=r.resolveComponent("progress-bar"),N=r.resolveComponent("svg-icon"),L=r.resolveComponent("format-message");return r.openBlock(),r.createElementBlock("div",pu,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.imageVideoFiles,(k,f)=>(r.openBlock(),r.createElementBlock("div",{key:f+"iv"},[r.createVNode(R,{file:k,"current-user-id":a.currentUserId,message:a.message,index:f,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:t[0]||(t[0]=x=>e.$emit("open-file",x))},r.createSlots({_:2},[r.renderList(e.$slots,(x,y)=>({name:y,fn:r.withCtx(o=>[r.renderSlot(e.$slots,y,r.normalizeProps(r.guardReactiveProps(o)))])}))]),1032,["file","current-user-id","message","index","message-selection-enabled"])]))),128)),(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.otherFiles,(k,f)=>(r.openBlock(),r.createElementBlock("div",{key:f+"a",class:"vac-file-wrapper"},[k.progress>=0?(r.openBlock(),r.createBlock(E,{key:0,progress:k.progress,style:{top:"44px"}},null,8,["progress"])):r.createCommentVNode("",!0),r.createElementVNode("div",{class:r.normalizeClass(["vac-file-container",{"vac-file-container-progress":k.progress>=0}]),onClick:x=>s.openFile(x,k,"download")},[r.createElementVNode("div",gu,[r.renderSlot(e.$slots,"document-icon",{},()=>[r.createVNode(N,{name:"document"})])]),r.createElementVNode("div",bu,r.toDisplayString(k.name),1),k.extension?(r.openBlock(),r.createElementBlock("div",yu,r.toDisplayString(k.extension),1)):r.createCommentVNode("",!0)],10,vu)]))),128)),r.createVNode(L,{content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:t[1]||(t[1]=k=>e.$emit("open-user-tag",k))},r.createSlots({_:2},[r.renderList(e.$slots,(k,f)=>({name:f,fn:r.withCtx(x=>[r.renderSlot(e.$slots,f,r.normalizeProps(r.guardReactiveProps(x)))])}))]),1032,["content","users","text-formatting","link-options"])])}var wu=Xe(_u,[["render",xu]]);const Su={name:"MessageActions",components:{SvgIcon:bt,EmojiPickerContainer:bi},directives:{clickOutside:io},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},messageActions:{type:Array,required:!0},showReactionEmojis:{type:Boolean,required:!0},messageHover:{type:Boolean,required:!0},hoverMessageId:{type:[String,Number],default:null},hoverAudioProgress:{type:Boolean,required:!0}},emits:["update-emoji-opened","update-options-opened","update-message-hover","message-action-handler","send-message-reaction"],data(){return{menuOptionsTop:0,optionsOpened:!1,optionsClosing:!1,emojiOpened:!1}},computed:{isMessageActions(){return this.filteredMessageActions.length&&this.messageHover&&!this.message.deleted&&!this.message.disableActions&&!this.hoverAudioProgress},isMessageReactions(){return this.showReactionEmojis&&this.messageHover&&!this.message.deleted&&!this.message.disableReactions&&!this.hoverAudioProgress},filteredMessageActions(){return this.message.senderId===this.currentUserId?this.messageActions:this.messageActions.filter(e=>!e.onlyMe)}},watch:{emojiOpened(e){this.$emit("update-emoji-opened",e),e&&(this.optionsOpened=!1)},optionsOpened(e){this.$emit("update-options-opened",e)}},methods:{openOptions(){this.optionsClosing||(this.optionsOpened=!this.optionsOpened,this.optionsOpened&&setTimeout(()=>{const e=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer");if(!e||!this.$refs.menuOptions||!this.$refs.actionIcon)return;const t=this.$refs.menuOptions.getBoundingClientRect().height,a=this.$refs.actionIcon.getBoundingClientRect().top;e.getBoundingClientRect().top-a>t+50?this.menuOptionsTop=30:this.menuOptionsTop=-t}))},closeOptions(){this.optionsOpened=!1,this.optionsClosing=!0,this.updateMessageHover(),setTimeout(()=>this.optionsClosing=!1,100)},openEmoji(){this.emojiOpened=!this.emojiOpened},closeEmoji(){this.emojiOpened=!1,this.updateMessageHover()},updateMessageHover(){this.hoverMessageId!==this.message._id&&this.$emit("update-message-hover",!1)},messageActionHandler(e){this.closeOptions(),this.$emit("message-action-handler",e)},sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t}),this.closeEmoji()}}},ku={class:"vac-message-actions-wrapper"},Eu={key:"3"},Mu={class:"vac-menu-list"},Ru=["onClick"];function Au(e,t,a,n,m,s){const R=r.resolveComponent("svg-icon"),E=r.resolveComponent("emoji-picker-container"),N=r.resolveDirective("click-outside");return r.openBlock(),r.createElementBlock("div",ku,[r.createElementVNode("div",{class:"vac-options-container",style:r.normalizeStyle({display:a.hoverAudioProgress?"none":"initial",width:s.filteredMessageActions.length&&a.showReactionEmojis?"70px":"45px"})},[r.createVNode(r.TransitionGroup,{name:"vac-slide-left",tag:"span"},{default:r.withCtx(()=>[s.isMessageActions||s.isMessageReactions?(r.openBlock(),r.createElementBlock("div",{key:"1",class:r.normalizeClass(["vac-blur-container",{"vac-options-me":a.message.senderId===a.currentUserId}])},null,2)):r.createCommentVNode("",!0),s.isMessageActions?(r.openBlock(),r.createElementBlock("div",{ref:"actionIcon",key:"2",class:"vac-svg-button vac-message-options",onClick:t[0]||(t[0]=(...L)=>s.openOptions&&s.openOptions(...L))},[r.renderSlot(e.$slots,"dropdown-icon",{},()=>[r.createVNode(R,{name:"dropdown",param:"message"})])],512)):r.createCommentVNode("",!0),s.isMessageReactions?r.withDirectives((r.openBlock(),r.createElementBlock("div",Eu,[r.renderSlot(e.$slots,"emoji-picker",r.mergeProps({emojiOpened:m.emojiOpened},{addEmoji:s.sendMessageReaction}),()=>[r.createVNode(E,{class:"vac-message-emojis",style:r.normalizeStyle({right:s.isMessageActions?"30px":"5px"}),"emoji-opened":m.emojiOpened,"emoji-reaction":!0,"position-right":a.message.senderId===a.currentUserId,onAddEmoji:s.sendMessageReaction,onOpenEmoji:s.openEmoji},{"emoji-picker-icon":r.withCtx(()=>[r.renderSlot(e.$slots,"emoji-picker-reaction-icon")]),_:3},8,["style","emoji-opened","position-right","onAddEmoji","onOpenEmoji"])])])),[[N,s.closeEmoji]]):r.createCommentVNode("",!0)]),_:3})],4),s.filteredMessageActions.length?(r.openBlock(),r.createBlock(r.Transition,{key:0,name:a.message.senderId===a.currentUserId?"vac-slide-left":"vac-slide-right"},{default:r.withCtx(()=>[m.optionsOpened?r.withDirectives((r.openBlock(),r.createElementBlock("div",{key:0,ref:"menuOptions",class:r.normalizeClass(["vac-menu-options",{"vac-menu-left":a.message.senderId!==a.currentUserId}]),style:r.normalizeStyle({top:`${m.menuOptionsTop}px`})},[r.createElementVNode("div",Mu,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(s.filteredMessageActions,L=>(r.openBlock(),r.createElementBlock("div",{key:L.name},[r.createElementVNode("div",{class:"vac-menu-item",onClick:k=>s.messageActionHandler(L)},r.toDisplayString(L.title),9,Ru)]))),128))])],6)),[[N,s.closeOptions]]):r.createCommentVNode("",!0)]),_:1},8,["name"])):r.createCommentVNode("",!0)])}var Tu=Xe(Su,[["render",Au]]);const Bu={name:"MessageReactions",props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0}},emits:["send-message-reaction"],methods:{sendMessageReaction(e,t){this.$emit("send-message-reaction",{emoji:e,reaction:t})}}},Cu=["onClick"];function Ou(e,t,a,n,m,s){return a.message.deleted?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(r.TransitionGroup,{key:0,name:"vac-slide-left",tag:"span"},{default:r.withCtx(()=>[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.message.reactions,(R,E)=>r.withDirectives((r.openBlock(),r.createElementBlock("button",{key:E+0,class:r.normalizeClass(["vac-button-reaction",{"vac-reaction-me":R.indexOf(a.currentUserId)!==-1}]),style:r.normalizeStyle({float:a.message.senderId===a.currentUserId?"right":"left"}),onClick:N=>s.sendMessageReaction({unicode:E},R)},[r.createTextVNode(r.toDisplayString(E),1),r.createElementVNode("span",null,r.toDisplayString(R.length),1)],14,Cu)),[[r.vShow,R.length]])),128))]),_:1}))}var Nu=Xe(Bu,[["render",Ou]]);function Iu(e){if(!((n,m)=>m.every(s=>{let R=!1;return(s.type[0]==="array"&&Array.isArray(n[s.key])||s.type.find(E=>E===typeof n[s.key]))&&(R=!0),R&&Fs(n,s.key)}))(e,[{key:"roomId",type:["string","number"]},{key:"roomName",type:["string"]},{key:"users",type:["array"]}]))throw new Error("Rooms object is not valid! Must contain roomId[String, Number], roomName[String] and users[Array]")}function Lu(e){if(!((n,m)=>m.every(s=>s.type.find(E=>E===typeof n[s.key])&&Fs(n,s.key)))(e,[{key:"_id",type:["string","number"]},{key:"username",type:["string"]}]))throw new Error("Participants object is not valid! Must contain _id[String, Number] and username[String]")}function Vu(e){if(!((n,m)=>m.every(s=>s.type.find(E=>E===typeof n[s.key])&&Fs(n,s.key)))(e,[{key:"_id",type:["string","number"]},{key:"content",type:["string","number"]},{key:"senderId",type:["string","number"]}]))throw new Error("Messages object is not valid! Must contain _id[String, Number], content[String, Number] and senderId[String, Number]")}function Fs(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==null&&e[t]!==void 0}const ju={name:"RoomMessage",components:{SvgIcon:bt,FormatMessage:Tr,AudioPlayer:xs,MessageReply:eu,MessageFiles:wu,MessageActions:Tu,MessageReactions:Nu},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},index:{type:Number,required:!0},message:{type:Object,required:!0},messages:{type:Array,required:!0},editedMessageId:{type:[String,Number],default:null},roomUsers:{type:Array,default:()=>[]},messageActions:{type:Array,required:!0},newMessages:{type:Array,default:()=>[]},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},usernameOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},selectedMessages:{type:Array,default:()=>[]}},emits:["message-added","open-file","open-user-tag","open-failed-message","message-action-handler","send-message-reaction","select-message","unselect-message"],data(){return{hoverMessageId:null,messageHover:!1,optionsOpened:!1,emojiOpened:!1,newMessage:{},progressTime:"- : -",hoverAudioProgress:!1}},computed:{showUsername(){return!this.usernameOptions.currentUser&&this.message.senderId===this.currentUserId?!1:this.roomUsers.length>=this.usernameOptions.minUsers},showDate(){return this.index>0&&this.message.date!==this.messages[this.index-1].date},messageOffset(){return this.index>0&&this.message.senderId!==this.messages[this.index-1].senderId},isMessageHover(){return this.editedMessageId===this.message._id||this.hoverMessageId===this.message._id},isAudio(){var e;return(e=this.message.files)==null?void 0:e.some(t=>lo(t))},isCheckmarkVisible(){return this.message.senderId===this.currentUserId&&!this.message.deleted&&(this.message.saved||this.message.distributed||this.message.seen)},hasCurrentUserAvatar(){return this.messages.some(e=>e.senderId===this.currentUserId&&e.avatar)},hasSenderUserAvatar(){return this.messages.some(e=>e.senderId!==this.currentUserId&&e.avatar)},isMessageSelected(){return this.messageSelectionEnabled&&!!this.selectedMessages.find(e=>e._id===this.message._id)}},watch:{newMessages:{immediate:!0,deep:!0,handler(e){if(!e.length||!this.showNewMessagesDivider){this.newMessage={};return}this.newMessage=e.reduce((t,a)=>a.index<t.index?a:t)}},messageSelectionEnabled(){this.resetMessageHover()}},mounted(){Vu(this.message),this.$emit("message-added",{message:this.message,index:this.index,ref:this.$refs.message})},methods:{onHoverMessage(){this.messageSelectionEnabled||(this.messageHover=!0,this.canEditMessage()&&(this.hoverMessageId=this.message._id))},canEditMessage(){return!this.message.deleted},onLeaveMessage(){this.messageSelectionEnabled||(!this.optionsOpened&&!this.emojiOpened&&(this.messageHover=!1),this.hoverMessageId=null)},resetMessageHover(){this.messageHover=!1,this.hoverMessageId=null},openFile(e){this.$emit("open-file",{message:this.message,file:e})},openUserTag(e){this.$emit("open-user-tag",{user:e})},messageActionHandler(e){this.resetMessageHover(),setTimeout(()=>{this.$emit("message-action-handler",{action:e,message:this.message})},300)},sendMessageReaction({emoji:e,reaction:t}){this.$emit("send-message-reaction",{messageId:this.message._id,reaction:e,remove:t&&t.indexOf(this.currentUserId)!==-1}),this.messageHover=!1},selectMessage(){this.messageSelectionEnabled&&(this.isMessageSelected?this.$emit("unselect-message",this.message._id):this.$emit("select-message",this.message))}}},Hu=["id"],Pu={key:0,class:"vac-card-info vac-card-date"},Fu={key:1,class:"vac-line-new"},Du={key:2,class:"vac-card-info vac-card-system"},Uu={key:1,class:"vac-avatar-offset"},zu={key:2},qu={key:0,class:"vac-progress-time"},Xu={class:"vac-text-timestamp"},Yu={key:0,class:"vac-icon-edited"},Gu={key:1},Ku=[r.createElementVNode("div",{class:"vac-failure-text"}," ! ",-1)],Zu={key:3,class:"vac-avatar-current-offset"};function Wu(e,t,a,n,m,s){const R=r.resolveComponent("format-message"),E=r.resolveComponent("message-reply"),N=r.resolveComponent("svg-icon"),L=r.resolveComponent("message-files"),k=r.resolveComponent("audio-player"),f=r.resolveComponent("message-actions"),x=r.resolveComponent("message-reactions");return r.openBlock(),r.createElementBlock("div",{id:a.message._id,ref:"message",class:"vac-message-wrapper"},[s.showDate?(r.openBlock(),r.createElementBlock("div",Pu,r.toDisplayString(a.message.date),1)):r.createCommentVNode("",!0),m.newMessage._id===a.message._id?(r.openBlock(),r.createElementBlock("div",Fu,r.toDisplayString(a.textMessages.NEW_MESSAGES),1)):r.createCommentVNode("",!0),a.message.system?(r.openBlock(),r.createElementBlock("div",Du,[r.renderSlot(e.$slots,"system-message",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[r.createVNode(R,{content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:s.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(y,o)=>({name:o,fn:r.withCtx(S=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(S)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])])])):(r.openBlock(),r.createElementBlock("div",{key:3,class:r.normalizeClass(["vac-message-box",{"vac-offset-current":a.message.senderId===a.currentUserId}]),onClick:t[8]||(t[8]=(...y)=>s.selectMessage&&s.selectMessage(...y))},[r.renderSlot(e.$slots,"message",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[a.message.avatar&&a.message.senderId!==a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-avatar",style:r.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):r.createCommentVNode("",!0),s.hasSenderUserAvatar&&!a.message.avatar?(r.openBlock(),r.createElementBlock("div",Uu)):r.createCommentVNode("",!0),r.createElementVNode("div",{class:r.normalizeClass(["vac-message-container",{"vac-message-container-offset":s.messageOffset}])},[r.createElementVNode("div",{class:r.normalizeClass(["vac-message-card",{"vac-message-highlight":s.isMessageHover,"vac-message-current":a.message.senderId===a.currentUserId,"vac-message-deleted":a.message.deleted,"vac-item-clickable":a.messageSelectionEnabled,"vac-message-selected":s.isMessageSelected}]),onMouseover:t[5]||(t[5]=(...y)=>s.onHoverMessage&&s.onHoverMessage(...y)),onMouseleave:t[6]||(t[6]=(...y)=>s.onLeaveMessage&&s.onLeaveMessage(...y))},[s.showUsername?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-text-username",{"vac-username-reply":!a.message.deleted&&a.message.replyMessage}])},[r.createElementVNode("span",null,r.toDisplayString(a.message.username),1)],2)):r.createCommentVNode("",!0),!a.message.deleted&&a.message.replyMessage?(r.openBlock(),r.createBlock(E,{key:1,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions},r.createSlots({_:2},[r.renderList(e.$slots,(y,o)=>({name:o,fn:r.withCtx(S=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(S)))])}))]),1032,["message","room-users","text-formatting","link-options"])):r.createCommentVNode("",!0),a.message.deleted?(r.openBlock(),r.createElementBlock("div",zu,[r.renderSlot(e.$slots,"deleted-icon",{},()=>[r.createVNode(N,{name:"deleted",class:"vac-icon-deleted"})]),r.createElementVNode("span",null,r.toDisplayString(a.textMessages.MESSAGE_DELETED),1)])):!a.message.files||!a.message.files.length?(r.openBlock(),r.createBlock(R,{key:3,content:a.message.content,users:a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,onOpenUserTag:s.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(y,o)=>({name:o,fn:r.withCtx(S=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(S)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])):!s.isAudio||a.message.files.length>1?(r.openBlock(),r.createBlock(L,{key:4,"current-user-id":a.currentUserId,message:a.message,"room-users":a.roomUsers,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"message-selection-enabled":a.messageSelectionEnabled,onOpenFile:s.openFile,onOpenUserTag:s.openUserTag},r.createSlots({_:2},[r.renderList(e.$slots,(y,o)=>({name:o,fn:r.withCtx(S=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(S)))])}))]),1032,["current-user-id","message","room-users","text-formatting","link-options","message-selection-enabled","onOpenFile","onOpenUserTag"])):(r.openBlock(),r.createElementBlock(r.Fragment,{key:5},[r.createVNode(k,{"message-id":a.message._id,src:a.message.files[0].url,"message-selection-enabled":a.messageSelectionEnabled,onUpdateProgressTime:t[0]||(t[0]=y=>m.progressTime=y),onHoverAudioProgress:t[1]||(t[1]=y=>m.hoverAudioProgress=y)},r.createSlots({_:2},[r.renderList(e.$slots,(y,o)=>({name:o,fn:r.withCtx(S=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(S)))])}))]),1032,["message-id","src","message-selection-enabled"]),a.message.deleted?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",qu,r.toDisplayString(m.progressTime),1))],64)),r.createElementVNode("div",Xu,[a.message.edited&&!a.message.deleted?(r.openBlock(),r.createElementBlock("div",Yu,[r.renderSlot(e.$slots,"pencil-icon",{},()=>[r.createVNode(N,{name:"pencil"})])])):r.createCommentVNode("",!0),r.createElementVNode("span",null,r.toDisplayString(a.message.timestamp),1),s.isCheckmarkVisible?(r.openBlock(),r.createElementBlock("span",Gu,[r.renderSlot(e.$slots,"checkmark-icon",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[r.createVNode(N,{name:a.message.distributed?"double-checkmark":"checkmark",param:a.message.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):r.createCommentVNode("",!0)]),r.createVNode(f,{"current-user-id":a.currentUserId,message:a.message,"message-actions":a.messageActions,"show-reaction-emojis":a.showReactionEmojis,"message-hover":m.messageHover,"hover-message-id":m.hoverMessageId,"hover-audio-progress":m.hoverAudioProgress,onUpdateMessageHover:t[2]||(t[2]=y=>m.messageHover=y),onUpdateOptionsOpened:t[3]||(t[3]=y=>m.optionsOpened=y),onUpdateEmojiOpened:t[4]||(t[4]=y=>m.emojiOpened=y),onMessageActionHandler:s.messageActionHandler,onSendMessageReaction:s.sendMessageReaction},r.createSlots({_:2},[r.renderList(e.$slots,(y,o)=>({name:o,fn:r.withCtx(S=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(S)))])}))]),1032,["current-user-id","message","message-actions","show-reaction-emojis","message-hover","hover-message-id","hover-audio-progress","onMessageActionHandler","onSendMessageReaction"])],34),r.createVNode(x,{"current-user-id":a.currentUserId,message:a.message,onSendMessageReaction:s.sendMessageReaction},null,8,["current-user-id","message","onSendMessageReaction"])],2),r.renderSlot(e.$slots,"message-failure",r.normalizeProps(r.guardReactiveProps({message:a.message})),()=>[a.message.failure&&a.message.senderId===a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:0,class:r.normalizeClass(["vac-failure-container vac-svg-button",{"vac-failure-container-avatar":a.message.avatar&&a.message.senderId===a.currentUserId}]),onClick:t[7]||(t[7]=y=>e.$emit("open-failed-message",{message:a.message}))},Ku,2)):r.createCommentVNode("",!0)]),a.message.avatar&&a.message.senderId===a.currentUserId?(r.openBlock(),r.createElementBlock("div",{key:2,class:"vac-avatar vac-avatar-current",style:r.normalizeStyle({"background-image":`url('${a.message.avatar}')`})},null,4)):r.createCommentVNode("",!0),s.hasCurrentUserAvatar&&!a.message.avatar?(r.openBlock(),r.createElementBlock("div",Zu)):r.createCommentVNode("",!0)])],2))],8,Hu)}var Qu=Xe(ju,[["render",Wu]]);const $u={name:"ChatRoom",components:{Loader:Qr,SvgIcon:bt,RoomHeader:Xc,RoomFooter:Dh,RoomMessage:Qu},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},roomId:{type:[String,Number],required:!0},loadFirstRoom:{type:Boolean,required:!0},messages:{type:Array,required:!0},roomMessage:{type:String,default:null},messagesLoaded:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},messageActions:{type:Array,required:!0},messageSelectionActions:{type:Array,required:!0},autoScroll:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},showEmojis:{type:Boolean,required:!0},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},loadingRooms:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},scrollDistance:{type:Number,required:!0},templatesText:{type:Array,default:null},usernameOptions:{type:Object,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","message-selection-action-handler","edit-message","send-message","delete-message","message-action-handler","fetch-messages","send-message-reaction","typing-message","open-file","open-user-tag","open-failed-message","textarea-action-handler"],data(){return{editedMessageId:null,initReplyMessage:null,initEditMessage:null,infiniteState:null,loadingMessages:!1,observer:null,showLoader:!0,loadingMoreMessages:!1,scrollIcon:!1,scrollMessagesCount:0,newMessages:[],messageSelectionEnabled:!1,selectedMessages:[]}},computed:{room(){return this.rooms.find(e=>e.roomId===this.roomId)||{}},showNoMessages(){return this.roomId&&!this.messages.length&&!this.loadingMessages&&!this.loadingRooms},showNoRoom(){const e=!this.rooms.length&&!this.loadingRooms||!this.roomId&&!this.loadFirstRoom;return e&&this.updateLoadingMessages(!1),e},showMessagesStarted(){return this.messages.length&&this.messagesLoaded}},watch:{roomId(){this.onRoomChanged()},messages:{deep:!0,handler(e,t){e.forEach((a,n)=>{this.showNewMessagesDivider&&!a.seen&&a.senderId!==this.currentUserId&&this.newMessages.push({_id:a._id,index:n})}),(t==null?void 0:t.length)===(e==null?void 0:e.length)-1&&(this.newMessages=[]),this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.loadingMoreMessages=!1)}},messagesLoaded(e){e&&this.updateLoadingMessages(!1),this.infiniteState&&this.infiniteState.complete()}},mounted(){this.newMessages=[]},methods:{updateLoadingMessages(e){this.loadingMessages=e,e?this.infiniteState=null:(this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.initIntersectionObserver()))},initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const e=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("infinite-loader-messages");if(e){const t={root:document.querySelector("vue-advanced-chat").shadowRoot.getElementById("messages-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(a=>{a[0].isIntersecting&&this.loadMoreMessages()},t),this.observer.observe(e)}},preventTopScroll(){const e=this.$refs.scrollContainer,t=e.scrollHeight,a=new ResizeObserver(m=>{e.scrollHeight!==t&&this.$refs.scrollContainer&&(this.$refs.scrollContainer.scrollTo({top:e.scrollHeight-t}),a.disconnect())});for(var n=0;n<e.children.length;n++)a.observe(e.children[n])},touchStart(e){if(!this.singleRoom&&e.changedTouches.length===1){const t=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY;addEventListener("touchend",n=>this.touchEnd(n,t,a),{once:!0})}},touchEnd(e,t,a){if(e.changedTouches.length===1){const n=e.changedTouches[0].clientX,m=e.changedTouches[0].clientY,s=n-t>100,R=Math.abs(m-a)>50;s&&!R&&this.$emit("toggle-rooms-list")}},onRoomChanged(){this.updateLoadingMessages(!0),this.scrollIcon=!1,this.scrollMessagesCount=0,this.resetMessageSelection();const e=this.$watch(()=>this.messages,t=>{if(!t||!t.length)return;const a=this.$refs.scrollContainer;!a||(e(),setTimeout(()=>{a.scrollTo({top:a.scrollHeight}),this.updateLoadingMessages(!1)}))})},resetMessageSelection(){this.messageSelectionEnabled=!1,this.selectedMessages=[]},selectMessage(e){this.selectedMessages.push(e)},unselectMessage(e){this.selectedMessages=this.selectedMessages.filter(t=>t._id!==e)},onMessageAdded({message:e,index:t,ref:a}){if(t!==this.messages.length-1)return;const n=a.offsetHeight+60;setTimeout(()=>{const m=this.getBottomScroll(this.$refs.scrollContainer)>n;e.senderId===this.currentUserId?m?this.autoScroll.send.newAfterScrollUp&&this.scrollToBottom():this.autoScroll.send.new&&this.scrollToBottom():m?this.autoScroll.receive.newAfterScrollUp?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++):this.autoScroll.receive.new?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++)})},onContainerScroll(e){if(!e.target)return;const t=this.getBottomScroll(e.target);t<60&&(this.scrollMessagesCount=0),this.scrollIcon=t>500||this.scrollMessagesCount},loadMoreMessages(){this.loadingMessages||setTimeout(()=>{if(!this.loadingMoreMessages){if(this.messagesLoaded||!this.roomId){this.loadingMoreMessages=!1,this.showLoader=!1;return}this.preventTopScroll(),this.$emit("fetch-messages"),this.loadingMoreMessages=!0}},500)},messageActionHandler({action:e,message:t}){switch(e.name){case"replyMessage":this.initReplyMessage=t;return;case"editMessage":this.initEditMessage=t;return;case"deleteMessage":return this.$emit("delete-message",t);case"selectMessages":this.selectedMessages=[t],this.messageSelectionEnabled=!0;return;default:return this.$emit("message-action-handler",{action:e,message:t})}},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{action:e,messages:this.selectedMessages}),this.resetMessageSelection()},sendMessageReaction(e){this.$emit("send-message-reaction",e)},getBottomScroll(e){const{scrollHeight:t,clientHeight:a,scrollTop:n}=e;return t-a-n},scrollToBottom(){setTimeout(()=>{const e=this.$refs.scrollContainer;e.classList.add("vac-scroll-smooth"),e.scrollTo({top:e.scrollHeight,behavior:"smooth"}),setTimeout(()=>e.classList.remove("vac-scroll-smooth"))},50)},openFile({message:e,file:t}){this.$emit("open-file",{message:e,file:t})},openUserTag(e){this.$emit("open-user-tag",e)}}},Ju={class:"vac-container-center vac-room-empty"},ef={class:"vac-messages-container"},tf={key:0,class:"vac-text-started"},af={key:1,class:"vac-text-started"},rf={key:0,id:"infinite-loader-messages"},of={key:2},sf={key:0,class:"vac-badge-counter vac-messages-count"};function nf(e,t,a,n,m,s){const R=r.resolveComponent("room-header"),E=r.resolveComponent("loader"),N=r.resolveComponent("room-message"),L=r.resolveComponent("svg-icon"),k=r.resolveComponent("room-footer");return r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:"vac-col-messages",onTouchstart:t[12]||(t[12]=(...f)=>s.touchStart&&s.touchStart(...f))},[s.showNoRoom?r.renderSlot(e.$slots,"no-room-selected",{key:0},()=>[r.createElementVNode("div",Ju,[r.createElementVNode("div",null,r.toDisplayString(a.textMessages.ROOM_EMPTY),1)])]):(r.openBlock(),r.createBlock(R,{key:1,"current-user-id":a.currentUserId,"text-messages":a.textMessages,"single-room":a.singleRoom,"show-rooms-list":a.showRoomsList,"is-mobile":a.isMobile,"room-info-enabled":a.roomInfoEnabled,"menu-actions":a.menuActions,room:s.room,"message-selection-enabled":m.messageSelectionEnabled,"message-selection-actions":a.messageSelectionActions,"selected-messages-total":m.selectedMessages.length,onToggleRoomsList:t[0]||(t[0]=f=>e.$emit("toggle-rooms-list")),onRoomInfo:t[1]||(t[1]=f=>e.$emit("room-info")),onMenuActionHandler:t[2]||(t[2]=f=>e.$emit("menu-action-handler",f)),onMessageSelectionActionHandler:s.messageSelectionActionHandler,onCancelMessageSelection:t[3]||(t[3]=f=>m.messageSelectionEnabled=!1)},r.createSlots({_:2},[r.renderList(e.$slots,(f,x)=>({name:x,fn:r.withCtx(y=>[r.renderSlot(e.$slots,x,r.normalizeProps(r.guardReactiveProps(y)))])}))]),1032,["current-user-id","text-messages","single-room","show-rooms-list","is-mobile","room-info-enabled","menu-actions","room","message-selection-enabled","message-selection-actions","selected-messages-total","onMessageSelectionActionHandler"])),r.createElementVNode("div",{id:"messages-list",ref:"scrollContainer",class:"vac-container-scroll",onScroll:t[5]||(t[5]=(...f)=>s.onContainerScroll&&s.onContainerScroll(...f))},[r.createVNode(E,{show:m.loadingMessages},r.createSlots({_:2},[r.renderList(e.$slots,(f,x)=>({name:x,fn:r.withCtx(y=>[r.renderSlot(e.$slots,x,r.normalizeProps(r.guardReactiveProps(y)))])}))]),1032,["show"]),r.createElementVNode("div",ef,[r.createElementVNode("div",{class:r.normalizeClass({"vac-messages-hidden":m.loadingMessages})},[r.createVNode(r.Transition,{name:"vac-fade-message"},{default:r.withCtx(()=>[r.createElementVNode("div",null,[s.showNoMessages?(r.openBlock(),r.createElementBlock("div",tf,[r.renderSlot(e.$slots,"messages-empty",{},()=>[r.createTextVNode(r.toDisplayString(a.textMessages.MESSAGES_EMPTY),1)])])):r.createCommentVNode("",!0),s.showMessagesStarted?(r.openBlock(),r.createElementBlock("div",af,r.toDisplayString(a.textMessages.CONVERSATION_STARTED)+" "+r.toDisplayString(a.messages[0].date),1)):r.createCommentVNode("",!0)])]),_:3}),a.messages.length&&!a.messagesLoaded?(r.openBlock(),r.createElementBlock("div",rf,[r.createVNode(E,{show:!0,infinite:!0},r.createSlots({_:2},[r.renderList(e.$slots,(f,x)=>({name:x,fn:r.withCtx(y=>[r.renderSlot(e.$slots,x,r.normalizeProps(r.guardReactiveProps(y)))])}))]),1024)])):r.createCommentVNode("",!0),(r.openBlock(),r.createBlock(r.TransitionGroup,{key:a.roomId,name:"vac-fade-message",tag:"span"},{default:r.withCtx(()=>[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(a.messages,(f,x)=>(r.openBlock(),r.createElementBlock("div",{key:f.indexId||f._id},[r.createVNode(N,{"current-user-id":a.currentUserId,message:f,index:x,messages:a.messages,"edited-message-id":m.editedMessageId,"message-actions":a.messageActions,"room-users":s.room.users,"text-messages":a.textMessages,"new-messages":m.newMessages,"show-reaction-emojis":a.showReactionEmojis,"show-new-messages-divider":a.showNewMessagesDivider,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"username-options":a.usernameOptions,"message-selection-enabled":m.messageSelectionEnabled,"selected-messages":m.selectedMessages,onMessageAdded:s.onMessageAdded,onMessageActionHandler:s.messageActionHandler,onOpenFile:s.openFile,onOpenUserTag:s.openUserTag,onOpenFailedMessage:t[4]||(t[4]=y=>e.$emit("open-failed-message",y)),onSendMessageReaction:s.sendMessageReaction,onSelectMessage:s.selectMessage,onUnselectMessage:s.unselectMessage},r.createSlots({_:2},[r.renderList(e.$slots,(y,o)=>({name:o,fn:r.withCtx(S=>[r.renderSlot(e.$slots,o,r.normalizeProps(r.guardReactiveProps(S)))])}))]),1032,["current-user-id","message","index","messages","edited-message-id","message-actions","room-users","text-messages","new-messages","show-reaction-emojis","show-new-messages-divider","text-formatting","link-options","username-options","message-selection-enabled","selected-messages","onMessageAdded","onMessageActionHandler","onOpenFile","onOpenUserTag","onSendMessageReaction","onSelectMessage","onUnselectMessage"])]))),128))]),_:3}))],2)])],544),m.loadingMessages?r.createCommentVNode("",!0):(r.openBlock(),r.createElementBlock("div",of,[r.createVNode(r.Transition,{name:"vac-bounce"},{default:r.withCtx(()=>[m.scrollIcon?(r.openBlock(),r.createElementBlock("div",{key:0,class:"vac-icon-scroll",onClick:t[6]||(t[6]=(...f)=>s.scrollToBottom&&s.scrollToBottom(...f))},[r.createVNode(r.Transition,{name:"vac-bounce"},{default:r.withCtx(()=>[m.scrollMessagesCount?(r.openBlock(),r.createElementBlock("div",sf,r.toDisplayString(m.scrollMessagesCount),1)):r.createCommentVNode("",!0)]),_:1}),r.renderSlot(e.$slots,"scroll-icon",{},()=>[r.createVNode(L,{name:"dropdown",param:"scroll"})])])):r.createCommentVNode("",!0)]),_:3})])),r.createVNode(k,{room:s.room,"room-id":a.roomId,"room-message":a.roomMessage,"text-messages":a.textMessages,"show-send-icon":a.showSendIcon,"show-files":a.showFiles,"show-audio":a.showAudio,"show-emojis":a.showEmojis,"show-footer":a.showFooter,"accepted-files":a.acceptedFiles,"textarea-action-enabled":a.textareaActionEnabled,"textarea-auto-focus":a.textareaAutoFocus,"user-tags-enabled":a.userTagsEnabled,"emojis-suggestion-enabled":a.emojisSuggestionEnabled,"templates-text":a.templatesText,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"init-reply-message":m.initReplyMessage,"init-edit-message":m.initEditMessage,onUpdateEditedMessageId:t[7]||(t[7]=f=>m.editedMessageId=f),onEditMessage:t[8]||(t[8]=f=>e.$emit("edit-message",f)),onSendMessage:t[9]||(t[9]=f=>e.$emit("send-message",f)),onTypingMessage:t[10]||(t[10]=f=>e.$emit("typing-message",f)),onTextareaActionHandler:t[11]||(t[11]=f=>e.$emit("textarea-action-handler",f))},r.createSlots({_:2},[r.renderList(e.$slots,(f,x)=>({name:x,fn:r.withCtx(y=>[r.renderSlot(e.$slots,x,r.normalizeProps(r.guardReactiveProps(y)))])}))]),1032,["room","room-id","room-message","text-messages","show-send-icon","show-files","show-audio","show-emojis","show-footer","accepted-files","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","templates-text","text-formatting","link-options","audio-bit-rate","audio-sample-rate","init-reply-message","init-edit-message"])],544)),[[r.vShow,a.isMobile&&!a.showRoomsList||!a.isMobile||a.singleRoom]])}var lf=Xe($u,[["render",nf]]);const cf={name:"MediaPreview",components:{SvgIcon:bt},props:{file:{type:Object,required:!0}},emits:["close-media-preview"],computed:{isImage(){return Ja(this.file)},isVideo(){return Cr(this.file)}},mounted(){this.$refs.modal.focus()},methods:{closeModal(){this.$emit("close-media-preview")}}},df={key:0,class:"vac-media-preview-container"},mf={key:1,class:"vac-media-preview-container"},hf={width:"100%",height:"100%",controls:"",autoplay:""},uf=["src"],ff={class:"vac-svg-button"};function _f(e,t,a,n,m,s){const R=r.resolveComponent("svg-icon");return r.openBlock(),r.createElementBlock("div",{ref:"modal",tabindex:"0",class:"vac-media-preview",onClick:t[0]||(t[0]=r.withModifiers((...E)=>s.closeModal&&s.closeModal(...E),["stop"])),onKeydown:t[1]||(t[1]=r.withKeys((...E)=>s.closeModal&&s.closeModal(...E),["esc"]))},[r.createVNode(r.Transition,{name:"vac-bounce-preview",appear:""},{default:r.withCtx(()=>[s.isImage?(r.openBlock(),r.createElementBlock("div",df,[r.createElementVNode("div",{class:"vac-image-preview",style:r.normalizeStyle({"background-image":`url('${a.file.url}')`})},null,4)])):s.isVideo?(r.openBlock(),r.createElementBlock("div",mf,[r.createElementVNode("video",hf,[r.createElementVNode("source",{src:a.file.url},null,8,uf)])])):r.createCommentVNode("",!0)]),_:1}),r.createElementVNode("div",ff,[r.renderSlot(e.$slots,"preview-close-icon",{},()=>[r.createVNode(R,{name:"close-outline",param:"preview"})])])],544)}var pf=Xe(cf,[["render",_f]]),vf={ROOMS_EMPTY:"No rooms",ROOM_EMPTY:"No room selected",NEW_MESSAGES:"New Messages",MESSAGE_DELETED:"This message was deleted",MESSAGES_EMPTY:"No messages",CONVERSATION_STARTED:"Conversation started on:",TYPE_MESSAGE:"Type message",SEARCH:"Search",IS_ONLINE:"is online",LAST_SEEN:"last seen ",IS_TYPING:"is writing...",CANCEL_SELECT_MESSAGE:"Cancel"};const gf={light:{general:{color:"#0a0a0a",colorButtonClear:"#1976d2",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#fff",colorPlaceholder:"#9ca6af",colorCaret:"#1976d2",colorSpinner:"#333",borderStyle:"1px solid #e1e4e8",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#fff",colorRoomName:"#0a0a0a",colorRoomInfo:"#9ca6af"},footer:{background:"#f8f9fa",borderStyleInput:"1px solid #e1e4e8",borderInputSelected:"#1976d2",backgroundReply:"#e5e5e6",backgroundTagActive:"#e5e5e6",backgroundTag:"#f8f9fa"},content:{background:"#f8f9fa"},sidemenu:{background:"#fff",backgroundHover:"#f6f6f6",backgroundActive:"#e5effa",colorActive:"#1976d2",borderColorSearch:"#e1e5e8"},dropdown:{background:"#fff",backgroundHover:"#f6f6f6"},message:{background:"#fff",backgroundMe:"#ccf2cf",color:"#0a0a0a",colorStarted:"#9ca6af",backgroundDeleted:"#dadfe2",backgroundSelected:"#c2dcf2",colorDeleted:"#757e85",colorUsername:"#9ca6af",colorTimestamp:"#828c94",backgroundDate:"#e5effa",colorDate:"#505a62",backgroundSystem:"#e5effa",colorSystem:"#505a62",backgroundMedia:"rgba(0, 0, 0, 0.15)",backgroundReply:"rgba(0, 0, 0, 0.08)",colorReplyUsername:"#0a0a0a",colorReply:"#6e6e6e",colorTag:"#0d579c",backgroundImage:"#ddd",colorNewMessages:"#1976d2",backgroundScrollCounter:"#0696c7",colorScrollCounter:"#fff",backgroundReaction:"#eee",borderStyleReaction:"1px solid #eee",backgroundReactionHover:"#fff",borderStyleReactionHover:"1px solid #ddd",colorReactionCounter:"#0a0a0a",backgroundReactionMe:"#cfecf5",borderStyleReactionMe:"1px solid #3b98b8",backgroundReactionHoverMe:"#cfecf5",borderStyleReactionHoverMe:"1px solid #3b98b8",colorReactionCounterMe:"#0b59b3",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(0, 0, 0, 0.15)",backgroundAudioProgress:"#455247",backgroundAudioProgressSelector:"#455247",colorFileExtension:"#757e85"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#0a0a0a",colorMessage:"#67717a",colorTimestamp:"#a2aeb8",colorStateOnline:"#4caf50",colorStateOffline:"#9ca6af",backgroundCounterBadge:"#0696c7",colorCounterBadge:"#fff"},emoji:{background:"#fff"},icons:{search:"#9ca6af",add:"#1976d2",toggle:"#0a0a0a",menu:"#0a0a0a",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#1976d2",closeOutline:"#000",closePreview:"#fff",send:"#1976d2",sendDisabled:"#9ca6af",emoji:"#1976d2",emojiReaction:"rgba(0, 0, 0, 0.3)",document:"#1976d2",pencil:"#9e9e9e",checkmark:"#9e9e9e",checkmarkSeen:"#0696c7",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#9e9e9e",dropdownScroll:"#0a0a0a",microphone:"#1976d2",audioPlay:"#455247",audioPause:"#455247",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}},dark:{general:{color:"#fff",colorButtonClear:"#fff",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#202223",colorPlaceholder:"#596269",colorCaret:"#fff",colorSpinner:"#fff",borderStyle:"none",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#181a1b",colorRoomName:"#fff",colorRoomInfo:"#9ca6af"},footer:{background:"#131415",borderStyleInput:"none",borderInputSelected:"#1976d2",backgroundReply:"#1b1c1c",backgroundTagActive:"#1b1c1c",backgroundTag:"#131415"},content:{background:"#131415"},sidemenu:{background:"#181a1b",backgroundHover:"#202224",backgroundActive:"#151617",colorActive:"#fff",borderColorSearch:"#181a1b"},dropdown:{background:"#2a2c33",backgroundHover:"#26282e"},message:{background:"#22242a",backgroundMe:"#1f7e80",color:"#fff",colorStarted:"#9ca6af",backgroundDeleted:"#1b1c21",backgroundSelected:"#c2dcf2",colorDeleted:"#a2a5a8",colorUsername:"#b3bac9",colorTimestamp:"#ebedf2",backgroundDate:"rgba(0, 0, 0, 0.3)",colorDate:"#bec5cc",backgroundSystem:"rgba(0, 0, 0, 0.3)",colorSystem:"#bec5cc",backgroundMedia:"rgba(0, 0, 0, 0.18)",backgroundReply:"rgba(0, 0, 0, 0.18)",colorReplyUsername:"#fff",colorReply:"#d6d6d6",colorTag:"#f0c60a",backgroundImage:"#ddd",colorNewMessages:"#fff",backgroundScrollCounter:"#1976d2",colorScrollCounter:"#fff",backgroundReaction:"none",borderStyleReaction:"none",backgroundReactionHover:"#202223",borderStyleReactionHover:"none",colorReactionCounter:"#fff",backgroundReactionMe:"#4e9ad1",borderStyleReactionMe:"none",backgroundReactionHoverMe:"#4e9ad1",borderStyleReactionHoverMe:"none",colorReactionCounterMe:"#fff",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(255, 255, 255, 0.15)",backgroundAudioProgress:"#b7d4d3",backgroundAudioProgressSelector:"#b7d4d3",colorFileExtension:"#a2a5a8"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#fff",colorMessage:"#6c7278",colorTimestamp:"#6c7278",colorStateOnline:"#4caf50",colorStateOffline:"#596269",backgroundCounterBadge:"#1976d2",colorCounterBadge:"#fff"},emoji:{background:"#343740"},icons:{search:"#596269",add:"#fff",toggle:"#fff",menu:"#fff",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#fff",closeOutline:"#fff",closePreview:"#fff",send:"#fff",sendDisabled:"#646a70",emoji:"#fff",emojiReaction:"#fff",document:"#1976d2",pencil:"#ebedf2",checkmark:"#ebedf2",checkmarkSeen:"#f0d90a",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#fff",dropdownScroll:"#0a0a0a",microphone:"#fff",audioPlay:"#b7d4d3",audioPause:"#b7d4d3",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}}},bf=({general:e,container:t,header:a,footer:n,sidemenu:m,content:s,dropdown:R,message:E,markdown:N,room:L,emoji:k,icons:f})=>({"--chat-color":e.color,"--chat-color-button-clear":e.colorButtonClear,"--chat-color-button":e.colorButton,"--chat-bg-color-button":e.backgroundColorButton,"--chat-bg-color-input":e.backgroundInput,"--chat-color-spinner":e.colorSpinner,"--chat-color-placeholder":e.colorPlaceholder,"--chat-color-caret":e.colorCaret,"--chat-border-style":e.borderStyle,"--chat-bg-scroll-icon":e.backgroundScrollIcon,"--chat-container-border":t.border,"--chat-container-border-radius":t.borderRadius,"--chat-container-box-shadow":t.boxShadow,"--chat-header-bg-color":a.background,"--chat-header-color-name":a.colorRoomName,"--chat-header-color-info":a.colorRoomInfo,"--chat-footer-bg-color":n.background,"--chat-border-style-input":n.borderStyleInput,"--chat-border-color-input-selected":n.borderInputSelected,"--chat-footer-bg-color-reply":n.backgroundReply,"--chat-footer-bg-color-tag-active":n.backgroundTagActive,"--chat-footer-bg-color-tag":n.backgroundTag,"--chat-content-bg-color":s.background,"--chat-sidemenu-bg-color":m.background,"--chat-sidemenu-bg-color-hover":m.backgroundHover,"--chat-sidemenu-bg-color-active":m.backgroundActive,"--chat-sidemenu-color-active":m.colorActive,"--chat-sidemenu-border-color-search":m.borderColorSearch,"--chat-dropdown-bg-color":R.background,"--chat-dropdown-bg-color-hover":R.backgroundHover,"--chat-message-bg-color":E.background,"--chat-message-bg-color-me":E.backgroundMe,"--chat-message-color-started":E.colorStarted,"--chat-message-bg-color-deleted":E.backgroundDeleted,"--chat-message-bg-color-selected":E.backgroundSelected,"--chat-message-color-deleted":E.colorDeleted,"--chat-message-color-username":E.colorUsername,"--chat-message-color-timestamp":E.colorTimestamp,"--chat-message-bg-color-date":E.backgroundDate,"--chat-message-color-date":E.colorDate,"--chat-message-bg-color-system":E.backgroundSystem,"--chat-message-color-system":E.colorSystem,"--chat-message-color":E.color,"--chat-message-bg-color-media":E.backgroundMedia,"--chat-message-bg-color-reply":E.backgroundReply,"--chat-message-color-reply-username":E.colorReplyUsername,"--chat-message-color-reply-content":E.colorReply,"--chat-message-color-tag":E.colorTag,"--chat-message-bg-color-image":E.backgroundImage,"--chat-message-color-new-messages":E.colorNewMessages,"--chat-message-bg-color-scroll-counter":E.backgroundScrollCounter,"--chat-message-color-scroll-counter":E.colorScrollCounter,"--chat-message-bg-color-reaction":E.backgroundReaction,"--chat-message-border-style-reaction":E.borderStyleReaction,"--chat-message-bg-color-reaction-hover":E.backgroundReactionHover,"--chat-message-border-style-reaction-hover":E.borderStyleReactionHover,"--chat-message-color-reaction-counter":E.colorReactionCounter,"--chat-message-bg-color-reaction-me":E.backgroundReactionMe,"--chat-message-border-style-reaction-me":E.borderStyleReactionMe,"--chat-message-bg-color-reaction-hover-me":E.backgroundReactionHoverMe,"--chat-message-border-style-reaction-hover-me":E.borderStyleReactionHoverMe,"--chat-message-color-reaction-counter-me":E.colorReactionCounterMe,"--chat-message-bg-color-audio-record":E.backgroundAudioRecord,"--chat-message-bg-color-audio-line":E.backgroundAudioLine,"--chat-message-bg-color-audio-progress":E.backgroundAudioProgress,"--chat-message-bg-color-audio-progress-selector":E.backgroundAudioProgressSelector,"--chat-message-color-file-extension":E.colorFileExtension,"--chat-markdown-bg":N.background,"--chat-markdown-border":N.border,"--chat-markdown-color":N.color,"--chat-markdown-color-multi":N.colorMulti,"--chat-room-color-username":L.colorUsername,"--chat-room-color-message":L.colorMessage,"--chat-room-color-timestamp":L.colorTimestamp,"--chat-room-color-online":L.colorStateOnline,"--chat-room-color-offline":L.colorStateOffline,"--chat-room-bg-color-badge":L.backgroundCounterBadge,"--chat-room-color-badge":L.colorCounterBadge,"--chat-emoji-bg-color":k.background,"--chat-icon-color-search":f.search,"--chat-icon-color-add":f.add,"--chat-icon-color-toggle":f.toggle,"--chat-icon-color-menu":f.menu,"--chat-icon-color-close":f.close,"--chat-icon-color-close-image":f.closeImage,"--chat-icon-color-file":f.file,"--chat-icon-color-paperclip":f.paperclip,"--chat-icon-color-close-outline":f.closeOutline,"--chat-icon-color-close-preview":f.closePreview,"--chat-icon-color-send":f.send,"--chat-icon-color-send-disabled":f.sendDisabled,"--chat-icon-color-emoji":f.emoji,"--chat-icon-color-emoji-reaction":f.emojiReaction,"--chat-icon-color-document":f.document,"--chat-icon-color-pencil":f.pencil,"--chat-icon-color-checkmark":f.checkmark,"--chat-icon-color-checkmark-seen":f.checkmarkSeen,"--chat-icon-color-eye":f.eye,"--chat-icon-color-dropdown-message":f.dropdownMessage,"--chat-icon-bg-dropdown-message":f.dropdownMessageBackground,"--chat-icon-color-dropdown-room":f.dropdownRoom,"--chat-icon-color-dropdown-scroll":f.dropdownScroll,"--chat-icon-color-microphone":f.microphone,"--chat-icon-color-audio-play":f.audioPlay,"--chat-icon-color-audio-pause":f.audioPause,"--chat-icon-color-audio-cancel":f.audioCancel,"--chat-icon-color-audio-confirm":f.audioConfirm});var yf=`.vac-fade-spinner-enter-from{opacity:0}.vac-fade-spinner-enter-active{transition:opacity .8s}.vac-fade-spinner-leave-active{transition:opacity .2s;opacity:0}.vac-fade-image-enter-from{opacity:0}.vac-fade-image-enter-active{transition:opacity 1s}.vac-fade-image-leave-active{transition:opacity .5s;opacity:0}.vac-fade-message-enter-from{opacity:0}.vac-fade-message-enter-active{transition:opacity .5s}.vac-fade-message-leave-active{transition:opacity .2s;opacity:0}.vac-slide-left-enter-active,.vac-slide-right-enter-active{transition:all .3s ease;transition-property:transform,opacity}.vac-slide-left-leave-active,.vac-slide-right-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)!important;transition-property:transform,opacity}.vac-slide-left-enter-from,.vac-slide-left-leave-to{transform:translate(10px);opacity:0}.vac-slide-right-enter-from,.vac-slide-right-leave-to{transform:translate(-10px);opacity:0}.vac-slide-up-enter-active{transition:all .3s ease}.vac-slide-up-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)}.vac-slide-up-enter-from,.vac-slide-up-leave-to{transform:translateY(10px);opacity:0}.vac-bounce-enter-active{animation:vac-bounce-in .5s}.vac-bounce-leave-active{animation:vac-bounce-in .3s reverse}@keyframes vac-bounce-in{0%{transform:scale(0)}50%{transform:scale(1.05)}to{transform:scale(1)}}.vac-fade-preview-enter{opacity:0}.vac-fade-preview-enter-active{transition:opacity .1s}.vac-fade-preview-leave-active{transition:opacity .2s;opacity:0}.vac-bounce-preview-enter-active{animation:vac-bounce-image-in .4s}.vac-bounce-preview-leave-active{animation:vac-bounce-image-in .3s reverse}@keyframes vac-bounce-image-in{0%{transform:scale(.6)}to{transform:scale(1)}}.vac-menu-list{border-radius:4px;display:block;cursor:pointer;background:var(--chat-dropdown-bg-color);padding:6px 0}.vac-menu-list :hover{background:var(--chat-dropdown-bg-color-hover);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-list :not(:hover){transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-item{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1 1 100%;flex:1 1 100%;min-height:30px;padding:5px 16px;position:relative;white-space:nowrap;line-height:30px}.vac-menu-options{position:absolute;right:10px;top:20px;z-index:9999;min-width:150px;display:inline-block;border-radius:4px;font-size:14px;color:var(--chat-color);overflow-y:auto;overflow-x:hidden;contain:content;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-app-border{border:var(--chat-border-style)}.vac-app-border-t{border-top:var(--chat-border-style)}.vac-app-border-r{border-right:var(--chat-border-style)}.vac-app-border-b{border-bottom:var(--chat-border-style)}.vac-app-box-shadow{transition:all .5s;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-item-clickable{cursor:pointer}.vac-vertical-center{display:flex;align-items:center;height:100%}.vac-vertical-center .vac-vertical-container{width:100%;text-align:center}.vac-svg-button{max-height:30px;display:flex;cursor:pointer;transition:all .2s}.vac-svg-button:hover{transform:scale(1.1);opacity:.7}.vac-avatar{background-size:cover;background-position:center center;background-repeat:no-repeat;background-color:#ddd;height:42px;width:42px;min-height:42px;min-width:42px;margin-right:15px;border-radius:50%}.vac-blur-loading{filter:blur(3px)}.vac-badge-counter{height:13px;width:auto;min-width:13px;border-radius:50%;display:flex;align-items:center;justify-content:center;padding:3px;font-size:11px;font-weight:500}.vac-text-ellipsis{width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-text-bold{font-weight:700}.vac-text-italic{font-style:italic}.vac-text-strike{text-decoration:line-through}.vac-text-underline{text-decoration:underline}.vac-text-inline-code{display:inline-block;font-size:12px;color:var(--chat-markdown-color);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:2px 0;padding:2px 3px}.vac-text-multiline-code{display:block;font-size:12px;color:var(--chat-markdown-color-multi);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:4px 0;padding:7px}.vac-text-tag{color:var(--chat-message-color-tag);cursor:pointer}.vac-file-container{display:flex;align-content:center;justify-content:center;flex-wrap:wrap;text-align:center;background:var(--chat-bg-color-input);border:var(--chat-border-style-input);border-radius:4px;padding:10px}.vac-file-container svg{height:28px;width:28px}.vac-file-container .vac-text-extension{font-size:12px;color:var(--chat-message-color-file-extension);margin-top:-2px}.vac-card-window{width:100%;display:block;max-width:100%;background:var(--chat-content-bg-color);color:var(--chat-color);overflow-wrap:break-word;white-space:normal;border:var(--chat-container-border);border-radius:var(--chat-container-border-radius);box-shadow:var(--chat-container-box-shadow);-webkit-tap-highlight-color:transparent}.vac-card-window *{font-family:inherit}.vac-card-window a{color:#0d579c;font-weight:500}.vac-card-window .vac-chat-container{height:100%;display:flex}.vac-card-window .vac-chat-container input{min-width:10px}.vac-card-window .vac-chat-container textarea,.vac-card-window .vac-chat-container input[type=text],.vac-card-window .vac-chat-container input[type=search]{-webkit-appearance:none}.vac-media-preview{position:fixed;top:0;left:0;z-index:99;width:100vw;height:100vh;display:flex;align-items:center;background-color:#000c;outline:none}.vac-media-preview .vac-media-preview-container{height:calc(100% - 140px);width:calc(100% - 80px);padding:70px 40px;margin:0 auto}.vac-media-preview .vac-image-preview{width:100%;height:100%;background-size:contain;background-repeat:no-repeat;background-position:center}.vac-media-preview .vac-svg-button{position:absolute;top:30px;right:30px;transform:scale(1.4)}@media only screen and (max-width: 768px){.vac-media-preview .vac-svg-button{top:20px;right:20px;transform:scale(1.2)}.vac-media-preview .vac-media-preview-container{width:calc(100% - 40px);padding:70px 20px}}.vac-col-messages{position:relative;height:100%;flex:1;overflow:hidden;display:flex;flex-flow:column}.vac-col-messages .vac-container-center{height:100%;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.vac-col-messages .vac-room-empty{font-size:14px;color:#9ca6af;font-style:italic;line-height:20px;white-space:pre-line}.vac-col-messages .vac-room-empty div{padding:0 10%}.vac-col-messages .vac-container-scroll{background:var(--chat-content-bg-color);flex:1;overflow-y:auto;margin-right:1px;margin-top:60px;-webkit-overflow-scrolling:touch}.vac-col-messages .vac-container-scroll.vac-scroll-smooth{scroll-behavior:smooth}.vac-col-messages .vac-messages-container{padding:0 5px 5px}.vac-col-messages .vac-text-started{font-size:14px;color:var(--chat-message-color-started);font-style:italic;text-align:center;margin-top:30px;margin-bottom:20px}.vac-col-messages .vac-icon-scroll{position:absolute;bottom:80px;right:20px;padding:8px;background:var(--chat-bg-scroll-icon);border-radius:50%;box-shadow:0 1px 1px -1px #0003,0 1px 1px #00000024,0 1px 2px #0000001f;display:flex;cursor:pointer;z-index:10}.vac-col-messages .vac-icon-scroll svg{height:25px;width:25px}.vac-col-messages .vac-messages-count{position:absolute;top:-8px;left:11px;background-color:var(--chat-message-bg-color-scroll-counter);color:var(--chat-message-color-scroll-counter)}.vac-col-messages .vac-messages-hidden{opacity:0}@media only screen and (max-width: 768px){.vac-col-messages .vac-container-scroll{margin-top:50px}.vac-col-messages .vac-text-started{margin-top:20px}.vac-col-messages .vac-icon-scroll{bottom:70px}}.vac-room-header{position:absolute;display:flex;align-items:center;height:64px;width:100%;z-index:10;margin-right:1px;background:var(--chat-header-bg-color);border-top-right-radius:var(--chat-container-border-radius)}.vac-room-header .vac-room-wrapper{display:flex;align-items:center;min-width:0;height:100%;width:100%;padding:0 16px}.vac-room-header .vac-toggle-button{margin-right:15px}.vac-room-header .vac-toggle-button svg{height:26px;width:26px}.vac-room-header .vac-rotate-icon{transform:rotate(180deg)!important}.vac-room-header .vac-rotate-icon-init{transform:rotate(360deg)}.vac-room-header .vac-info-wrapper,.vac-room-header .vac-room-selection{display:flex;align-items:center;min-width:0;width:100%;height:100%}.vac-room-header .vac-room-selection .vac-selection-button{padding:8px 16px;color:var(--chat-color-button);background-color:var(--chat-bg-color-button);border-radius:4px;margin-right:10px;cursor:pointer;transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-button:hover{opacity:.7}.vac-room-header .vac-room-selection .vac-selection-button:active{opacity:.9}.vac-room-header .vac-room-selection .vac-selection-button .vac-selection-button-count{margin-left:6px;opacity:.9}.vac-room-header .vac-room-selection .vac-selection-cancel{display:flex;align-items:center;margin-left:auto;white-space:nowrap;color:var(--chat-color-button-clear);transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-cancel:hover{opacity:.7}.vac-room-header .vac-room-name{font-size:17px;font-weight:500;line-height:22px;color:var(--chat-header-color-name)}.vac-room-header .vac-room-info{font-size:13px;line-height:18px;color:var(--chat-header-color-info)}.vac-room-header .vac-room-options{margin-left:auto}@media only screen and (max-width: 768px){.vac-room-header{height:50px}.vac-room-header .vac-room-wrapper{padding:0 10px}.vac-room-header .vac-room-name{font-size:16px;line-height:22px}.vac-room-header .vac-room-info{font-size:12px;line-height:16px}.vac-room-header .vac-avatar{height:37px;width:37px;min-height:37px;min-width:37px}}.vac-room-footer{width:100%;border-bottom-right-radius:4px;z-index:10}.vac-box-footer{display:flex;position:relative;background:var(--chat-footer-bg-color);padding:10px 8px}.vac-textarea{height:20px;width:100%;line-height:20px;overflow:hidden;outline:0;resize:none;border-radius:20px;padding:12px 16px;box-sizing:content-box;font-size:16px;background:var(--chat-bg-color-input);color:var(--chat-color);caret-color:var(--chat-color-caret);border:var(--chat-border-style-input)}.vac-textarea::placeholder{color:var(--chat-color-placeholder);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-textarea-outline{border:1px solid var(--chat-border-color-input-selected);box-shadow:inset 0 0 0 1px var(--chat-border-color-input-selected)}.vac-icon-textarea,.vac-icon-textarea-left{display:flex;align-items:center}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea{margin-left:5px}.vac-icon-textarea-left{display:flex;align-items:center;margin-right:5px}.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea-left .vac-icon-microphone{fill:var(--chat-icon-color-microphone);margin:0 7px}.vac-icon-textarea-left .vac-dot-audio-record{height:15px;width:15px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-record);animation:vac-scaling .8s ease-in-out infinite alternate}@keyframes vac-scaling{0%{transform:scale(1);opacity:.4}to{transform:scale(1.1);opacity:1}}.vac-icon-textarea-left .vac-dot-audio-record-time{font-size:16px;color:var(--chat-color);margin-left:8px;width:45px}.vac-icon-textarea-left .vac-icon-audio-stop,.vac-icon-textarea-left .vac-icon-audio-confirm{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop svg,.vac-icon-textarea-left .vac-icon-audio-confirm svg{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop{margin-right:20px}.vac-icon-textarea-left .vac-icon-audio-stop #vac-icon-close-outline{fill:var(--chat-icon-color-audio-cancel)}.vac-icon-textarea-left .vac-icon-audio-confirm{margin-right:3px;margin-left:12px}.vac-icon-textarea-left .vac-icon-audio-confirm #vac-icon-checkmark{fill:var(--chat-icon-color-audio-confirm)}.vac-send-disabled,.vac-send-disabled svg{cursor:none!important;pointer-events:none!important;transform:none!important}@media only screen and (max-width: 768px){.vac-room-footer{width:100%}.vac-box-footer{padding:7px 2px 7px 7px}.vac-box-footer.vac-box-footer-border{border-top:var(--chat-border-style-input)}.vac-textarea{padding:7px;line-height:18px}.vac-textarea::placeholder{color:transparent}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 5px!important}}.vac-emojis-container{width:calc(100% - 16px);padding:10px 8px;background:var(--chat-footer-bg-color);display:flex;align-items:center;overflow:auto}.vac-emojis-container .vac-emoji-element{padding:0 8px;font-size:30px;border-radius:4px;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-emojis-container .vac-emoji-element-active{background:var(--chat-footer-bg-color-tag-active)}@media only screen and (max-width: 768px){.vac-emojis-container{width:calc(100% - 10px);padding:7px 5px}.vac-emojis-container .vac-emoji-element{padding:0 7px;font-size:26px}}.vac-reply-container{display:flex;padding:10px 10px 0;background:var(--chat-footer-bg-color);align-items:center;width:calc(100% - 20px)}.vac-reply-container .vac-reply-box{width:100%;overflow:hidden;background:var(--chat-footer-bg-color-reply);border-radius:4px;padding:8px 10px}.vac-reply-container .vac-reply-info{overflow:hidden}.vac-reply-container .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-container .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content);white-space:pre-line}.vac-reply-container .vac-icon-reply{margin-left:10px}.vac-reply-container .vac-icon-reply svg{height:20px;width:20px}.vac-reply-container .vac-image-reply{max-height:100px;max-width:200px;margin:4px 10px 0 0;border-radius:4px}.vac-reply-container .vac-audio-reply{margin-right:10px}.vac-reply-container .vac-file-container{max-width:80px}@media only screen and (max-width: 768px){.vac-reply-container{padding:5px 8px;width:calc(100% - 16px)}}.vac-room-files-container{display:flex;align-items:center;padding:10px 6px 0;background:var(--chat-footer-bg-color)}.vac-room-files-container .vac-files-box{display:flex;overflow:auto;width:calc(100% - 30px)}.vac-room-files-container video{height:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-files-container .vac-icon-close{margin-left:auto}.vac-room-files-container .vac-icon-close svg{height:20px;width:20px}@media only screen and (max-width: 768px){.vac-files-container{padding:6px 4px 4px 2px}}.vac-room-file-container{display:flex;position:relative;margin:0 4px}.vac-room-file-container .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:100px;width:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-file-container .vac-file-container{height:80px;width:80px}.vac-room-file-container .vac-icon-remove{position:absolute;top:6px;left:6px;z-index:10}.vac-room-file-container .vac-icon-remove svg{height:20px;width:20px;border-radius:50%}.vac-room-file-container .vac-icon-remove:before{content:" ";position:absolute;width:100%;height:100%;background:rgba(0,0,0,.5);border-radius:50%;z-index:-1}.vac-tags-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-tags-container .vac-tags-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-tags-container .vac-tags-box-active{background:var(--chat-footer-bg-color-tag-active)}.vac-tags-container .vac-tags-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-tags-container .vac-tags-avatar{height:34px;width:34px;min-height:34px;min-width:34px}.vac-tags-container .vac-tags-username{font-size:14px}@media only screen and (max-width: 768px){.vac-tags-container .vac-tags-box{height:50px}.vac-tags-container .vac-tags-info{padding:0 12px}}.vac-template-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-template-container .vac-template-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-template-container .vac-template-active{background:var(--chat-footer-bg-color-tag-active)}.vac-template-container .vac-template-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-template-container .vac-template-tag{font-size:14px;font-weight:700;margin-right:10px}.vac-template-container .vac-template-text{font-size:14px}@media only screen and (max-width: 768px){.vac-template-container .vac-template-box{height:50px}.vac-template-container .vac-template-info{padding:0 12px}}.vac-rooms-container{display:flex;flex-flow:column;flex:0 0 25%;min-width:260px;max-width:500px;position:relative;background:var(--chat-sidemenu-bg-color);height:100%;border-top-left-radius:var(--chat-container-border-radius);border-bottom-left-radius:var(--chat-container-border-radius)}.vac-rooms-container.vac-rooms-container-full{flex:0 0 100%;max-width:100%}.vac-rooms-container .vac-rooms-empty{font-size:14px;color:#9ca6af;font-style:italic;text-align:center;margin:40px 0;line-height:20px;white-space:pre-line}.vac-rooms-container .vac-room-list{flex:1;position:relative;max-width:100%;cursor:pointer;padding:0 10px 5px;overflow-y:auto}.vac-rooms-container .vac-room-item{border-radius:8px;align-items:center;display:flex;flex:1 1 100%;margin-bottom:5px;padding:0 14px;position:relative;min-height:71px;transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-rooms-container .vac-room-item:hover{background:var(--chat-sidemenu-bg-color-hover)}.vac-rooms-container .vac-room-selected{color:var(--chat-sidemenu-color-active)!important;background:var(--chat-sidemenu-bg-color-active)!important}.vac-rooms-container .vac-room-selected:hover{background:var(--chat-sidemenu-bg-color-active)!important}@media only screen and (max-width: 768px){.vac-rooms-container .vac-room-list{padding:0 7px 5px}.vac-rooms-container .vac-room-item{min-height:60px;padding:0 8px}}.vac-room-container{display:flex;flex:1;align-items:center;width:100%}.vac-room-container .vac-name-container{flex:1}.vac-room-container .vac-title-container{display:flex;align-items:center;line-height:25px}.vac-room-container .vac-state-circle{width:9px;height:9px;border-radius:50%;background-color:var(--chat-room-color-offline);margin-right:6px;transition:.3s}.vac-room-container .vac-state-online{background-color:var(--chat-room-color-online)}.vac-room-container .vac-room-name{flex:1;color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-text-date{margin-left:5px;font-size:11px;color:var(--chat-room-color-timestamp)}.vac-room-container .vac-text-last{display:flex;align-items:center;font-size:12px;line-height:19px;color:var(--chat-room-color-message)}.vac-room-container .vac-message-new{color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-icon-check{display:flex;vertical-align:middle;height:14px;width:14px;margin-top:-2px;margin-right:2px}.vac-room-container .vac-icon-microphone{height:15px;width:15px;vertical-align:middle;margin:-3px 1px 0 -2px;fill:var(--chat-room-color-message)}.vac-room-container .vac-room-options-container{display:flex;margin-left:auto}.vac-room-container .vac-room-badge{background-color:var(--chat-room-bg-color-badge);color:var(--chat-room-color-badge);margin-left:5px}.vac-room-container .vac-list-room-options{height:19px;width:19px;align-items:center;margin-left:5px}.vac-box-empty{margin-top:10px}@media only screen and (max-width: 768px){.vac-box-empty{margin-top:7px}}.vac-box-search{position:sticky;display:flex;align-items:center;height:64px;padding:0 15px}.vac-box-search .vac-icon-search{display:flex;position:absolute;left:30px}.vac-box-search .vac-icon-search svg{width:18px;height:18px}.vac-box-search .vac-input{height:38px;width:100%;background:var(--chat-bg-color-input);color:var(--chat-color);font-size:15px;outline:0;caret-color:var(--chat-color-caret);padding:10px 10px 10px 40px;border:1px solid var(--chat-sidemenu-border-color-search);border-radius:20px}.vac-box-search .vac-input::placeholder{color:var(--chat-color-placeholder)}.vac-box-search .vac-add-icon{margin-left:auto;padding-left:10px}@media only screen and (max-width: 768px){.vac-box-search{height:58px}}.vac-message-wrapper .vac-card-info{border-radius:4px;text-align:center;margin:10px auto;font-size:12px;padding:4px;display:block;overflow-wrap:break-word;position:relative;white-space:normal;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-card-date{max-width:150px;font-weight:500;text-transform:uppercase;color:var(--chat-message-color-date);background-color:var(--chat-message-bg-color-date)}.vac-message-wrapper .vac-card-system{max-width:250px;padding:8px 4px;color:var(--chat-message-color-system);background-color:var(--chat-message-bg-color-system)}.vac-message-wrapper .vac-line-new{color:var(--chat-message-color-new-messages);position:relative;text-align:center;font-size:13px;padding:10px 0}.vac-message-wrapper .vac-line-new:after,.vac-message-wrapper .vac-line-new:before{border-top:1px solid var(--chat-message-color-new-messages);content:"";left:0;position:absolute;top:50%;width:calc(50% - 60px)}.vac-message-wrapper .vac-line-new:before{left:auto;right:0}.vac-message-wrapper .vac-message-box{display:flex;flex:0 0 50%;max-width:50%;justify-content:flex-start;line-height:1.4}.vac-message-wrapper .vac-avatar{height:28px;width:28px;min-height:28px;min-width:28px;margin:0 0 2px;align-self:flex-end}.vac-message-wrapper .vac-avatar-current-offset{margin-right:28px}.vac-message-wrapper .vac-avatar-offset{margin-left:28px}.vac-message-wrapper .vac-failure-container{position:relative;align-self:flex-end;height:20px;width:20px;margin:0 0 2px -4px;border-radius:50%;background-color:#f44336}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:6px}.vac-message-wrapper .vac-failure-container .vac-failure-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:15px;font-weight:700}.vac-message-wrapper .vac-message-container{position:relative;padding:2px 10px;align-items:end;min-width:100px;box-sizing:content-box}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-offset-current{margin-left:50%;justify-content:flex-end}.vac-message-wrapper .vac-message-card{background-color:var(--chat-message-bg-color);color:var(--chat-message-color);border-radius:8px;font-size:14px;padding:6px 9px 3px;white-space:pre-line;max-width:100%;-webkit-transition-property:box-shadow,opacity;transition-property:box-shadow,opacity;transition:box-shadow .28s cubic-bezier(.4,0,.2,1);will-change:box-shadow;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-message-highlight{box-shadow:0 1px 2px -1px #0000001a,0 1px 2px -1px #0000001c,0 1px 5px -1px #0000001c}.vac-message-wrapper .vac-message-current{background-color:var(--chat-message-bg-color-me)!important}.vac-message-wrapper .vac-message-deleted{color:var(--chat-message-color-deleted)!important;font-size:13px!important;font-style:italic!important;background-color:var(--chat-message-bg-color-deleted)!important}.vac-message-wrapper .vac-message-selected{background-color:var(--chat-message-bg-color-selected)!important;transition:background-color .2s}.vac-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-2px 2px 0 0;fill:var(--chat-message-color-deleted)}.vac-message-wrapper .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:250px;width:250px;max-width:100%;border-radius:4px;margin:4px auto 5px;transition:.4s filter linear}.vac-message-wrapper .vac-text-username{font-size:13px;color:var(--chat-message-color-username);margin-bottom:2px}.vac-message-wrapper .vac-username-reply{margin-bottom:5px}.vac-message-wrapper .vac-text-timestamp{font-size:10px;color:var(--chat-message-color-timestamp);text-align:right}.vac-message-wrapper .vac-progress-time{float:left;margin:-2px 0 0 40px;color:var(--chat-color);font-size:12px}.vac-message-wrapper .vac-icon-edited{-webkit-box-align:center;align-items:center;display:-webkit-inline-box;display:inline-flex;justify-content:center;letter-spacing:normal;line-height:1;text-indent:0;vertical-align:middle;margin:0 4px 2px}.vac-message-wrapper .vac-icon-edited svg{height:12px;width:12px}.vac-message-wrapper .vac-icon-check{height:14px;width:14px;vertical-align:middle;margin:-3px -3px 0 3px}@media only screen and (max-width: 768px){.vac-message-wrapper .vac-message-container{padding:2px 3px 1px}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-message-box{flex:0 0 80%;max-width:80%}.vac-message-wrapper .vac-avatar{height:25px;width:25px;min-height:25px;min-width:25px;margin:0 6px 1px 0}.vac-message-wrapper .vac-avatar.vac-avatar-current{margin:0 0 1px 6px}.vac-message-wrapper .vac-avatar-current-offset{margin-right:31px}.vac-message-wrapper .vac-avatar-offset{margin-left:31px}.vac-message-wrapper .vac-failure-container{margin-left:2px}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:0}.vac-message-wrapper .vac-offset-current{margin-left:20%}.vac-message-wrapper .vac-progress-time{margin-left:37px}}.vac-audio-player{display:flex;margin:8px 0 5px}.vac-audio-player .vac-svg-button{max-width:18px;margin-left:7px}@media only screen and (max-width: 768px){.vac-audio-player{margin:4px 0 0}.vac-audio-player .vac-svg-button{max-width:16px;margin-left:5px}}.vac-player-bar{display:flex;align-items:center;max-width:calc(100% - 18px);margin-right:7px;margin-left:20px}.vac-player-bar .vac-player-progress{width:190px}.vac-player-bar .vac-player-progress .vac-line-container{position:relative;height:4px;border-radius:5px;background-color:var(--chat-message-bg-color-audio-line)}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-progress{position:absolute;height:inherit;background-color:var(--chat-message-bg-color-audio-progress);border-radius:inherit}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{position:absolute;top:-5px;margin-left:-7px;height:14px;width:14px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-progress-selector);transition:transform .25s}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot__active{transform:scale(1.2)}@media only screen and (max-width: 768px){.vac-player-bar{margin-right:5px}.vac-player-bar .vac-player-progress .vac-line-container{height:3px}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{height:12px;width:12px;top:-5px;margin-left:-5px}}.vac-message-actions-wrapper .vac-options-container{position:absolute;top:2px;right:10px;height:40px;width:70px;overflow:hidden;border-top-right-radius:8px}.vac-message-actions-wrapper .vac-blur-container{position:absolute;height:100%;width:100%;left:8px;bottom:10px;background:var(--chat-message-bg-color);filter:blur(3px);border-bottom-left-radius:8px}.vac-message-actions-wrapper .vac-options-me{background:var(--chat-message-bg-color-me)}.vac-message-actions-wrapper .vac-message-options{background:var(--chat-icon-bg-dropdown-message);border-radius:50%;position:absolute;top:7px;right:7px}.vac-message-actions-wrapper .vac-message-options svg{height:17px;width:17px;padding:5px;margin:-5px}.vac-message-actions-wrapper .vac-message-emojis{position:absolute;top:6px;right:30px}.vac-message-actions-wrapper .vac-menu-options{right:15px}.vac-message-actions-wrapper .vac-menu-left{right:-118px}@media only screen and (max-width: 768px){.vac-message-actions-wrapper .vac-options-container{right:3px}.vac-message-actions-wrapper .vac-menu-left{right:-50px}}.vac-message-files-container .vac-file-wrapper{position:relative;width:fit-content}.vac-message-files-container .vac-file-wrapper .vac-file-container{height:60px;width:60px;margin:3px 0 5px;cursor:pointer;transition:all .6s}.vac-message-files-container .vac-file-wrapper .vac-file-container:hover{opacity:.85}.vac-message-files-container .vac-file-wrapper .vac-file-container svg{height:30px;width:30px}.vac-message-files-container .vac-file-wrapper .vac-file-container.vac-file-container-progress{background-color:#0000004d}.vac-message-file-container{position:relative;z-index:0}.vac-message-file-container .vac-message-image-container{cursor:pointer}.vac-message-file-container .vac-image-buttons{position:absolute;width:100%;height:100%;border-radius:4px;background:linear-gradient(to bottom,rgba(0,0,0,0) 55%,rgba(0,0,0,.02) 60%,rgba(0,0,0,.05) 65%,rgba(0,0,0,.1) 70%,rgba(0,0,0,.2) 75%,rgba(0,0,0,.3) 80%,rgba(0,0,0,.5) 85%,rgba(0,0,0,.6) 90%,rgba(0,0,0,.7) 95%,rgba(0,0,0,.8) 100%)}.vac-message-file-container .vac-image-buttons svg{height:26px;width:26px}.vac-message-file-container .vac-image-buttons .vac-button-view,.vac-message-file-container .vac-image-buttons .vac-button-download{position:absolute;bottom:6px;left:7px}.vac-message-file-container .vac-image-buttons :first-child{left:40px}.vac-message-file-container .vac-image-buttons .vac-button-view{max-width:18px;bottom:8px}.vac-message-file-container .vac-video-container{width:350px;max-width:100%;margin:4px auto 5px;cursor:pointer}.vac-message-file-container .vac-video-container video{border-radius:4px}.vac-button-reaction{display:inline-flex;align-items:center;border:var(--chat-message-border-style-reaction);outline:none;background:var(--chat-message-bg-color-reaction);border-radius:4px;margin:4px 2px 0;transition:.3s;padding:0 5px;font-size:18px;line-height:23px}.vac-button-reaction span{font-size:11px;font-weight:500;min-width:7px;color:var(--chat-message-color-reaction-counter)}.vac-button-reaction:hover{border:var(--chat-message-border-style-reaction-hover);background:var(--chat-message-bg-color-reaction-hover);cursor:pointer}.vac-button-reaction.vac-reaction-me{border:var(--chat-message-border-style-reaction-me);background:var(--chat-message-bg-color-reaction-me)}.vac-button-reaction.vac-reaction-me span{color:var(--chat-message-color-reaction-counter-me)}.vac-button-reaction.vac-reaction-me:hover{border:var(--chat-message-border-style-reaction-hover-me);background:var(--chat-message-bg-color-reaction-hover-me)}.vac-reply-message{background:var(--chat-message-bg-color-reply);border-radius:4px;margin:-1px -5px 8px;padding:8px 10px}.vac-reply-message .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-message .vac-image-reply-container{width:70px}.vac-reply-message .vac-image-reply-container .vac-message-image-reply{height:70px;width:70px;margin:4px auto 3px}.vac-reply-message .vac-video-reply-container{width:200px;max-width:100%}.vac-reply-message .vac-video-reply-container video{border-radius:4px}.vac-reply-message .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content)}.vac-reply-message .vac-file-container{height:60px;width:60px}.vac-emoji-wrapper{position:relative;display:flex}.vac-emoji-wrapper .vac-emoji-reaction svg{height:19px;width:19px}.vac-emoji-wrapper .vac-emoji-picker{position:absolute;z-index:9999;bottom:32px;right:10px;width:300px;padding-top:4px;overflow:scroll;box-sizing:border-box;border-radius:.5rem;background:var(--chat-emoji-bg-color);box-shadow:0 1px 2px -2px #0000001a,0 1px 2px -1px #0000001a,0 1px 2px 1px #0000001a;scrollbar-width:none}.vac-emoji-wrapper .vac-emoji-picker::-webkit-scrollbar{display:none}.vac-emoji-wrapper .vac-emoji-picker.vac-picker-reaction{position:fixed;top:initial;right:initial}.vac-emoji-wrapper .vac-emoji-picker emoji-picker{height:100%;width:100%;--emoji-size: 1.2rem;--background: var(--chat-emoji-bg-color);--emoji-padding: .4rem;--border-color: var(--chat-sidemenu-border-color-search);--button-hover-background: var(--chat-sidemenu-bg-color-hover);--button-active-background: var(--chat-sidemenu-bg-color-hover)}.vac-format-message-wrapper .vac-format-container{display:inline}.vac-format-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-3px 1px 0 0;fill:var(--chat-room-color-message)}.vac-format-message-wrapper .vac-image-link-container{background-color:var(--chat-message-bg-color-media);padding:8px;margin:2px auto;border-radius:4px}.vac-format-message-wrapper .vac-image-link{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:contain;background-position:center center!important;background-repeat:no-repeat!important;height:150px;width:150px;max-width:100%;border-radius:4px;margin:0 auto}.vac-format-message-wrapper .vac-image-link-message{max-width:166px;font-size:12px}.vac-loader-wrapper.vac-container-center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-loader-wrapper.vac-container-top{padding:21px}.vac-loader-wrapper.vac-container-top #vac-circle{height:20px;width:20px}.vac-loader-wrapper #vac-circle{margin:auto;height:28px;width:28px;border:3px rgba(0,0,0,.25) solid;border-top:3px var(--chat-color-spinner) solid;border-right:3px var(--chat-color-spinner) solid;border-bottom:3px var(--chat-color-spinner) solid;border-radius:50%;-webkit-animation:vac-spin 1s infinite linear;animation:vac-spin 1s infinite linear}@media only screen and (max-width: 768px){.vac-loader-wrapper #vac-circle{height:24px;width:24px}.vac-loader-wrapper.vac-container-top{padding:18px}.vac-loader-wrapper.vac-container-top #vac-circle{height:16px;width:16px}}@-webkit-keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}#vac-icon-search{fill:var(--chat-icon-color-search)}#vac-icon-add{fill:var(--chat-icon-color-add)}#vac-icon-toggle{fill:var(--chat-icon-color-toggle)}#vac-icon-menu{fill:var(--chat-icon-color-menu)}#vac-icon-close{fill:var(--chat-icon-color-close)}#vac-icon-close-image{fill:var(--chat-icon-color-close-image)}#vac-icon-file{fill:var(--chat-icon-color-file)}#vac-icon-paperclip{fill:var(--chat-icon-color-paperclip)}#vac-icon-close-outline{fill:var(--chat-icon-color-close-outline)}#vac-icon-close-outline-preview{fill:var(--chat-icon-color-close-preview)}#vac-icon-send{fill:var(--chat-icon-color-send)}#vac-icon-send-disabled{fill:var(--chat-icon-color-send-disabled)}#vac-icon-emoji{fill:var(--chat-icon-color-emoji)}#vac-icon-emoji-reaction{fill:var(--chat-icon-color-emoji-reaction)}#vac-icon-document{fill:var(--chat-icon-color-document)}#vac-icon-pencil{fill:var(--chat-icon-color-pencil)}#vac-icon-checkmark,#vac-icon-double-checkmark{fill:var(--chat-icon-color-checkmark)}#vac-icon-checkmark-seen,#vac-icon-double-checkmark-seen{fill:var(--chat-icon-color-checkmark-seen)}#vac-icon-eye{fill:var(--chat-icon-color-eye)}#vac-icon-dropdown-message{fill:var(--chat-icon-color-dropdown-message)}#vac-icon-dropdown-room{fill:var(--chat-icon-color-dropdown-room)}#vac-icon-dropdown-scroll{fill:var(--chat-icon-color-dropdown-scroll)}#vac-icon-audio-play{fill:var(--chat-icon-color-audio-play)}#vac-icon-audio-pause{fill:var(--chat-icon-color-audio-pause)}.vac-progress-wrapper{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-progress-wrapper circle{transition:stroke-dashoffset .35s;transform:rotate(-90deg);transform-origin:50% 50%}.vac-progress-wrapper .vac-progress-content{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:-1;margin-top:-2px;background-color:#000000b3;border-radius:50%}.vac-progress-wrapper .vac-progress-content .vac-progress-text{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:700;color:#fff}.vac-progress-wrapper .vac-progress-content .vac-progress-text .vac-progress-pourcent{font-size:9px;font-weight:400}
`;const xf={name:"ChatContainer",components:{RoomsList:Tc,Room:lf,MediaPreview:pf},props:{height:{type:String,default:"600px"},theme:{type:String,default:"light"},styles:{type:[Object,String],default:()=>({})},responsiveBreakpoint:{type:Number,default:900},singleRoom:{type:[Boolean,String],default:!1},roomsListOpened:{type:[Boolean,String],default:!0},textMessages:{type:[Object,String],default:null},currentUserId:{type:String,default:""},rooms:{type:[Array,String],default:null},roomsOrder:{type:String,default:"desc"},loadingRooms:{type:[Boolean,String],default:!1},roomsLoaded:{type:[Boolean,String],default:!1},roomId:{type:String,default:null},loadFirstRoom:{type:[Boolean,String],default:!0},messages:{type:[Array,String],default:null},messagesLoaded:{type:[Boolean,String],default:!1},roomActions:{type:Array,default:()=>[]},menuActions:{type:Array,default:()=>[]},messageActions:{type:Array,default:()=>[{name:"replyMessage",title:"Reply"},{name:"editMessage",title:"Edit Message",onlyMe:!0},{name:"deleteMessage",title:"Delete Message",onlyMe:!0},{name:"selectMessages",title:"Select"}]},messageSelectionActions:{type:Array,default:()=>[]},autoScroll:{type:Object,default:()=>({send:{new:!0,newAfterScrollUp:!0},receive:{new:!0,newAfterScrollUp:!1}})},showSearch:{type:[Boolean,String],default:!0},showAddRoom:{type:[Boolean,String],default:!0},showSendIcon:{type:[Boolean,String],default:!0},showFiles:{type:[Boolean,String],default:!0},showAudio:{type:[Boolean,String],default:!0},audioBitRate:{type:Number,default:128},audioSampleRate:{type:Number,default:44100},showEmojis:{type:[Boolean,String],default:!0},showReactionEmojis:{type:[Boolean,String],default:!0},showNewMessagesDivider:{type:[Boolean,String],default:!0},showFooter:{type:[Boolean,String],default:!0},textFormatting:{type:Object,default:()=>({disabled:!1,italic:"_",bold:"*",strike:"~",underline:"\xB0",multilineCode:"```",inlineCode:"`"})},linkOptions:{type:Object,default:()=>({disabled:!1,target:"_blank",rel:null})},roomInfoEnabled:{type:[Boolean,String],default:!1},textareaActionEnabled:{type:[Boolean,String],default:!1},textareaAutoFocus:{type:[Boolean,String],default:!0},userTagsEnabled:{type:[Boolean,String],default:!0},emojisSuggestionEnabled:{type:[Boolean,String],default:!0},roomMessage:{type:String,default:""},scrollDistance:{type:Number,default:60},acceptedFiles:{type:String,default:"*"},templatesText:{type:[Array,String],default:null},mediaPreviewEnabled:{type:[Boolean,String],default:!0},usernameOptions:{type:Object,default:()=>({minUsers:3,currentUser:!1})}},emits:["toggle-rooms-list","room-info","fetch-messages","send-message","edit-message","delete-message","open-file","open-user-tag","open-failed-message","menu-action-handler","message-action-handler","send-message-reaction","typing-message","textarea-action-handler","fetch-more-rooms","add-room","room-action-handler","message-selection-action-handler"],data(){return{room:{},loadingMoreRooms:!1,showRoomsList:!0,isMobile:!1,showMediaPreview:!1,previewFile:{}}},computed:{t(){return{...vf,...this.textMessages}},cssVars(){const e=gf[this.theme],t={};return Object.keys(e).map(a=>{t[a]={...e[a],...this.styles[a]||{}}}),bf(t)},orderedRooms(){return this.roomsCasted.slice().sort((e,t)=>{const a=e.index||0,n=t.index||0;return this.roomsOrder==="asc"?a<n?-1:n<a?1:0:a>n?-1:n>a?1:0})},roomsCasted(){return this.rooms||[]},messagesCasted(){return this.messages||[]},singleRoomCasted(){return this.castBooleanToString(this.singleRoom)},roomsListOpenedCasted(){return this.castBooleanToString(this.roomsListOpened)},loadingRoomsCasted(){return this.castBooleanToString(this.loadingRooms)},roomsLoadedCasted(){return this.castBooleanToString(this.roomsLoaded)},loadFirstRoomCasted(){return this.castBooleanToString(this.loadFirstRoom)},messagesLoadedCasted(){return this.castBooleanToString(this.messagesLoaded)},showSearchCasted(){return this.castBooleanToString(this.showSearch)},showAddRoomCasted(){return this.castBooleanToString(this.showAddRoom)},showSendIconCasted(){return this.castBooleanToString(this.showSendIcon)},showFilesCasted(){return this.castBooleanToString(this.showFiles)},showAudioCasted(){return this.castBooleanToString(this.showAudio)},showEmojisCasted(){return this.castBooleanToString(this.showEmojis)},showReactionEmojisCasted(){return this.castBooleanToString(this.showReactionEmojis)},showNewMessagesDividerCasted(){return this.castBooleanToString(this.showNewMessagesDivider)},showFooterCasted(){return this.castBooleanToString(this.showFooter)},roomInfoEnabledCasted(){return this.castBooleanToString(this.roomInfoEnabled)},textareaActionEnabledCasted(){return this.castBooleanToString(this.textareaActionEnabled)},textareaAutoFocusCasted(){return this.castBooleanToString(this.textareaAutoFocus)},userTagsEnabledCasted(){return this.castBooleanToString(this.userTagsEnabled)},emojisSuggestionEnabledCasted(){return this.castBooleanToString(this.emojisSuggestionEnabled)},mediaPreviewEnabledCasted(){return this.castBooleanToString(this.mediaPreviewEnabled)}},watch:{rooms:{immediate:!0,deep:!0,handler(e,t){if((!e[0]||!e.find(a=>a.roomId===this.room.roomId))&&(this.showRoomsList=!0),!this.loadingMoreRooms&&this.loadFirstRoomCasted&&e[0]&&(!t||e.length!==t.length))if(this.roomId){const a=e.find(n=>n.roomId===this.roomId)||{};this.fetchRoom({room:a})}else!this.isMobile||this.singleRoomCasted?this.fetchRoom({room:this.orderedRooms[0]}):this.showRoomsList=!0}},loadingRoomsCasted(e){e&&(this.room={})},roomId:{immediate:!0,handler(e,t){if(e&&!this.loadingRoomsCasted&&this.roomsCasted.length){const a=this.roomsCasted.find(n=>n.roomId===e);this.fetchRoom({room:a})}else t&&!e&&(this.room={})}},room(e){!e||Object.entries(e).length===0||(Iu(e),e.users.forEach(t=>{Lu(t)}))},roomsListOpenedCasted(e){this.showRoomsList=e}},created(){this.updateResponsive(),window.addEventListener("resize",e=>{e.isTrusted&&this.updateResponsive()})},methods:{castBooleanToString(e){return e==="true"||e===!0},updateResponsive(){this.isMobile=window.innerWidth<Number(this.responsiveBreakpoint)},toggleRoomsList(){this.showRoomsList=!this.showRoomsList,this.isMobile&&(this.room={}),this.$emit("toggle-rooms-list",{opened:this.showRoomsList})},fetchRoom({room:e}){this.room=e,this.fetchMessages({reset:!0}),this.isMobile&&(this.showRoomsList=!1)},fetchMoreRooms(){this.$emit("fetch-more-rooms")},roomInfo(){this.$emit("room-info",this.room)},addRoom(){this.$emit("add-room")},fetchMessages(e){this.$emit("fetch-messages",{room:this.room,options:e})},sendMessage(e){this.$emit("send-message",{...e,roomId:this.room.roomId})},editMessage(e){this.$emit("edit-message",{...e,roomId:this.room.roomId})},deleteMessage(e){this.$emit("delete-message",{message:e,roomId:this.room.roomId})},openFile({message:e,file:t}){this.mediaPreviewEnabledCasted&&t.action==="preview"?(this.previewFile=t.file,this.showMediaPreview=!0):this.$emit("open-file",{message:e,file:t})},openUserTag({user:e}){this.$emit("open-user-tag",{user:e})},openFailedMessage({message:e}){this.$emit("open-failed-message",{message:e,roomId:this.room.roomId})},menuActionHandler(e){this.$emit("menu-action-handler",{action:e,roomId:this.room.roomId})},roomActionHandler({action:e,roomId:t}){this.$emit("room-action-handler",{action:e,roomId:t})},messageActionHandler(e){this.$emit("message-action-handler",{...e,roomId:this.room.roomId})},messageSelectionActionHandler(e){this.$emit("message-selection-action-handler",{...e,roomId:this.room.roomId})},sendMessageReaction(e){this.$emit("send-message-reaction",{...e,roomId:this.room.roomId})},typingMessage(e){this.$emit("typing-message",{message:e,roomId:this.room.roomId})},textareaActionHandler(e){this.$emit("textarea-action-handler",{message:e,roomId:this.room.roomId})}}},wf={class:"vac-chat-container"};function Sf(e,t,a,n,m,s){const R=r.resolveComponent("rooms-list"),E=r.resolveComponent("room"),N=r.resolveComponent("media-preview");return r.openBlock(),r.createElementBlock("div",{class:"vac-card-window",style:r.normalizeStyle([{height:a.height},s.cssVars])},[r.createElementVNode("div",wf,[s.singleRoomCasted?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(R,{key:0,"current-user-id":a.currentUserId,rooms:s.orderedRooms,"loading-rooms":s.loadingRoomsCasted,"rooms-loaded":s.roomsLoadedCasted,room:m.room,"room-actions":a.roomActions,"text-messages":s.t,"show-search":s.showSearchCasted,"show-add-room":s.showAddRoomCasted,"show-rooms-list":m.showRoomsList,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"is-mobile":m.isMobile,"scroll-distance":a.scrollDistance,onFetchRoom:s.fetchRoom,onFetchMoreRooms:s.fetchMoreRooms,onLoadingMoreRooms:t[0]||(t[0]=L=>m.loadingMoreRooms=L),onAddRoom:s.addRoom,onRoomActionHandler:s.roomActionHandler},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["current-user-id","rooms","loading-rooms","rooms-loaded","room","room-actions","text-messages","show-search","show-add-room","show-rooms-list","text-formatting","link-options","is-mobile","scroll-distance","onFetchRoom","onFetchMoreRooms","onAddRoom","onRoomActionHandler"])),r.createVNode(E,{"current-user-id":a.currentUserId,rooms:s.roomsCasted,"room-id":m.room.roomId||"","load-first-room":s.loadFirstRoomCasted,messages:s.messagesCasted,"room-message":a.roomMessage,"messages-loaded":s.messagesLoadedCasted,"menu-actions":a.menuActions,"message-actions":a.messageActions,"message-selection-actions":a.messageSelectionActions,"auto-scroll":a.autoScroll,"show-send-icon":s.showSendIconCasted,"show-files":s.showFilesCasted,"show-audio":s.showAudioCasted,"audio-bit-rate":a.audioBitRate,"audio-sample-rate":a.audioSampleRate,"show-emojis":s.showEmojisCasted,"show-reaction-emojis":s.showReactionEmojisCasted,"show-new-messages-divider":s.showNewMessagesDividerCasted,"show-footer":s.showFooterCasted,"text-messages":s.t,"single-room":s.singleRoomCasted,"show-rooms-list":m.showRoomsList,"text-formatting":a.textFormatting,"link-options":a.linkOptions,"is-mobile":m.isMobile,"loading-rooms":s.loadingRoomsCasted,"room-info-enabled":s.roomInfoEnabledCasted,"textarea-action-enabled":s.textareaActionEnabledCasted,"textarea-auto-focus":s.textareaAutoFocusCasted,"user-tags-enabled":s.userTagsEnabledCasted,"emojis-suggestion-enabled":s.emojisSuggestionEnabledCasted,"scroll-distance":a.scrollDistance,"accepted-files":a.acceptedFiles,"templates-text":a.templatesText,"username-options":a.usernameOptions,onToggleRoomsList:s.toggleRoomsList,onRoomInfo:s.roomInfo,onFetchMessages:s.fetchMessages,onSendMessage:s.sendMessage,onEditMessage:s.editMessage,onDeleteMessage:s.deleteMessage,onOpenFile:s.openFile,onOpenUserTag:s.openUserTag,onOpenFailedMessage:s.openFailedMessage,onMenuActionHandler:s.menuActionHandler,onMessageActionHandler:s.messageActionHandler,onMessageSelectionActionHandler:s.messageSelectionActionHandler,onSendMessageReaction:s.sendMessageReaction,onTypingMessage:s.typingMessage,onTextareaActionHandler:s.textareaActionHandler},r.createSlots({_:2},[r.renderList(e.$slots,(L,k)=>({name:k,fn:r.withCtx(f=>[r.renderSlot(e.$slots,k,r.normalizeProps(r.guardReactiveProps(f)))])}))]),1032,["current-user-id","rooms","room-id","load-first-room","messages","room-message","messages-loaded","menu-actions","message-actions","message-selection-actions","auto-scroll","show-send-icon","show-files","show-audio","audio-bit-rate","audio-sample-rate","show-emojis","show-reaction-emojis","show-new-messages-divider","show-footer","text-messages","single-room","show-rooms-list","text-formatting","link-options","is-mobile","loading-rooms","room-info-enabled","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","scroll-distance","accepted-files","templates-text","username-options","onToggleRoomsList","onRoomInfo","onFetchMessages","onSendMessage","onEditMessage","onDeleteMessage","onOpenFile","onOpenUserTag","onOpenFailedMessage","onMenuActionHandler","onMessageActionHandler","onMessageSelectionActionHandler","onSendMessageReaction","onTypingMessage","onTextareaActionHandler"])]),r.createVNode(r.Transition,{name:"vac-fade-preview",appear:""},{default:r.withCtx(()=>[m.showMediaPreview?(r.openBlock(),r.createBlock(N,{key:0,file:m.previewFile,onCloseMediaPreview:t[1]||(t[1]=L=>m.showMediaPreview=!1)},null,8,["file"])):r.createCommentVNode("",!0)]),_:1})],4)}var kf=Xe(xf,[["render",Sf],["styles",[yf]]]);const _0=r.defineCustomElement(kf);function Ef(){customElements.define("vue-advanced-chat",_0)}va.VueAdvancedChat=_0,va.register=Ef,Object.defineProperties(va,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
